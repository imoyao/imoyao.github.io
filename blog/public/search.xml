<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä¸ºä»€ä¹ˆRedisè¿™ä¹ˆå¿«ï¼Ÿ</title>
      <link href="/blog/2019-09-19/Why-redis-is-so-fast/"/>
      <url>/blog/2019-09-19/Why-redis-is-so-fast/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="å¤ªé•¿ä¸çœ‹ç‰ˆ"><a href="#å¤ªé•¿ä¸çœ‹ç‰ˆ" class="headerlink" title="å¤ªé•¿ä¸çœ‹ç‰ˆ"></a>å¤ªé•¿ä¸çœ‹ç‰ˆ</h2><ol><li><p>Redisæ˜¯åŸºäºå†…å­˜çš„è®¿é—®ï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼›</p></li><li><p>Redisæ˜¯å•çº¿ç¨‹çš„æ¨¡å‹ã€‚ä¿è¯äº†æ¯ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œçœå»äº†å¾ˆå¤šä¸Šä¸‹æ–‡åˆ‡æ¢çº¿ç¨‹çš„æ—¶é—´ä»¥åŠç«æ€è€Œäº§ç”Ÿçš„æ¶ˆè€—ï¼›</p></li><li><p>Redisä½¿ç”¨å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå¯ä»¥å¤„ç†å¹¶å‘çš„è¿æ¥ã€‚éé˜»å¡IOå†…éƒ¨å®ç°é‡‡ç”¨epollï¼Œé‡‡ç”¨äº†epoll+è‡ªå·±å®ç°çš„ç®€å•çš„äº‹ä»¶è½®è¯¢ï¼ˆevent loopï¼‰æ¡†æ¶ã€‚epollä¸­çš„è¯»ã€å†™ã€å…³é—­ã€è¿æ¥éƒ½è½¬åŒ–æˆäº†äº‹ä»¶ï¼Œç„¶ååˆ©ç”¨epollçš„å¤šè·¯å¤ç”¨ç‰¹æ€§ï¼Œç»ä¸åœ¨ioä¸Šæµªè´¹ä¸€ç‚¹æ—¶é—´ã€‚</p></li><li><p>æ•°æ®ç»“æ„ã€‚Rediså…¨ç¨‹ä½¿ç”¨hashç»“æ„ï¼Œè¯»å–é€Ÿåº¦å¿«ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå¯¹æ•°æ®å­˜å‚¨è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¦‚å‹ç¼©è¡¨ï¼Œå¯¹çŸ­æ•°æ®è¿›è¡Œå‹ç¼©å­˜å‚¨ï¼Œå†å¦‚ï¼Œè·³è¡¨ï¼Œä½¿ç”¨æœ‰åºçš„æ•°æ®ç»“æ„åŠ å¿«è¯»å–çš„é€Ÿåº¦ã€‚</p></li></ol><h2 id="ä¸ºä»€ä¹ˆRedisä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆRedisä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆRedisä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆRedisä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ</h2><p>å› ä¸ºRedisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPUä¸æ˜¯Redisçš„ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆã€‚</p><h3 id="è¯¦ç»†åŸå› "><a href="#è¯¦ç»†åŸå› " class="headerlink" title="è¯¦ç»†åŸå› "></a>è¯¦ç»†åŸå› </h3><ol><li><p>ä¸éœ€è¦å„ç§é”çš„æ€§èƒ½æ¶ˆè€—</p><p> Redisçš„æ•°æ®ç»“æ„å¹¶ä¸å…¨æ˜¯ç®€å•çš„Key-Valueï¼Œè¿˜æœ‰listï¼Œhashç­‰å¤æ‚çš„ç»“æ„ï¼Œè¿™äº›ç»“æ„æœ‰å¯èƒ½ä¼šè¿›è¡Œå¾ˆç»†ç²’åº¦çš„æ“ä½œï¼Œæ¯”å¦‚åœ¨å¾ˆé•¿çš„åˆ—è¡¨åé¢æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨hashå½“ä¸­æ·»åŠ æˆ–è€…åˆ é™¤</p><p> ä¸€ä¸ªå¯¹è±¡ã€‚è¿™äº›æ“ä½œå¯èƒ½å°±éœ€è¦åŠ éå¸¸å¤šçš„é”ï¼Œå¯¼è‡´çš„ç»“æœæ˜¯åŒæ­¥å¼€é”€å¤§å¤§å¢åŠ ã€‚</p><p> æ€»ä¹‹ï¼Œåœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå°±ä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ã€‚</p></li><li><p>å•çº¿ç¨‹å¤šè¿›ç¨‹é›†ç¾¤æ–¹æ¡ˆ</p><p> å•çº¿ç¨‹çš„å¨åŠ›å®é™…ä¸Šéå¸¸å¼ºå¤§ï¼Œæ¯æ ¸å¿ƒæ•ˆç‡ä¹Ÿéå¸¸é«˜ï¼Œå¤šçº¿ç¨‹è‡ªç„¶æ˜¯å¯ä»¥æ¯”å•çº¿ç¨‹æœ‰æ›´é«˜çš„æ€§èƒ½ä¸Šé™ï¼Œä½†æ˜¯åœ¨ä»Šå¤©çš„è®¡ç®—ç¯å¢ƒä¸­ï¼Œå³ä½¿æ˜¯å•æœºå¤šçº¿ç¨‹çš„ä¸Šé™ä¹Ÿå¾€å¾€ä¸èƒ½æ»¡è¶³éœ€è¦äº†ï¼Œéœ€è¦è¿›ä¸€æ­¥æ‘¸ç´¢çš„æ˜¯å¤šæœåŠ¡å™¨é›†ç¾¤åŒ–çš„æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆä¸­å¤šçº¿ç¨‹çš„æŠ€æœ¯ç…§æ ·æ˜¯ç”¨ä¸ä¸Šçš„ã€‚</p><p> æ‰€ä»¥å•çº¿ç¨‹ã€å¤šè¿›ç¨‹çš„é›†ç¾¤ä¸å¤±ä¸ºä¸€ä¸ªæ—¶é«¦çš„è§£å†³æ–¹æ¡ˆã€‚</p></li><li><p>CPUæ¶ˆè€—</p><p> é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUã€‚</p></li></ol><h2 id="ä½†æ˜¯å¦‚æœCPUæˆä¸ºRedisç“¶é¢ˆï¼Œæˆ–è€…ä¸æƒ³è®©æœåŠ¡å™¨å…¶ä»–CUPæ ¸é—²ç½®ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿ"><a href="#ä½†æ˜¯å¦‚æœCPUæˆä¸ºRedisç“¶é¢ˆï¼Œæˆ–è€…ä¸æƒ³è®©æœåŠ¡å™¨å…¶ä»–CUPæ ¸é—²ç½®ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="ä½†æ˜¯å¦‚æœCPUæˆä¸ºRedisç“¶é¢ˆï¼Œæˆ–è€…ä¸æƒ³è®©æœåŠ¡å™¨å…¶ä»–CUPæ ¸é—²ç½®ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿ"></a>ä½†æ˜¯å¦‚æœCPUæˆä¸ºRedisç“¶é¢ˆï¼Œæˆ–è€…ä¸æƒ³è®©æœåŠ¡å™¨å…¶ä»–CUPæ ¸é—²ç½®ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿ</h2><p>å¯ä»¥è€ƒè™‘å¤šèµ·å‡ ä¸ªRedisè¿›ç¨‹ï¼ŒRedisæ˜¯key-valueæ•°æ®åº“ï¼Œä¸æ˜¯å…³ç³»æ•°æ®åº“ï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰çº¦æŸã€‚åªè¦å®¢æˆ·ç«¯åˆ†æ¸…å“ªäº›keyæ”¾åœ¨å“ªä¸ªRedisè¿›ç¨‹ä¸Šå°±å¯ä»¥äº†ã€‚</p><h2 id="Rediså•çº¿ç¨‹çš„ä¼˜åŠ£åŠ¿"><a href="#Rediså•çº¿ç¨‹çš„ä¼˜åŠ£åŠ¿" class="headerlink" title="Rediså•çº¿ç¨‹çš„ä¼˜åŠ£åŠ¿"></a>Rediså•çº¿ç¨‹çš„ä¼˜åŠ£åŠ¿</h2><ol><li><p>å•è¿›ç¨‹å•çº¿ç¨‹ä¼˜åŠ¿</p><ul><li>ä»£ç æ›´æ¸…æ™°ï¼Œå¤„ç†é€»è¾‘æ›´ç®€å•ï¼›</li><li>ä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›</li><li>ä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€—CPUï¼› </li></ul></li><li><p>å•è¿›ç¨‹å•çº¿ç¨‹å¼Šç«¯<br> æ— æ³•å‘æŒ¥å¤šæ ¸CPUæ€§èƒ½ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡åœ¨å•æœºå¼€å¤šä¸ªRediså®ä¾‹æ¥å®Œå–„ï¼›</p></li></ol><h2 id="IOå¤šè·¯å¤ç”¨æŠ€æœ¯"><a href="#IOå¤šè·¯å¤ç”¨æŠ€æœ¯" class="headerlink" title="IOå¤šè·¯å¤ç”¨æŠ€æœ¯"></a>IOå¤šè·¯å¤ç”¨æŠ€æœ¯</h2><p>Redis é‡‡ç”¨ç½‘ç»œIOå¤šè·¯å¤ç”¨æŠ€æœ¯æ¥ä¿è¯åœ¨å¤šè¿æ¥çš„æ—¶å€™ï¼Œç³»ç»Ÿçš„é«˜ååé‡ã€‚</p><p>è¿™é‡Œâ€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚é‡‡ç”¨å¤šè·¯I/Oå¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œIOçš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼Œä¸”Redisåœ¨å†…å­˜ä¸­æ“ä½œæ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ï¼ˆå†…å­˜å†…çš„æ“ä½œä¸ä¼šæˆä¸ºè¿™é‡Œçš„æ€§èƒ½ç“¶é¢ˆï¼‰ï¼Œä¸»è¦ä»¥ä¸Šä¸¤ç‚¹é€ å°±äº†Rediså…·æœ‰å¾ˆé«˜çš„ååé‡ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://blog.csdn.net/u011663149/article/details/85307615" target="_blank" rel="noopener">Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹ã€åŠé«˜å¹¶å‘å¿«çš„å¤§åŸå› è¯¦è§£</a></li><li><a href="https://www.jianshu.com/p/3d54131ee94c" target="_blank" rel="noopener">Redis ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨Gunicorn+Gevent+Supervisor+Nginxéƒ¨ç½²Flaskåº”ç”¨</title>
      <link href="/blog/2019-08-07/how-to-deploy-flask-with-nginx-gunicorn-gevent-supervisor/"/>
      <url>/blog/2019-08-07/how-to-deploy-flask-with-nginx-gunicorn-gevent-supervisor/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="ç»„ä»¶ä»‹ç»"><a href="#ç»„ä»¶ä»‹ç»" class="headerlink" title="ç»„ä»¶ä»‹ç»"></a>ç»„ä»¶ä»‹ç»</h2><ol><li><p>Nginx: é«˜æ€§èƒ½<code>Web</code>æœåŠ¡å™¨+è´Ÿè´£åå‘ä»£ç†;</p></li><li><p>gunicorn: é«˜æ€§èƒ½WSGIæœåŠ¡å™¨;</p></li><li><p>gevent: å°†<code>Python</code>åŒæ­¥ä»£ç è½¬æ¢ä¸ºå¼‚æ­¥åè®®åº“;</p></li><li><p>supervisor: ç›‘æ§æœåŠ¡æµç¨‹çš„å·¥å…·;</p><h2 id="ç‰ˆæœ¬ä¿¡æ¯"><a href="#ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="ç‰ˆæœ¬ä¿¡æ¯"></a>ç‰ˆæœ¬ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash-4.2<span class="comment"># gunicorn --version</span></span><br><span class="line">gunicorn (version 19.9.0)</span><br></pre></td></tr></table></figure></li></ol><h2 id="å®‰è£…gunicornå’Œgevent"><a href="#å®‰è£…gunicornå’Œgevent" class="headerlink" title="å®‰è£…gunicornå’Œgevent"></a>å®‰è£…gunicornå’Œgevent</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install gunicorn</span><br><span class="line">pip install gevent</span><br></pre></td></tr></table></figure><h2 id="é…ç½®-gunicorn"><a href="#é…ç½®-gunicorn" class="headerlink" title="é…ç½® gunicorn"></a>é…ç½® gunicorn</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># gun.py</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> gevent.monkey</span><br><span class="line"></span><br><span class="line">gevent.monkey.patch_all()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'log'</span>):</span><br><span class="line">    os.mkdir(<span class="string">'log'</span>)</span><br><span class="line">debug = <span class="literal">True</span></span><br><span class="line">loglevel = <span class="string">'debug'</span></span><br><span class="line"><span class="comment"># ç»‘å®šçš„ipåŠç«¯å£å·</span></span><br><span class="line">bind = <span class="string">'0.0.0.0:5000'</span></span><br><span class="line">pidfile = <span class="string">'log/gunicorn.pid'</span></span><br><span class="line">logfile = <span class="string">'log/debug.log'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨çš„è¿›ç¨‹æ•°</span></span><br><span class="line">workers = multiprocessing.cpu_count() * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">worker_class = <span class="string">'gunicorn.workers.ggevent.GeventWorker'</span></span><br><span class="line"></span><br><span class="line">x_forwarded_for_header = <span class="string">'X-FORWARDED-FOR'</span></span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash-4.2<span class="comment"># gunicorn -k gevent -c gun.py runserver:app</span></span><br><span class="line">[2019-08-07 16:00:20 +0800] [32111] [DEBUG] Current configuration:</span><br><span class="line">  config: gun.py</span><br><span class="line">  <span class="built_in">bind</span>: [<span class="string">'0.0.0.0:5000'</span>]</span><br><span class="line">  backlog: 2048</span><br><span class="line">  workers: 3</span><br><span class="line">  worker_class: gevent</span><br><span class="line">  threads: 1</span><br><span class="line">  worker_connections: 1000</span><br><span class="line">  max_requests: 0</span><br><span class="line">  max_requests_jitter: 0</span><br><span class="line">  timeout: 30</span><br><span class="line">  graceful_timeout: 30</span><br><span class="line">  keepalive: 2</span><br><span class="line">  limit_request_line: 4094</span><br><span class="line">  limit_request_fields: 100</span><br><span class="line">  limit_request_field_size: 8190</span><br><span class="line">  reload: False</span><br><span class="line">  reload_engine: auto</span><br><span class="line">  reload_extra_files: []</span><br><span class="line">  spew: False</span><br><span class="line">  check_config: False</span><br><span class="line">  preload_app: False</span><br><span class="line">  sendfile: None</span><br><span class="line">  reuse_port: False</span><br><span class="line">  <span class="built_in">chdir</span>: /root/PMMT</span><br><span class="line">  daemon: False</span><br><span class="line">  raw_env: []</span><br><span class="line">  pidfile: <span class="built_in">log</span>/gunicorn.pid</span><br><span class="line">  worker_tmp_dir: None</span><br><span class="line">  user: 0</span><br><span class="line">  group: 0</span><br><span class="line">  <span class="built_in">umask</span>: 0</span><br><span class="line">  initgroups: False</span><br><span class="line">  tmp_upload_dir: None</span><br><span class="line">  secure_scheme_headers: &#123;<span class="string">'X-FORWARDED-PROTOCOL'</span>: <span class="string">'ssl'</span>, <span class="string">'X-FORWARDED-PROTO'</span>: <span class="string">'https'</span>, <span class="string">'X-FORWARDED-SSL'</span>: <span class="string">'on'</span>&#125;</span><br><span class="line">  forwarded_allow_ips: [<span class="string">'127.0.0.1'</span>]</span><br><span class="line">  accesslog: None</span><br><span class="line">  disable_redirect_access_to_syslog: False</span><br><span class="line">  access_log_format: %(h)s %(l)s %(u)s %(t)s <span class="string">"%(r)s"</span> %(s)s %(b)s <span class="string">"%(f)s"</span> <span class="string">"%(a)s"</span></span><br><span class="line">  errorlog: -</span><br><span class="line">  loglevel: debug</span><br><span class="line">  capture_output: False</span><br><span class="line">  logger_class: gunicorn.glogging.Logger</span><br><span class="line">  logconfig: None</span><br><span class="line">  logconfig_dict: &#123;&#125;</span><br><span class="line">  syslog_addr: udp://localhost:514</span><br><span class="line">  syslog: False</span><br><span class="line">  syslog_prefix: None</span><br><span class="line">  syslog_facility: user</span><br><span class="line">  enable_stdio_inheritance: False</span><br><span class="line">  statsd_host: None</span><br><span class="line">  statsd_prefix: </span><br><span class="line">  proc_name: None</span><br><span class="line">  default_proc_name: runserver:app</span><br><span class="line">  pythonpath: None</span><br><span class="line">  paste: None</span><br><span class="line">  on_starting: &lt;<span class="keyword">function</span> OnStarting.on_starting at 0x7fbf4cf806a8&gt;</span><br><span class="line">  on_reload: &lt;<span class="keyword">function</span> OnReload.on_reload at 0x7fbf4cf807b8&gt;</span><br><span class="line">  when_ready: &lt;<span class="keyword">function</span> WhenReady.when_ready at 0x7fbf4cf808c8&gt;</span><br><span class="line">  pre_fork: &lt;<span class="keyword">function</span> Prefork.pre_fork at 0x7fbf4cf809d8&gt;</span><br><span class="line">  post_fork: &lt;<span class="keyword">function</span> Postfork.post_fork at 0x7fbf4cf80ae8&gt;</span><br><span class="line">  post_worker_init: &lt;<span class="keyword">function</span> PostWorkerInit.post_worker_init at 0x7fbf4cf80bf8&gt;</span><br><span class="line">  worker_int: &lt;<span class="keyword">function</span> WorkerInt.worker_int at 0x7fbf4cf80d08&gt;</span><br><span class="line">  worker_abort: &lt;<span class="keyword">function</span> WorkerAbort.worker_abort at 0x7fbf4cf80e18&gt;</span><br><span class="line">  pre_exec: &lt;<span class="keyword">function</span> PreExec.pre_exec at 0x7fbf4cf80f28&gt;</span><br><span class="line">  pre_request: &lt;<span class="keyword">function</span> PreRequest.pre_request at 0x7fbf4cf960d0&gt;</span><br><span class="line">  post_request: &lt;<span class="keyword">function</span> PostRequest.post_request at 0x7fbf4cf96158&gt;</span><br><span class="line">  child_exit: &lt;<span class="keyword">function</span> ChildExit.child_exit at 0x7fbf4cf96268&gt;</span><br><span class="line">  worker_exit: &lt;<span class="keyword">function</span> WorkerExit.worker_exit at 0x7fbf4cf96378&gt;</span><br><span class="line">  nworkers_changed: &lt;<span class="keyword">function</span> NumWorkersChanged.nworkers_changed at 0x7fbf4cf96488&gt;</span><br><span class="line">  on_exit: &lt;<span class="keyword">function</span> OnExit.on_exit at 0x7fbf4cf96598&gt;</span><br><span class="line">  proxy_protocol: False</span><br><span class="line">  proxy_allow_ips: [<span class="string">'127.0.0.1'</span>]</span><br><span class="line">  keyfile: None</span><br><span class="line">  certfile: None</span><br><span class="line">  ssl_version: 2</span><br><span class="line">  cert_reqs: 0</span><br><span class="line">  ca_certs: None</span><br><span class="line">  suppress_ragged_eofs: True</span><br><span class="line">  do_handshake_on_connect: False</span><br><span class="line">  ciphers: TLSv1</span><br><span class="line">  raw_paste_global_conf: []</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32111] [INFO] Starting gunicorn 19.9.0</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32111] [DEBUG] Arbiter booted</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32111] [INFO] Listening at: http://0.0.0.0:5000 (32111)</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32111] [INFO] Using worker: gevent</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32115] [INFO] Booting worker with pid: 32115</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32116] [INFO] Booting worker with pid: 32116</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32117] [INFO] Booting worker with pid: 32117</span><br><span class="line">[2019-08-07 16:00:20 +0800] [32111] [DEBUG] 3 workers</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ­£å¸¸è®¿é—®<code>http://10.10.15.111:5000/</code>åº”è¯¥å¯ä»¥çœ‹åˆ°é¦–é¡µä¿¡æ¯æç¤ºè¡¨ç¤ºè¿æ¥æœåŠ¡æ­£å¸¸ã€‚<br><strong>æ³¨æ„</strong>ï¼šæ­¤å¤„ipå’Œç«¯å£å‡ç”±è‡ªå·±è®¾ç½®ï¼Œæ‰€ä»¥è®¿é—®æ—¶åº”è¯¥åšç›¸åº”è°ƒæ•´ã€‚<br>å¦‚æœæ— æ³•æ­£å¸¸è®¿é—®ï¼Œåˆ™éœ€è¦éªŒè¯é˜²ç«å¢™æ˜¯å¦æ­£å¸¸ï¼š  </p><ul><li><p>CentOS 7 ä»¥ä¸‹ç‰ˆæœ¬  </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢</span></span><br><span class="line">-bash-4.2<span class="comment"># iptables -nL|grep 5000</span></span><br><span class="line"><span class="comment"># å¼€æ”¾æŒ‡å®šç«¯å£</span></span><br><span class="line">-bash-4.2<span class="comment"># iptables -I INPUT -p tcp --dport 5000 -j ACCEPT</span></span><br><span class="line"><span class="comment"># å†æ¬¡æŸ¥è¯¢</span></span><br><span class="line">-bash-4.2<span class="comment"># iptables -nL|grep 5000</span></span><br><span class="line">ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:5000</span><br></pre></td></tr></table></figure></li><li><p>CentOS7<br>ä½¿ç”¨<code>firewall-cmd</code>ç®¡ç†é˜²ç«å¢™ç«¯å£</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --query-port=5000/tcp      <span class="comment"># no</span></span><br><span class="line">firewall-cmd --add-port=5000/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --query-port=5000/tcp  <span class="comment"># yes</span></span><br><span class="line">systemctl status firewall</span><br><span class="line">systemctl status firewalld</span><br><span class="line">systemctl restart firewalld</span><br></pre></td></tr></table></figure></li></ul><h2 id="å®‰è£…nginxå’Œsupervisor"><a href="#å®‰è£…nginxå’Œsupervisor" class="headerlink" title="å®‰è£…nginxå’Œsupervisor"></a>å®‰è£…nginxå’Œsupervisor</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install nginx supervisor</span><br></pre></td></tr></table></figure><h3 id="é…ç½®nginx"><a href="#é…ç½®nginx" class="headerlink" title="é…ç½®nginx"></a>é…ç½®nginx</h3><p>é»˜è®¤å®‰è£…çš„Nginxé…ç½®æ–‡ä»¶<code>/etc/nginx/nginx.conf</code>å†…æœ‰å¦‚ä¸‹é…ç½®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">include /etc/nginx/conf.d/*.conf;</span><br></pre></td></tr></table></figure><p>å³ä»å¤–éƒ¨ç›®å½•<code>/etc/nginx/conf.d/</code>æ–‡ä»¶å¤¹ä¸‹è¿˜å¼•å…¥äº†å…¶ä»–é…ç½®æ–‡ä»¶ã€‚<br>è¿™æ ·ï¼Œæˆ‘ä»¬ä¸ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œåªåœ¨<code>/etc/nginx/conf.d/</code>ç›®å½•ä¸‹å¢åŠ ä¸€ä¸ª<code>***.conf</code>ï¼Œæ¥åœ¨å¤–é¢å¢åŠ æ–°é…ç½®ã€‚</p><p>åœ¨<code>/etc/nginx/conf.d/</code>å¢åŠ <code>app.conf</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen  80;     <span class="comment"># å¦‚æœ80ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–ç«¯å£ï¼Œè®°å¾—åœ¨é˜²ç«å¢™ä¸­æ‰“å¼€ç›¸åº”ç«¯å£</span></span><br><span class="line">    server_name localhost;</span><br><span class="line">    charset utf-8;Â </span><br><span class="line">    access_log /var/pmmt/access.log;</span><br><span class="line">    error_log /var/pmmt/error.log;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 100M;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">            proxy_pass  http://0.0.0.0:5000;</span><br><span class="line">            proxy_http_version 1.1;</span><br><span class="line">            proxy_connect_timeout 300;</span><br><span class="line">            proxy_send_timeout 300;</span><br><span class="line">            proxy_read_timeout 300;</span><br><span class="line">            send_timeout 300;</span><br><span class="line">            proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">            proxy_set_header Connection <span class="string">"upgrade"</span>;</span><br><span class="line">            proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">            proxy_set_header X-Scheme <span class="variable">$scheme</span>;</span><br><span class="line">            proxy_set_header X-Forwarded-For <span class="variable">$remote_addr</span>;</span><br><span class="line">            proxy_set_header X-Forwarded-Port <span class="variable">$server_port</span>;</span><br><span class="line">            proxy_set_header X-Request-Start <span class="variable">$msec</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æœåŠ¡-1"><a href="#å¯åŠ¨æœåŠ¡-1" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure><ul><li>æŠ¥é”™<code>nginx: [emerg] getpwnam(&quot;nginx&quot;) failed in /etc/nginx/nginx.conf:5</code><br>æŸ¥çœ‹é…ç½®è¯¥è¡Œå†…å®¹ä¸º<code>user nginx;</code>ï¼Œæ·»åŠ ç”¨æˆ·<code>useradd nginx</code>ï¼›</li></ul><h3 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h3><ul><li><p>ERR_CONTENT_LENGTH_MISMATCH<br>  æŸ¥çœ‹nginxé”™è¯¯æ—¥å¿—</p>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tailf /var/<span class="built_in">log</span>/nginx/error.log</span><br><span class="line">2019/08/09 03:04:21 [crit] 24616<span class="comment">#0: *204 open() "/var/lib/nginx/tmp/proxy/2/03/0000000032" failed (13: Permission denied) while reading upstream, client: 10.10.15.199, server: localhost, request: "GET /static/js/app.1b53c809113e333c2727.js.map HTTP/1.1", upstream: "http://0.0.0.0:5000/static/js/app.1b53c809113e333c2727.js.map", host: "10.10.15.111:82"</span></span><br></pre></td></tr></table></figure><p>  å‚è€ƒè¿™é‡Œï¼š<a href="https://blog.csdn.net/mr_ooo/article/details/81068369" target="_blank" rel="noopener">ERR_CONTENT_LENGTH_MISMATCHè§£å†³æ–¹æ³•</a>      </p></li><li>è¿›å…¥é¦–é¡µå‡ºç°<code>403 Forbidden</code><ol><li>nginxå¯åŠ¨ç”¨æˆ·å’Œé…ç½®ä¸­çš„å·¥ä½œç”¨æˆ·ä¸ä¸€è‡´ï¼›</li><li>é…ç½®æ–‡ä»¶ä¸­ç¼ºå°‘index index.html index.htm index.php è¡Œï¼›</li><li>nginxç”¨æˆ·æ²¡æœ‰å“åº”å·¥ä½œç›®å½•çš„æ“ä½œæƒé™ï¼ˆ<code>chown -R nginx:nginx WORK_DIR_PATH</code>ï¼‰ï¼›</li><li>é˜²ç«å¢™è®¾ç½®ã€‚<br>å‚è€ƒè¿™é‡Œï¼š<a href="https://blog.csdn.net/onlysunnyboy/article/details/75270533" target="_blank" rel="noopener">è§£å†³Nginxå‡ºç°403 forbidden (13: Permission denied)æŠ¥é”™çš„å››ç§æ–¹æ³•</a></li></ol></li></ul><h2 id="é…ç½®Supervisor"><a href="#é…ç½®Supervisor" class="headerlink" title="é…ç½®Supervisor"></a>é…ç½®Supervisor</h2><p>é¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬é…ç½®æ–‡ä»¶çš„è·¯å¾„æ˜¯<code>/etc/supervisord.conf</code>ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤æ¥ç”Ÿæˆï¼š<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p><p>é…ç½®æ–‡ä»¶çš„å†…å®¹å¾ˆå¤šï¼Œé¡¹ç›®é…ç½®å¯ä»¥å‚ç…§<a href="http://www.supervisord.org/introduction.html" target="_blank" rel="noopener">å®˜ç½‘æ–‡æ¡£</a></p><p>æ‰“å¼€é…ç½®æ–‡ä»¶çš„æœ€åä¸€è¡Œ<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">;[include]</span><br><span class="line">;files = /etc/supervisord/*.conf    <span class="comment"># æ³¨æ„ï¼šæœ¬äººå®‰è£…ç‰ˆæœ¬ä¸ºiniæ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå†™çš„é…ç½®ä¹Ÿåº”è¯¥è°ƒæ•´ä¸ºç›¸åº”çš„.iniæ ¼å¼[include] \n files = supervisord.d/*.ini</span></span><br></pre></td></tr></table></figure></p><p>é»˜è®¤ä¸€èˆ¬æ˜¯æ³¨é‡Šæ‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆæ³¨é‡Šï¼Œè¿™è¡Œé…ç½®çš„ä½œç”¨ä¹Ÿå¾ˆæµ…æ˜¾ï¼Œå°±æ˜¯å¯¼å…¥è®¾ç½®çš„è·¯å¾„ä¸‹çš„æ‰€æœ‰<code>conf</code>æ–‡ä»¶ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¦‚æœæœ‰å¤šä¸ªé¡¹ç›®å¯ä»¥ä¸ç”¨éƒ½å†™åœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œï¼Œå¯ä»¥ä¸€ä¸ªé¡¹ç›®ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ›´é€‚åˆç®¡ç†ã€‚è¿™é‡Œçš„è·¯å¾„ä¹Ÿæ˜¯å¯ä»¥æŒ‰ç…§å®é™…éœ€æ±‚éšæ„æ›´æ”¹ã€‚<br>æ‰‹åŠ¨å¯åŠ¨Supervisord<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure></p><p>åœ¨è®¾ç½®çš„è·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘½ä»¤è¯·æ ¹æ®ä¸Šä¸€æ­¥è®¾ç½®çš„æ‰©å±•åã€‚<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[program:project_name]</span><br><span class="line"><span class="built_in">command</span>=/usr/bin/gunicorn -c gun.py runserver:app       <span class="comment"># å…·ä½“è·¯å¾„æ ¹æ®è‡ªå·±å®‰è£…æˆ–è€…è™šæ‹Ÿç¯å¢ƒä¸­çš„ä½ç½®è¿›è¡Œé…ç½®</span></span><br><span class="line">directory=/project_path/        <span class="comment"># é¡¹ç›®è·¯å¾„</span></span><br><span class="line">startsecs=0</span><br><span class="line">stopwaitsecs=0</span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p><code>project_name</code>æŒ‰ç…§ä½ çš„å®é™…éœ€æ±‚ä¿®æ”¹ï¼Œä½œä¸ºä½ è¿™ä¸ªæœåŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºå¯åŠ¨åœæ­¢æœåŠ¡æ—¶ä½¿ç”¨ã€‚<br><code>command</code>ä¿®æ”¹ä¸ºæµ‹è¯•<code>gunicorn</code>æ—¶ä½¿ç”¨çš„å‘½ä»¤ï¼Œå»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚<br><code>directory</code>æŒ‡å®šäº†å·¥ä½œè·¯å¾„ï¼Œé€šå¸¸è®¾ç½®ä¸ºé¡¹ç›®æ ¹ç›®å½•ï¼Œæˆ‘ä»¬å¡«å†™çš„gun.pyå’Œappéƒ½æ˜¯åŸºäºè¿™ä¸ªè·¯å¾„çš„ã€‚</p><p>ç®¡ç†<code>Supervisor</code>çš„é¡¹ç›®æ˜¯ä½¿ç”¨<code>supervisorctl</code>å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨é¡¹ç›®è¯•è¯•çœ‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">supervisorctl start PROJECT_NAME</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œåº”è¯¥å¯ä»¥å’Œä¸Šä¸€æ­¥æµ‹è¯•<code>gunicorn</code>ä¸€æ ·å¯ä»¥æ­£å¸¸è®¿é—®é¡¹ç›®äº†ã€‚<br>éªŒè¯<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash-4.2<span class="comment"># supervisorctl</span></span><br><span class="line">app                              RUNNING   pid 24639, uptime 0:20:55</span><br></pre></td></tr></table></figure></p><h3 id="æŠ¥é”™è®°å½•"><a href="#æŠ¥é”™è®°å½•" class="headerlink" title="æŠ¥é”™è®°å½•"></a>æŠ¥é”™è®°å½•</h3><ul><li>Error: Another program is already listening on a port that one of our HTTP servers is configured to use.  Shut this program down first before starting supervisord. For help, use /usr/bin/supervisord -h  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥æŸ¥çœ‹supervisor.sockå¹¶åˆ é™¤ </span></span><br><span class="line">-bash-4.2<span class="comment"># find / -name supervisor.sock </span></span><br><span class="line">/run/supervisor/supervisor.sock</span><br><span class="line">-bash-4.2<span class="comment"># unlink /run/supervisor/supervisor.sock</span></span><br></pre></td></tr></table></figure></li></ul><p>å†æ¬¡é‡æ–°å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash-4.2<span class="comment"># supervisord -c /etc/supervisord.conf</span></span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><ol><li><a href="https://programmer.help/blogs/5c13afa73d10a.html" target="_blank" rel="noopener">Huawei Cloud Centos7 Flask+Gunicorn+Gevent+Supervisor+Nginx Multi-site Production Environment Deployment</a></li><li><a href="https://www.jianshu.com/p/192e62a5cdd2" target="_blank" rel="noopener">Flask + Nginx + Gunicorn + Geventéƒ¨ç½²</a></li><li><a href="https://www.jianshu.com/p/65fae00615b9" target="_blank" rel="noopener">gunicorn+gevent+nginxéƒ¨ç½²flaskåº”ç”¨</a></li><li><a href="https://blog.csdn.net/spark_csdn/article/details/80790929" target="_blank" rel="noopener">CentOS ä¸Š Flask + uWSGI + Nginx éƒ¨ç½²</a></li><li><a href="https://www.zhihu.com/question/38528616" target="_blank" rel="noopener">Nginxã€Gunicornåœ¨æœåŠ¡å™¨ä¸­åˆ†åˆ«èµ·ä»€ä¹ˆä½œç”¨</a></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Flask </tag>
            
            <tag> Nginx </tag>
            
            <tag> éƒ¨ç½² </tag>
            
            <tag> Webå¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python3 æŠ¥é”™&quot;TypeError:a-bytes-like-object-is-required,not-&#39;str&#39;&quot;è§£å†³åŠæ³•</title>
      <link href="/blog/2019-07-11/a-bytes-like-object-is-required-not-str-python3/"/>
      <url>/blog/2019-07-11/a-bytes-like-object-is-required-not-str-python3/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©åœ¨è§£æä¸€ä¸ªå·¥å…·è¾“å‡ºé—®é¢˜æ—¶é‡åˆ°è¿™ä¸¤ä¸ªç¼–ç é”™è¯¯ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><ul><li>TypeError: a bytes-like object is required, not â€˜strâ€™</li><li>UnicodeDecodeError: â€˜utf-8â€™ codec canâ€™t decode byte 0xb3 in position 38: invalid start byte<a id="more"></a></li></ul><h2 id="å…ˆä¸Šä»£ç "><a href="#å…ˆä¸Šä»£ç " class="headerlink" title="å…ˆä¸Šä»£ç "></a>å…ˆä¸Šä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExecCommandError</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExecCommand</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cust_popen_list</span><span class="params">(cmdlist, close_fds=True)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        subprocess.callåªæ¥å—æ•°ç»„å˜é‡ä½œä¸ºå‘½ä»¤ï¼Œå¹¶å°†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºå‘½ä»¤ï¼Œå‰©ä¸‹çš„å…¨éƒ¨ä½œä¸ºè¯¥å‘½ä»¤çš„å‚æ•°ã€‚</span></span><br><span class="line"><span class="string">        :param cmdlist:</span></span><br><span class="line"><span class="string">        :param close_fds:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        lastcmdlist = list()</span><br><span class="line">        lastcmdlist.extend(cmdlist)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            proc = subprocess.Popen(lastcmdlist, shell=<span class="literal">False</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE,</span><br><span class="line">                                    close_fds=close_fds)</span><br><span class="line">            retcode = proc.wait()</span><br><span class="line">            <span class="keyword">return</span> retcode, proc</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> (ExecCommandError, e)</span><br><span class="line">            </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HwMaker</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.retcode = <span class="number">1</span></span><br><span class="line">        self.proc = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exec_command</span><span class="params">(cmd_list=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        è°ƒç”¨æ‰§è¡Œå‘½ä»¤çš„ç¨‹åº</span></span><br><span class="line"><span class="string">        :param cmd_list: list,</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">assert</span> cmd_list</span><br><span class="line">        cmd = ExecCommand()</span><br><span class="line">        <span class="keyword">return</span> cmd.cust_popen_list(cmd_list)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_label</span><span class="params">(label)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å¦‚æœä»¥ç©ºæ ¼åˆ†å‰²ï¼Œåˆ™æ›¿æ¢ä¸º with_under_case,æœ€åè°ƒç”¨lower()è¿”å›lower_with_under_case</span></span><br><span class="line"><span class="string">        :param label:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        split_label = label.split()</span><br><span class="line">        label = <span class="string">'_'</span>.join([span.lower() <span class="keyword">for</span> span <span class="keyword">in</span> split_label]) <span class="keyword">if</span> len(split_label) &gt; <span class="number">1</span> <span class="keyword">else</span> label.lower()</span><br><span class="line">        <span class="keyword">return</span> label</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SensorMaker</span><span class="params">(HwMaker)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">secs2hours</span><span class="params">(secs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ç§’è½¬åŒ–ä¸ºå°æ—¶</span></span><br><span class="line"><span class="string">        :param secs:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        mm, ss = divmod(secs, <span class="number">60</span>)</span><br><span class="line">        hh, mm = divmod(mm, <span class="number">60</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"%d:%02d:%02d"</span> % (hh, mm, ss)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_vertical_line</span><span class="params">(self, parser_data)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ä»¥â€œ|â€ åˆ†å‰²ä¹‹åè·å–æœ‰ç”¨ä¿¡æ¯</span></span><br><span class="line"><span class="string">        :param parser_data:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        _expect_info = dict()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> parser_data:</span><br><span class="line">            strip_line = line.strip().decode(<span class="string">'utf-8'</span>, <span class="string">"ignore"</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'|'</span> <span class="keyword">in</span> strip_line:</span><br><span class="line">                item, value = [item.strip() <span class="keyword">for</span> item <span class="keyword">in</span> strip_line.split(<span class="string">'|'</span>)]</span><br><span class="line">                lower_label = self.make_label(item)</span><br><span class="line">                _expect_info[lower_label] = value</span><br><span class="line">        <span class="keyword">return</span> _expect_info</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ipmi_pminfo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         [SlaveAddress = B2h] [Module 2]</span></span><br><span class="line"><span class="string">         Item                           |                Value</span></span><br><span class="line"><span class="string">         ----                           |                -----</span></span><br><span class="line"><span class="string">         Status                         |     [STATUS OK](00h)</span></span><br><span class="line"><span class="string">         AC Input Voltage               |              237.0 V</span></span><br><span class="line"><span class="string">         AC Input Current               |               0.36 A</span></span><br><span class="line"><span class="string">         DC 12V Output Voltage          |              12.04 V</span></span><br><span class="line"><span class="string">         DC 12V Output Current          |               5.07 A</span></span><br><span class="line"><span class="string">         Temperature 1                  |              34C/94F</span></span><br><span class="line"><span class="string">         Temperature 2                  |              37C/98F</span></span><br><span class="line"><span class="string">         Fan 1                          |             5400 RPM</span></span><br><span class="line"><span class="string">         Fan 2                          |              985 RPM</span></span><br><span class="line"><span class="string">         DC 12V Output Power            |                 61 W</span></span><br><span class="line"><span class="string">         AC Input Power                 |                 78 W</span></span><br><span class="line"><span class="string">         PMBus Revision                 |               0xD222</span></span><br><span class="line"><span class="string">         PWS Serial Number              |      Â³Â³Â³Â³Â³Â³Â³UÂ³Â³Â³Â³Â³Â³Â³</span></span><br><span class="line"><span class="string">         PWS Module Number              |         Â³Â³Â³Â³Â³Â³Â³Â³Â³Â³Â³Â³</span></span><br><span class="line"><span class="string">         PWS Revision                   |               Â³Â³Â³Â³Â³Â³</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         out: &#123;'status': '[STATUS OK](00h)',</span></span><br><span class="line"><span class="string">             'ac_input_voltage': '237.0 V',</span></span><br><span class="line"><span class="string">             'ac_input_current': '0.39 A',</span></span><br><span class="line"><span class="string">             'dc_12v_output_voltage': '12.04 V',</span></span><br><span class="line"><span class="string">             'dc_12v_output_current': '5.19 A',</span></span><br><span class="line"><span class="string">             'temperature_1': '34C/94F',</span></span><br><span class="line"><span class="string">             'temperature_2': '37C/98F',</span></span><br><span class="line"><span class="string">             'fan_1': '5424 RPM',</span></span><br><span class="line"><span class="string">             'fan_2': '985 RPM',</span></span><br><span class="line"><span class="string">             'dc_12v_output_power': '63 W',</span></span><br><span class="line"><span class="string">             'ac_input_power': '71 W',</span></span><br><span class="line"><span class="string">             'pmbus_revision': '0xD222',</span></span><br><span class="line"><span class="string">             'pws_serial_number': 'U',</span></span><br><span class="line"><span class="string">             'pws_module_number': '',</span></span><br><span class="line"><span class="string">             'pws_revision': ''&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        _pm_info = &#123;&#125;</span><br><span class="line">        _cmd = [<span class="string">'ipmicfg'</span>, <span class="string">'-pminfo'</span>]</span><br><span class="line">        self.retcode, self.proc = self.exec_command(_cmd)</span><br><span class="line">        <span class="keyword">if</span> self.retcode == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># æˆªå–æœ‰ç”¨è¡Œï¼ˆæ’é™¤å‰ä¸‰è¡Œï¼‰</span></span><br><span class="line">            out_data = self.out_data()</span><br><span class="line">            <span class="keyword">if</span> out_data:</span><br><span class="line">                _pm_info = self.parse_vertical_line(out_data[<span class="number">3</span>:])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> _pm_info</span><br></pre></td></tr></table></figure><h2 id="åŸå› è§£é‡ŠåŠè§£å†³æ–¹æ¡ˆ"><a href="#åŸå› è§£é‡ŠåŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="åŸå› è§£é‡ŠåŠè§£å†³æ–¹æ¡ˆ"></a>åŸå› è§£é‡ŠåŠè§£å†³æ–¹æ¡ˆ</h2><p>å…³äº<code>TypeError: a bytes-like object is required, not &#39;str&#39;</code>é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å¤ç°ä¸€ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">16</span>]: a = <span class="string">b'123|456'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: a.split(<span class="string">'|'</span>)                                                                                         </span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-17</span>-d4229c89bf5f&gt; <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">----&gt; 1 a.split('|')</span><br><span class="line"></span><br><span class="line">TypeError: a bytes-like object <span class="keyword">is</span> required, <span class="keyword">not</span> <span class="string">'str'</span></span><br></pre></td></tr></table></figure></p><hr><h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">20</span>]: a = <span class="string">b'123|456'</span>                                                                                        </span><br><span class="line">In [<span class="number">21</span>]: a.decode(<span class="string">'utf-8'</span>).split(<span class="string">'|'</span>)                                                                         </span><br><span class="line">Out[<span class="number">21</span>]: [<span class="string">'123'</span>, <span class="string">'456'</span>]</span><br></pre></td></tr></table></figure><p>å…³äºé—®é¢˜<code>UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0xb3 in position 38: invalid start byte</code>ï¼Œä¸»è¦æ˜¯å› ä¸ºç»“æœä¸­æœ‰<code>Â³Â³Â³Â³Â³Â³Â³UÂ³Â³Â³Â³Â³Â³Â³</code>,è¿™ä¸ªæ²¡æœ‰åŠæ³•æŒ‰ç…§<code>utf-8</code>è§£ç ã€‚<br>å‡ºç°å¼‚å¸¸æŠ¥é”™æ˜¯ç”±äºè®¾ç½®äº†<code>decode()</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°<code>errors</code>ä¸ºä¸¥æ ¼ï¼ˆ<code>strict</code>ï¼‰å½¢å¼é€ æˆçš„ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯è¿™ä¸ªå‚æ•°ï¼Œå°†å…¶æ›´æ”¹ä¸º<code>ignore</code>å³å¯ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://blog.csdn.net/wang7807564/article/details/78164855/" target="_blank" rel="noopener">Python3è§£å†³UnicodeDecodeError: â€˜utf-8â€™ codec canâ€™t decode byte..é—®é¢˜ ç»ˆæè§£å†³æ–¹æ¡ˆ</a></li><li><a href="https://stackoverflow.com/questions/33054527/typeerror-a-bytes-like-object-is-required-not-str-when-writing-to-a-file-in" target="_blank" rel="noopener">TypeError: a bytes-like object is required, not â€˜strâ€™ when writing to a file in Python3</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Python3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨ Vue ä¸­å®ç°æ˜¾ç¤ºå…¨éƒ¨çš„åŠŸèƒ½ï¼Ÿ</title>
      <link href="/blog/2019-07-05/how-to-make-show-all-with-Vue/"/>
      <url>/blog/2019-07-05/how-to-make-show-all-with-Vue/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="åŠŸèƒ½åˆ†æ"><a href="#åŠŸèƒ½åˆ†æ" class="headerlink" title="åŠŸèƒ½åˆ†æ"></a>åŠŸèƒ½åˆ†æ</h2><p>æˆ‘ä»¬å¯ä»¥ç®€å•åˆ†æä¸€ä¸‹åŠŸèƒ½å®ç°ï¼š</p><ol><li>æ˜¾ç¤ºå†…å®¹æ˜¯ä»åå°ä¸€æ¬¡æ€§è·å–åˆ°çš„ï¼Œä¸å­˜åœ¨ç‚¹å‡»â€œé˜…è¯»æ›´å¤šâ€å†å»è¯·æ±‚ä¸€æ¬¡åå°è·å–å‰©ä½™æ•°æ®çš„å¯èƒ½ï¼›</li><li>é€šè¿‡ç¬¬ä¸€æ­¥å…¶å®å¯ä»¥å¾—å‡ºï¼Œç½‘ç«™æ˜¯é€šè¿‡æ§åˆ¶æ˜¾ç¤ºå…ƒç´ çš„é«˜åº¦æ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œè€Œéæ§åˆ¶å†…å®¹çš„è·å–ï¼›</li><li>å¯ä»¥çœ‹åˆ°â€œé˜…è¯»æ›´å¤šâ€æŒ‰é’®ä¸Šæœ‰ä¸€å±‚æ¸å˜é®ç½©å±‚ï¼Œç½‘ç«™é€šè¿‡è¿™ä¸€é®ç½©æŒ¡ä½å‰©ä½™å†…å®¹ã€‚</li></ol><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;div v-for=&quot;(item, key) in testItems&quot; v-show=&quot;key&lt;limitShowNum&quot;&gt;</span><br><span class="line">      &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;el-button @click=&quot;showMore&quot; type=&quot;text&quot; style=&quot;color:#79bbff;&quot;&gt;&#123;&#123;showAllTip&#125;&#125;&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/element-ui/lib/theme-chalk/index.css&quot;&gt;</span><br><span class="line">&lt;!-- å¼•å…¥ç»„ä»¶åº“ --&gt;</span><br><span class="line">&lt;script src=&quot;https://unpkg.com/element-ui/lib/index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;https://unpkg.com/vue&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    var app = new Vue(&#123;</span><br><span class="line">      el: &apos;#app&apos;,</span><br><span class="line">      data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">          testItems: [&apos;æµ·å®¢è°ˆç€›æ´²ï¼ŒçƒŸæ¶›å¾®èŒ«ä¿¡éš¾æ±‚ï¼›&apos;, &apos;è¶Šäººè¯­å¤©å§¥ï¼Œäº‘éœæ˜ç­æˆ–å¯ç¹ã€‚&apos;, &apos;å¤©å§¥è¿å¤©å‘å¤©æ¨ªï¼ŒåŠ¿æ‹”äº”å²³æ©èµ¤åŸã€‚&apos;, &apos;å¤©å°å››ä¸‡å…«åƒä¸ˆï¼Œå¯¹æ­¤æ¬²å€’ä¸œå—å€¾ã€‚&apos;, &apos;æˆ‘æ¬²å› ä¹‹æ¢¦å´è¶Šï¼Œä¸€å¤œé£åº¦é•œæ¹–æœˆã€‚&apos;, &apos;æ¹–æœˆç…§æˆ‘å½±ï¼Œé€æˆ‘è‡³å‰¡æºªã€‚&apos;, &apos;è°¢å…¬å®¿å¤„ä»Šå°šåœ¨ï¼Œæ¸Œæ°´è¡æ¼¾æ¸…çŒ¿å•¼ã€‚&apos;, &apos;è„šè‘—è°¢å…¬å±ï¼Œèº«ç™»é’äº‘æ¢¯ã€‚&apos;, &apos;åŠå£è§æµ·æ—¥ï¼Œç©ºä¸­é—»å¤©é¸¡ã€‚&apos;, &apos;åƒå²©ä¸‡è½¬è·¯ä¸å®šï¼Œè¿·èŠ±å€šçŸ³å¿½å·²æšã€‚&apos;, &apos;ç†Šå’†é¾™åŸæ®·å²©æ³‰ï¼Œæ —æ·±æ—å…®æƒŠå±‚å·…ã€‚&apos;, &apos;äº‘é’é’å…®æ¬²é›¨ï¼Œæ°´æ¾¹æ¾¹å…®ç”ŸçƒŸã€‚&apos;, &apos;åˆ—ç¼ºéœ¹é›³ï¼Œä¸˜å³¦å´©æ‘§ã€‚&apos;, &apos;æ´å¤©çŸ³æ‰‰ï¼Œè¨‡ç„¶ä¸­å¼€ã€‚&apos;, &apos;é’å†¥æµ©è¡ä¸è§åº•ï¼Œæ—¥æœˆç…§è€€é‡‘é“¶å°ã€‚&apos;, &apos;éœ“ä¸ºè¡£å…®é£ä¸ºé©¬ï¼Œäº‘ä¹‹å›å…®çº·çº·è€Œæ¥ä¸‹ã€‚&apos;, &apos;è™é¼“ç‘Ÿå…®é¸¾å›è½¦ï¼Œä»™ä¹‹äººå…®åˆ—å¦‚éº»ã€‚&apos;, &apos;å¿½é­‚æ‚¸ä»¥é­„åŠ¨ï¼ŒææƒŠèµ·è€Œé•¿å—Ÿã€‚&apos;, &apos;æƒŸè§‰æ—¶ä¹‹æ•å¸­ï¼Œå¤±å‘æ¥ä¹‹çƒŸéœã€‚&apos;, &apos;ä¸–é—´è¡Œä¹äº¦å¦‚æ­¤ï¼Œå¤æ¥ä¸‡äº‹ä¸œæµæ°´ã€‚&apos;, &apos;åˆ«å›å»å…®ä½•æ—¶è¿˜ï¼Ÿä¸”æ”¾ç™½é¹¿é’å´–é—´ã€‚é¡»è¡Œå³éª‘è®¿åå±±ã€‚&apos;, &apos;å®‰èƒ½æ‘§çœ‰æŠ˜è…°äº‹æƒè´µï¼Œä½¿æˆ‘ä¸å¾—å¼€å¿ƒé¢œï¼&apos;],</span><br><span class="line">          isShow: true,</span><br><span class="line">  showAllTip: &apos;æˆ‘å…¨éƒ½è¦ ğŸ˜œ&apos;,</span><br><span class="line">  limitShowNum: 5,</span><br><span class="line">      defaultShowNum:5</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        // åŠŸèƒ½å®ç°</span><br><span class="line">        showMore()&#123;</span><br><span class="line">let showDataLen = this.testItems.length</span><br><span class="line">this.isShow = !this.isShow;</span><br><span class="line">this.limitShowNum = this.isShow? this.defaultShowNum: showDataLen;</span><br><span class="line">this.showAllTip = this.isShow?&apos;æˆ‘å…¨éƒ½è¦ ğŸ˜œ&apos;:&apos;æ”¶èµ·&apos;</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="åŠŸèƒ½æ¼”ç¤º"><a href="#åŠŸèƒ½æ¼”ç¤º" class="headerlink" title="åŠŸèƒ½æ¼”ç¤º"></a>åŠŸèƒ½æ¼”ç¤º</h2><p>æ­¤å¤„æ˜¾ç¤ºä¸ç›´æ¥ä»£ç è¿è¡Œæ•ˆæœä¸ä¸€æ ·ï¼Œä¸»è¦æ˜¯å› ä¸ºæ ·å¼ä»¥åŠæ·»åŠ iæ ‡ç­¾å›¾æ ‡ç­‰å¯¼è‡´ï¼›æ ·å¼ä¸ä¼šå†™çš„è¯å¯ä»¥å‚è€ƒ<code>element-ui</code>å®˜æ–¹æ–‡æ¡£çš„å®ç°ã€‚</p><p><img src="/images/show_all_example.gif" alt="æ˜¾ç¤ºå…¨éƒ¨ä¸æŠ˜å "></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://blog.csdn.net/XuM222222/article/details/80189355" target="_blank" rel="noopener">åˆ©ç”¨vueå®ç°â€œæ˜¾ç¤ºæ›´å¤šâ€åŠŸèƒ½</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Vue </tag>
            
            <tag> element-ui </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flask-sqlalchemyä¸­çš„å¤šå¯¹å¤šå…³ç³»æ¨¡å‹é—®é¢˜è®°å½•</title>
      <link href="/blog/2019-07-03/flask-sqlalchemy-many-to-many/"/>
      <url>/blog/2019-07-03/flask-sqlalchemy-many-to-many/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can<span class="string">'t proceed with initialization of other mappers. Triggering mapper: '</span>mapped class Article-&gt;iy_article<span class="string">'. Original exception was: Error creating backref '</span>articles<span class="string">' on relationship '</span>Article.tags<span class="string">': property of that name exists on mapper '</span>mapped class Tag-&gt;iy_tag<span class="string">'</span></span><br></pre></td></tr></table></figure><p>å‡ºç°è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºä¸¤ä¸ªå…³ç³»è¡¨ä¸­äº’ç›¸å®šä¹‰ï¼Œæ„æ€æ˜¯ä½ çš„ä»£ç ä¸­å¯èƒ½åŒæ—¶åŒ…å«ä¸‹é¢çš„è¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># class Article:</span></span><br><span class="line"></span><br><span class="line">tags = db.relationship(<span class="string">'Tag'</span>, secondary=posts_tags_table, backref=db.backref(<span class="string">'articles'</span>, lazy=<span class="string">'dynamic'</span>),</span><br><span class="line">                               lazy=<span class="string">"dynamic"</span>)</span><br><span class="line"><span class="comment"># Class Tag:                            </span></span><br><span class="line">articles = db.relationship(<span class="string">'Article'</span>, secondary=posts_tags_table,</span><br><span class="line">    <span class="comment">#                            back_populates='tags')</span></span><br></pre></td></tr></table></figure><h3 id="è§£é‡Šï¼š"><a href="#è§£é‡Šï¼š" class="headerlink" title="è§£é‡Šï¼š"></a>è§£é‡Šï¼š</h3><p>å½“æ‚¨ä½¿ç”¨<code>backref</code>æ—¶ï¼Œ<code>SQLAlchemy</code>ä¼šè‡ªåŠ¨åˆ›å»ºå‘åå…³è”ï¼Œå› æ­¤å®ƒï¼ˆbackrefï¼‰<strong>åªåº”è¯¥</strong>åœ¨å…³ç³»çš„ä¸€ä¾§ä½¿ç”¨ã€‚æ‰€ä»¥åº”è¯¥åˆ é™¤ä¸Šé¢å…¶ä¸­çš„ä¸€å¥å®šä¹‰ã€‚</p><p>å‚è§è¿™é‡Œ<br><a href="https://stackoverflow.com/questions/39869793/when-do-i-need-to-use-sqlalchemy-back-populates" target="_blank" rel="noopener">when-do-i-need-to-use-sqlalchemy-back-populates</a></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlalchemy.orm.exc.StaleDataError: DELETE statement on table <span class="string">'iy_post_tags'</span> expected to delete 4 row(s); Only 24 were matched.</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†è¿‡ç¨‹"><a href="#å¤„ç†è¿‡ç¨‹" class="headerlink" title="å¤„ç†è¿‡ç¨‹"></a>å¤„ç†è¿‡ç¨‹</h3><p>å‡ºç°è¿™ä¸ªé—®é¢˜åŸå› æ˜¯åœ¨å¤šå¯¹å¤šå…³ç³»çš„å…³è”è¡¨ä¸­ï¼Œå‡ºç°äº†é‡å¤æ•°æ®ã€‚<br>ä¹¦ä¸Šè¯´â€œå°†æŸä¸ªBookçš„Writerå±æ€§è®¾ç½®ä¸ºNone,å°±ä¼šè§£é™¤ä¸Writerå¯¹è±¡çš„å…³ç³»ã€‚â€<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">post_obj = Article.query.filter(Article.post_id == post_id).one()</span><br><span class="line"><span class="keyword">if</span> post_obj:</span><br><span class="line">    body_id = post_obj.body_id</span><br><span class="line">    post_obj.tags = <span class="literal">None</span></span><br><span class="line">    db.session.commit()</span><br></pre></td></tr></table></figure></p><p>å¤±è´¥ï¼ï¼ï¼</p><p>å†æ¬¡å‚è€ƒ<a href="https://seagullbird.xyz/posts/how-to-delete-many-to-many-in-sqlalchemy/" target="_blank" rel="noopener">How to delete a Many-to-Many relationship in Flask-SQLAlchemy</a><br>ä½œè€…æåˆ°å¯èƒ½æ˜¯å› ä¸ºå¯¹æ•°æ®æ‰‹åŠ¨å¤„ç†çš„é—®é¢˜ã€‚<br>éªŒè¯æ•°æ®è¡¨ä¸­æ˜¯å¦å­˜åœ¨é‡å¤æ•°æ®ï¼š<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; delete from iy_post_tags where post_id=26;</span><br><span class="line">Query OK, 2 rows affected (0.22 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from iy_post_tags;</span><br><span class="line">+<span class="comment">---------+--------+</span></span><br><span class="line">| post_id | tag_id |</span><br><span class="line">+<span class="comment">---------+--------+</span></span><br><span class="line">|      20 |      7 |</span><br><span class="line">|      21 |      7 |</span><br><span class="line">|      22 |      7 |</span><br><span class="line">|      23 |      7 |</span><br><span class="line">|      24 |      7 |</span><br><span class="line">|      24 |      7 |</span><br><span class="line">|      20 |      7 |</span><br><span class="line">|      25 |      7 |</span><br><span class="line">|      27 |      7 |    <span class="comment">-- æ³¨æ„è¿™ä¸¤è¡Œï¼Œè¡¨ä¸­å‡ºç°åŒä¸€ç¯‡æ–‡ç« ï¼Œæ ‡ç­¾ç›¸åŒè®°å½•ä¸¤æ¬¡çš„æƒ…å†µï¼Œæ­¤æ—¶åˆ é™¤æ“ä½œå°±ä¼šæŠ¥é”™</span></span><br><span class="line">|      27 |      7 |</span><br><span class="line">+<span class="comment">---------+--------+</span></span><br></pre></td></tr></table></figure></p><p>çš„ç¡®å­˜åœ¨ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ é™¤ã€‚</p><h3 id="åˆ©ç”¨ä»£ç é™åˆ¶æ°¸ä¹…è§£å†³"><a href="#åˆ©ç”¨ä»£ç é™åˆ¶æ°¸ä¹…è§£å†³" class="headerlink" title="åˆ©ç”¨ä»£ç é™åˆ¶æ°¸ä¹…è§£å†³"></a>åˆ©ç”¨ä»£ç é™åˆ¶æ°¸ä¹…è§£å†³</h3><p>è¿˜æœ‰<a href="https://stackoverflow.com/questions/36002638/how-to-fix-sqlalchemy-sawarning-delete-statement-on-table-expected-to-delete-1" target="_blank" rel="noopener">è¿™é‡Œ</a><br>ä¿®æ”¹è¡¨ç»“æ„ï¼Œè§£é™¤ç¡®è®¤åˆ é™¤ã€‚</p><p>åˆ©ç”¨ä¸»é”®å”¯ä¸€çº¦æŸï¼Œåœ¨åˆ›å»ºä¸­é—´è¡¨çš„æ—¶å€™è¿›è¡Œé™åˆ¶<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ï¼š primary_key=True</span></span><br><span class="line">article_tag_rel = sa.Table(<span class="string">'article_tag_rel'</span>, Base.metadata,</span><br><span class="line">    sa.Column(<span class="string">'tag_id'</span>, sa.Integer, ForeignKey(<span class="string">'tag.id'</span>), primary_key=<span class="literal">True</span>),</span><br><span class="line">    sa.Column(<span class="string">'article_id'</span>, sa.Integer, ForeignKey(<span class="string">'article.id'</span>), primary_key=<span class="literal">True</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>å‚è§<a href="https://github.com/kvesteri/sqlalchemy-continuum/issues/65" target="_blank" rel="noopener">è¿™é‡Œ</a><br>è¿˜æœ‰<a href="https://stackoverflow.com/questions/36002638/how-to-fix-sqlalchemy-sawarning-delete-statement-on-table-expected-to-delete-1" target="_blank" rel="noopener">è¿™é‡Œ</a>æ˜¯ä¿®æ”¹è¡¨ç»“æ„<br><a href="https://stackoverflow.com/questions/41941273/deleting-from-a-sqlalchemy-many-to-many-matches-the-wrong-number-of-rows" target="_blank" rel="noopener">è¿™é‡Œ</a><br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸Šé¢çš„ä¸€ç§ç®€ä¾¿å†™æ³•</span></span><br><span class="line"><span class="keyword">import</span> db</span><br><span class="line">posts_tags_table = db.Table(<span class="string">'iy_post_tags'</span>, db.Model.metadata,</span><br><span class="line">                            db.Column(<span class="string">'post_id'</span>, db.Integer, db.ForeignKey(<span class="string">'iy_article.post_id'</span>)),</span><br><span class="line">                            db.Column(<span class="string">'tag_id'</span>, db.Integer, db.ForeignKey(<span class="string">'iy_tag.id'</span>)),</span><br><span class="line">                            db.PrimaryKeyConstraint(<span class="string">'tag_id'</span>, <span class="string">'post_id'</span>)</span><br><span class="line">                            )</span><br></pre></td></tr></table></figure></p><p>å‚è§<a href="https://groups.google.com/forum/#!topic/sqlalchemy/vfoTsQkqfHI" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½æ˜¯å› ä¸ºåˆ é™¤ä¸»é”®å­—æ®µçš„æ—¶å€™ï¼Œtagså«æœ‰å¯¹post_idçš„å¼•ç”¨ã€‚<br>å‚è§<a href="https://groups.google.com/forum/#!topic/sqlalchemy/vfoTsQkqfHI" target="_blank" rel="noopener">è¿™é‡Œ</a></p><blockquote><p>A human being should be able to change a diaper, plan an invasion, butcher a hog, conn a ship, design a building, write a sonnet, balance accounts, build a wall, set a bone, comfort the dying, take orders, give orders, cooperate, act alone, solve equations, analyze a new problem, pitch manure, program a computer, cook a tasty meal, fight efficiently, die gallantly. Specialization is for insects.</p><p>ä¸€ä¸ªäººåº”è¯¥èƒ½å¤Ÿæ›´æ¢å°¿å¸ƒï¼Œç­–åˆ’æˆ˜äº‰ï¼Œæ€ä¸€å¤´çŒªï¼Œå¼€èˆ¹æŒèˆµï¼Œè®¾è®¡å»ºç­‘ï¼Œå†™åå››è¡Œè¯—ï¼Œä¼šè®¡ç»“ç®—ï¼Œç²‰åˆ·ç Œå¢™ï¼Œæ²»ç–—è„±è‡¼ï¼Œå®‰æ…°ä¸´ç»ˆçš„äººï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œå‘å¸ƒå‘½ä»¤ï¼Œæºæ‰‹åˆä½œï¼Œç‹¬ç«‹è¡ŒåŠ¨ï¼Œè§£æ•°å­¦æ–¹ç¨‹ï¼Œåˆ†æé—®é¢˜ï¼Œæ–½è‚¥é“²ç²ªï¼Œç”µè„‘ç¼–ç¨‹ï¼Œåšå¯å£çš„é¥­èœï¼Œé«˜æ•ˆåœ°æˆ˜æ–—ï¼Œå‹‡æ•¢åœ°æ­»å»ã€‚åªæœ‰æ˜†è™«æ‰ä¸“ä¸šåŒ–ã€‚</p><p>â€“ Robert A. Heinlein</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨ Linux ä¸Šå®‰è£… MySQLï¼Ÿ</title>
      <link href="/blog/2019-06-23/how-to-install-mysql-on-Linux/"/>
      <url>/blog/2019-06-23/how-to-install-mysql-on-Linux/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨<code>Linux</code>ä¸Šé¢å®‰è£…<code>MySQL</code>æœ¬åº”è¯¥æ˜¯å¾ˆå®¹æ˜“çš„ä¸€ä»¶äº‹ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ä¸æ³¨æ„ç»†èŠ‚è¿˜æ˜¯å¾ˆå®¹æ˜“â€œç¿»è½¦â€ï¼Œå‡ºç°ä¸€äº›é¢„æ–™ä¸åˆ°çš„é—®é¢˜ã€‚æœ¬æ–‡åœ¨å®è·µä¸­åšä¸€ä¸ªç®€å•çš„è®°å½•ã€‚</p><a id="more"></a><h1 id="å·¥ä½œç¯å¢ƒ"><a href="#å·¥ä½œç¯å¢ƒ" class="headerlink" title="å·¥ä½œç¯å¢ƒ"></a>å·¥ä½œç¯å¢ƒ</h1><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># uname -a</span></span><br><span class="line">Linux 172.18.1.117 3.10.0-957.el7.x86_64 <span class="comment">#1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line"><span class="comment"># å‘è¡Œç‰ˆæœ¬</span></span><br><span class="line">[root@172 mysql]<span class="comment"># cat /etc/redhat-release</span></span><br><span class="line">CentOS Linux release 7.6.1810 (Core)</span><br></pre></td></tr></table></figure><h2 id="MySQL-ç‰ˆæœ¬"><a href="#MySQL-ç‰ˆæœ¬" class="headerlink" title="MySQL ç‰ˆæœ¬"></a>MySQL ç‰ˆæœ¬</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å®Œæˆä¹‹åæ‰å¯ä»¥æŸ¥è¯¢åˆ°</span></span><br><span class="line">[root@172 mysql]<span class="comment"># mysql --version</span></span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.26, <span class="keyword">for</span> linux-glibc2.12 (x86_64) using  EditLine wrapper</span><br></pre></td></tr></table></figure><h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><p>ç‚¹å‡»<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">æ­¤é“¾æ¥</a>é€‰æ‹©é€‚å®œç‰ˆæœ¬ä¸‹è½½ï¼›<br>å¦‚å›¾æ‰€ç¤ºè¿›è¡Œé€‰æ‹©</p><p><img src="/images/download-mysql.png" alt="é€‰æ‹©åˆé€‚ç‰ˆæœ¬ä¸‹è½½"></p><p>æˆ–è€…ä½¿ç”¨<code>wget</code>ä¸‹è½½ï¼š<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.26-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure></p><h1 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h1><p>æˆ‘ä¸€èˆ¬ä¹ æƒ¯åœ¨å·¥ä½œç›®å½•æ–°å»º<code>temp</code>æ–‡ä»¶å¤¹ï¼Œç„¶åå­˜æ”¾è¿™äº›ä¸´æ—¶æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/root/temp/</span><br><span class="line">tar -xzvf mysql-5.7.26-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"><span class="comment"># çœç•¥è§£å‹ç»“æœ</span></span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure></p><h1 id="åˆ›å»ºå®‰è£…ç›®å½•å¹¶åˆ‡æ¢"><a href="#åˆ›å»ºå®‰è£…ç›®å½•å¹¶åˆ‡æ¢" class="headerlink" title="åˆ›å»ºå®‰è£…ç›®å½•å¹¶åˆ‡æ¢"></a>åˆ›å»ºå®‰è£…ç›®å½•å¹¶åˆ‡æ¢</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/mysql</span><br><span class="line"><span class="comment"># å°†è§£å‹æ–‡ä»¶ç§»åŠ¨åˆ°æ–°å»ºç›®å½•</span></span><br><span class="line">mv mysql-5.7.26-linux-glibc2.12-x86_64/* /usr/<span class="built_in">local</span>/mysql/</span><br><span class="line"><span class="comment"># åˆ‡æ¢ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql</span><br></pre></td></tr></table></figure><h1 id="æ£€æŸ¥å¹¶åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„"><a href="#æ£€æŸ¥å¹¶åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„" class="headerlink" title="æ£€æŸ¥å¹¶åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„"></a>æ£€æŸ¥å¹¶åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># cat /etc/group | grep mysql</span></span><br><span class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># cat /etc/passwd |grep mysql</span></span><br><span class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># groupadd mysql</span></span><br><span class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># useradd -r -g mysql mysql</span></span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•å¹¶èµ‹æƒ"><a href="#åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•å¹¶èµ‹æƒ" class="headerlink" title="åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•å¹¶èµ‹æƒ"></a>åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•å¹¶èµ‹æƒ</h2><p><strong>æ³¨æ„</strong>ï¼šå¿˜è®°æˆæƒä¼šå‡ºé—®é¢˜ï¼Œå„ç§å„æ ·çš„é—®é¢˜ã€‚æˆ‘ç¬¬ä¸€æ¬¡å®‰è£…çš„æ—¶å€™æ²¡æœ‰æ–°å»ºç”¨æˆ·å¹¶èµ‹äºˆç›¸åº”æƒé™ï¼Œå¯¼è‡´å®‰è£…å‡ºç°<br><code>Starting MySQL... ERROR! The server quit without updating PID file (/var/lib/mysql/xxx.pid).</code>ç­‰å„ç§é—®é¢˜ã€‚<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir data</span><br><span class="line"><span class="comment"># ç”¨æˆ·èµ‹æƒ</span></span><br><span class="line">chown -R mysql mysql/</span><br><span class="line">chgrp -R mysql mysql/</span><br></pre></td></tr></table></figure></p><h1 id="å®‰è£…å¹¶åˆå§‹åŒ–"><a href="#å®‰è£…å¹¶åˆå§‹åŒ–" class="headerlink" title="å®‰è£…å¹¶åˆå§‹åŒ–"></a>å®‰è£…å¹¶åˆå§‹åŒ–</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysqld --initialize --user=mysql --basedir=/usr/<span class="built_in">local</span>/mysql/ --datadir=/usr/<span class="built_in">local</span>/mysql/data/   </span><br><span class="line">--pid-file=/usr/<span class="built_in">local</span>/mysql/data/mysql.pid --lc_messages_dir=/usr/<span class="built_in">local</span>/mysql/share --lc_messages=en_US</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>:</p><ol><li><p>ç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ²¡æœ‰è®¾ç½®<code>--lc_messages_dir</code>å’Œ <code>--lc_messages</code>å‡ºç°ä»¥ä¸‹æŠ¥é”™ï¼Œæ‰€ä»¥å»ºè®®ç›´æ¥ä½¿ç”¨å®Œæ•´çš„å‘½ä»¤ï¼Œå¦‚æœå·²ç»å‡ºç°ä¸‹é¢çš„æŠ¥é”™ã€‚å¯ä»¥ä½¿ç”¨<code>rm -rf /usr/local/mysql/data/*</code>å°†æ•°æ®åˆ é™¤ä¹‹åé‡æ–°åˆå§‹åŒ–ï¼›</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2019-06-23T08:38:15.774307Z 0 [ERROR] Can<span class="string">'t find error-message file '</span>/usr/<span class="built_in">local</span>/mysql/share/errmsg.sys<span class="string">'. Check error-message file location and '</span>lc-messages-dir<span class="string">' configuration directive.</span></span><br></pre></td></tr></table></figure></li><li><p>æ­¤æ­¥éª¤å¦‚æœå‡ºç°<code>ERROR</code>é”™è¯¯ä¸€å®šè¦æ³¨æ„è§£å†³ï¼Œä¸èƒ½ç»§ç»­æ“ä½œï¼Œå¦‚ï¼š</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[ERROR] Can<span class="string">'t find error-message file '</span>/usr/<span class="built_in">local</span>/mysql/share/errmsg.sys<span class="string">'. Check error-message file location and '</span>lc-messages-dir<span class="string">' configuration directive.</span></span><br></pre></td></tr></table></figure></li><li><p>è®°ä½æœ€åä¸€è¡Œç”Ÿæˆçš„éšæœºå¯†ç ï¼Œå®‰è£…æˆåŠŸåç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦ä½¿ç”¨ï¼š</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­¤å¤„å¯†ç éšæœºç”Ÿæˆï¼Œæ³¨æ„è®°å½•</span></span><br><span class="line">2019-06-23T08:52:37.416821Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: PDRO-ab.a8jd</span><br></pre></td></tr></table></figure></li><li><p>æœ€å®¹æ˜“å‡ºç°è¿™ä¸ªé”™è¯¯ï¼š<code>Starting MySQL. ERROR! The server quit without updating PID file</code>ï¼Œç½‘ä¸Šæœåˆ°çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰å•¥ç”¨ï¼Œæˆ‘æœ¬æ¬¡å®‰è£…èµ°åˆ°è¿™é‡Œæ²¡æœ‰å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œä½†æ˜¯ä¸‹é¢<em>å¯åŠ¨æœåŠ¡</em>ç¯èŠ‚å‡ºç°è¯¥æŠ¥é”™ï¼Œä½¿ç”¨<code>rm  /etc/my.cnf -rf</code>å±…ç„¶æœ‰ç”¨ï¼Œæš‚æ—¶ä¸çŸ¥é“é€ æˆåŸå› ã€‚</p><h2 id="ä½¿ç”¨-mysqld-safe-å¯åŠ¨æœåŠ¡"><a href="#ä½¿ç”¨-mysqld-safe-å¯åŠ¨æœåŠ¡" class="headerlink" title="ä½¿ç”¨ mysqld_safe å¯åŠ¨æœåŠ¡"></a>ä½¿ç”¨ mysqld_safe å¯åŠ¨æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --user=mysql</span><br><span class="line">2019-06-23T09:00:10.100530Z mysqld_safe error: <span class="built_in">log</span>-error <span class="built_in">set</span> to <span class="string">'/var/log/mariadb/mariadb.log'</span>, however file don<span class="string">'t exists. Create writable for user '</span>mysql<span class="string">'.</span></span><br></pre></td></tr></table></figure></li></ol><p>æ ¹æ®æç¤ºä¿®æ”¹é…ç½®æˆ–è€…æ–°å»º<code>log</code>æ—¥å¿—å­˜æ”¾ç›®å½•<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># mkdir /var/log/mariadb</span></span><br><span class="line">[root@172 mysql]<span class="comment"># touch /var/log/mariadb/mariadb.log</span></span><br></pre></td></tr></table></figure></p><p>å†æ¬¡å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># bin/mysqld_safe --user=mysql</span></span><br><span class="line">2019-06-23T09:00:58.541328Z mysqld_safe Logging to <span class="string">'/var/log/mariadb/mariadb.log'</span>.</span><br><span class="line">2019-06-23T09:00:58.546897Z mysqld_safe Directory <span class="string">'/var/lib/mysql'</span> <span class="keyword">for</span> UNIX socket file don<span class="string">'t exists.</span></span><br></pre></td></tr></table></figure></p><h2 id="æ ¹æ®æŠ¥é”™ä¿¡æ¯ä¿®æ”¹-my-cnf-ä¸­çš„é…ç½®é¡¹"><a href="#æ ¹æ®æŠ¥é”™ä¿¡æ¯ä¿®æ”¹-my-cnf-ä¸­çš„é…ç½®é¡¹" class="headerlink" title="æ ¹æ®æŠ¥é”™ä¿¡æ¯ä¿®æ”¹ my.cnf ä¸­çš„é…ç½®é¡¹"></a>æ ¹æ®æŠ¥é”™ä¿¡æ¯ä¿®æ”¹ my.cnf ä¸­çš„é…ç½®é¡¹</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># vi /etc/my.cnf</span></span><br><span class="line"><span class="comment"># æ­¤å¤„çœç•¥ï¼Œæ¯ä¸ªäººçš„é…ç½®ä¸ä¸€æ ·ï¼ˆæˆ‘å·²ç»å°†è¯¥æ–‡ä»¶åˆ é™¤äº†ï¼Œæ²¡åŠæ³•è®°ä½æ€ä¹ˆé…ç½®çš„äº†ï¼Œè¿™é‡Œçš„é”™è¯¯ä¿¡æ¯å¾ˆæ˜ç¡®ï¼Œæ ¹æ®é”™è¯¯ä¿®æ”¹åˆ°ä¸æŠ¥é”™å³å¯ï¼‰</span></span><br><span class="line">[root@172 mysql]<span class="comment"># bin/mysqld_safe --user=mysql</span></span><br><span class="line">2019-06-23T09:03:54.795490Z mysqld_safe Logging to <span class="string">'/var/log/mariadb/mariadb.log'</span>.</span><br><span class="line">2019-06-23T09:03:54.845647Z mysqld_safe Starting mysqld daemon with databases from /usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line">2019-06-23T09:03:55.148856Z mysqld_safe mysqld from pid file /var/run/mariadb/mariadb.pid ended</span><br></pre></td></tr></table></figure><h2 id="åŠ å…¥å¼€æœºè‡ªå¯åŠ¨é¡¹"><a href="#åŠ å…¥å¼€æœºè‡ªå¯åŠ¨é¡¹" class="headerlink" title="åŠ å…¥å¼€æœºè‡ªå¯åŠ¨é¡¹"></a>åŠ å…¥å¼€æœºè‡ªå¯åŠ¨é¡¹</h2><p>å°†<code>/usr/local/mysql/support-files/mysql.server</code> æ‹·è´ä¸º<code>/etc/init.d/mysql</code>å¹¶è®¾ç½®è¿è¡Œæƒé™ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨<code>service mysql</code>å‘½ä»¤å¯åŠ¨/åœæ­¢æœåŠ¡ï¼Œ<br>å¦åˆ™å°±åªèƒ½ä½¿ç”¨<code>/usr/local/mysql/bin/mysqld_safe</code>å‘½ä»¤æ¥å¯åŠ¨æœåŠ¡<br>å¦‚æœè‡ªå®šä¹‰äº†å®‰è£…è·¯å¾„,è¿˜éœ€è¦æŠŠ<code>mysql.server</code>ä¸­<code>basedir</code>çš„ç›¸å…³è·¯å¾„ï¼Œæ”¹ä¸ºè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œé»˜è®¤è·¯å¾„æ˜¯<code>/usr/local/mysql</code>ã€‚æœ¬æ–‡ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼Œæ‰€ä»¥ä¸ç”¨ä¿®æ”¹ã€‚<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@dbserver support-files]<span class="comment"># cp mysql.server /etc/init.d/mysql  </span></span><br><span class="line">[root@dbserver support-files]<span class="comment"># chmod +x /etc/init.d/mysql </span></span><br><span class="line">-- æŠŠmysqlæ³¨å†Œä¸ºå¼€æœºå¯åŠ¨çš„æœåŠ¡</span><br><span class="line">[root@dbserver support-files]<span class="comment"># chkconfig --add mysql  </span></span><br><span class="line">-- æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ</span><br><span class="line">[root@dbserver support-files]<span class="comment">#  chkconfig --list mysql  </span></span><br><span class="line">Note: This output shows SysV services only and does not include native</span><br><span class="line">      systemd services. SysV configuration data might be overridden by native</span><br><span class="line">      systemd configuration.</span><br><span class="line"></span><br><span class="line">      If you want to list systemd services use <span class="string">'systemctl list-unit-files'</span>.</span><br><span class="line">      To see services enabled on particular target use</span><br><span class="line">      <span class="string">'systemctl list-dependencies [target]'</span>.</span><br><span class="line"></span><br><span class="line">mysql          0:off1:off2:on3:on4:on5:on6:off</span><br></pre></td></tr></table></figure></p><h2 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># service mysql start</span></span><br><span class="line">Starting MySQL. ERROR! The server quit without updating PID file (/usr/<span class="built_in">local</span>/mysql/data/172.18.1.117.pid).</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åˆ é™¤é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è§£å†³è¯¥æŠ¥é”™ï¼ˆåŸå› æœªçŸ¥ï¼Œæ²¡æœ‰æ·±ç©¶ï¼‰<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># rm  /etc/my.cnf -rf</span></span><br></pre></td></tr></table></figure></p><p>é‡æ–°å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># /etc/init.d/mysql start</span></span><br><span class="line">Starting MySQL.Logging to <span class="string">'/usr/local/mysql/data/172.18.1.117.err'</span>.</span><br><span class="line"> SUCCESS!</span><br></pre></td></tr></table></figure></p><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 mysql]<span class="comment"># /usr/local/mysql/bin/mysql -uroot -pPDRO-ab.a8jd</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¯†ç <br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ‰çš„æ–‡ç« è¯´æ­¤å¤„ä¸èƒ½ä½¿ç”¨å•å¼•å·ï¼Œä½†æ˜¯æˆ‘ä½¿ç”¨å•å¼•å·ä¹ŸæˆåŠŸäº†ï¼Œå¥½åƒæ²¡æœ‰é—®é¢˜ã€‚YOUR PASSWORD ä¸ºä½ è‡ªå·±è®¾ç½®çš„æ•°æ®åº“çš„å¯†ç ï¼Œè¿™ä¸ªè¦è®°ä½äº†ï¼Œä¸ç„¶å°±è¦è‡ªå·±å†å»æ‰‹åŠ¨é‡ç½®å¯†ç äº†ï¼</span></span><br><span class="line">mysql&gt;  <span class="built_in">set</span> password=password(<span class="string">"YOUR PASSWORD"</span>);</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure></p><h2 id="æ·»åŠ ç¯å¢ƒå˜é‡"><a href="#æ·»åŠ ç¯å¢ƒå˜é‡" class="headerlink" title="æ·»åŠ ç¯å¢ƒå˜é‡"></a>æ·»åŠ ç¯å¢ƒå˜é‡</h2><p>ä¸Šä¸€æ­¥ä¸­å¯åŠ¨ mysql çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å…¨è·¯å¾„ï¼Œæœ‰çš„æ—¶å€™ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ä¿®æ”¹ï¼›<br>æ‰§è¡Œ<code>vi ~/.bash_profile</code>ä¿®æ”¹æ–‡ä»¶ä¸­<code>PATH</code>ä¸€è¡Œï¼Œå°†<code>/usr/local/mysql/bin</code> åŠ å…¥åˆ°<code>PATH=$PATH:$HOME/bin</code>ä¸€è¡Œä¹‹å<br><strong>æ³¨æ„</strong>ï¼šè¿™ç§æ–¹æ³•åªå¯¹å½“å‰ç™»å½•ç”¨æˆ·ç”Ÿæ•ˆã€‚</p><h1 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h1><p><a href="https://blog.csdn.net/qq_30000313/article/details/85333971" target="_blank" rel="noopener">linux å®‰è£… mysql5.7.24 - ç»¿è‰²è½æ—¥çš„åšå®¢ - CSDN åšå®¢</a><br><a href="https://blog.csdn.net/zhou920786312/article/details/77750604" target="_blank" rel="noopener">linux å®‰è£… mysql5.7.19</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨ flask-celery å®ç°å¼‚æ­¥ä»»åŠ¡ï¼Ÿ</title>
      <link href="/blog/2019-06-18/how-to-use-flask-celery/"/>
      <url>/blog/2019-06-18/how-to-use-flask-celery/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="å…ˆå†³æ¡ä»¶"><a href="#å…ˆå†³æ¡ä»¶" class="headerlink" title="å…ˆå†³æ¡ä»¶"></a>å…ˆå†³æ¡ä»¶</h1><ul><li><p><code>redis</code>ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis-cli --version</span><br><span class="line">redis-cli 5.0.4</span><br></pre></td></tr></table></figure></li><li><p><code>celery</code>ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">celery --version</span><br><span class="line">4.3.0 (rhubarb)</span><br></pre></td></tr></table></figure></li><li><p><code>Flask</code>å’Œ <code>Python</code> ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">flask --version</span><br><span class="line">Flask 1.0.2</span><br><span class="line">Python 3.6.5 (default, Apr  1 2018, 05:46:30) </span><br><span class="line">[GCC 7.3.0]</span><br></pre></td></tr></table></figure></li><li><p><code>Linux</code> ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:Ubuntu</span><br><span class="line">Description:Ubuntu 18.04 LTS</span><br><span class="line">Release:18.04</span><br><span class="line">Codename:bionic</span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line">uname -a</span><br><span class="line">Linux <span class="built_in">local</span> 4.15.0-22-generic <span class="comment">#24-Ubuntu SMP Wed May 16 12:15:17 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="Celeryæ˜¯ä»€ä¹ˆ"><a href="#Celeryæ˜¯ä»€ä¹ˆ" class="headerlink" title="Celeryæ˜¯ä»€ä¹ˆ"></a><code>Celery</code>æ˜¯ä»€ä¹ˆ</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><code>Celery</code> æ˜¯ä¸€ä¸ªâ€œè‡ªå¸¦ç”µæ± â€çš„ä¸“æ³¨äºå®æ—¶å¤„ç†å’Œä»»åŠ¡è°ƒåº¦çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼ŒåŒæ—¶æä¾›æ“ä½œå’Œç»´æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿæ‰€éœ€çš„<strong>å·¥å…·</strong>ã€‚</p><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h3><p><img src="/images/structure-of-celery.png" alt="celeryæ¶æ„å›¾"></p><center><span>celeryæ¶æ„å›¾</span></center><p><code>Celery</code>æ”¯æŒå®šæ—¶ä»»åŠ¡ï¼ˆCelery Beatï¼‰å’Œå¼‚æ­¥æ‰§è¡Œ(Async Task)ä¸¤ç§æ¨¡å¼ã€‚åŒæ­¥æ¨¡å¼ä¸ºä»»åŠ¡è°ƒç”¨æ–¹ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè¿™ç§æ–¹å¼ç­‰åŒäºRPC(Remote Procedure Call)ï¼Œ å¼‚æ­¥æ–¹å¼ä¸ºä»»åŠ¡åœ¨åå°æ‰§è¡Œï¼Œè°ƒç”¨æ–¹è°ƒç”¨åå°±å»åšå…¶ä»–å·¥ä½œï¼Œä¹‹åå†æ ¹æ®éœ€è¦æ¥æŸ¥çœ‹ä»»åŠ¡ç»“æœã€‚<code>Celery</code>è‡ªå·±æ²¡æœ‰å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œæ˜¯ç›´æ¥å·²å­˜åœ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸º<code>Broker</code>è§’è‰²ã€‚</p><h3 id="ç»„ä»¶"><a href="#ç»„ä»¶" class="headerlink" title="ç»„ä»¶"></a>ç»„ä»¶</h3><p>ä½¿ç”¨ <code>Celery</code> è¿è¡Œåå°ä»»åŠ¡å¹¶ä¸åƒåœ¨çº¿ç¨‹ä¸­è¿™æ ·åšé‚£ä¹ˆç®€å•ï¼Œä½†æ˜¯å¥½å¤„å¤šå¤šã€‚<code>Celery</code> å…·æœ‰åˆ†å¸ƒå¼æ¶æ„ï¼Œä½¿åº”ç”¨æ›´åŠ æ˜“äºæ‰©å±•ã€‚ä¸€ä¸ª <code>Celery</code> å®‰è£…æœ‰ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p><ul><li><code>Celery</code> å®¢æˆ·ç«¯: ç”¨äºå‘å¸ƒåå°ä½œä¸šã€‚å½“ä¸ <code>Flask</code> ä¸€èµ·å·¥ä½œçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¸ <code>Flask</code> åº”ç”¨ä¸€èµ·è¿è¡Œã€‚</li><li>Celery workers: ä»»åŠ¡æ¶ˆè´¹è€…ï¼Œæ˜¯è¿è¡Œåå°ä½œä¸šçš„è¿›ç¨‹ã€‚<code>Celery</code> æ”¯æŒæœ¬åœ°å’Œè¿œç¨‹çš„ <code>workers</code>ï¼Œå› æ­¤ä½ å°±å¯ä»¥åœ¨ <code>Flask</code> æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„ <code>worker</code>ï¼Œéšåéšç€ä½ çš„åº”ç”¨éœ€æ±‚çš„å¢åŠ è€Œæ–°å¢æ›´å¤šçš„ <code>workers</code>ã€‚</li><li>æ¶ˆæ¯ä»£ç†ï¼ˆ<code>Broker</code>ï¼‰: å®¢æˆ·ç«¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å’Œ <code>workers</code> è¿›è¡Œé€šä¿¡ï¼Œ<code>Celery</code> æ”¯æŒå¤šç§æ–¹å¼æ¥å®ç°è¿™äº›é˜Ÿåˆ—ã€‚å¸¸è§çš„ä¸º <code>RabbitMQ</code> å’Œ <code>Redis</code>ã€‚</li><li>ä»»åŠ¡ç»“æœå­˜å‚¨ï¼šç”¨æ¥å­˜å‚¨<code>workers</code>æ‰§è¡Œçš„ä»»åŠ¡ç»“æœã€‚<br>è¯¦è§<a href="http://docs.jinkan.org/docs/celery/getting-started/introduction.html#id19" target="_blank" rel="noopener">Celery æ˜¯â€¦â€¦</a></li></ul><h2 id="Celeryçš„å®‰è£…é…ç½®"><a href="#Celeryçš„å®‰è£…é…ç½®" class="headerlink" title="Celeryçš„å®‰è£…é…ç½®"></a><code>Celery</code>çš„å®‰è£…é…ç½®</h2><h3 id="å®‰è£…-Celery"><a href="#å®‰è£…-Celery" class="headerlink" title="å®‰è£… Celery"></a>å®‰è£… <code>Celery</code></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip install celery</span><br></pre></td></tr></table></figure><p>å®‰è£…æ—¶ä¼šè‡ªåŠ¨è§£å†³ä¾èµ–ï¼š<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Installing collected packages: vine, amqp, kombu, billiard, celery</span><br></pre></td></tr></table></figure></p><p>éªŒè¯<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">celery --version</span><br><span class="line">4.3.0 (rhubarb)</span><br></pre></td></tr></table></figure></p><h3 id="ä¸-redis-ç»“åˆä½¿ç”¨"><a href="#ä¸-redis-ç»“åˆä½¿ç”¨" class="headerlink" title="ä¸ redis ç»“åˆä½¿ç”¨"></a>ä¸ <code>redis</code> ç»“åˆä½¿ç”¨</h3><p>redis å®‰è£…å¯ä»¥å‚è€ƒä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« <a href="https://imoyao.github.io/blog/2019-04-11/how-to-install-Redis-on-Linux/">Linux ä¸‹å¦‚ä½•å®‰è£… Redisï¼Ÿ</a></p><p><strong>æ³¨æ„</strong>ï¼š æ­¤å¤„éœ€è¦åŒæ—¶å®‰è£…<code>redis</code>å®¢æˆ·ç«¯å’Œ<code>redis</code>çš„<code>Python</code>æ”¯æŒã€‚</p><h3 id="éªŒè¯ç»“æœ"><a href="#éªŒè¯ç»“æœ" class="headerlink" title="éªŒè¯ç»“æœ"></a>éªŒè¯ç»“æœ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">imoyao@<span class="built_in">local</span>:~$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">"_kombu.binding.celery"</span></span><br><span class="line">2) <span class="string">"celery-task-meta-a9db6911-e15a-4b9e-b321-958f5298652a"</span></span><br><span class="line">3) <span class="string">"celery-task-meta-e22b0603-8117-4f0d-ac6b-ad621738e256"</span></span><br><span class="line">4) <span class="string">"unacked_mutex"</span></span><br><span class="line">5) <span class="string">"_kombu.binding.celery.pidbox"</span></span><br><span class="line">6) <span class="string">"celery-task-meta-aac524bd-cb47-4493-b0dd-9712a98a3f14"</span></span><br><span class="line">7) <span class="string">"_kombu.binding.celeryev"</span></span><br><span class="line">8) <span class="string">"celery-task-meta-ccd8d274-7f14-4abc-8244-e80f01932097"</span></span><br><span class="line">9) <span class="string">"celery-task-meta-3b2b3efa-4ad7-4c7e-b92d-27636eaeaa6b"</span></span><br><span class="line">127.0.0.1:6379&gt; get celery-task-meta-a9db6911-e15a-4b9e-b321-958f5298652a</span><br><span class="line"><span class="string">"&#123;\"status\": \"SUCCESS\", \"result\": 30, \"traceback\": null, \"children\": [], \"task_id\": \"a9db6911-e15a-4b9e-b321-958f5298652a\", \"date_done\": \"2019-06-13T18:43:43.491009\"&#125;"</span></span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Celery"><a href="#å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Celery" class="headerlink" title="å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Celery"></a>å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>Celery</code></h2><p>ä»¥ä¸<code>Flask</code>ç»“åˆä¸ºä¾‹(ä½¿ç”¨<code>redis</code>ä½œä¸º<code>backend</code>)</p><ul><li>åˆ›å»º<code>celery</code>å®ä¾‹</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># app\__init__.py</span></span><br><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_celery</span><span class="params">(app)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å‚è§ï¼šhttp://docs.jinkan.org/docs/flask/patterns/celery.html</span></span><br><span class="line"><span class="string">    åˆå§‹åŒ–celery</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    celery = Celery(app.import_name, broker=app.config[<span class="string">'CELERY_BROKER_URL'</span>])</span><br><span class="line">    celery.conf.update(app.config)</span><br><span class="line">    TaskBase = celery.Task</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ContextTask</span><span class="params">(TaskBase)</span>:</span></span><br><span class="line">        abstract = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">            <span class="keyword">with</span> app.app_context():</span><br><span class="line">                <span class="keyword">return</span> TaskBase.__call__(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    celery.Task = ContextTask</span><br><span class="line">    <span class="keyword">return</span> celery</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºåå°ä»»åŠ¡</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> celery.utils.log <span class="keyword">import</span> get_task_logger</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, init_celery</span><br><span class="line"></span><br><span class="line">lg = get_task_logger(__name__)      <span class="comment"># è®°å½•æ—¥å¿—</span></span><br><span class="line">celery = init_celery(create_app(os.getenv(<span class="string">'FLASK_CONFIG'</span>, <span class="string">'default'</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># @celery.task(name='pmrearend.task.log_it')        # æ­¤å¤„æ˜¯è§£å†³å¯¼å…¥å¤±è´¥çš„ä¸€ç§æ–¹æ¡ˆï¼Œä½†æ˜¯æ„Ÿè§‰ä¸å¤Ÿä¼˜é›…ï¼Œéœ€è¦æ·±å…¥äº†è§£</span></span><br><span class="line"><span class="meta">@celery.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_it</span><span class="params">(num1, num2)</span>:</span></span><br><span class="line">    msg = num1 + num2</span><br><span class="line">    print(msg)</span><br><span class="line">    lg.debug(<span class="string">"in log_test()"</span>)</span><br><span class="line">    <span class="keyword">return</span> msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># task = log_it.delay(5,8)</span></span><br><span class="line">    task = log_it.apply_async(args=[<span class="number">10</span>, <span class="number">20</span>], countdown=<span class="number">10</span>)</span><br></pre></td></tr></table></figure><ul><li><p>æ–°å»ºç›®å½•åŠæ–‡ä»¶</p>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /var/<span class="built_in">log</span>/celery/</span><br><span class="line">sudo touch /var/<span class="built_in">log</span>/celery/celery.log</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ celery worker æœåŠ¡</p>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">celery -A task worker -l debug -f /var/<span class="built_in">log</span>/celery/celery.log</span><br></pre></td></tr></table></figure></li></ul><hr><h3 id="é‡åˆ°çš„é—®é¢˜è®°å½•"><a href="#é‡åˆ°çš„é—®é¢˜è®°å½•" class="headerlink" title="é‡åˆ°çš„é—®é¢˜è®°å½•"></a>é‡åˆ°çš„é—®é¢˜è®°å½•</h3><ol><li><p>sqlalchemy.exc.InvalidRequestError</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlalchemy.exc.InvalidRequestError: Table <span class="string">'user'</span> is already defined <span class="keyword">for</span> this MetaData instance.  </span><br><span class="line">Specify <span class="string">'extend_existing=True'</span> to redefine options and columns on an existing Table object.</span><br></pre></td></tr></table></figure><p> è§£å†³ï¼šåœ¨å¯¹åº” model ä¸­æ·»åŠ <code>&#39;extend_existing&#39;: True</code></p> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__table_args__ = &#123;<span class="string">'extend_existing'</span>: <span class="literal">True</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p>celery: command not found</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo: celery: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p> è§£å†³ï¼šæŒ‰ç…§ç»å¯¹è·¯å¾„è°ƒç”¨<code>celery</code></p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">which</span> celery</span><br><span class="line">/home/imoyao/envs/py3flk/bin/celery</span><br></pre></td></tr></table></figure><p> æ›¿æ¢æ­¤å¤„<code>celery</code>çš„ä½ç½®å³å¯è¿è¡Œï¼ˆTODOï¼šä¸å¤Ÿä¼˜é›…ï¼Œæš‚æ—¶æµ‹è¯•æ€§è§£å†³æ–¹æ¡ˆï¼‰</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo /home/imoyao/envs/py3flk/bin/celery -A pmrearend.task worker -l debug -f /var/<span class="built_in">log</span>/celery/celery.log</span><br></pre></td></tr></table></figure></li><li><p>æ²¡æœ‰å¯¼å…¥<code>task</code>æ¨¡å—</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[2019-06-14 02:32:40,115: ERROR/MainProcess] Received unregistered task of <span class="built_in">type</span> <span class="string">'pmrearend.log_it'</span>.</span><br><span class="line">The message has been ignored and discarded.</span><br><span class="line"></span><br><span class="line">Did you remember to import the module containing this task?</span><br><span class="line">Or maybe you<span class="string">'re using relative imports?</span></span><br></pre></td></tr></table></figure><p> è§£å†³ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»æœ‰ä¸åŒçš„åç§°ã€‚å¦‚æœæ²¡æœ‰æ˜¾ç¤ºæä¾›åç§°ï¼Œä»»åŠ¡è£…é¥°å™¨å°†ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªï¼Œäº§ç”Ÿçš„åç§°ä¼šåŸºäºè¿™äº›ä¿¡æ¯ï¼š 1ï¼‰ä»»åŠ¡å®šä¹‰æ‰€åœ¨çš„æ¨¡å—ï¼Œ 2ï¼‰ä»»åŠ¡å‡½æ•°çš„åç§°</p><p> æ˜¾ç¤ºè®¾ç½®ä»»åŠ¡åç§°çš„ä¾‹å­ï¼šåœ¨è£…é¥°å™¨<code>@app.task</code>ä¸­åŠ å…¥å‚æ•°<code>name</code>ï¼Œå°±å¯ä»¥è¢«<code>celery</code>è¯»å–åˆ°ã€‚  </p> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@celery.task(name='pmrearend.task.log_it')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_it</span><span class="params">(num1, num2)</span>:</span></span><br><span class="line">    msg = num1 + num2</span><br><span class="line">    print(msg)</span><br><span class="line">    lg.debug(<span class="string">"in log_test()"</span>)</span><br><span class="line">    <span class="keyword">return</span> msg</span><br><span class="line">```   </span><br><span class="line">æ­£å¸¸è¿è¡Œç»“æœ</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">43</span>,<span class="number">139</span>: DEBUG/MainProcess] TaskPool: Apply &lt;function _fast_trace_task at <span class="number">0x7f72a03fef28</span>&gt; (args:(<span class="string">'pmrearend.task.log_it'</span>, <span class="string">'a9db6911-e15a-4b9e-b321-958f5298652a'</span>, &#123;<span class="string">'lang'</span>: <span class="string">'py'</span>, <span class="string">'task'</span>: <span class="string">'pmrearend.task.log_it'</span>, <span class="string">'id'</span>: <span class="string">'a9db6911-e15a-4b9e-b321-958f5298652a'</span>, <span class="string">'shadow'</span>: <span class="literal">None</span>, <span class="string">'eta'</span>: <span class="string">'2019-06-13T18:43:43.139123+00:00'</span>, <span class="string">'expires'</span>: <span class="literal">None</span>, <span class="string">'group'</span>: <span class="literal">None</span>, <span class="string">'retries'</span>: <span class="number">0</span>, <span class="string">'timelimit'</span>: [<span class="literal">None</span>, <span class="literal">None</span>], <span class="string">'root_id'</span>: <span class="string">'a9db6911-e15a-4b9e-b321-958f5298652a'</span>, <span class="string">'parent_id'</span>: <span class="literal">None</span>, <span class="string">'argsrepr'</span>: <span class="string">'[10, 20]'</span>, <span class="string">'kwargsrepr'</span>: <span class="string">'&#123;&#125;'</span>, <span class="string">'origin'</span>: <span class="string">'gen4669@local'</span>, <span class="string">'reply_to'</span>: <span class="string">'a2563c50-9249-3718-85a8-9ad44174831c'</span>, <span class="string">'correlation_id'</span>: <span class="string">'a9db6911-e15a-4b9e-b321-958f5298652a'</span>, <span class="string">'delivery_info'</span>: &#123;<span class="string">'exchange'</span>: <span class="string">''</span>, <span class="string">'routing_key'</span>: <span class="string">'celery'</span>, <span class="string">'priority'</span>: <span class="number">0</span>, <span class="string">'redelivered'</span>: <span class="literal">None</span>&#125;&#125;, <span class="string">b'[[10, 20], &#123;&#125;, &#123;"callbacks": null, "errbacks": null, "chain": null, "chord": null&#125;]'</span>, <span class="string">'application/json'</span>, <span class="string">'utf-8'</span>) kwargs:&#123;&#125;)</span><br><span class="line">[2019-06-14 02:43:43,281: DEBUG/MainProcess] basic.qos: prefetch_count-&gt;4</span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">43</span>,<span class="number">284</span>: WARNING/ForkPoolWorker<span class="number">-1</span>] <span class="number">30</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">43</span>,<span class="number">286</span>: DEBUG/MainProcess] Task accepted: pmrearend.task.log_it[a9db6911-e15a<span class="number">-4</span>b9e-b321<span class="number">-958</span>f5298652a] pid:<span class="number">4089</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">43</span>,<span class="number">287</span>: DEBUG/ForkPoolWorker<span class="number">-1</span>] pmrearend.task.log_it[a9db6911-e15a<span class="number">-4</span>b9e-b321<span class="number">-958</span>f5298652a]: <span class="keyword">in</span> log_test()</span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">43</span>,<span class="number">504</span>: INFO/ForkPoolWorker<span class="number">-1</span>] Task pmrearend.task.log_it[a9db6911-e15a<span class="number">-4</span>b9e-b321<span class="number">-958</span>f5298652a] succeeded <span class="keyword">in</span> <span class="number">0.22014467700500973</span>s: <span class="number">30</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">44</span>,<span class="number">751</span>: INFO/MainProcess] Received task: pmrearend.task.log_it[aac524bd-cb47<span class="number">-4493</span>-b0dd<span class="number">-9712</span>a98a3f14]  ETA:[<span class="number">2019</span><span class="number">-06</span><span class="number">-13</span> <span class="number">18</span>:<span class="number">43</span>:<span class="number">54.619709</span>+<span class="number">00</span>:<span class="number">00</span>] </span><br><span class="line">[2019-06-14 02:43:44,752: DEBUG/MainProcess] basic.qos: prefetch_count-&gt;5</span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">54</span>,<span class="number">621</span>: DEBUG/MainProcess] TaskPool: Apply &lt;function _fast_trace_task at <span class="number">0x7f72a03fef28</span>&gt; (args:(<span class="string">'pmrearend.task.log_it'</span>, <span class="string">'aac524bd-cb47-4493-b0dd-9712a98a3f14'</span>, &#123;<span class="string">'lang'</span>: <span class="string">'py'</span>, <span class="string">'task'</span>: <span class="string">'pmrearend.task.log_it'</span>, <span class="string">'id'</span>: <span class="string">'aac524bd-cb47-4493-b0dd-9712a98a3f14'</span>, <span class="string">'shadow'</span>: <span class="literal">None</span>, <span class="string">'eta'</span>: <span class="string">'2019-06-13T18:43:54.619709+00:00'</span>, <span class="string">'expires'</span>: <span class="literal">None</span>, <span class="string">'group'</span>: <span class="literal">None</span>, <span class="string">'retries'</span>: <span class="number">0</span>, <span class="string">'timelimit'</span>: [<span class="literal">None</span>, <span class="literal">None</span>], <span class="string">'root_id'</span>: <span class="string">'aac524bd-cb47-4493-b0dd-9712a98a3f14'</span>, <span class="string">'parent_id'</span>: <span class="literal">None</span>, <span class="string">'argsrepr'</span>: <span class="string">'[10, 20]'</span>, <span class="string">'kwargsrepr'</span>: <span class="string">'&#123;&#125;'</span>, <span class="string">'origin'</span>: <span class="string">'gen4706@local'</span>, <span class="string">'reply_to'</span>: <span class="string">'ee66dc1c-aebd-3111-9ef4-f07a71943fc0'</span>, <span class="string">'correlation_id'</span>: <span class="string">'aac524bd-cb47-4493-b0dd-9712a98a3f14'</span>, <span class="string">'delivery_info'</span>: &#123;<span class="string">'exchange'</span>: <span class="string">''</span>, <span class="string">'routing_key'</span>: <span class="string">'celery'</span>, <span class="string">'priority'</span>: <span class="number">0</span>, <span class="string">'redelivered'</span>: <span class="literal">None</span>&#125;&#125;, <span class="string">b'[[10, 20], &#123;&#125;, &#123;"callbacks": null, "errbacks": null, "chain": null, "chord": null&#125;]'</span>, <span class="string">'application/json'</span>, <span class="string">'utf-8'</span>) kwargs:&#123;&#125;)</span><br><span class="line">[2019-06-14 02:43:54,631: DEBUG/MainProcess] basic.qos: prefetch_count-&gt;4</span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">54</span>,<span class="number">637</span>: WARNING/ForkPoolWorker<span class="number">-1</span>] <span class="number">30</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">54</span>,<span class="number">639</span>: DEBUG/ForkPoolWorker<span class="number">-1</span>] pmrearend.task.log_it[aac524bd-cb47<span class="number">-4493</span>-b0dd<span class="number">-9712</span>a98a3f14]: <span class="keyword">in</span> log_test()</span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">54</span>,<span class="number">645</span>: DEBUG/MainProcess] Task accepted: pmrearend.task.log_it[aac524bd-cb47<span class="number">-4493</span>-b0dd<span class="number">-9712</span>a98a3f14] pid:<span class="number">4089</span></span><br><span class="line">[<span class="number">2019</span><span class="number">-06</span><span class="number">-14</span> <span class="number">02</span>:<span class="number">43</span>:<span class="number">54</span>,<span class="number">650</span>: INFO/ForkPoolWorker<span class="number">-1</span>] Task pmrearend.task.log_it[aac524bd-cb47<span class="number">-4493</span>-b0dd<span class="number">-9712</span>a98a3f14] succeeded <span class="keyword">in</span> <span class="number">0.012691148993326351</span>s: <span class="number">30</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="é—®é¢˜è®°å½•ï¼š"><a href="#é—®é¢˜è®°å½•ï¼š" class="headerlink" title="é—®é¢˜è®°å½•ï¼š"></a>é—®é¢˜è®°å½•ï¼š</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">celery.platforms.LockFailed: [Errno 13] Permission denied: <span class="string">'/home/xxx/celerybeat.pid'</span></span><br><span class="line">```    </span><br><span class="line">pidæ–‡ä»¶æ²¡æœ‰æƒé™ï¼›è¿™ç§æƒ…å†µæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</span><br><span class="line">- ä¿®æ”¹pidæ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œæ”¾åˆ°å½“å‰æ‰§è¡Œç”¨æˆ·æœ‰æƒé™çš„ä½ç½®</span><br><span class="line">```bash</span><br><span class="line">celery beat -A celeryapp --loglevel=INFO --pidfile=<span class="string">"/tmp/celerybeat.pid"</span>        <span class="comment"># ä¿®æ”¹è·¯å¾„</span></span><br></pre></td></tr></table></figure><ul><li>å¯¹pidæ–‡ä»¶æ‰€åœ¨ç›®å½•åŠ æƒé™ï¼Œç„¶åæ‰§è¡Œï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chown -R YOUR_USER_NAME:YOUR_USER_NAME  CURRENT_PATH</span><br><span class="line">celery -A celery_worker:celery beat --loglevel=INFO</span><br></pre></td></tr></table></figure></li></ul><p><a href="https://github.com/celery/celery/issues/3828" target="_blank" rel="noopener">å‚è§è¿™é‡Œ</a></p><h2 id="æ³¨æ„é—®é¢˜"><a href="#æ³¨æ„é—®é¢˜" class="headerlink" title="æ³¨æ„é—®é¢˜"></a>æ³¨æ„é—®é¢˜</h2><p><strong>ä¸è¦</strong>å°†taskå†™è¿›ç±»ä¸­ï¼Œå› ä¸ºå¯èƒ½å¯¼è‡´æ‰§è¡Œå‡ºé”™ç­‰å„ç§é—®é¢˜ï¼Œå¦‚æœçœŸçš„è¦è¿™ä¹ˆåšï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œï¼š<br>å‚è§ <a href="https://stackoverflow.com/questions/9250317/using-class-methods-as-celery-tasks" target="_blank" rel="noopener">using class methods as celery tasks</a></p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p>å› ä¸ºä¸ªäººæ—¶é—´å…³ç³»ï¼Œè¿™ä¸ªæš‚æ—¶æ²¡æœ‰å­¦å®Œã€‚å…³äº<code>Celery</code>çš„ä½¿ç”¨éœ€è¦è¿›ä¸€æ­¥å®è·µå­¦ä¹ ã€‚</p><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><p><a href="http://docs.celeryproject.org/en/latest/" target="_blank" rel="noopener">Celery 4.3.0 documentation Â»</a><br><a href="https://www.jianshu.com/p/807efde55d81" target="_blank" rel="noopener">åœ¨ Flask ä¸­ä½¿ç”¨ Celery çš„æœ€ä½³å®è·µ</a><br><a href="https://blog.csdn.net/libing_thinking/article/details/78547816" target="_blank" rel="noopener">Celeryä¸­æ–‡æ–‡æ¡£</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flask </tag>
            
            <tag> HOWTO </tag>
            
            <tag> Celery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ç†è§£ cookieã€session ä¸ token</title>
      <link href="/blog/2019-06-18/diff-cookie-session-token/"/>
      <url>/blog/2019-06-18/diff-cookie-session-token/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><p><a href="https://segmentfault.com/a/1190000017831088" target="_blank" rel="noopener">å½»åº•å¼„æ‡‚ sessionï¼Œcookieï¼Œtoken</a><br><a href="https://segmentfault.com/a/1190000015881055" target="_blank" rel="noopener">token ä¸ sessionId çš„åŒºåˆ«â€”â€”å­¦ä¹ ç¬”è®°</a><br><a href="https://www.liangzl.com/get-article-detail-16019.html" target="_blank" rel="noopener">å½»åº•ç†è§£ cookieï¼Œsessionï¼Œtoken</a><br><a href="https://www.zhihu.com/question/23202402" target="_blank" rel="noopener">HTTP æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ã€‚è¿™å¥è¯é‡Œçš„æ— çŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ä¹‹ Web å¼€å‘æ¡†æ¶å¯¹æ¯”â€”â€”Flask vs webpy</title>
      <link href="/blog/2019-06-05/Flask-vs-webpy/"/>
      <url>/blog/2019-06-05/Flask-vs-webpy/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><code>Python</code> å¸¸ç”¨çš„<code>web</code>å¼€å‘æ¡†æ¶æœ‰å¾ˆå¤šå¦‚<code>Django</code>ã€<code>Flask</code>ã€<code>Tornado</code>ã€<code>Web.py</code>ç­‰ï¼Œæˆ‘ä»¬ä¹‹å‰é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ <code>web.py</code>,ä½†æ˜¯æ–°é¡¹ç›®ä¸­é€‰æ‹©å“ªä¸ªï¼Ÿæˆ–è®¸æ˜¯ä¸ªå€¼å¾—æ€è€ƒçš„é—®é¢˜ã€‚æœ¬æ–‡ä¸»è¦å¯¹<code>web.py</code>å’Œ<code>Flask</code>è¿›è¡Œä¸€ä¸ªç®€å•çš„å¯¹æ¯”ã€‚</p><a id="more"></a><h2 id="ä¸ºä»€ä¹ˆè¦ä»web-pyè¿ç§»åˆ°Flask"><a href="#ä¸ºä»€ä¹ˆè¦ä»web-pyè¿ç§»åˆ°Flask" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä»web.pyè¿ç§»åˆ°Flask"></a>ä¸ºä»€ä¹ˆè¦ä»<code>web.py</code>è¿ç§»åˆ°<code>Flask</code></h2><p>å¤§åŠ¿æ‰€è¶‹ã€‚æ ¹æ®æœ€æ–°çš„<a href="https://www.jetbrains.com/research/python-developers-survey-2018/" target="_blank" rel="noopener">Python å¼€å‘è€…è°ƒç ”-2018</a>ç»“æœæ˜¾ç¤ºï¼Œ<code>Flask</code>å’Œ<code>Django</code>å·²ç»æˆä¸ºæœ€æµè¡Œçš„<code>web</code>å¼€å‘æ¡†æ¶ã€‚å¯¹ä¼ä¸šçš„è‰¯æ€§å‘å±•å’Œå¼€å‘è€…ä¸ªäººæˆé•¿è€Œè¨€ï¼Œä½¿ç”¨çƒ­é—¨æŠ€æœ¯éƒ½æ˜¯å€¼å¾—é¼“åŠ±ä¸”å¿…è¦çš„ã€‚è€Œä¸”ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå®˜æ–¹è®¡åˆ’åœ¨<code>2020</code>å¹´åœæ­¢<code>Python2</code>æ”¯æŒï¼Œè€Œç›¸æ¯”<code>Flask</code>è€Œè¨€,<code>web.py</code><br>çš„ç‰ˆæœ¬æ›´æ–°è®¡åˆ’æœ‰ç‚¹è·Ÿä¸ä¸ŠèŠ‚å¥çš„æ„Ÿè§‰ã€‚</p><p><img src="/images/Web-frameworks-python-developers-survey-2018.jpg" alt="Web-frameworks-python-developers-survey-2018"></p><center><span>Web-frameworks-python-developers-survey-2018</span></center><h2 id="TL-DRï¼ŒFlask-å¯¹æ¯”-web-py-çš„ä¸åŒç‚¹"><a href="#TL-DRï¼ŒFlask-å¯¹æ¯”-web-py-çš„ä¸åŒç‚¹" class="headerlink" title="TL;DRï¼ŒFlask å¯¹æ¯” web.py çš„ä¸åŒç‚¹"></a>TL;DRï¼Œ<code>Flask</code> å¯¹æ¯” <code>web.py</code> çš„ä¸åŒç‚¹</h2><p><code>Flask</code>æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºæ–‡åŒ–å’Œä¸°å¯Œè€Œå¼ºå¤§çš„ç¬¬ä¸‰æ–¹æ‰©å±•ï¼Œè€Œ<code>web.py</code>åœ¨åŸä½œè€…ï¼ˆAaron Swartzï¼‰è‡ªæ€ä¹‹åè‡ªèº«ç»´æŠ¤å·²ä¸¾æ­¥ç»´è‰°ï¼Œç¬¬ä¸‰æ–¹æ‰©å±•çš„å‘å±•æ›´æ˜¯ä¸è¨€è€Œå–»ã€‚</p><ul><li><p><strong>ç»´æŠ¤ç§¯ææ€§</strong>  - æœ€æ–°ç‰ˆæœ¬åˆ†åˆ«ä¸º<code>Flask-1.0.2</code>å’Œ <code>webpy-0.39</code>ã€‚</p>  <figure class="half"><br>      <img src="/images/flask-contributors.jpg" alt="flask-contributors"><br>      <center><span>flask-contributors</span></center><br>      <img src="/images/webpy-contributors.jpg" alt="webpy-contributors"><br>      <center><span>webpy-contributors</span></center><br>  </figure></li><li><p><strong>å®˜æ–¹æ–‡æ¡£</strong> - <code>Flask</code>å…·æœ‰è‰¯å¥½çš„å®˜æ–¹æ–‡æ¡£ï¼Œå¹¶ä¸”æœ‰å›½å†…ä½¿ç”¨è€…ç¿»è¯‘çš„ä¸­æ–‡æ–‡æ¡£ï¼›<code>web.py</code>åªæœ‰å‹‰å¼ºå¤Ÿç”¨ã€æ‰è¥Ÿè§è‚˜çš„å…¥é—¨çº§å®˜æ–¹æ–‡æ¡£ï¼Œå‰©ä¸‹çš„éœ€è¦å¼€å‘äººå‘˜è‡ªè¡Œæ‘¸ç´¢ã€‚</p></li><li><strong>ç¤¾åŒºæ´»è·ƒåº¦</strong> - <code>Flask</code>æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºæ–‡åŒ–å’Œæ•°é‡åºå¤§çš„æ‹¥è¶¸è€…ï¼Œ<code>web.py</code>å›½å†…åªæœ‰ä¸æ´»è·ƒçš„ä¸“é—¨çš„è±†ç“£å°ç»„æˆ–è€…åœ¨ä¸€äº›çƒ­é—¨<code>Python</code>ç¤¾åŒºå¶æœ‰æåŠã€‚</li><li>ç¬¬ä¸‰æ–¹æ‰©å±•  <ul><li>è¡¨å• - <code>Flask</code> ä½¿ç”¨æ‰©å±•<code>Flask-WTF</code>å’Œ<code>WTForms</code>å¯ä»¥å®ç°å¾ˆå¥½çš„è¡¨å•éªŒè¯å’Œ <code>csrf</code> å®‰å…¨ä¿æŠ¤ï¼›ï¼ˆå‚é˜…<a href="https://www.jianshu.com/p/7e16877757f8" target="_blank" rel="noopener">Flask-WTF ä¸ WTForms çš„ç”¨æ³•è¯¦è§£</a>ï¼‰ï¼›è€Œ<code>web.py</code>è‡ªå¸¦<a href="http://webpy.org/form" target="_blank" rel="noopener">Form åº“</a>ï¼Œå¯ä»¥å®ç°è¡¨å•åŠç®€å•æ ¡éªŒã€‚</li><li>æ•°æ®åº“ -  <code>Flask</code> ä½¿ç”¨æ‰©å±•<code>Flask-SQLAlchemy</code>å®ç°å¯¹æ•°æ®åº“çš„<code>ORM</code>æ“ä½œ,å¯ä»¥å¾ˆå¥½åœ°ç®¡ç†å’Œå®ç°æ•°æ®åº“çš„è¿ç§»(å€ŸåŠ©<code>Flask-Migrate</code>)å·¥ä½œï¼›<code>web.py</code>æˆ‘ä»¬ä½¿ç”¨è‡ªå·±å°è£…çš„<code>database.py</code>ã€‚</li><li>èº«ä»½éªŒè¯å’Œæƒé™ - <code>Flask</code>æä¾›å®‰å…¨<code>cookie</code>ä½œä¸ºæ‚¨è‡ªå·±å®ç°çš„å·¥å…·ï¼Œç¬¬ä¸‰æ–¹æ‰©å±•å¦‚<code>Flask-Login</code>(ç”¨æˆ·ä¼šè¯ç®¡ç†)ï¼Œ<code>Flask-HTTPAuth</code><sup>â‘ </sup>ï¼ˆç®€åŒ–äº†ä½¿ç”¨<code>Flask</code>è·¯ç”±çš„<code>HTTP</code>èº«ä»½éªŒè¯çš„ä½¿ç”¨ï¼‰ï¼Œ<code>Flask-Security</code>ï¼ˆæä¾›ä¸€ç«™å¼ç®¡ç†ï¼‰ï¼Œ <code>Flask-Social</code>ï¼ˆç”¨äºæ·»åŠ â€œç¤¾äº¤â€æˆ–<code>OAuth</code>ç™»å½•å’Œè¿æ¥ç®¡ç†ï¼‰ç­‰ï¼Œè¿™äº›æ‰©å±•è‰¯è ä¸é½ï¼Œä½¿ç”¨æ—¶éœ€è¦å¯¹å…¶æœ‰ä¸ªåˆæ­¥äº†è§£å¹¶è¿›è¡Œé´é€‰ï¼›<code>web.py</code>è¿˜æ˜¯è¦è‡ªå·±é€ è½®å­ã€‚</li><li><code>RESTful</code> - ä½¿ç”¨<code>Flask-RESTful</code> å¯ä»¥åˆ›å»º<code>REST</code>çš„<code>API</code>ã€‚</li><li>å¼ºå¤§çš„é¡µé¢æ¸²æŸ“ -<code>Flask</code>ä½¿ç”¨<code>jinja2</code>ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼›<code>web.py</code>ä½¿ç”¨<code>Templetor</code>,ç±» <code>python</code>,å†™èµ·æ¥ä¿¡æ‰‹æ‹ˆæ¥ï¼Œæ— ç—›è¡”æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>Mako</code>æ¨¡æ¿å¼•æ“ï¼Œä¸¤è€…å¹³åˆ†ç§‹è‰²ã€‚æ€§èƒ½å¯¹æ¯”è§è¿™é‡Œ &gt;&gt; <a href="http://www.pythontip.com/blog/post/2239/" target="_blank" rel="noopener">å‡ ä¸ªæ¨¡æ¿ç³»ç»Ÿçš„æ€§èƒ½å¯¹æ¯”</a></li></ul></li><li>ä¼¸ç¼©æ€§ - <code>Flask</code>æ—¢å¯ä»¥åƒ<code>web.py</code>é‚£æ ·åšå¾®æ¡†æ¶å¼€å‘ä¸€ä¸ªå¾ˆå°çš„<code>web</code>åº”ç”¨ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©ä¸Šæ–¹çš„å„ç§æ‰©å±•åšåˆ°<code>Django</code>çº§åˆ«çš„åº”ç”¨ã€‚</li></ul><h2 id="Flask-æ¡†æ¶"><a href="#Flask-æ¡†æ¶" class="headerlink" title="Flask æ¡†æ¶"></a>Flask æ¡†æ¶</h2><blockquote><p>Flask is a microframework for Python based on Werkzeug, Jinja 2 and good intentions.<br>Flask æ˜¯ä¸€ä¸ªåŸºäº <code>Jinja2</code> æ¨¡æ¿å¼•æ“å’Œ <code>Werkzeug WSGI</code> å¥—ä»¶çš„ä¸€ä¸ªå¾®å‹çš„<code>Web</code>å¼€å‘æ¡†æ¶ã€‚ä½“ç°äº†<code>logo</code>ä¸­çš„å£å·<code>web development, one drop at a time.</code>(<code>web</code>å¼€å‘,ä¸€æ¬¡ä¸€æ»´ã€‚)</p></blockquote><h3 id="ä»€ä¹ˆæ˜¯-â€œå¾®â€"><a href="#ä»€ä¹ˆæ˜¯-â€œå¾®â€" class="headerlink" title="ä»€ä¹ˆæ˜¯ â€œå¾®â€"></a>ä»€ä¹ˆæ˜¯ â€œå¾®â€</h3><blockquote><p>â€œå¾®â€ (â€œMicroâ€) å¹¶ä¸æ˜¯æ„å‘³ç€æŠŠæ•´ä¸ª <code>Web</code> åº”ç”¨æ”¾å…¥åˆ°ä¸€ä¸ª <code>Python</code> æ–‡ä»¶ï¼Œå°½ç®¡ç¡®å®å¯ä»¥è¿™ä¹ˆåšã€‚å½“ç„¶â€œå¾®â€ (â€œMicroâ€) ä¹Ÿä¸æ˜¯æ„å‘³ <code>Flask</code> çš„åŠŸèƒ½ä¸Šæ˜¯ä¸è¶³çš„ã€‚å¾®æ¡†æ¶ä¸­çš„ â€œå¾®â€ (â€œMicroâ€) æ˜¯æŒ‡ <code>Flask</code> æ—¨åœ¨ä¿æŒä»£ç ç®€æ´ä¸”æ˜“äºæ‰©å±•ã€‚<code>Flask</code> ä¸ä¼šæ›¿ä½ åšå‡ºå¤ªå¤šå†³ç­–â€”â€”æ¯”å¦‚ä½¿ç”¨ä½•ç§æ•°æ®åº“ã€‚è€Œé‚£äº› <code>Flask</code> æ‰€é€‰æ‹©çš„â€”â€”æ¯”å¦‚ä½¿ç”¨ä½•ç§æ¨¡æ¿å¼•æ“â€”â€”åˆ™å¾ˆå®¹æ˜“æ›¿æ¢ã€‚é™¤æ­¤ä¹‹å¤–çš„ä¸€åˆ‡éƒ½å¯ç”±ä½ æŒæ¡ã€‚å¦‚æ­¤ï¼Œ<code>Flask</code> å¯ä»¥ä¸æ‚¨ç è”ç’§åˆã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Flask</code> å¹¶ä¸åŒ…å«æ•°æ®åº“æŠ½è±¡å±‚ï¼Œè¡¨å•éªŒè¯æˆ–è€…ä»»ä½•å…¶ä»–ç°æœ‰çš„åº“( <code>Django</code> )èƒ½å¤Ÿå¤„ç†çš„ã€‚ç›¸åï¼Œ<code>Flask</code> æ”¯æŒæ‰©å±•ï¼Œè¿™äº›æ‰©å±•èƒ½å¤Ÿæ·»åŠ åŠŸèƒ½åˆ°ä½ çš„åº”ç”¨ï¼Œåƒæ˜¯ <code>Flask</code> æœ¬èº«å®ç°çš„ä¸€æ ·ã€‚ä¼—å¤šçš„æ‰©å±•æä¾›äº†æ•°æ®åº“é›†æˆï¼Œè¡¨å•éªŒè¯ï¼Œä¸Šä¼ å¤„ç†ï¼Œå¤šç§å¼€æ”¾çš„è®¤è¯æŠ€æœ¯ç­‰åŠŸèƒ½ã€‚<code>Flask</code> å¯èƒ½æ˜¯â€œå¾®â€å‹çš„ï¼Œä½†å®ƒå¯ä»¥æ¸¸åˆƒæœ‰ä½™åœ°åº”ä»˜éœ€æ±‚ç¹æ‚çš„ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨ã€‚</p></blockquote><p>â‘  åœ¨ <code>Web</code> åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¿æŠ¤æˆ‘ä»¬çš„ <code>api</code>ï¼Œä»¥é¿å…éæ³•è®¿é—®ã€‚æ¯”å¦‚ï¼Œåªå…è®¸ç™»å½•æˆåŠŸçš„ç”¨æˆ·å‘è¡¨è¯„è®ºç­‰ã€‚<code>Flask-HTTPAuth</code> æ‰©å±•å¯ä»¥å¾ˆå¥½åœ°å¯¹ <code>HTTP</code> çš„è¯·æ±‚è¿›è¡Œè®¤è¯ï¼Œä¸ä¾èµ–äº <code>Cookie</code> å’Œ <code>Session</code>ã€‚è€Œæ˜¯åŸºäºå¯†ç å’ŒåŸºäºä»¤ç‰Œ (<code>token</code>)ã€‚</p><h2 id="web-py-æ¡†æ¶"><a href="#web-py-æ¡†æ¶" class="headerlink" title="web.py æ¡†æ¶"></a><code>web.py</code> æ¡†æ¶</h2><blockquote><p>web.py is a web framework for Python that is as simple as it is powerful.<br>web.py æ˜¯ä¸€ä¸ªç®€å•ä¸”åŠŸèƒ½å¼ºå¤§çš„ç”¨äº Python è¯­è¨€çš„ web æ¡†æ¶ã€‚</p></blockquote><h3 id="web-pyè®¾è®¡å“²å­¦"><a href="#web-pyè®¾è®¡å“²å­¦" class="headerlink" title="web.pyè®¾è®¡å“²å­¦"></a><code>web.py</code>è®¾è®¡å“²å­¦</h3><p><code>web.py</code>çš„å£å·æ˜¯<code>Think about the ideal way to write a web app. Write the code to make it happen.</code>ï¼ˆæ€è€ƒç¼–å†™<code>web</code>åº”ç”¨ç¨‹åºçš„ç†æƒ³æ–¹å¼ï¼Œç„¶åå»ç¼–å†™ä»£ç å®ç°å®ƒã€‚ï¼‰<br>åœ¨ç”¨<code>Python</code>ç¼–å†™<code>web</code>åº”ç”¨ç¨‹åºçš„æ—¶å€™ï¼Œæˆ‘æƒ³è±¡è‡ªå·±æƒ³è¦<code>API</code>çš„æ–¹å¼ã€‚å®ƒå§‹äºå¯¼å…¥<code>web</code>ï¼Œç„¶åæœ‰ä¸€ä¸ªå®šä¹‰<code>URL</code>çš„åœ°æ–¹ï¼Œå¤„ç†<code>GET</code>å’Œ<code>POST</code>çš„ç®€å•å‡½æ•°å’Œä¸€äº›å¤„ç†è¾“å…¥å˜é‡çš„ä¸œè¥¿ã€‚ä¸€æ—¦ä»£ç å¯¹æˆ‘æ¥è¯´çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„, æˆ‘å°±ä¼šæƒ³å°½åŠæ³•ä½¿å®ƒåœ¨ä¸æ›´æ”¹åº”ç”¨ç¨‹åºä»£ç çš„æƒ…å†µä¸‹æ‰§è¡Œâ€”â€”ç»“æœå°±æ˜¯ <code>web.py</code>ã€‚<br>æœ‰äººæŠ±æ€¨è¯´æˆ‘â€œæäº†å¦ä¸€å¥—æ¨¡æ¿è¯­è¨€â€ï¼ˆyet another template languageï¼‰ï¼Œæˆ‘å†™äº†æ›´å¤šæ–‡å­—å…³äºæˆ‘çš„è®¾è®¡ç†å¿µï¼š<a href="http://groups.google.com/group/webpy/msg/f266701d97e7ceb1" target="_blank" rel="noopener">å‚é˜…</a></p><p>ä½ ä¸å¿…ä½¿ç”¨å®ƒâ€”â€”<code>web.py</code>çš„æ¯ä¸ªéƒ¨åˆ†éƒ½ä¸å…¶ä»–éƒ¨åˆ†å®Œå…¨åˆ†ç¦»ã€‚ä½†ä½ æ˜¯å¯¹çš„, å®ƒæ˜¯â€œå¦ä¸€ç§æ¨¡æ¿è¯­è¨€â€ï¼Œè€Œæˆ‘ä¸ä¼šä¸ºæ­¤é“æ­‰ã€‚<br><code>Web.py</code> çš„ç›®æ ‡æ˜¯æ„å»ºåˆ¶ä½œ <code>web</code> åº”ç”¨ç¨‹åºçš„ç†æƒ³æ–¹æ³•ã€‚å¦‚æœä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡éœ€è¦æœ‰å¾®å°å·®å¼‚åŒ–çš„æ¥é‡å¡‘é™ˆæ—§çš„ä¸œè¥¿, æˆ‘ä¼šæå«è‡ªå·±å¯¹å®ƒä»¬è¿›è¡Œæ”¹é€ çš„æƒåˆ©ã€‚<code>ç†æƒ³çš„æ–¹å¼</code>å’Œ<code>å‡ ä¹ç†æƒ³çš„æ–¹å¼</code>ä¹‹é—´çš„åŒºåˆ«, æ­£å¦‚é©¬å…‹Â·åæ¸©æ‰€è¨€ï¼šæ˜¯é—ªç”µå’Œè¤ç«è™«ä¹‹é—´çš„åŒºåˆ«ã€‚ï¼ˆThe difference between the right word and the almost right word is the difference between lightning and the lightning Bug.ï¼‰<br>ä½†è¿™äº›ä¸ä»…ä»…æ˜¯ç»†å¾®çš„å·®å¼‚ã€‚<code>Web.py</code> å…è®¸æ‚¨æ„å»º <code>http</code> å“åº”, è€Œä¸æš´éœ² <code>Python</code> å¯¹è±¡ã€‚<code>web.py</code> ä½¿æ•°æ®åº“æ›´æ˜“ä½¿ç”¨,è€Œä¸è¯•å›¾ä½¿æ•°æ®åº“çœ‹èµ·æ¥åƒä¸€ä¸ªå¯¹è±¡ã€‚ <code>web.py</code> æ¨¡æ¿ç³»ç»Ÿè¯•å›¾æŠŠ <code>Python</code> çº³å…¥ <code>HTML</code>è€Œä¸æ˜¯æƒ³å‡ºå¦ä¸€ç§æ–¹æ³•æ¥ç¼–å†™ <code>HTML</code>ã€‚æ²¡å¤šå°‘äººçœŸæ­£å°è¯•è¿‡è¿™ä¹ˆåšçš„å¯èƒ½æ€§ã€‚<br>ä½ å¯ä»¥ä¸åŒæ„è¿™äº›æ–¹æ³•æ›´å¥½å¹¶ç»™å‡ºåŸå› ï¼Œä½†ä»…ä»…æ‰¹è¯„å®ƒä»¬ä¸ä¼—ä¸åŒæ˜¯æµªè´¹æ—¶é—´ã€‚æ˜¯çš„, å®ƒä»¬å¤©ç”Ÿéª„å‚²ã€‚æˆ‘çš„è¯è®²å®Œäº†ã€‚<br>æ–‡å­—æ¥æºï¼š<a href="http://webpy.org/philosophy" target="_blank" rel="noopener">The web.py Philosophy</a></p><h2 id="Show-me-the-code"><a href="#Show-me-the-code" class="headerlink" title="Show me the code"></a>Show me the code</h2><h3 id="web-py"><a href="#web-py" class="headerlink" title="web.py"></a>web.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> web</span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">    <span class="string">'/'</span>, <span class="string">'Index'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello, world!"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># def POST(self):</span></span><br><span class="line">    <span class="comment">#     pass    # TODO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    web.config.debug = <span class="literal">False</span></span><br><span class="line">    app = web.application(urls, globals())</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><ol><li>å¯¼å…¥<code>web</code>æ¨¡å—ï¼›</li><li>ç»„è£…<code>url</code>ç»“æ„ï¼›<ul><li>ç¬¬ä¸€éƒ¨åˆ†ä¸ºåŒ¹é…<code>URL</code>çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ¥å—è¯·æ±‚çš„ç±»åç§°</li></ul></li><li>å®šä¹‰ç±»<ul><li>å®šä¹‰å¤„ç†<code>GET</code>è¯·æ±‚çš„æ–¹æ³•ï¼›</li><li>å®šä¹‰ï¼ˆå¯é€‰çš„ï¼‰å¤„ç†<code>POST</code>è¯·æ±‚çš„æ–¹æ³•ï¼›</li></ul></li><li><code>debug</code>æ¨¡å¼<br> å½“åº”ç”¨åœ¨å†…å»ºçš„æœåŠ¡å™¨ä¸­è¿è¡Œæ—¶ï¼Œå®ƒä¼šä»¥<code>debug</code>æ¨¡å¼å¯åŠ¨ç¨‹åºã€‚åœ¨<code>debug</code>æ¨¡å¼ä¸‹ï¼Œä»»ä½•ä»£ç ã€æ¨¡æ¿çš„ä¿®æ”¹ï¼Œéƒ½ä¼šè®©æœåŠ¡å™¨é‡æ–°åŠ è½½å®ƒä»¬ï¼Œç„¶åè¿˜ä¼šè¾“å‡ºæœ‰ç”¨çš„é”™è¯¯æ¶ˆæ¯ã€‚<br> åªæœ‰åœ¨ç”Ÿäº§ç¯å¢ƒä¸­<code>debug</code>æ¨¡å¼æ˜¯å…³é—­çš„ï¼Œå¦‚æœä½ æƒ³ç¦ç”¨<code>debug</code>æ¨¡å¼ï¼Œä½ å¯ä»¥åœ¨åˆ›å»ºç¨‹åº/æ¨¡æ¿å‰æ·»åŠ ç½®ä¸º<code>False</code>ã€‚</li><li>åˆ›å»ºåº”ç”¨ï¼Œè¿™ä¸ª<code>application</code>ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶çš„å…¨å±€å‘½åç©ºé—´ä¸­æŸ¥æ‰¾<code>urls</code>ä¸­å®šä¹‰çš„å¯¹åº”ç±»ã€‚</li><li>å¯åŠ¨åº”ç”¨ã€‚</li></ol><h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/',methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    æ‰“å¼€è°ƒè¯•æ¨¡å¼çš„å¦ä¸€ç§è®¾ç½®æ–¹å¼</span></span><br><span class="line"><span class="string">    app.debug = True</span></span><br><span class="line"><span class="string">    app.run()</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¹‹åï¼Œæµè§ˆ<code>http://0.0.0.1:5000/</code>å³å¯è®¿é—®ã€‚<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python app.py</span><br><span class="line"> * Running on http://0.0.0.1:5000/</span><br></pre></td></tr></table></figure></p><p>ä»£ç è§£é‡Š</p><ol><li>å¯¼å…¥<code>Flask</code>ç±»ï¼›</li><li>å®ä¾‹åŒ–ï¼Œå³ç”Ÿæˆæˆ‘ä»¬çš„ <code>WSGI</code> åº”ç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨æ¨¡å—çš„åç§°ã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å•ä¸€çš„æ¨¡å—ï¼ˆå°±å¦‚æœ¬ä¾‹ï¼‰ï¼Œç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥ä½¿ç”¨ <code>__name__</code>ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä¼ é€’ç»™å®ƒæ¨¡å—æˆ–åŒ…çš„åç§°ã€‚è¿™æ · <code>Flask</code> æ‰ä¼šçŸ¥é“å»å“ªé‡Œå¯»æ‰¾æ¨¡æ¿ã€é™æ€æ–‡ä»¶ç­‰ç­‰ã€‚</li><li>ä½¿ç”¨è£…é¥°å™¨ <code>route()</code> å‘Šè¯‰ <code>Flask</code> å“ªä¸ª <code>URL</code> æ‰èƒ½è§¦å‘æˆ‘ä»¬çš„å‡½æ•°ã€‚<ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œè·¯ç”±åªä¼šå“åº” <code>GET</code> è¯·æ±‚ï¼Œ ä½†æ˜¯èƒ½å¤Ÿé€šè¿‡ç»™ <code>route()</code> è£…é¥°å™¨æä¾› <code>methods</code> å‚æ•°æ”¹å˜ã€‚</li></ul></li><li>å®šä¹‰å‡½æ•°ï¼Œè¯¥å‡½æ•°åä¹Ÿæ˜¯ç”¨æ¥ç»™ç‰¹å®šå‡½æ•°ç”Ÿæˆ <code>URLs</code>ï¼Œå¹¶ä¸”è¿”å›æˆ‘ä»¬æƒ³è¦æ˜¾ç¤ºåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸Šçš„ä¿¡æ¯ã€‚</li><li>æœ€åæˆ‘ä»¬ç”¨å‡½æ•° <code>run()</code> å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨æ¥è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ã€‚<ul><li><code>host=&#39;0.0.0.0&#39;</code>ä½ å¯ä»¥è®©ä½ çš„æœåŠ¡å™¨å¯¹å¤–å¯è§ã€‚</li><li><code>debug=True</code>å¼€å¯è°ƒå¼æ¨¡å¼,ä»…é€‚ç”¨äºå¼€å‘é˜¶æ®µï¼Œåœ¨ä»£ç ä¿®æ”¹çš„æ—¶å€™æœåŠ¡å™¨èƒ½å¤Ÿè‡ªåŠ¨åŠ è½½ï¼Œå‘ç”Ÿé”™è¯¯ä¹‹åå¯ä»¥æ›´å¥½è¿½è¸ªè°ƒè¯•ï¼› <strong>ç”Ÿäº§æ¨¡å¼æ—¶ï¼Œä¸€å®šè¦å…³é—­è¯¥é€‰é¡¹ã€‚</strong></li></ul></li></ol><p><strong>æ³¨æ„</strong><br>å¯èƒ½æœ‰äººæƒ³è¦ä½¿ç”¨<code>Flask</code>å®ç°<code>web.py</code>ç±»ä¼¼çš„<code>RESTful</code>çš„ä»£ç è®¾è®¡é£æ ¼ï¼Œå€ŸåŠ©<code>Flask-RESTful</code>å¯ä»¥å®ç°åƒ<code>web.py</code>ä¸€æ ·çš„<code>RESTful</code>è®¾è®¡ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_restful <span class="keyword">import</span> Resource, Api</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span><span class="params">(Resource)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">'hello'</span>: <span class="string">'world'</span>&#125;</span><br><span class="line"></span><br><span class="line">api.add_resource(HelloWorld, <span class="string">'/'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></p><h2 id="å…³äº-Flask-çš„è“æœ¬-è“å›¾ï¼ˆBlueprintï¼‰"><a href="#å…³äº-Flask-çš„è“æœ¬-è“å›¾ï¼ˆBlueprintï¼‰" class="headerlink" title="å…³äº Flask çš„è“æœ¬/è“å›¾ï¼ˆBlueprintï¼‰"></a>å…³äº Flask çš„è“æœ¬/è“å›¾ï¼ˆBlueprintï¼‰</h2><p>åœ¨<code>Flask</code>ä¸­å¯ä»¥ç”¨<code>Blueprint</code> (è“å›¾) å®ç°åº”ç”¨çš„<strong>æ¨¡å—åŒ–</strong>ï¼Œåº”ç”¨å±‚æ¬¡æ¸…æ™°ï¼Œè“å›¾å¯ä»¥æå¤§åœ°<strong>ç®€åŒ–å¤§å‹åº”ç”¨</strong>å¹¶ä¸ºæ‰©å±•æä¾›é›†ä¸­çš„æ³¨å†Œå…¥å£ã€‚<br>è“å›¾é€šå¸¸ä½œç”¨äºç›¸åŒçš„<code>URL</code>å‰ç¼€ï¼Œå¦‚<code>/user/:id</code>ã€<code>/user/profile</code>è¿™æ ·çš„åœ°å€ï¼Œéƒ½ä»¥<code>/user</code>å¼€å¤´ï¼Œå®ƒä»¬æ˜¯ä¸€ç»„ç”¨æˆ·ç›¸å…³çš„æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ã€‚<br>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éƒ½æ˜¯ååŒå¼€å‘å„å…±åŒè¿›è¡Œçš„ï¼Œä½¿ç”¨è“å›¾å¯ä»¥é¿å…äº’ç›¸å¹²æ‰°ï¼Œå¼€å‘äººå‘˜ä¸€çœ‹è·¯ç”±å°±èƒ½å¾ˆå¿«çš„æ‰¾åˆ°å¯¹åº”çš„è§†å›¾ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°<strong>å¼€å‘å’Œç»´æŠ¤</strong>é¡¹ç›®ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨è“å›¾ç»„ç»‡åº”ç”¨çš„é¡¹ç›®ç»“æ„ï¼š<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">app/</span><br><span class="line">    __init__.py</span><br><span class="line">    admin/</span><br><span class="line">        __init__.py</span><br><span class="line">        views.py</span><br><span class="line">        static/</span><br><span class="line">        templates/</span><br><span class="line">    home/</span><br><span class="line">        __init__.py</span><br><span class="line">        views.py</span><br><span class="line">        static/</span><br><span class="line">        templates/</span><br><span class="line">    control_panel/</span><br><span class="line">        __init__.py</span><br><span class="line">        views.py</span><br><span class="line">        static/</span><br><span class="line">        templates/</span><br><span class="line">    models.py</span><br><span class="line">    runserver.py</span><br></pre></td></tr></table></figure></p><p>å‚é˜…<a href="https://www.zhihu.com/question/31748237" target="_blank" rel="noopener">å¦‚ä½•ç†è§£ Flask ä¸­çš„è“æœ¬ï¼Ÿ</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>éœ€æ±‚é©±åŠ¨ï¼Œæ²¡æœ‰æœ€å¥½çš„æ¡†æ¶ï¼Œåªæœ‰é€‚åˆä½ çš„æ¡†æ¶ã€‚<br>ä¸¤è€…éƒ½æ˜¯è½»é‡çº§<code>web</code>å¼€å‘æ¡†æ¶ï¼ˆç›¸è¾ƒäº<code>Django</code>è€Œè¨€ï¼‰ï¼Œéƒ½å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å¹¶éµå¾ª<code>Pythonic</code>è®¾è®¡ï¼Œéå¸¸é€‚åˆåˆå­¦è€…å­¦ä¹ ä¸ä½¿ç”¨ã€‚<br><code>web.py</code>åšæŒå°è€Œç¾çš„è®¾è®¡ç†å¿µã€‚ç®€å•ç›´æ¥ï¼Œå­¦ä¹ æˆæœ¬æ›´ä½ï¼Œå¯¹äºæ–°æ‰‹ç†è§£ web å¤„ç†æµç¨‹å¾ˆæœ‰å¸®åŠ©ï¼Œæ›´é€‚åˆæ•æ·å¼€å‘å’Œå®šåˆ¶åŒ–ï¼Œå½“ç„¶ä¹Ÿå°±æ„å‘³ç€å¯èƒ½éœ€è¦è‡ªå·±é€ æ›´å¤šçš„è½®å­ã€‚<br>è€Œ<code>Flask</code>æ‹¥æœ‰åºæ‚çš„ç¬¬ä¸‰æ–¹æ‰©å±•å¯ä»¥å‚è€ƒä½¿ç”¨ï¼Œå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œé‡åˆ°é—®é¢˜æ›´å¥½å‘ç¤¾åŒºå¯»æ±‚ç­”æ¡ˆã€‚å½“ç„¶ï¼Œéšç€å¼€å‘çš„æ·±å…¥ï¼Œå¯èƒ½ä¼´éšä¸€ç³»åˆ—æ‰©å±•çš„äº†è§£å’Œå­¦ä¹ ï¼Œä¼šæ¶ˆè€—è¾ƒå¤šæ—¶é—´ã€‚ä½†æ˜¯ç›¸æ¯”<code>Django</code>è¿™ç§<code>å®Œç¾ä¸»ä¹‰è€…ç”¨æ¥èµ¶æœŸé™çš„é€‰æ‹©</code>ï¼Œä½ ä¸å¿…ä¸€å¼€å§‹å°±å­¦æ‰€æœ‰çš„ä¸œè¥¿ï¼ˆsessionã€ORMã€CSRFã€Formã€Templateã€Middleware ç­‰ï¼‰ï¼Œå¯ä»¥è‡ªä¸»æ­é…ï¼Œæ¸è¿›å¼€å‘ã€‚<br>æ‰€ä»¥ï¼Œå¯¹äºå…¨æ–°é¡¹ç›®ï¼Œä¸ºäº†åç»­çš„å¯æŒç»­è¿­ä»£å’Œç»´æŠ¤ï¼Œç›¸æ¯”<code>web.py</code>æ›´å»ºè®®é€‰æ‹©<code>Flask</code>ã€‚</p><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><h3 id="æ¡†æ¶å¯¹æ¯”"><a href="#æ¡†æ¶å¯¹æ¯”" class="headerlink" title="æ¡†æ¶å¯¹æ¯”"></a>æ¡†æ¶å¯¹æ¯”</h3><ul><li><a href="https://kite.com/blog/python/flask-vs-django-python" target="_blank" rel="noopener">Flask vs Django</a></li><li><a href="https://www.douban.com/group/topic/29598761/" target="_blank" rel="noopener">web.py,web2py,django ä¸‰è€…é—´åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ- è±†ç“£</a></li><li><a href="https://www.zhihu.com/question/20708601" target="_blank" rel="noopener">Flask æ¡†æ¶æ€ä¹ˆæ ·ï¼Œæ¯”èµ· Web.py æœ‰å“ªäº›ä¸åŒï¼Ÿ- çŸ¥ä¹</a></li><li><a href="https://stackoverflow.com/questions/5695689/web-py-and-flask" target="_blank" rel="noopener">web.py-and-flask- StackOverflow</a></li><li><a href="https://www.quora.com/Which-is-better-Flask-vs-web-py-Why" target="_blank" rel="noopener">Which is better: Flask vs web.py? Why?-Quora</a></li><li><a href="https://www.reddit.com/r/Python/comments/28qr7c/can_anyone_explain_the_differences_between_web2py/" target="_blank" rel="noopener">Can anyone explain the differences between web2py, Django, Flask, etc, and when I should use one or the other and what the benefits and drawbacks of each?-Reddit</a></li></ul><h3 id="Flaskå­¦ä¹ èµ„æº"><a href="#Flaskå­¦ä¹ èµ„æº" class="headerlink" title="Flaskå­¦ä¹ èµ„æº"></a><code>Flask</code>å­¦ä¹ èµ„æº</h3><ul><li><a href="http://flask.pocoo.org/" target="_blank" rel="noopener">Welcome | Flask (A Python Microframework)</a></li><li><a href="http://docs.jinkan.org/docs/flask/index.html" target="_blank" rel="noopener">Flask ä¸­æ–‡æ–‡æ¡£</a></li><li><a href="https://www.ctolib.com/docs/sfile/head-first-flask/" target="_blank" rel="noopener">Flask Web å¼€å‘å…¥é—¨</a></li><li><a href="http://www.pythondoc.com/flask-mega-tutorial/index.html" target="_blank" rel="noopener">æ¬¢è¿è¿›å…¥ Flask å¤§å‹é¡¹ç›®æ•™ç¨‹</a></li><li><a href="https://book.douban.com/subject/26274202/" target="_blank" rel="noopener">Flask Web å¼€å‘ï¼šåŸºäº Python çš„ Web åº”ç”¨å¼€å‘å®æˆ˜ -ï¼ˆç‹—ä¹¦ï¼‰</a></li><li><a href="https://book.douban.com/subject/30310340/" target="_blank" rel="noopener">Flask Web å¼€å‘å®æˆ˜ -ï¼ˆç‹¼ä¹¦ï¼‰</a></li></ul><h3 id="Flaskæ‰©å±•"><a href="#Flaskæ‰©å±•" class="headerlink" title="Flaskæ‰©å±•"></a><code>Flask</code>æ‰©å±•</h3><ul><li><a href="https://github.com/humiaozuzu/awesome-flask" target="_blank" rel="noopener">Awesome Flask(Flask èµ„æºå’Œæ’ä»¶çš„ç²¾é€‰åˆ—è¡¨)</a></li><li><a href="http://www.pythondoc.com/" target="_blank" rel="noopener">Flask æ–‡æ¡£å’Œä¸»æµç¬¬ä¸‰æ–¹æ‰©å±•æ–‡æ¡£</a></li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><ul><li><a href="https://www.zhihu.com/question/20711220" target="_blank" rel="noopener">äºšä¼¦Â·æ–¯æ²ƒèŒ¨ (Aaron Swartz) æ˜¯æ€ä¹ˆæ ·ä¸€ä¸ªäººï¼Ÿ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flask </tag>
            
            <tag> Web å¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ä¸­å­˜å‚¨ IP åœ°å€åº”è¯¥é€‰ç”¨ä½•ç§æ•°æ®ç±»å‹ï¼Ÿ</title>
      <link href="/blog/2019-05-11/which-mysql-datatype-use-for-store-an-ip-address/"/>
      <url>/blog/2019-05-11/which-mysql-datatype-use-for-store-an-ip-address/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©åœ¨é¡¹ç›®å¼€å‘æ—¶ï¼Œé‡åˆ°éœ€è¦åœ¨æ•°æ®åº“ä¸­å­˜å‚¨ ip åœ°å€ï¼Œé‚£ä¹ˆåº”è¯¥é€‰ç”¨ä½•ç§æ•°æ®ç±»å‹æ›´åŠ é«˜æ•ˆå‘¢ï¼Ÿ<br>å¦‚æœå­˜å‚¨çš„æ˜¯<code>IPV4</code>åœ°å€ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨<code>INT UNSIGNED</code>ï¼Œç„¶åå€ŸåŠ© <code>MySQL</code> è‡ªå¸¦çš„ <code>INET_ATON()</code> å’Œ  <code>INET_NTOA()</code>æ¥å­˜å–æ•°æ®ï¼›<br>å¦‚æœå­˜å‚¨çš„æ˜¯<code>IPV6</code>åœ°å€ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨<code>VARBINARY()</code>ï¼Œç„¶åå€ŸåŠ© <code>INET6_ATON()</code>å’Œ<code>INET6_NTOA()</code> (<code>MySQL5.6+</code>æ”¯æŒ)æ–¹æ³•å­˜å–æ•°æ®ã€‚</p><a id="more"></a><h2 id="é’ˆå¯¹IPv4åœ°å€"><a href="#é’ˆå¯¹IPv4åœ°å€" class="headerlink" title="é’ˆå¯¹IPv4åœ°å€"></a>é’ˆå¯¹<code>IPv4</code>åœ°å€</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select inet_aton('127.0.0.1');</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| inet_aton('127.0.0.1') |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">|             2130706433 |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">inet_ntoa</span>(<span class="number">2130706433</span>);</span><br><span class="line">+<span class="comment">-----------------------+</span></span><br><span class="line">| inet_ntoa(2130706433) |</span><br><span class="line">+<span class="comment">-----------------------+</span></span><br><span class="line">| 127.0.0.1             |</span><br><span class="line">+<span class="comment">-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®å­˜å–"><a href="#æ•°æ®å­˜å–" class="headerlink" title="æ•°æ®å­˜å–"></a>æ•°æ®å­˜å–</h3><ul><li><p>å­˜æ•°æ®</p>  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`ip_addresses`</span> (<span class="string">`ip_address`</span>)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="keyword">INET_ATON</span>(<span class="string">'127.0.0.1'</span>));</span><br></pre></td></tr></table></figure></li><li><p>å–æ•°æ®</p>  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">INET_NTOA</span>(<span class="string">`ip_address`</span>) <span class="keyword">AS</span> ip</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`ip_addresses`</span>;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Pythonå®ç°"><a href="#Pythonå®ç°" class="headerlink" title="Pythonå®ç°"></a><code>Python</code>å®ç°</h3><p>å¯¹äºä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨å†…ç½®çš„<code>MySQL</code>æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨åº”ç”¨å±‚ä½¿ç”¨è‡ªå·±å°è£…çš„æ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket, struct</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip2long</span><span class="params">(ip)</span>:</span>  </span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">"!L"</span>,socket.inet_aton(ip))[<span class="number">0</span>]  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long2ip</span><span class="params">(longip)</span>:</span>  </span><br><span class="line">    <span class="keyword">return</span> socket.inet_ntoa(struct.pack(<span class="string">'!L'</span>, longip))  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:  </span><br><span class="line">    print(<span class="string">'local ip address to long is %s'</span>%ip2long(<span class="string">'127.0.0.1'</span>))  </span><br><span class="line">    print(<span class="string">'local ip address to long is %s'</span>%ip2long(<span class="string">'255.255.255.255'</span>))  </span><br><span class="line">    print(<span class="string">'local ip address long to ip is %s'</span>%long2ip(<span class="number">2130706433</span>))  </span><br><span class="line">    print(<span class="string">'local ip address long to ip is %s'</span>%long2ip(<span class="number">4294967295</span>))</span><br></pre></td></tr></table></figure><h2 id="é’ˆå¯¹IPv6åœ°å€"><a href="#é’ˆå¯¹IPv6åœ°å€" class="headerlink" title="é’ˆå¯¹IPv6åœ°å€"></a>é’ˆå¯¹<code>IPv6</code>åœ°å€</h2><p>MySQL æä¾›å†…ç½®å‡½æ•°<code>inet6_aton()</code>æ¥å­˜å‚¨å’Œæ£€ç´¢<code>IPv6</code>åœ°å€ã€‚æ•²é»‘æ¿ï¼Œä¸è¦æŠŠ<code>IPv6</code>åœ°å€å­˜å‚¨ä¸ºæ•´æ•°ï¼Œå› ä¸ºæ•°å­—æ ¼å¼çš„<code>IPv6</code>åœ°å€éœ€è¦æ¯”<code>UNSIGNED BIGINT</code>æ›´å¤šçš„å­—èŠ‚ã€‚æ‰€ä»¥ä¸‹é¢çš„å‡½æ•°è¿”å›<code>VARBINARY(16)</code>æ•°æ®ç±»å‹ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select hex(inet6_aton('127.0.0.1'));</span><br><span class="line">+<span class="comment">---------------------------------+</span></span><br><span class="line">| hex(inet6_aton('127.0.0.1'))    |</span><br><span class="line">+<span class="comment">---------------------------------+</span></span><br><span class="line">| 7F000001                        |</span><br><span class="line">+<span class="comment">---------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">inet6_aton</span>(<span class="string">'2001:0db8:85a3:0000:0000:8a2e:0370:7334'</span>));</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">| hex(inet6_aton('2001:0db8:85a3:0000:0000:8a2e:0370:7334'))                |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">| 20010DB885A3000000008A2E03707334                                          |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">inet6_ntoa</span>(<span class="keyword">unhex</span>(<span class="string">'20010DB885A3000000008A2E03707334'</span>));</span><br><span class="line">+<span class="comment">----------------------------------------------------------------------------+</span></span><br><span class="line">| inet6_ntoa(unhex('20010DB885A3000000008A2E03707334'))                      |</span><br><span class="line">+<span class="comment">----------------------------------------------------------------------------+</span></span><br><span class="line">| 2001:db8:85a3::8a2e:370:7334                                               |</span><br><span class="line">+<span class="comment">----------------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p><strong>æ³¨æ„</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™æŸ¥æ‰¾ä»¥<code>ip</code>åœ°å€ä¸º<code>127.0.0.1</code>è¿æ¥çš„ç”¨æˆ·ï¼Œå¯èƒ½å†™å‡ºå¦‚ä¸‹çš„æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> <span class="keyword">inet_ntoa</span>(ipaddress)=<span class="string">'127.0.0.1'</span>;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œæ­¤æŸ¥è¯¢ä¸ä¼šä½¿ç”¨åœ¨<code>ipaddress</code>åˆ—ä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨<code>SQL</code>æ‰§è¡ŒæœŸé—´ä¿®æ”¹äº†ç´¢å¼•åˆ—ï¼Œå®ƒä¹Ÿä¼šé€è¡Œå°†æ•´æ•°è½¬æ¢ä¸ºçœŸå®çš„<code>IP</code>åœ°å€ã€‚æ‰€ä»¥è¦æƒ³è®©ç´¢å¼•ç”Ÿæ•ˆåº”è¯¥ï¼š<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> @ip = <span class="keyword">inet_aton</span>(<span class="string">'127.0.0.1'</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> ipaddress = @ip;</span><br></pre></td></tr></table></figure></p><p>æˆ–è€…<br><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> ipaddress = <span class="keyword">inet_aton</span>(<span class="string">'127.0.0.1'</span>);</span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://www.rathishkumar.in/2017/08/how-to-store-ip-address-in-mysql.html" target="_blank" rel="noopener">How to store IP (internet protocol) address in MySQL?</a></li><li><a href="https://itsolutionstuff.com/post/which-mysql-datatype-use-for-store-an-ip-address" target="_blank" rel="noopener">Which MySQL datatype use for store an IP address?</a></li><li><a href="https://stackoverflow.com/questions/2542011/most-efficient-way-to-store-ip-address-in-mysql" target="_blank" rel="noopener">Most efficient way to store IP Address in MySQL</a></li><li><a href="https://dev.mysql.com/doc/refman/5.6/en/miscellaneous-functions.html#function_inet6-aton" target="_blank" rel="noopener">MySQL doc-function_inet6-aton</a></li><li><a href="https://www.cnblogs.com/gomysql/p/4595621.html" target="_blank" rel="noopener">IP åœ°å€åœ¨æ•°æ®åº“é‡Œé¢çš„å­˜å‚¨æ–¹å¼</a></li><li><a href="https://www.cnblogs.com/skynet/archive/2011/01/09/1931044.html" target="_blank" rel="noopener">è®º IP åœ°å€åœ¨æ•°æ®åº“ä¸­åº”è¯¥ç”¨ä½•ç§å½¢å¼å­˜å‚¨?</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•é…ç½® Pycharm ä½¿ç”¨è¿œç¨‹çš„ Flask è™šæ‹Ÿå¼€å‘ç¯å¢ƒï¼Ÿ</title>
      <link href="/blog/2019-05-06/pycharm-with-remote-flask-venv/"/>
      <url>/blog/2019-05-06/pycharm-with-remote-flask-venv/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å­¦ä¹ <code>Flask</code>å¼€å‘çš„æ—¶å€™ï¼Œå› ä¸ºä¸»æœºæ˜¯<code>Windows</code>ç¯å¢ƒï¼Œè€Œæ—¥å¸¸è·‘æœåŠ¡çš„æ˜¯<code>Linux</code>ç¯å¢ƒï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡é…ç½®<code>pycharm</code>ä½¿ä¹‹ä½¿ç”¨è¿œç«¯çš„è™šæ‹Ÿç¯å¢ƒã€‚</p><a id="more"></a><h2 id="åˆ›å»ºè™šæ‹ŸæœºFlaskç¯å¢ƒ"><a href="#åˆ›å»ºè™šæ‹ŸæœºFlaskç¯å¢ƒ" class="headerlink" title="åˆ›å»ºè™šæ‹ŸæœºFlaskç¯å¢ƒ"></a>åˆ›å»ºè™šæ‹Ÿæœº<code>Flask</code>ç¯å¢ƒ</h2><p>ç•¥</p><p>æ­¤å¤„åœ¨ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°å¾ˆå¤šå†™å¥½çš„æ•™ç¨‹ï¼Œä¸éœ€è¦æˆ‘å†æ¬¡å åºŠæ¶å±‹äº†ã€‚</p><h2 id="é…ç½®Pycharmç¯å¢ƒ"><a href="#é…ç½®Pycharmç¯å¢ƒ" class="headerlink" title="é…ç½®Pycharmç¯å¢ƒ"></a>é…ç½®<code>Pycharm</code>ç¯å¢ƒ</h2><p>æ‰“å¼€ Pycharm çš„ setting å¯¹è¯æ¡†ï¼ŒæŒ‰ç…§å¦‚ä¸‹é…ç½®  </p><p><img src="/images/snipaste_20190506_141224.jpg" alt="setting_start"></p><p>ä¾æ¬¡è¾“å…¥çœŸå®è¿œç«¯ä¿¡æ¯ä¹‹åï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç›´åˆ°å‡ºç°ä¸‹æ–¹å¯¹è¯æ¡†</p><p><img src="/images/snipaste_20190506_142141.jpg" alt="setting_end"></p><p>ä¾æ¬¡ä¿®æ”¹å°†è¦ä½¿ç”¨çš„è§£é‡Šå™¨å’Œä¸»æœºä¸è¿œç«¯éœ€è¦ä¿æŒåŒæ­¥çš„ç›®å½•ï¼›</p><p><img src="/images/snipaste_20190506_143428.jpg" alt="setting_flask"></p><p>å¦‚å›¾è®¾ç½®ä¹‹åè¿è¡Œï¼Œ<code>Run</code>å‡ºç°å¦‚ä¸‹ç»“æœ<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FLASK_APP = app</span><br><span class="line">FLASK_ENV = development</span><br><span class="line">FLASK_DEBUG = 1</span><br><span class="line">In folder D:/MYcode/flk</span><br><span class="line">ssh://root@192.168.116.21:22/home/imoyao/envs/flk/bin/python -u -m flask run --host=0.0.0.0</span><br><span class="line"> * Serving Flask app "app" (lazy loading)</span><br><span class="line"> * Environment: development</span><br><span class="line"> * Debug mode: on</span><br><span class="line"> * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br><span class="line"> * Restarting with stat</span><br><span class="line"> * Debugger is active!</span><br><span class="line"> * Debugger PIN: 820-491-228</span><br></pre></td></tr></table></figure></p><p>ä¹‹ååœ¨æœ¬æœºè®¿é—®è™šæ‹Ÿæœº<code>ip</code>ï¼Œæ¯”å¦‚æœ¬ä¾‹ä¸­çš„<code>192.168.116.21:5000</code>ï¼Œå³å¯è¿›å…¥<code>app</code>é¦–é¡µã€‚</p><h2 id="æ³¨æ„é—®é¢˜"><a href="#æ³¨æ„é—®é¢˜" class="headerlink" title="æ³¨æ„é—®é¢˜"></a>æ³¨æ„é—®é¢˜</h2><p>åœ¨é…ç½®å¥½ä¸Šè¿°é€‰é¡¹ä¹‹åï¼Œè¿è¡Œå¯èƒ½ä¼šæç¤º <code>NoAppException: Could not import &quot;app&quot;.</code>ã€‚è¿™ä¸ªé—®é¢˜æš‚æ—¶ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¼•èµ·ï¼Œå¯èƒ½æ˜¯<code>Pycharm</code>è¯†åˆ«è·¯å¾„æœ‰è¯¯å¯¼è‡´ï¼Œæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°å¾ˆå¥½çš„è§£å†³åŠæ³•ã€‚å¤§å®¶å¯ä»¥å‚è€ƒä¸‹å›¾å°è¯•é…ç½®ï¼ˆé€’å½’æ‰‹åŠ¨è®¾ç½®ç›®å½•ï¼Œå¯èƒ½æœ‰ç”¨ï¼‰ã€‚</p><p><img src="/images/snipaste_20190507_133810.jpg" alt="can&#39;t_import_app"></p><h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>ä»Šå¤©çªç„¶å‡ºç°ä¸èƒ½è®¿é—®çš„é—®é¢˜ï¼Œä½¿ç”¨<code>netstat nap|grep 5000(flask è¿è¡Œç«¯å£)</code>æŸ¥çœ‹ç«¯å£çŠ¶æ€ï¼š<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN      8195/python</span><br></pre></td></tr></table></figure></p><p>è¯´æ˜ç«¯å£æ­£å¸¸å¼€æ”¾ï¼Œæ€€ç–‘æ˜¯é˜²ç«å¢™çš„åŸå› <br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure></p><p>å…³é—­ä¹‹åå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œç¡®è®¤æ˜¯å…¶é—®é¢˜ã€‚<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=5000/tcp --permanent</span><br><span class="line">Warning: ALREADY_ENABLED: 5000:tcp</span><br><span class="line">success</span><br></pre></td></tr></table></figure></p><p>é‡å¯é˜²ç«å¢™ä¹‹åå¯ä»¥æ­£å¸¸è®¿é—®ï¼š<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@172 ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line"></span><br><span class="line">[root@172 ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">FirewallD is not running</span><br><span class="line"></span><br><span class="line">[root@172 ~]<span class="comment"># firewall-cmd --state</span></span><br><span class="line">running</span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://www.jetbrains.com/help/pycharm/run-debug-configuration-flask-server.html" target="_blank" rel="noopener">é…ç½®<code>flask</code>æœåŠ¡è¿›è¡Œè°ƒè¯•</a></li><li><a href="https://www.jetbrains.com/help/pycharm/configuring-python-interpreter.html" target="_blank" rel="noopener">é…ç½®<code>Python</code>è§£é‡Šå™¨</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flask </tag>
            
            <tag> HOWTO </tag>
            
            <tag> PyCharm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨ï¼Ÿ| é€šè¿‡å¯¹è±¡å¼•ç”¨ä¼ é€’</title>
      <link href="/blog/2019-04-13/python-pass-by-object-reference/"/>
      <url>/blog/2019-04-13/python-pass-by-object-reference/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å“ˆå§†é›·ç‰¹ä¸æ˜¯èå£«æ¯”äºšå†™çš„;å®ƒåªæ˜¯ç”±ä¸€ä¸ªåå«èå£«æ¯”äºšçš„äººå†™çš„ã€‚<br>Python é€šè¿‡å¯¹è±¡å¼•ç”¨ä¼ é€’ã€‚</p><a id="more"></a><p>æœ¬æ–‡è¯‘è‡ª <a href="https://robertheaton.com/2014/02/09/pythons-pass-by-object-reference-as-explained-by-philip-k-dick/" target="_blank" rel="noopener">Is Python pass-by-reference or pass-by-value?</a></p><blockquote><p>â€œå‡è®¾æˆ‘å¯¹ Fat è¯´ï¼Œæˆ– Kevin å¯¹ Fat è¯´ï¼Œâ€œä½ æ²¡æœ‰ç»å†è¿‡ä¸Šå¸ã€‚ä½ åªä¸è¿‡ç»å†äº†ä¸€äº›ä¸ä¸Šå¸çš„å“è´¨ã€æ–¹é¢ã€æ€§è´¨ã€åŠ›é‡ã€æ™ºæ…§å’Œå–„è‰¯æœ‰å…³çš„äº‹æƒ…ã€‚â€è¿™å°±åƒæ˜¯å…³äºå¾·å›½äººè®²çš„ä¸€ä¸ªåŒé‡æŠ½è±¡å€¾å‘çš„ç¬‘è¯ï¼›å¾·å›½è‹±å›½æ–‡å­¦æƒå¨å®£ç§°ï¼Œâ€œå“ˆå§†é›·ç‰¹ä¸æ˜¯èå£«æ¯”äºšå†™çš„;å®ƒåªæ˜¯ç”±ä¸€ä¸ªåå«èå£«æ¯”äºšçš„äººå†™çš„ã€‚â€åœ¨è‹±è¯­è¯­å¢ƒä¸­ï¼Œè¿™å¥è¯çš„åŒºåˆ«åªæ˜¯å£å¤´çš„ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ï¼Œå°½ç®¡å¾·è¯­ä¸­è¿™ç§è¡¨è¾¾å­˜åœ¨å·®å¼‚ï¼ˆè¿™è§£é‡Šäº†å¾·å›½æ€æƒ³çš„ä¸€äº›å¥‡æ€ªç‰¹å¾ï¼‰ã€‚â€<br>  </p><p align="right"> â€“Valisï¼Œp71ï¼ˆBook-of-the-Month-Club Editionï¼‰</p><p></p></blockquote><p>Philip K. Dick å¹¶ä¸ä»¥å…¶è½»æ¾æˆ–æ˜“æ‡‚çš„æ•£æ–‡è€Œé—»åã€‚ç»å¤§å¤šæ•°è§’è‰²éƒ½å¾ˆé«˜ã€‚å°±åƒï¼ŒçœŸçš„ï¼ŒçœŸçš„ï¼ŒçœŸçš„å¾ˆé«˜ã€‚ç„¶è€Œï¼Œåœ¨ Valis çš„ä¸Šè¿°å¼•æ–‡ï¼ˆ1981 å¹´å‡ºç‰ˆï¼‰ä¸­ï¼Œä»–å¯¹è‡­åæ˜­ç€çš„<code>Python</code>å‚æ•°ä¼ é€’èŒƒå¼ç»™å‡ºäº†éå¸¸æœ‰è¿œè§çš„è§£é‡Šã€‚Plus Ã§a change, plus câ€™est omnomnomnom drugs.</p><p>åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å‚æ•°ä¼ é€’çš„ä¸¤ç§æœ€å¹¿ä¸ºäººçŸ¥ä¸”æ˜“äºç†è§£çš„æ–¹æ³•æ˜¯æŒ‰å¼•ç”¨ä¼ é€’( pass-by-reference )å’ŒæŒ‰å€¼ä¼ é€’ ( pass-by-value )ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ<code>Python</code>æ˜¯â€œä¼ é€’å¯¹è±¡å¼•ç”¨â€( pass-by-object-reference )ï¼Œç»å¸¸è¯´ï¼š</p><p>â€œå¯¹è±¡å¼•ç”¨æŒ‰å€¼ä¼ é€’ã€‚â€(Object references are passed by value.)</p><p>å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªæ²¾æ²¾è‡ªå–œå’Œè¿‡äºç²¾è¾Ÿçš„å®šä¹‰æ—¶ï¼Œæˆ‘æƒ³æ¶äººã€‚åœ¨ä»æ‰‹ä¸Šå–ä¸‹ç»ç’ƒç¢ç‰‡å¹¶è¢«æŠ¤é€å‡ºè„±è¡£èˆä¿±ä¹éƒ¨åï¼Œ<del>æˆ‘æ„è¯†åˆ°æ‰€æœ‰ 3 ç§èŒƒä¾‹éƒ½å¯ä»¥ç†è§£å®ƒä»¬å¦‚ä½•å¯¼è‡´ä»¥ä¸‹ 2 ä¸ªåŠŸèƒ½çš„è¡¨ç°ï¼š</del></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reassign</span><span class="params">(alist)</span>:</span></span><br><span class="line">    alist = [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(alist)</span>:</span></span><br><span class="line">    alist.append(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">alist = [<span class="number">0</span>]</span><br><span class="line">reassign(alist)</span><br><span class="line">append(alist)</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="å˜é‡ä¸æ˜¯å¯¹è±¡"><a href="#å˜é‡ä¸æ˜¯å¯¹è±¡" class="headerlink" title="å˜é‡ä¸æ˜¯å¯¹è±¡"></a>å˜é‡ä¸æ˜¯å¯¹è±¡</h2><p>â€œå“ˆå§†é›·ç‰¹ä¸æ˜¯èå£«æ¯”äºšå†™çš„;å®ƒåªæ˜¯ç”±ä¸€ä¸ªåå«èå£«æ¯”äºšçš„äººå†™çš„ã€‚â€ Python å’Œ PKDï¼ˆ Philip K. Dickï¼‰éƒ½åœ¨ä¸€ä¸ªä¸œè¥¿çš„æœ¬è´¨ä¸æˆ‘ä»¬ç”¨æ¥æŒ‡ä»£é‚£ä¸ªä¸œè¥¿çš„æ ‡ç­¾ä¹‹é—´åšå‡ºäº†è‡³å…³é‡è¦çš„åŒºåˆ†ã€‚ â€œè¿™ä¸ªåå«èå£«æ¯”äºšçš„ç”·äººâ€æ˜¯ä¸€ä¸ªå…·ä½“çš„äººã€‚ è€Œâ€œèå£«æ¯”äºšâ€åªæ˜¯ä¸€ä¸ªåå­—ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = []</span><br></pre></td></tr></table></figure></p><p><code>[]</code>æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ a æ˜¯æŒ‡å‘ç©ºåˆ—è¡¨çš„å˜é‡ï¼Œä½†å…¶æœ¬èº«å¹¶ä¸æ˜¯ç©ºåˆ—è¡¨ã€‚æˆ‘ç”»å›¾å¹¶å°†å˜é‡ç§°ä¸ºåŒ…å«å¯¹è±¡çš„â€œç›’å­â€;ä½†æ— è®ºå¦‚ä½•ä½ æ„æƒ³å®ƒï¼Œè¿™ç§å·®å¼‚æ˜¯å…³é”®ã€‚<br><img src="https://robertheaton.com/images/Intro.jpg" alt="Pass-by-reference"></p><h2 id="é€šè¿‡å¼•ç”¨ä¼ é€’"><a href="#é€šè¿‡å¼•ç”¨ä¼ é€’" class="headerlink" title="é€šè¿‡å¼•ç”¨ä¼ é€’"></a>é€šè¿‡å¼•ç”¨ä¼ é€’</h2><p>åœ¨ pass-by-reference ä¸­ï¼Œboxï¼ˆå˜é‡ï¼‰ç›´æ¥ä¼ é€’ç»™å‡½æ•°ï¼Œå…¶å†…å®¹ï¼ˆç”±å˜é‡è¡¨ç¤ºçš„å¯¹è±¡ï¼‰éšæ€§åœ°éšä¹‹è€Œæ¥ã€‚åœ¨å‡½æ•°ä¸Šä¸‹æ–‡ä¸­ï¼Œå‚æ•°æœ¬è´¨ä¸Šæ˜¯è°ƒç”¨è€…ä¼ å…¥çš„å˜é‡çš„å®Œæ•´åˆ«åã€‚å®ƒä»¬éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ç›’å­ï¼Œå› æ­¤ä¹ŸæŒ‡å‘å†…å­˜ä¸­å®Œå…¨ç›¸åŒçš„å¯¹è±¡ã€‚<br><img src="https://robertheaton.com/images/PBRIntro.jpg" alt></p><p>å› æ­¤ï¼Œå‡½æ•°å¯¹å˜é‡æˆ–å®ƒæ‰€ä»£è¡¨çš„å¯¹è±¡æ‰€åšçš„ä»»ä½•æ“ä½œéƒ½å°†å¯¹è°ƒç”¨è€…å¯è§ã€‚ä¾‹å¦‚ï¼Œè¯¥å‡½æ•°å¯ä»¥å®Œå…¨æ›´æ”¹å˜é‡çš„å†…å®¹ï¼Œå¹¶å°†å…¶æŒ‡å‘å®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼š</p><p><img src="https://robertheaton.com/images/PBRReassign.jpg" alt></p><p>è¯¥å‡½æ•°è¿˜å¯ä»¥åœ¨ä¸é‡æ–°åˆ†é…å¯¹è±¡çš„æƒ…å†µä¸‹æ“ä½œå¯¹è±¡ï¼Œæ•ˆæœç›¸åŒï¼š<br><img src="https://robertheaton.com/images/PBRAppend.jpg" alt></p><p>é‡ç”³ä¸€ä¸‹ï¼Œåœ¨<code>pass-by-reference</code>ä¸­ï¼Œå‡½æ•°å’Œè°ƒç”¨è€…éƒ½ä½¿ç”¨å®Œå…¨ç›¸åŒçš„å˜é‡å’Œå¯¹è±¡ã€‚</p><h2 id="é€šè¿‡å€¼ä¼ é€’"><a href="#é€šè¿‡å€¼ä¼ é€’" class="headerlink" title="é€šè¿‡å€¼ä¼ é€’"></a>é€šè¿‡å€¼ä¼ é€’</h2><p>åœ¨<code>pass-by-value</code>ä¸­ï¼Œå‡½æ•°æ¥æ”¶è°ƒç”¨è€…ä¼ é€’ç»™å®ƒçš„å‚æ•°å¯¹è±¡çš„å‰¯æœ¬ï¼Œå¹¶åœ¨å†…å­˜ä¸­å¼€è¾Ÿæ–°çš„ç©ºé—´ä¿å­˜ã€‚</p><p><img src="https://robertheaton.com/images/PBVIntro.jpg" alt></p><p>ç„¶åï¼Œè¯¥å‡½æ•°æœ‰æ•ˆåœ°æä¾›å…¶è‡ªå·±çš„ç›’å­ä»¥å°†å€¼æ”¾å…¥ï¼Œå¹¶ä¸”å‡½æ•°å’Œè°ƒç”¨è€…å¼•ç”¨çš„å˜é‡æˆ–å¯¹è±¡ä¹‹é—´ä¸å†å­˜åœ¨ä»»ä½•å…³ç³»ã€‚è¿™äº›å¯¹è±¡ç¢°å·§å…·æœ‰ç›¸åŒçš„å€¼ï¼Œä½†å®ƒä»¬å®Œå…¨æ˜¯åˆ†å¼€çš„ï¼Œä¸€ä¸ªå¯¹è±¡ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚å¦‚æœæˆ‘ä»¬å†æ¬¡å°è¯•é‡æ–°åˆ†é…ï¼š</p><p><img src="https://robertheaton.com/images/PBVReassign.jpg" alt></p><p>åœ¨å‡½æ•°ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•ååº”ã€‚åŒç†ï¼š</p><p><img src="https://robertheaton.com/images/PBVAppend.jpg" alt></p><p>è°ƒç”¨è€…ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å’Œå¯¹è±¡çš„å‰¯æœ¬æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚</p><h2 id="é€šè¿‡å¯¹è±¡å¼•ç”¨ä¼ é€’"><a href="#é€šè¿‡å¯¹è±¡å¼•ç”¨ä¼ é€’" class="headerlink" title="é€šè¿‡å¯¹è±¡å¼•ç”¨ä¼ é€’"></a>é€šè¿‡å¯¹è±¡å¼•ç”¨ä¼ é€’</h2><p>åœ¨<code>Python</code>æ˜¯ä¸åŒçš„ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨<code>Python</code>ä¸­ï¼Œâ€œå¯¹è±¡å¼•ç”¨æŒ‰å€¼ä¼ é€’â€ï¼ˆ<code>Object references are passed by value</code>ï¼‰ã€‚</p><p>å‡½æ•°æ¥æ”¶å¯¹ï¼ˆå¹¶å°†è®¿é—®ï¼‰å†…å­˜ä¸­ä¸è°ƒç”¨è€…ä½¿ç”¨çš„ç›¸åŒå¯¹è±¡çš„å¼•ç”¨ã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šæ”¶åˆ°è°ƒç”¨è€…æ­£åœ¨å­˜å‚¨æ­¤å¯¹è±¡çš„ç›’å­;åœ¨<code>pass-by-value</code>ä¸­ï¼Œå‡½æ•°æä¾›è‡ªå·±çš„ç­å¹¶ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°å˜é‡ã€‚è®©æˆ‘ä»¬å†æ¬¡æ‰§è¡Œ<code>append</code>ï¼š</p><p><img src="https://robertheaton.com/images/PBORAppend.jpg" alt></p><p>å‡½æ•°å’Œè°ƒç”¨è€…éƒ½å¼•ç”¨å†…å­˜ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å½“<code>append</code>å‡½æ•°å‘åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªé¢å¤–çš„é¡¹æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåœ¨è°ƒç”¨è€…ä¸­çœ‹åˆ°è¿™ä¸ªï¼å®ƒä»¬æ˜¯åŒä¸€ä¸ªä¸œè¥¿çš„ä¸åŒåç§°;åŒ…å«ç›¸åŒå¯¹è±¡çš„ä¸åŒç­ã€‚è¿™æ„å‘³ç€æ˜¯é€šè¿‡å€¼ä¼ é€’å¯¹è±¡å¼•ç”¨çš„â€”â€”å‡½æ•°å’Œè°ƒç”¨è€…åœ¨å†…å­˜ä¸­ä½¿ç”¨ç›¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯é€šè¿‡ä¸åŒçš„å˜é‡è®¿é—®ã€‚è¿™æ„å‘³ç€åŒä¸€ä¸ªå¯¹è±¡è¢«å­˜å‚¨åœ¨å¤šä¸ªä¸åŒçš„ç­ä¸­ï¼Œè€Œè¿™ç§éšå–»ä¼šè¢«æ‰“ç ´ã€‚<del>å‡å®šå®ƒæ˜¯é‡å­æˆ–å…¶ä»–ä¸œè¥¿ã€‚</del></p><p>ä½†å…³é”®æ˜¯å®ƒä»¬çœŸçš„æ˜¯ä¸åŒçš„åå­—å’Œä¸åŒçš„ç›’å­ã€‚åœ¨<code>pass-by-reference</code>ä¸­ï¼Œå®ƒä»¬æ˜¯ç›¸åŒçš„ç›’å­ã€‚å½“ä½ è¯•å›¾é‡æ–°åˆ†é…ä¸€ä¸ªå˜é‡ï¼Œå¹¶å°†ä¸€äº›ä¸åŒçš„ä¸œè¥¿æ”¾å…¥å‡½æ•°çš„ç›’å­ä¸­æ—¶ï¼Œä½ ä¹Ÿå°†å®ƒæ”¾å…¥è°ƒç”¨è€…çš„ç›’å­ä¸­ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªç›’å­ã€‚ä½†æ˜¯ï¼Œåœ¨<code>pass-by-object-reference</code>ä¸­ï¼š</p><p><img src="https://robertheaton.com/images/PBORReassign.jpg" alt></p><p>è°ƒç”¨è€…ä¸åœ¨ä¹ä½ æ˜¯å¦é‡æ–°åˆ†é…æ–¹æ³•çš„ç›’å­ã€‚ä¸åŒçš„ç›’å­ï¼Œç›¸åŒçš„å†…å®¹ã€‚</p><p>ç°åœ¨æˆ‘ä»¬çœ‹çœ‹è²åˆ©æ™®Â·KÂ·è¿ªå…‹è¯•å›¾å‘Šè¯‰æˆ‘ä»¬çš„äº‹æƒ…ã€‚åå­—å’Œäººæ˜¯ä¸åŒçš„ä¸œè¥¿ã€‚å˜é‡å’Œå¯¹è±¡æ˜¯ä¸åŒçš„ä¸œè¥¿ã€‚æœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œä½ æˆ–è®¸å¯ä»¥å¼€å§‹æ¨æ–­å½“ä½ åšè¿™æ ·çš„äº‹æƒ…æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">listA = [0]</span><br><span class="line">listB = listA</span><br><span class="line">listB.append(1)</span><br><span class="line">print listA</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½è¿˜æƒ³äº†è§£è¿™äº›æ¦‚å¿µä¸å¯å˜å’Œä¸å¯å˜ç±»å‹ä¹‹é—´çš„æœ‰è¶£äº¤äº’ã€‚ä½†è¿™äº›æ˜¯å¦ä¸€å›äº‹äº†ã€‚ç°åœ¨ï¼Œå¦‚æœä½ èƒ½åŸè°…æˆ‘ï¼Œæˆ‘è¦å»è¯»ã€ŠDororoids Dream Of Electric Sheepï¼Ÿã€‹äº†ã€‚ - æˆ‘å¯¹å…ƒç¼–ç¨‹æœ‰ç‚¹ç”Ÿç–ã€‚</p><hr><p><a href="https://eev.ee/blog/2012/05/23/python-faq-passing/" target="_blank" rel="noopener">Does Python pass by reference or value?</a></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="http://foobarnbaz.com/2012/07/08/understanding-python-variables/" target="_blank" rel="noopener">http://foobarnbaz.com/2012/07/08/understanding-python-variables/</a> </li><li><a href="http://javadude.com/articles/passbyvalue.htm" target="_blank" rel="noopener">http://javadude.com/articles/passbyvalue.htm</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ä¸‹å¦‚ä½•å®‰è£… Redisï¼Ÿ</title>
      <link href="/blog/2019-04-11/how-to-install-Redis-on-Linux/"/>
      <url>/blog/2019-04-11/how-to-install-Redis-on-Linux/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><code>Redis</code>æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„<code>key-value</code>æ•°æ®åº“ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•å¦‚ä½•åœ¨<code>Linux</code>ç³»ç»Ÿä¸Šè¿›è¡Œå®‰è£…ï¼Œä»¥åŠä¸º<code>Python</code>å¼€å‘å®‰è£…å¯¹åº”çš„<code>redis</code>æ¨¡å—ã€‚</p><a id="more"></a><h2 id="æµ‹è¯•ç¯å¢ƒ"><a href="#æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ"></a>æµ‹è¯•ç¯å¢ƒ</h2><ul><li><p><code>Linux</code>ç‰ˆæœ¬</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Ubuntu 18.04 LTS &amp;&amp; NeoKylin 3.2</span><br></pre></td></tr></table></figure></li><li><p><code>Python</code>ç‰ˆæœ¬</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Python 2.7.15rc1 &amp;&amp; Python 2.6.6</span><br></pre></td></tr></table></figure></li><li><p><code>Redis</code>ç‰ˆæœ¬</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-5.0.4</span><br></pre></td></tr></table></figure></li><li><p><code>redis-py</code>ç‰ˆæœ¬</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-3.2.1 &amp;&amp; redis-2.10.6</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>ä¸‹è½½åœ°å€ï¼š<code>http://redis.io/download</code>ï¼Œä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆæœ¬æºç ã€‚</p><p>æœ¬æ–‡ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º <code>redis-5.0.4</code>ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><ol><li><p>è§£å‹ç¼©</p><p> é¦–å…ˆè¦è§£å‹<code>Redis</code>å‹ç¼©åŒ…ã€‚è¿›å…¥å‹ç¼©åŒ…ä¸‹è½½çš„è·¯å¾„ï¼Œæ‰§è¡Œï¼š</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xzf redis-5.0.4.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>GCC</code>ç¼–è¯‘æºç </p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd redis-5.0.4</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…<code>Redis</code></p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@local:~/temp# redis-server -v</span><br><span class="line">Redis server v=5.0.4 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=3dcf53963ddc396a</span><br><span class="line">root@local:~/temp# whereis redis-server</span><br><span class="line">redis-server: /usr/local/bin/redis-server</span><br></pre></td></tr></table></figure></li></ol><p>è‡³æ­¤ï¼Œ<code>Redis</code>å®‰è£…å®Œæˆã€‚</p><h3 id="CentOs"><a href="#CentOs" class="headerlink" title="CentOs"></a>CentOs</h3><ol><li><p>ç¼–è¯‘å®‰è£…</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make $$ make install</span><br></pre></td></tr></table></figure><p> æ­¤æ—¶æŠ¥é”™</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CC adlist.o</span><br><span class="line">/bin/sh: cc: command not found</span><br><span class="line">make[1]: *** [adlist.o] Error 127</span><br><span class="line">make[1]: Leaving directory `/root/temp/redis-5.0.4/src'</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… gcc</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install gcc -y</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>é‡æ–° make</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p> æ­¤æ—¶æŠ¥é”™</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">In file included from adlist.c:34:</span><br><span class="line">zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory</span><br><span class="line">zmalloc.h:55:2: error: #error "Newer version of jemalloc required"</span><br><span class="line">make[1]: *** [adlist.o] Error 1</span><br><span class="line">make[1]: Leaving directory `/root/temp/redis-5.0.4/src'</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure><p> åœ¨æ„å»º<code>Redis</code>æ—¶é€‰æ‹©éé»˜è®¤å†…å­˜åˆ†é…å™¨æ˜¯é€šè¿‡è®¾ç½®<code>MALLOC</code>ç¯å¢ƒå˜é‡å®Œæˆçš„ï¼Œ é»˜è®¤æƒ…å†µä¸‹ Redis æ˜¯ä½¿ç”¨<code>malloc</code>ä¸º<code>libc</code>ç¼–è¯‘å’Œé“¾æ¥çš„ã€‚<br> è€Œ<code>libc</code>å¹¶ä¸æ˜¯<code>Linux</code>ä¸Šé»˜è®¤çš„åˆ†é…å™¨ï¼Œé»˜è®¤çš„æ˜¯ <code>jemalloc</code>, å› ä¸º <code>jemalloc</code> è¢«è¯æ˜æ¯”<code>libc</code>æœ‰æ›´å°‘çš„ç¢ç‰‡é—®é¢˜ï¼ˆ<code>fragmentation problems</code>ï¼‰ã€‚<br> ä½†æ˜¯å¦‚æœä½ æ²¡æœ‰<code>jemalloc</code> è€Œåªæœ‰<code>libc</code> å½“ç„¶ <code>make</code> å‡ºé”™ã€‚ æ‰€ä»¥æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</p></li></ol><ul><li><p><del>æ–¹æ³•ä¸€</del>ï¼ˆä¸æ¨èï¼‰</p>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make MALLOC=libc</span><br></pre></td></tr></table></figure></li></ul><hr><ul><li><p>æ–¹æ³•äºŒ</p>  <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd deps/</span><br><span class="line">make hiredis jemalloc linenoise lua geohash-int</span><br></pre></td></tr></table></figure></li></ul><p>åŸå› å‚è§ï¼š <a href="http://www.jb51.net/article/100575.htm" target="_blank" rel="noopener">æµ…è°ˆ redis é‡‡ç”¨ä¸åŒå†…å­˜åˆ†é…å™¨ tcmalloc å’Œ jemalloc</a></p><blockquote><p>å¯¹äº<code>tcmalloc</code>ï¼Œ<code>jemalloc</code>å’Œ<code>libc</code>å¯¹åº”çš„ä¸‰ä¸ªå†…å­˜åˆ†é…å™¨ã€‚å…¶æ€§èƒ½å’Œç¢ç‰‡ç‡å¦‚ä½•å‘¢ï¼Ÿ<br>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•æµ‹è¯•ç»“æœï¼Œä½¿ç”¨<code>Redis</code>è‡ªå¸¦çš„<code>redis-benchmark</code>å†™å…¥ç­‰é‡æ•°æ®è¿›è¡Œæµ‹è¯•ï¼Œæ•°æ®æ‘˜è‡ªé‡‡ç”¨ä¸åŒåˆ†é…å™¨æ—¶<code>Redis info</code>ä¿¡æ¯ã€‚<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé‡‡ç”¨<code>tcmalloc</code>æ—¶ç¢ç‰‡ç‡æ˜¯æœ€ä½çš„ï¼Œä¸º<code>1.01</code>ï¼Œ<code>jemalloc</code>ä¸º<code>1.02</code>ï¼Œè€Œ<code>libc</code>çš„åˆ†é…å™¨ç¢ç‰‡ç‡ä¸º<code>1.31</code>ï¼Œ</p></blockquote><ol><li><p>ç¼–è¯‘å®‰è£…</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make $$ make install</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯</p> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-server -v</span><br><span class="line">Redis server v=5.0.4 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=b139020f90f1d493</span><br><span class="line">whereis redis-server</span><br><span class="line">redis-server: /usr/local/bin/redis-server</span><br></pre></td></tr></table></figure></li></ol><p>è‡³æ­¤ï¼Œ<code>Redis</code>å®‰è£…å®Œæˆã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®<code>Redis</code>æœåŠ¡å¼€æœºè‡ªå¯åŠ¨ã€‚</p><ol><li><p>è®¾ç½®è‡ªå¯åŠ¨é…ç½®æ–‡ä»¶</p><ol><li><p>åˆ‡æ¢ç›®å½•</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd utils/</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶è„šæœ¬æ–‡ä»¶</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp redis_init_script /etc/init.d/redisd</span><br></pre></td></tr></table></figure><p> å°†<code>redis_init_script</code>æ–‡ä»¶é‡æ–°å‘½åä¸º<code>redisd</code>ï¼Œä½œä¸ºç³»ç»Ÿå¯åŠ¨æœåŠ¡åï¼ˆä»¥<code>d</code>ç»“å°¾è¡¨ç¤ºæ˜¯è‡ªå¯åŠ¨æœåŠ¡ï¼Œçº¦å®šä¿—æˆï¼‰ã€‚</p></li><li><p>ä¿®æ”¹é…ç½®</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/init.d/redisd</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>redisd</code>æ–‡ä»¶ï¼Œæ³¨æ„è¦åœ¨æ–‡ä»¶å¤´éƒ¨åŠ ä¸Šä¸¤å¥æ³¨é‡Šæ¥è®¾å®šè¯¥æœåŠ¡çš„è¿è¡Œçº§åˆ«</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> chkconfig:   2345 90 10</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>è®¾ç½®<code>Redis</code>æ§åˆ¶è„šæœ¬çš„é…ç½®æ–‡ä»¶</p><ol><li><p>åˆ‡æ¢ç›®å½•</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd -</span><br><span class="line">cd ..</span><br></pre></td></tr></table></figure></li><li><p>åœ¨<code>redis</code>å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°<code>redis.conf</code>æ–‡ä»¶</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></figure><p> å¦‚ä¸‹</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">00-RELEASENOTES  INSTALL     runtest           tests</span><br><span class="line">BUGS             Makefile    runtest-cluster   utils</span><br><span class="line">CONTRIBUTING     MANIFESTO   runtest-sentinel</span><br><span class="line">COPYING          README.md   sentinel.conf</span><br><span class="line">deps             redis.conf  src</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶é…ç½®æ–‡ä»¶å¹¶é‡å‘½å</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp redis.conf /etc/redis/6379.conf</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘<code>Redis</code>é…ç½®æ–‡ä»¶</p><ol><li><p>è®¾ç½®<code>daemonize</code>ä¸º<code>yes</code>ï¼Œä½¿æœåŠ¡å¯ä»¥åå°è¿è¡Œï¼š</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nu:136</span></span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®<code>log</code>æ–‡ä»¶è·¯å¾„ï¼š</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nu:171</span></span><br><span class="line">logfile /var/log/redis/redis-server.log</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼š</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> nu:263</span></span><br><span class="line">dir /var/lib/redis</span><br></pre></td></tr></table></figure></li></ol></li><li><p>ä¿å­˜é€€å‡ºï¼Œå¹¶åˆ›å»ºç›¸åº”çš„ç›®å½•ç»“æ„ï¼š</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir /var/log/redis</span><br><span class="line">touch /var/log/redis/redis-server.log</span><br><span class="line">mkdir /var/lib/redis</span><br></pre></td></tr></table></figure></li></ol></li><li><p>è®¾ç½®å¼€æœºè‡ªå¯</p><h4 id="Ubuntu-1"><a href="#Ubuntu-1" class="headerlink" title="Ubuntu"></a>Ubuntu</h4> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> èµ‹æƒ</span></span><br><span class="line">chmod +x /etc/init.d/redisd</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°ç³»ç»Ÿå¯åŠ¨é¡¹</span></span><br><span class="line">update-rc.d redisd defaults</span><br></pre></td></tr></table></figure><h4 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h4> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master init.d]# chmod +x ./redisd</span><br><span class="line">[root@master init.d]# chkconfig redisd on</span><br></pre></td></tr></table></figure></li></ol><h2 id="é™„ï¼šå¸¸ç”¨redisç®¡ç†å‘½ä»¤"><a href="#é™„ï¼šå¸¸ç”¨redisç®¡ç†å‘½ä»¤" class="headerlink" title="é™„ï¼šå¸¸ç”¨redisç®¡ç†å‘½ä»¤"></a>é™„ï¼šå¸¸ç”¨<code>redis</code>ç®¡ç†å‘½ä»¤</h2><ul><li>å¯åŠ¨<code>Redis</code>æœåŠ¡ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service redisd start</span><br><span class="line">[root@master init.d]# service redisd start</span><br><span class="line">Starting Redis server...</span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯</span></span><br><span class="line">[root@master init.d]# ps aux|grep redis|grep -v grep</span><br><span class="line">root      6728  0.1  0.4  55572  9820 ?        Ssl  11:03   0:00 /usr/local/bin/redis-server 127.0.0.1:6379</span><br></pre></td></tr></table></figure><ul><li>å…³é—­æœåŠ¡ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master init.d]# service redisd stop</span><br><span class="line">Stopping ...</span><br><span class="line">Redis stopped</span><br><span class="line">[root@master init.d]# ps aux|grep redis|grep -v grep</span><br></pre></td></tr></table></figure><ul><li>é‡å¯æœåŠ¡ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service redisd restart</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ§åˆ¶å°ä¸­ç™»å½•<code>redis</code>å®¢æˆ·ç«¯ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@master init.d]# redis-cli</span><br><span class="line"># æµ‹è¯•redisè¿é€šæ€§</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br><span class="line">127.0.0.1:6379&gt; set hello world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get hello</span><br><span class="line">&quot;world&quot;</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…æä¾›Pythonæ”¯æŒ"><a href="#å®‰è£…æä¾›Pythonæ”¯æŒ" class="headerlink" title="å®‰è£…æä¾›Pythonæ”¯æŒ"></a>å®‰è£…æä¾›<code>Python</code>æ”¯æŒ</h2><h3 id="pip-å®‰è£…"><a href="#pip-å®‰è£…" class="headerlink" title="pip å®‰è£…"></a>pip å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install redis</span><br></pre></td></tr></table></figure><h3 id="æºç å®‰è£…"><a href="#æºç å®‰è£…" class="headerlink" title="æºç å®‰è£…"></a>æºç å®‰è£…</h3><p>å»<code>https://pypi.org/project/redis/</code>ä¸‹è½½æºç ï¼Œ<code>Ubuntu</code>ä¸Šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬<code>redis 3.2.1</code></p><ol><li><p>è§£å‹</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -xzvf redis-3.2.1.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>åˆ‡æ¢ç›®å½•</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd redis-3.2.1</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure></li><li><p>éªŒè¯</p> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@local:~/temp/redis-3.2.1# python</span><br><span class="line">Python 2.7.15rc1 (default, Apr 15 2018, 21:51:34) </span><br><span class="line">[GCC 7.3.0] on linux2</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; import redis</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; import redis</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; r = redis.Redis(host=<span class="string">'localhost'</span>, port=6379, db=0)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; ret = r.get(<span class="string">'hello'</span>)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; <span class="built_in">print</span> ret</span></span><br><span class="line">world</span><br></pre></td></tr></table></figure></li></ol><hr><p><strong>å°æ’æ›²</strong></p><p>å…³äº redis-py çš„ Python ä½ç‰ˆæœ¬æ”¯æŒ</p><p>åœ¨<code>CentOS</code>ä¸Šå®‰è£…<code>redis-3.2.1</code>çš„æ—¶å€™ç”±äº<code>python</code>ç‰ˆæœ¬è¾ƒä½ï¼ˆ<code>2.6.6</code>ï¼‰å‡ºç°ä»¥ä¸‹é—®é¢˜<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master redis-3.2.1]# python setup.py install</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "setup.py", line 4, in &lt;module&gt;</span><br><span class="line">    from setuptools import setup</span><br><span class="line">ImportError: No module named setuptools</span><br></pre></td></tr></table></figure></p><p>å®‰è£…<code>setuptools-0.6c9</code>ä¹‹åæ‰§è¡Œ<code>python setup.py install</code>æŠ¥é”™ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "setup.py", line 7, in &lt;module&gt;</span><br><span class="line">    from redis import __version__</span><br><span class="line">  File "/root/temp/pyredis-3.2.1/redis/__init__.py", line 1, in &lt;module&gt;</span><br><span class="line">    from redis.client import Redis, StrictRedis</span><br><span class="line">  File "/root/temp/pyredis-3.2.1/redis/client.py", line 3046</span><br><span class="line">    return &#123;decode(encode(k)): v for k, v in iteritems(data)&#125;</span><br><span class="line">                                   ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure><p>å»å®˜ç½‘æŸ¥çœ‹ï¼Œå‘ç°æœ€æ–°ç‰ˆç‰ˆæœ¬æ”¯æŒä¸ºï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Meta</span><br><span class="line">â€¦â€¦</span><br><span class="line"> Tags: Redis, key-value store</span><br><span class="line"></span><br><span class="line">Requires: Python &gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*</span><br></pre></td></tr></table></figure></p><p>ä»¥åŠ</p><blockquote><p>Python Version Support<br>redis-py 3.0 now supports Python 2.7 and Python 3.4+. Python 2.6 and 3.3 support has been dropped.</p></blockquote><p>æœ€åå®‰è£…è¾ƒä½ç‰ˆæœ¬ï¼ˆ<code>redis-2.10.6</code>ï¼‰æˆåŠŸï¼Œæ­¥éª¤åŒä¸Šï¼Œä¸å†èµ˜è¿°ã€‚</p><p>è¯»è€…å¯ä»¥ä» <a href="https://pypi.org/project/redis/#history" target="_blank" rel="noopener">è¿™é‡Œ</a> è·å–å†å²ç‰ˆæœ¬ï¼š<code>https://pypi.org/project/redis/#history</code></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://redis.io/topics/quickstart" target="_blank" rel="noopener">Redis Quick Start</a></li><li><a href="https://blog.csdn.net/softwave/article/details/53838194" target="_blank" rel="noopener">Ubuntu å®‰è£… Redis å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨æœåŠ¡</a></li><li><a href="https://www.cnblogs.com/cnkai/p/7642787.html" target="_blank" rel="noopener">Python æ“ä½œ Redis æ•°æ®åº“</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> HOWTO </tag>
            
            <tag> NoSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è·å– Ztree çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼Ÿ</title>
      <link href="/blog/2019-01-30/how-to-get-leaf-nodes-of-Ztree/"/>
      <url>/blog/2019-01-30/how-to-get-leaf-nodes-of-Ztree/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä½¿ç”¨<code>Ztree</code>æ—¶ï¼Œ<code>treeNode.children</code>åªèƒ½è·å–åˆ°å­èŠ‚ç‚¹ï¼Œè¯¥å¦‚ä½•æ‹¿åˆ°èŠ‚ç‚¹çš„å¶å­èŠ‚ç‚¹å‘¢ï¼Ÿ</p><a id="more"></a><h2 id="åˆ›å»ºåˆå§‹åŒ–è®¾ç½®"><a href="#åˆ›å»ºåˆå§‹åŒ–è®¾ç½®" class="headerlink" title="åˆ›å»ºåˆå§‹åŒ–è®¾ç½®"></a>åˆ›å»ºåˆå§‹åŒ–è®¾ç½®</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> setting = &#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        simpleData: &#123;</span><br><span class="line">            enable: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    callback: &#123;</span><br><span class="line">        onCheck:onCheck,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºç‚¹å‡»å“åº”äº‹ä»¶"><a href="#åˆ›å»ºç‚¹å‡»å“åº”äº‹ä»¶" class="headerlink" title="åˆ›å»ºç‚¹å‡»å“åº”äº‹ä»¶"></a>åˆ›å»ºç‚¹å‡»å“åº”äº‹ä»¶</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onCheck</span>(<span class="params">event, treeId, treeNode, clickFlag</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> treeObj = $(ELT).fn.zTree.getZTreeObj(<span class="string">"datarecdirs"</span>);</span><br><span class="line">        <span class="keyword">var</span> str = <span class="string">""</span>;</span><br><span class="line">        str = getAllChildNodes(treeNode,str);</span><br><span class="line">        <span class="comment">// // åŠ ä¸Šè¢«é€‰æ‹©èŠ‚ç‚¹è‡ªèº«</span></span><br><span class="line">        <span class="comment">// str = str + ',' + treeNode.id;</span></span><br><span class="line">        <span class="comment">// å»æ‰æœ€å‰é¢çš„é€—å·</span></span><br><span class="line">        <span class="keyword">var</span> ids = str.substring(<span class="number">1</span>, str.length);</span><br><span class="line">        <span class="comment">// å¾—åˆ°æ‰€æœ‰èŠ‚ç‚¹ID çš„æ•°ç»„</span></span><br><span class="line">        <span class="keyword">var</span> idsArray = ids.split(<span class="string">','</span>);</span><br><span class="line">        <span class="comment">// è¿‡æ»¤æ‰åºåˆ—ä¸­çš„ç©ºå…ƒç´  [1,2,'3',"", ''] &gt;&gt;&gt; [1,2,'3']   (javascript 1.6 and above)</span></span><br><span class="line">        <span class="keyword">var</span> filterArr = idsArray.filter(<span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;<span class="keyword">return</span> n&#125;);       </span><br><span class="line">        <span class="comment">// å¾—åˆ°èŠ‚ç‚¹æ€»æ•°é‡</span></span><br><span class="line">        <span class="keyword">var</span> leafNodesLen = filterArr.length;</span><br><span class="line">        <span class="keyword">if</span>(filterArr)&#123;</span><br><span class="line">            <span class="keyword">var</span> nodeChecked = treeNode.checked;</span><br><span class="line">            <span class="keyword">if</span>(nodeChecked)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; leafNodesLen; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> idVal = filterArr[i];</span><br><span class="line">                    <span class="keyword">var</span> node = treeObj.getNodeByParam(<span class="string">"id"</span>, idVal, <span class="literal">null</span>);</span><br><span class="line">                    treeObj.setChkDisabled(node,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> j=<span class="number">0</span>; j &lt; leafNodesLen; j++) &#123;</span><br><span class="line">                    idVal = filterArr[j];</span><br><span class="line">                    <span class="comment">// æŒ‰ç…§idè·å–èŠ‚ç‚¹ï¼Œsee:https://www.oschina.net/question/222309_131001</span></span><br><span class="line">                    node = treeObj.getNodeByParam(<span class="string">"id"</span>, idVal, <span class="literal">null</span>);       <span class="comment">// æ³¨æ„ï¼šæ­¤å¤„ä¸å¯ä½¿ç”¨getNodeByTId()æ–¹æ³•</span></span><br><span class="line">                    treeObj.setChkDisabled(node,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">true</span>);  <span class="comment">//å–æ¶ˆç¦ç”¨æ—¶ï¼Œå½±å“åˆ°å­èŠ‚ç‚¹</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> nodes = treeObj.getCheckedNodes();</span><br><span class="line">                <span class="built_in">console</span>.log(nodes);</span><br><span class="line">                <span class="keyword">if</span> (nodes.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">var</span> c=<span class="number">0</span>;c&lt;nodes.length;c++)&#123;</span><br><span class="line">                        treeObj.checkNode(nodes[c],<span class="literal">false</span>,<span class="literal">true</span>);     <span class="comment">//æ³¨æ„ï¼Œæ­¤å¤„ä¸å¯ä½¿ç”¨cancelSelectedNode()</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// é€’å½’ï¼Œè·å–æ‰€æœ‰å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAllChildNodes</span>(<span class="params">treeNode,result</span>)</span>&#123;     <span class="comment">// è·å–èŠ‚ç‚¹çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (treeNode.isParent) &#123;</span><br><span class="line">        <span class="keyword">var</span> childrenNodes = treeNode.children;</span><br><span class="line">        <span class="keyword">if</span> (childrenNodes) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; childrenNodes.length; i++) &#123;</span><br><span class="line">                result += <span class="string">','</span> + childrenNodes[i].id;</span><br><span class="line">                result = getAllChildNodes(childrenNodes[i], result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span class="label label-danger">æ³¨æ„</span><blockquote><p>zTree é‡Œä¸¥æ ¼åŒºåˆ†äº†é€‰ä¸­å’Œå‹¾é€‰è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œé€‰ä¸­æ˜¯æŒ‡èŠ‚ç‚¹è¢«é€‰æ‹©èƒŒæ™¯é¢œè‰²æœ‰å˜åŒ–ï¼Œå› æ­¤ cancelSelectedNode()åªæ˜¯æŠŠä½ é€‰æ‹©çš„èŠ‚ç‚¹ï¼Œå˜æˆä¸é€‰æ‹©çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹çš„èƒŒæ™¯è‰²å‘ç”Ÿå˜åŒ–ã€‚<br>è€Œå‹¾é€‰æ˜¯æŒ‡èŠ‚ç‚¹çš„å‹¾é€‰æ¡†è¢«é€‰ä¸­ï¼Œä½ è¦å°†èŠ‚ç‚¹çš„å‹¾é€‰çŠ¶æ€ç”±å‹¾é€‰å˜ä¸ºä¸å‹¾é€‰ï¼Œå°±ä¸èƒ½ä½¿ç”¨ cancelSelectedNode()æ–¹æ³•ï¼Œåªèƒ½ä½¿ç”¨ checknode()æ–¹æ³•ï¼</p></blockquote><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><ul><li><a href="https://blog.csdn.net/qq_15071263/article/details/82797734" target="_blank" rel="noopener">zTree æ’ä»¶ - è·å–å½“å‰é€‰æ‹©èŠ‚ç‚¹ä¸‹çš„å…¨éƒ¨å­èŠ‚ç‚¹</a> </li><li><a href="https://tieba.baidu.com/p/4157358359?red_tag=3393089686" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆ cancelSelectedNode()å–æ¶ˆä¸äº†èŠ‚ç‚¹çš„é€‰ä¸­çŠ¶æ€ï¼Ÿ</a> </li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zTree </tag>
            
            <tag> å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸€æ¬¡ MySQL é”™è¯¯ â€”â€” mysqld-dead-but-subsys-locked</title>
      <link href="/blog/2019-01-25/mysqld-dead-but-subsys-locked/"/>
      <url>/blog/2019-01-25/mysqld-dead-but-subsys-locked/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>è®°ä¸€æ¬¡<code>MySQL</code>æœåŠ¡å‡ºé”™æ’æŸ¥è¿‡ç¨‹ã€‚</p><a id="more"></a><p>ä»Šå¤©ç™»å½•ç®¡ç†ç³»ç»Ÿçš„æ—¶å€™è¾“å…¥è´¦æˆ·ä¿¡æ¯æ²¡æœ‰ååº”ï¼Œåå°æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—å‘ç°æŠ¥é”™ä¿¡æ¯ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span></span></span><br><span class="line">tailf /var/log/ODSP.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> out(éƒ¨åˆ†æœ‰ç”¨ä¿¡æ¯)</span></span><br><span class="line">2019-01-25 11:30:07 database [line:263]: Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)</span><br></pre></td></tr></table></figure></p><h2 id="æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€"><a href="#æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹MySQLæœåŠ¡çŠ¶æ€"></a>æŸ¥çœ‹<code>MySQL</code>æœåŠ¡çŠ¶æ€</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span></span></span><br><span class="line">/etc/init.d/mysqld status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> out</span></span><br><span class="line">mysqld dead but subsys locked</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹MySQLçš„logä¿¡æ¯"><a href="#æŸ¥çœ‹MySQLçš„logä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹MySQLçš„logä¿¡æ¯"></a>æŸ¥çœ‹<code>MySQL</code>çš„<code>log</code>ä¿¡æ¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span></span></span><br><span class="line">tailf /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> outï¼ˆæˆªå–éƒ¨åˆ†æœ‰ç”¨ä¿¡æ¯ï¼‰</span></span><br><span class="line">700101 00:28:38 mysqld_safe mysqld from pid file /var/run/mysqld/mysqld.pid ended</span><br><span class="line">700101 00:28:42 mysqld_safe Starting mysqld daemon with databases from /secbox/var/db</span><br><span class="line">700101  0:28:42 [ERROR] This MySQL server doesn't support dates later then 2038</span><br><span class="line">700101  0:28:42 [ERROR] Aborting</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´"><a href="#æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´"></a>æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master digitools]# date</span><br><span class="line">Wed Jan  1 00:31:52 CST 2070</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°è®¾ç½®ç³»ç»Ÿæ—¶é—´"><a href="#é‡æ–°è®¾ç½®ç³»ç»Ÿæ—¶é—´" class="headerlink" title="é‡æ–°è®¾ç½®ç³»ç»Ÿæ—¶é—´"></a>é‡æ–°è®¾ç½®ç³»ç»Ÿæ—¶é—´</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master digitools]# date -s "20190125 11:28:50"</span><br><span class="line">Fri Jan 25 11:28:50 CST 2019</span><br></pre></td></tr></table></figure><h2 id="é‡æ–°å¯åŠ¨MySQLæœåŠ¡"><a href="#é‡æ–°å¯åŠ¨MySQLæœåŠ¡" class="headerlink" title="é‡æ–°å¯åŠ¨MySQLæœåŠ¡"></a>é‡æ–°å¯åŠ¨<code>MySQL</code>æœåŠ¡</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master digitools]# /etc/init.d/mysqld status</span><br><span class="line">mysqld dead but subsys locked</span><br><span class="line"></span><br><span class="line">[root@master digitools]# /etc/init.d/mysqld stop</span><br><span class="line">Stopping mysqld:                                           [  OK  ]</span><br><span class="line">[root@master digitools]# /etc/init.d/mysqld start</span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸Šé¢ä¸¤æ­¥å‘½ä»¤ä¹Ÿå¯ä»¥ç›´æ¥åˆå¹¶ä¸ºæ‰§è¡Œ `/etc/init.d/mysqld restart`</span></span><br><span class="line">[root@master digitools]# /etc/init.d/mysqld status</span><br><span class="line">mysqld (pid  19402) is running...</span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—æ¢å¤æ­£å¸¸"><a href="#æ—¥å¿—æ¢å¤æ­£å¸¸" class="headerlink" title="æ—¥å¿—æ¢å¤æ­£å¸¸"></a>æ—¥å¿—æ¢å¤æ­£å¸¸</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">190125 11:30:10  InnoDB: Initializing buffer pool, size = 8.0M</span><br><span class="line">190125 11:30:10  InnoDB: Completed initialization of buffer pool</span><br><span class="line">190125 11:30:10  InnoDB: Started; log sequence number 0 398010</span><br><span class="line">190125 11:30:10 [Note] Event Scheduler: Loaded 0 events</span><br><span class="line">190125 11:30:10 [Note] /usr/libexec/mysqld: ready for connections.</span><br><span class="line">Version: '5.1.71'  socket: '/var/lib/mysql/mysql.sock'  port: 3306  Source distribution</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ•°æ®åº“å¼‚å¸¸é—®é¢˜ä¿®å¤ï¼Œå‰å°ç™»å½•ç³»ç»Ÿæ¢å¤æ­£å¸¸ã€‚</p><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><ul><li><a href="https://en.wikipedia.org/wiki/Year_2038_problem" target="_blank" rel="noopener">Year 2038 problem</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡åœ¨å‚ä¸çš„ 2018</title>
      <link href="/blog/2019-01-22/Annual-record-of-2018/"/>
      <url>/blog/2019-01-22/Annual-record-of-2018/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å²æœˆä¸å±…ï¼Œæ—¶å…‰å¦‚æµã€‚ä»Šå¤©å¿ƒè¡€æ¥æ½®æ¢äº†ä¸ª Hexo çš„ä¸»é¢˜â€”â€”FreeMindã€‚åŸæœ¬çš„ Material ä¸»é¢˜åœ¨å°†ç½‘ç«™èƒŒæ™¯å›¾ç‰‡è‡ªå®šä¹‰ä¸º Bing éšæœºå›¾ç‰‡ä¹‹åä¼šæ‰“å¼€å¾ˆæ…¢ï¼ŒæŒ‰ç…§ã€Œè¶…è¿‡ 3 ç§’éƒ½æ˜¯ç—…ã€çš„åŸåˆ™ï¼Œé‚æ¢ä¸Šäº†ç°åœ¨çš„ä¸»é¢˜ã€‚æœ¬è¯¥æ—©ç‚¹å¯¹ 2018 å¹´åšä¸ªå¹´ç»ˆæ€»ç»“çš„ï¼ˆè™½ç„¶ä¹Ÿæ²¡ä»€ä¹ˆäººçœ‹ï¼‰ï¼Œå¯æ˜¯æœ€è¿‘æ‹–å»¶ç—‡å‘ä½œåŠ ä¸Šä¸€ç›´åŠ ç­ï¼Œæ‰€ä»¥å°±å¾ˆä¹…æ²¡æ›´æ–°åšå®¢å’Œå…¬ä¼—å·äº†ã€‚ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯æˆ‘ä¸ºè‡ªå·±æ‰¾çš„ä¸€ä¸ªéª—äººçš„å€Ÿå£ã€‚ï¼‰<br><a id="more"></a></p><p>é¦–å…ˆå¯¹ 2018 å¹´ç«‹çš„ Flag åšä¸ªç®€å•å›é¡¾ï¼š</p><ul><li>æ‰¾ä¸ªå¥³æœ‹å‹ï¼›</li></ul><p>ä»Šå¹´è®¤è¯†äº† 2ã€3 ä¸ªå¥³ç”Ÿï¼Œä¸è¿‡ä»¤äººé—æ†¾çš„æ˜¯åˆ°å¤´æ¥è¿˜æ˜¯æ— åŠŸè€Œè¿”ã€‚ï¼ˆæˆ‘ä»¬è·Ÿéšç€å¯æ€œçš„å°å®¶ä¼™çš„è„šæ­¥ï¼Œåˆ°å¤´æ¥å‘ç°è¿™ä¸ªç¬¨è›‹è¿˜æ˜¯æ²¡èƒ½é€å‡ºç¥–ä¼ çš„ DNA !ï¼‰<br>è¿˜æœ‰ä¸€ä¸ªä»¤äººç»æœ›çš„æ¶ˆæ¯æ˜¯ï¼šç”±äºå¹´é¾„çš„å¢é•¿ï¼Œé€æ¸å¯¹ç°å®æœ‰äº†æ¸…æ™°ä¸€ç‚¹çš„è®¤è¯†ï¼Œæ„è¯†åˆ°å¤§å¤šæ•°äººæ ¹æœ¬æ²¡æœ‰æ”¶è·çˆ±æƒ…çš„å¯èƒ½ï¼Œå¤§å¤šæ•°åˆ°å¤´æ¥åªæ˜¯å¯¹ç”Ÿæ´»åšå‡ºå¦¥åæ‰¾äº†ä¸€ä¸ªä¼™ä¼´ä»¥é™ä½ç”Ÿæ´»ä¸­çš„ä¸å¯æ§é£é™©ã€‚å¯èƒ½æ¯”èµ·çˆ±æƒ…æ¥ï¼Œæ‰¾ä¸€ä¸ªåœ¨äº‹ä¸šæˆ–è€…ç”Ÿæ´»ä¸Šå¯ä»¥ä¸ºä½ æä¾›å¸®åŠ©çš„äººï¼Œç”šè‡³åªæ˜¯æ€§æ ¼ä¸Šåˆå¾—æ¥çš„åŒä¼´ç›¸å¯¹ç°å®ä¸€äº›ã€‚</p><ul><li>å…‹æœå›°éš¾ï¼Œé€šè¿‡èŠ‚é£ŸåŠ é”»ç‚¼å°†ä½“é‡æ§åˆ¶åœ¨å¯æ¥å—çš„èŒƒå›´ä¹‹å†…ï¼›</li></ul><p>ä»Šå¹´çš„ä½“é‡æ€»ä½“ä¸Šæ¥è¯´å½¢æˆäº†ä¸€æ¡ã€Œå¾®ç¬‘æ›²çº¿ã€ã€‚å…­æœˆä»½åˆ°åæœˆä»½ä¹‹é—´é€šè¿‡è·‘æ­¥å’Œä¸è§„å¾‹æ€§çš„èŠ‚é£Ÿå‡æ‰äº†å°†è¿‘ 20 æ–¤ã€‚ç„¶è€Œç”±äºå¤©æ°”è½¬å†·åäººå˜æ‡’äº†ï¼Œè·‘æ­¥ä¸­æ­¢ï¼Œè¿åŠ¨æ”¾å¼ƒï¼Œç°åœ¨ä½“é‡åˆæ¢å¤åˆ° 140 æ–¤å·¦å³ã€‚æ‰€ä»¥åªèƒ½è¯´ä¸‡å¹¸æ²¡æœ‰å¢é‡ï¼Œä½†æ˜¯å‡è‚¥çš„ç»“æœä¾ç„¶ä¸æ˜¯å¾ˆç†æƒ³ã€‚</p><h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><p>ä»Šå¹´æ€»ä½“ä¸Šæ¥è¯´æ²¡æœ‰ä»€ä¹ˆå¤§çš„æ”¶è·ï¼Œç”šè‡³å¯ä»¥è¯´æœ‰ç‚¹ä¹å‘³ã€‚æ¯å¤©éƒ½å¿™ç€è§£å†³å…¬å¸ä»£ç ä¸­çš„ BUG ,æŠ€æœ¯ä¸Šä¹Ÿæ²¡æœ‰å¾ˆå¤§çš„æé«˜ï¼Œåœ¨è¿™ç§é‡å¤ä¸­æƒ³è¦æé«˜è‡ªå·±çœŸçš„å¾ˆæ…¢ï¼ŒåŒæ—¶æ²¡æœ‰åŠ¨åŠ›å’Œæ„å¿—å»å­¦ä¹ æˆé•¿æé«˜è‡ªå·±ã€‚å¶å°”åªæ˜¯åœ¨å¿ƒè¡€æ¥æ½®çš„é‚£ä¹ˆä¸€ä¸‹å­åšä¸ªã€Œé©¬æ¥äººã€æ”¶é›†ä¸€äº›çœ‹èµ·æ¥æœ‰ç”¨çš„èµ„æ–™ï¼Œå¯æ˜¯åˆ°å¤´æ¥çœŸçš„æ²‰ä¸‹å¿ƒå»çœ‹çš„æœºä¼šä¾ç„¶å¾ˆå°‘ã€‚</p><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>ä¸¤ç‚¹ä¸€çº¿çš„åºŸæŸ´ç”Ÿæ´»æ²¡æœ‰å¤šå°‘æ³¢æ¾œï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå€¼å¾—æµªè´¹ç¬”å¢¨çš„ç‚¹ã€‚å™©è€—æ˜¯å¹¶ä¸å¹´è¿ˆçš„èˆ…èˆ…å´å› ä¸ºæ„å¤–å»ä¸–ã€‚å®é™…ä¸Šä¸‰èˆ…æ˜¯æˆ‘æ¯”è¾ƒé’¦ä½©çš„ä¸€ä¸ªäº²äººï¼Œåœ¨ä¸Šä¸ªä¸–çºªå¤§å®¶å—æ•™è‚²ç¨‹åº¦æ™®éä¸é«˜çš„å¤§èƒŒæ™¯ä¸‹é€šè¿‡ä¸ªäººè¾›å‹¤åŠ³åŠ¨æ”’ä¸‹ç™¾ä¸‡å®¶äº§ï¼ŒåŒæ—¶å¯¹äº²äººä¹Ÿå¾ˆçƒ­å¿ƒã€‚æˆ‘ç”Ÿæ€§å­¤å†·ï¼Œä¸€å‘ä¸æ“…äºè¡¨è¾¾è‡ªå·±çš„æ„Ÿæƒ…ã€‚åŸæœ¬æƒ³ç€åœ¨æœ‹å‹åœˆçºªå¿µä¸€ä¸‹èˆ…èˆ…çš„å»ä¸–ï¼Œåˆæ‹…å¿ƒè¢«åˆ«äººè®¤ä¸ºæ˜¯å“—ä¼—å–å® çš„å‚»Ã—ï¼Œæ‰€ä»¥æš‚ä¸”åœ¨è¿™é‡Œå†™ä¸‹ä¸€æ®µæ–‡å­—èŠè¡¨å¯¹èˆ…èˆ…å»ä¸–çš„æƒ‹æƒœå§ã€‚</p><p><em>å‘œå‘¼ï¼Œå¤©é™ç¾å¦ï¼Œå°ç”¥ä¼¤æ‚²ï¼Œç—›ä½•å¦‚å“‰ï¼</em></p><p><em>æ‚¨æ€§ä¹Ÿå­ï¼Œå¤–å©†ä¹…ç—…ï¼Œä¸å«Œä¸å¼ƒï¼Œä»¥å…‹ç»ˆå…»ï¼›</em><br><em>æ‚¨æ€§åˆè´¤ï¼Œå§Šå¦¹æœ‰éš¾ï¼Œäº²åŠ›äº²ä¸ºï¼Œæ€¥å…¶æ‰€éš¾ã€‚</em></p><p><em>ä½™å¿†å¹¼æ—¶ï¼Œä¸è¾¨å”èˆ…ï¼Œå‘¼æ±å¤§å¤§ï¼Œæƒ¹äººæ§è…¹ï¼›</em><br><em>ç«¥é¾€ä¹‹å¹´ï¼Œèˆ…çˆ¶ä¸¥å‰ï¼Œç”©é­å±±å“ï¼Œå“æˆ‘è¶‹èµ°ã€‚</em></p><p><em>å†å¿†é«˜ä¸­ï¼Œæ¡ä»¶è‰°è‹¦ï¼ŒæŠ«æ˜Ÿæˆ´æœˆï¼Œè½½æˆ‘å›å®¶ï¼›</em><br><em>å‘œå‘¼ï¼Œè¨€æœ‰ç©·è€Œæƒ…ä¸å¯ç»ˆã€‚å‘œå‘¼å“€å“‰ï¼ä¼æƒŸå°šé£¨ï¼</em></p><h2 id="ä¸€ç‚¹å›°æƒ‘"><a href="#ä¸€ç‚¹å›°æƒ‘" class="headerlink" title="ä¸€ç‚¹å›°æƒ‘"></a>ä¸€ç‚¹å›°æƒ‘</h2><ul><li><span class="label label-warning">Q:</span> åªå†™ä»£ç æ˜¯å¦è¿‡å¥½è¿™ä¸€ç”Ÿï¼Ÿéšç€å¹´é¾„å¢é•¿å¦‚ä½•ä¸è¢«æ–°äººæ›¿ä»£ï¼Ÿ</li></ul><p>ç¨‹åºå‘˜å·¥ä½œæ˜¯ä¸€ä¸ªä¸æ–­å­¦ä¹ çš„èŒä¸šï¼Œåœ¨ä¸€ä¸ªå…¬å¸å‘†ä¹…äº†å¯èƒ½å¯¹å…¬å¸çš„ä»£ç ç‰¹åˆ«ç†Ÿæ‚‰ã€‚ä½†æ˜¯å¯¹ç†Ÿæ‚‰çš„ä¸œè¥¿è¶Šç†Ÿæ‚‰ï¼Œå¯¹é™Œç”Ÿçš„ä¸œè¥¿å¯èƒ½ä¹Ÿä¼šé€æ¸å˜å¾—æ›´åŠ é™Œç”Ÿã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé¿å…ã€Œåæ¥è€…å±…ä¸Šã€çš„å°´å°¬ï¼Ÿ</p><ul><li><span class="label label-warning">Q:</span> å¦‚ä½•æé«˜è‡ªå·±çš„äº²å’ŒåŠ›ï¼Œå˜æˆä¸€ä¸ªè®©åˆ«äººæ„Ÿè§‰èˆ’æœçš„é™Œç”Ÿäººï¼Ÿ</li></ul><p>åŒæ ·æ˜¯ä¸€ä¸ªå’Œä½ æ— æ€¨æ— ä»‡çš„åŒäº‹ï¼Œä¸ºä»€ä¹ˆæœ‰çš„äººä½ å’Œ Ta å¾ˆèŠå¾—æ¥ï¼Œæœ‰çš„äººåªæ˜¯è¡¨é¢åº”ä»˜ï¼Œå…¶å®å†…å¿ƒå¾ˆæŠµè§¦å’Œ Ta æ²Ÿé€šï¼Ÿæ’é™¤é¢œå€¼ä¸Šé¢çš„å¤–åœ¨å› ç´ ï¼Œè¿˜æœ‰ä»€ä¹ˆåœ¨å½±å“ç€äººä¸äººä¹‹é—´çš„å’Œè°ç›¸å¤„å‘¢ï¼Ÿ</p><h2 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h2><p>2019 å¹´å¯èƒ½ä¼šè€ƒè™‘æ¢ä¸€ä¸ªå·¥ä½œç¯å¢ƒã€‚ä¸€æ–¹é¢å¸Œæœ›æŠ€æœ¯èƒ½å¤Ÿæœ‰æ›´å¥½çš„é”¤ç‚¼ï¼Œæ„Ÿè§‰è‡ªå·±è¿˜éœ€è¦åœ¨æ·±å¹¿åº¦ä¸Šå­¦ä¹ ä¸€ä¸ªï¼Œè€Œç›®å‰çš„å·¥ä½œæ›´å¤šçš„åªæ˜¯ä¸€äº›å¾ˆåŸºç¡€çš„æ“ä½œï¼Œå¾ˆå¤šé«˜çº§ç”¨æ³•æ ¹æœ¬æ²¡æœ‰åº”ç”¨åœºæ™¯ï¼Œå› æ­¤ç¼ºå°‘å­¦ä¹ çš„åŠ¨åŠ›ï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨ä¸€ä¸ªå¹³å¸¸çš„åœ°æ–¹å¾…ä¹…äº†ï¼Œäººä¹Ÿæ²¡æœ‰äº†å±æœºæ„Ÿå’Œè¿›å–å¿ƒã€‚</p><blockquote><p>å¾å¸¸èº«ä¸ç¦»éï¼Œé«€è‚‰çš†æ¶ˆã€‚ä»Šä¸å¤éª‘ï¼Œé«€é‡Œè‚‰ç”Ÿã€‚æ—¥æœˆè‹¥é©°ï¼Œè€å°†è‡³çŸ£ï¼Œè€ŒåŠŸä¸šä¸å»ºï¼Œæ˜¯ä»¥æ‚²è€³ã€‚</p></blockquote><p>è¿˜æœ‰ï¼Œè®¡åˆ’åœ¨æ‰¾å¥½å·¥ä½œä¹‹åæŠ¥è€ƒé©¾ç…§ï¼Œæˆ‘åŸæœ¬ä»¥ä¸ºæ— äººé©¾é©¶æŠ€æœ¯çš„æ™®åŠåˆ°åæ¥å°±æ²¡æœ‰å¿…è¦å­¦ä¹ é©¾ç…§ã€‚ä½†æ˜¯ç°åœ¨çœ‹æ¥å½“åˆå¯¹çš„é¢„æµ‹æœ‰ç‚¹ä¹è§‚ã€‚æˆ–è®¸çš„å¯æœŸçš„æœªæ¥ï¼ŒåŸå¸‚ä¹‹ä¸­çš„çƒ­ç‚¹çº¿è·¯ä¸Šè‡ªåŠ¨åŒ–é©¾é©¶æŠ€æœ¯å¯ä»¥å®ç°æ™®åŠï¼Œä½†æ˜¯åœ¨æ›´å¤šçš„ä¸ªæ€§åŒ–å®šåˆ¶æ–¹é¢å¯èƒ½ä¾ç„¶éœ€è¦å‡ä»¥æ—¶æ—¥ã€‚ä¸€å¦‚äººä»¬åæ§½çš„é‚£æ ·ï¼Œç›®å‰çš„äººå·¥æ™ºèƒ½æš‚æ—¶è¿˜åªèƒ½è¢«å«åšã€Œäººå·¥æ™ºéšœã€ã€‚</p><p>è€ç”Ÿå¸¸è°ˆçš„ä¸€ä»¶äº‹ï¼šæ—¢ç„¶æ²¡æœ‰èƒ½åŠ›åšä¸€ä¸ªå•èº«è´µæ—ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦å°½é‡åŠªåŠ›è§£å†³ä¸ªäººé—®é¢˜ï¼Œä¸è¦è®©çˆ¶æ¯è¿‡åˆ†æ‹…å¿ƒã€‚ä½†æ˜¯è¿™ä¸ªé—®é¢˜æˆ‘æ›´å¤šçš„åªèƒ½å°½äººäº‹è€ŒçŸ¥å¤©å‘½ï¼Œæœ‰åˆé€‚çš„å§‘å¨˜çš„è¯åŠ å€åŠªåŠ›ï¼Œæ²¡åˆé€‚çš„æˆ‘ä¹Ÿåªèƒ½æœ‰å¿ƒæ€è´¼ï¼Œæ— åŠ›å›å¤©å•¦ï¼</p><p>å¿ƒæœ‰å¤§æ„¿ï¼Œä¸è®¡é£é›¨ï¼Œé£é›¨ä¹‹ä¸­ï¼Œæ„¿ä½ å®‰å¥½ï¼Œé˜³å…‰ä¹‹ä¸‹ï¼Œæ„¿ä½ ç¿çƒ‚ã€‚</p><p>èƒ¸æœ‰é¸¿é¹„å¿—ï¼Œå¥ˆä½•ç‡•é›€èº«ã€‚ä»Šå¤©å¾ˆéš¾,æ˜å¤©æ›´éš¾ã€‚çœŸæ˜¯ã€Œé•¿æ¨æ­¤èº«éæˆ‘æœ‰ã€ï¼Œä¸çŸ¥ã€Œä½•æ—¶å¿˜å´è¥è¥ã€ã€‚æ­£æ‰€è°“<code>ä¸‡ç‰©ä¹‹ä¸­,å¸Œæœ›è‡³ç¾</code>ã€‚åŠ æ²¹å§ï¼  </p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="52" src="//music.163.com/outchain/player?type=2&id=353993&auto=1&height=32"></iframe><blockquote><p>é¸¿é¹„ä¹‹å¿—åƒä¸‡é‡Œï¼Œä½ å‹ƒç„¶è€Œèµ·ã€‚<br>å˜¿æˆ‘èƒ½ï¼Œå˜¿æˆ‘èƒ½ï¼Œè€å­å¯ä»¥ï¼<br>ä½ å¼•é¢ˆå‘å¤©æ­Œä¸€æ›²ã€‚<br>å¤©å°†é™å¤§ä»»äºä½ ï¼Œç£¨ç»ƒä½ çš„ç­‹éª¨çš®ã€‚<br>ç‰ä¸ç¢ä¸æˆå™¨ï¼Œå‡ºæ°´æ‰è§ä¸¤è…¿æ³¥<br>ä½å¤§æˆ¿å­å¼€å¤§è½¦å—…å¤§èœœï¼Œ<br>è°å®¶çš„å§‘å¨˜éƒ½èƒ½æ˜åª’æ­£å¨¶ã€‚<br>è®©é‚£äº›ç‹—çœ¼çœ‹äººä½çš„ä¸œè¥¿ï¼Œå†ä¹Ÿä¸æ•¢ç§ä¸èµ·ä½ ã€‚</p><p>ä½ çˆ¸çˆ¸ä¸æ˜¯è´ªå®˜æ±¡åï¼Œæ¯äº²æ˜¯è‰¯å®¶å¦‡å¥³ã€‚<br>ä½ ä¹Ÿæ²¡æœ‰å¯ä»¥è®©ä½ å°‘å¥‹æ–—åå¹´çš„ä¸Šæµç¤¾ä¼šå…³ç³»ã€‚<br>å¹»æƒ³çš„å‡è±¡å¤šä¹ˆç¾ä¸½ï¼Œä½ å¾ˆå‚»å¾ˆå¤©çœŸã€‚<br>è¿™çœŸæªå®å¼¹çš„æˆäººæ¸¸æˆï¼Œå¾ˆé»„å¾ˆæš´åŠ›ã€‚</p><p>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œåä¸‡å…«åƒé‡Œã€‚<br>æ—¶è¿ä¸æµä½ çš„ç£¨éš¾å…®ï¼Œä¹ä¹å…«åä¸€ã€‚<br>ä½ ç”¨é¸¡ç”Ÿè›‹ç”¨è›‹ç”Ÿé¸¡ï¼ŒçœŸä»–å¦ˆä¸å®¹æ˜“ã€‚<br>ä»–çªç„¶ä¸€åœºæš´é£é›¨ï¼Œé¸¡é£è›‹æ‰“äº†ã€‚</p><p>æ˜¨æ—¥çš„æœ‹å‹ä»Šéæ˜”æ¯”ï¼Œä½ å†ä¹Ÿæ²¡æœ‰å…´è¶£è°ˆèµ·ã€‚<br>æ˜”æ—¥çš„æ‹äººéšé’æ˜¥è€Œå»ï¼Œç«¥è¯èˆ¬çš„å›å¿†ã€‚</p><p>å¤•é˜³è¥¿ä¸‹æ¹–æ°´è¾¹çš„å€’å½±é‡Œï¼Œä½ çœ‹æ¸…æ¥šäº†è‡ªå·±ã€‚<br>å¦»å­åœ¨ä¸è¿œå¤„å‘¼å”¤ç€ä½ çš„åå­—ï¼Œå„¿å­è·‘è¿‡æ¥è¯´ä»–ä¼šå¤šä¹ˆäº†ä¸èµ·ã€‚</p><p>é¸¿é¹„å¿—ä½ çš„é¸¿é¹„å¿—ï¼Œåƒä¸€é¦–å¹´å°‘è½»ç‹‚çš„è¯—ã€‚<br>é‚£æ›¾ç»è‡ªå‘½ä¸å‡¡çš„æ—¥å­ï¼Œåœ¨å¤šå¹´ä»¥åä¸€ç¬‘äº†ä¹‹ã€‚<br>é¸¿é¹„å¿—ä½ çš„é¸¿é¹„ä¹‹å¿—ï¼Œåƒä¸€é¦–å¹´å°‘è½»ç‹‚çš„è¯—ã€‚</p><p>é‚£æ›¾ç»è‡ªå‘½ä¸å‡¡çš„æ—¥å­ï¼Œåœ¨ä¸Šä¸‹ç­çš„äººæµä¸­æ…¢æ…¢æ¶ˆå¤±ã€‚<br>åœ¨ä½ çš„é…’æ¯ä¸­æ…¢æ…¢æ¶ˆå¤±ï¼Œåœ¨ä½ çš„åºŠå•ä¸Šæ…¢æ…¢æ¶ˆå¤±ï¼Œ<br>åœ¨ä½ çš„å·¥èµ„é‡Œæ…¢æ…¢æ¶ˆå¤±ï¼Œåœ¨ç°å®çš„æ—‹æ¶¡ä¸­æ…¢æ…¢æ¶ˆå¤±ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ä¸ªäººæ—¥è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pip å°è€å¼Ÿï¼Œä½ æ€ä¹ˆè‚¥å››ï¼Ÿ</title>
      <link href="/blog/2018-09-21/get-some-trouble-with-pip/"/>
      <url>/blog/2018-09-21/get-some-trouble-with-pip/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©ç”¨<code>pip</code>çš„æ—¶å€™çªç„¶ä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåœ¨è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ã€‚<br><a id="more"></a></p><h2 id="æç¤ºpipç‰ˆæœ¬ä¸å¯¹"><a href="#æç¤ºpipç‰ˆæœ¬ä¸å¯¹" class="headerlink" title="æç¤ºpipç‰ˆæœ¬ä¸å¯¹"></a>æç¤º<code>pip</code>ç‰ˆæœ¬ä¸å¯¹</h2><h3 id="é”™è¯¯æç¤º"><a href="#é”™è¯¯æç¤º" class="headerlink" title="é”™è¯¯æç¤º"></a>é”™è¯¯æç¤º</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You are using pip version 9.0.3, however version 18.0.1 is available.</span><br><span class="line">You should consider upgrading via the &apos;python -m pip install --upgrade pip&apos; command.</span><br></pre></td></tr></table></figure><h3 id="å¤„ç†è¿‡ç¨‹"><a href="#å¤„ç†è¿‡ç¨‹" class="headerlink" title="å¤„ç†è¿‡ç¨‹"></a>å¤„ç†è¿‡ç¨‹</h3><p>å»<a href="https://pypi.org/project/pip/" target="_blank" rel="noopener">å®˜ç½‘</a>ä¸‹è½½æœ€æ–°ç‰ˆçš„åŒ…ï¼Œç›´æ¥è§£å‹å®‰è£…å³å¯ï¼›</p><h3 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h3><p><a href="https://blog.csdn.net/XavierDarkness/article/details/81234066" target="_blank" rel="noopener">Python2.7 è‡ªå¸¦çš„ pip9.0 å‡çº§åˆ° pip18.0</a></p><h2 id="æ˜ç¡®å·²ç»å®‰è£…pipï¼Œä½†æ˜¯ç³»ç»Ÿæç¤ºæ‰¾ä¸åˆ°pip"><a href="#æ˜ç¡®å·²ç»å®‰è£…pipï¼Œä½†æ˜¯ç³»ç»Ÿæç¤ºæ‰¾ä¸åˆ°pip" class="headerlink" title="æ˜ç¡®å·²ç»å®‰è£…pipï¼Œä½†æ˜¯ç³»ç»Ÿæç¤ºæ‰¾ä¸åˆ°pip"></a>æ˜ç¡®å·²ç»å®‰è£…<code>pip</code>ï¼Œä½†æ˜¯ç³»ç»Ÿæç¤ºæ‰¾ä¸åˆ°<code>pip</code></h2><h3 id="é”™è¯¯æç¤º-1"><a href="#é”™è¯¯æç¤º-1" class="headerlink" title="é”™è¯¯æç¤º"></a>é”™è¯¯æç¤º</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-bash: /home/imoyao/.local/bin/pip: No such file or directory</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1.which pip </span><br><span class="line">/usr/local/bin/pip</span><br><span class="line"></span><br><span class="line">2.pip </span><br><span class="line">-su: /usr/bin/pip: No such file or directory</span><br><span class="line"></span><br><span class="line">3.type pip </span><br><span class="line">pip is hashed (/usr/bin/pip) </span><br><span class="line">So pip is definintely in /usr/local/bin/pip but it is been cached as in /usr/bin/pip, thanks to the Stackoverflow question, the solution is very simple:</span><br><span class="line"></span><br><span class="line">4.hash -r </span><br><span class="line">When the cache is clear, pip is working again.</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ¥æº-1"><a href="#å‚è€ƒæ¥æº-1" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h3><p><a href="https://blog.csdn.net/qq_32755575/article/details/80443714" target="_blank" rel="noopener">/usr/bin/pip: No such file or directory</a></p><h2 id="å®‰è£…æˆ–å‡çº§pipæ—¶æç¤ºSSLError"><a href="#å®‰è£…æˆ–å‡çº§pipæ—¶æç¤ºSSLError" class="headerlink" title="å®‰è£…æˆ–å‡çº§pipæ—¶æç¤ºSSLError"></a>å®‰è£…æˆ–å‡çº§<code>pip</code>æ—¶æç¤º<code>SSLError</code></h2><h3 id="é”™è¯¯æç¤º-2"><a href="#é”™è¯¯æç¤º-2" class="headerlink" title="é”™è¯¯æç¤º"></a>é”™è¯¯æç¤º</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by &apos;SSLError(SSLError(1, &apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:833)&apos;),)&apos;: /simple/pip/</span><br><span class="line">Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by &apos;SSLError(SSLError(1, &apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:833)&apos;),)&apos;: /simple/pip/</span><br><span class="line">Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by &apos;SSLError(SSLError(1, &apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:833)&apos;),)&apos;: /simple/pip/</span><br><span class="line">Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by &apos;SSLError(SSLError(1, &apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:833)&apos;),)&apos;: /simple/pip/</span><br><span class="line">Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by &apos;SSLError(SSLError(1, &apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:833)&apos;),)&apos;: /simple/pip/</span><br><span class="line">Could not fetch URL https://pypi.python.org/simple/pip/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host=&apos;pypi.python.org&apos;, port=443): Max retries exceeded with url: /simple/pip/ (Caused by SSLError(SSLError(1, &apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:833)&apos;),)) - skipping</span><br><span class="line">#å…¶å®æœ¬äººé‡åˆ°çš„é”™è¯¯æ˜¯</span><br><span class="line">(Caused by SSLError(SSLError(1, u&apos;[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:726)&apos;),))</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ul><li>ä¸´æ—¶æ–¹æ¡ˆ</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…æ—¶æ·»åŠ å‚æ•°ï¼š</span><br><span class="line">--trusted-host pypi.python.org</span><br><span class="line">æ­¤æ–¹å¼è¡¨ç¤ºä¿¡ä»»è¯¥åŸŸåï¼Œä½†æ˜¯æ¯ä¸€æ¬¡å®‰è£…åŒ…çš„æ—¶å€™éƒ½éœ€è¦è¯¥æ“ä½œï¼Œæ¯”è¾ƒéº»çƒ¦ï¼›</span><br></pre></td></tr></table></figure><ul><li>æ°¸ä¹…æ–¹æ¡ˆ</li></ul><p>ä¿®æ”¹<code>pip.conf</code> é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åœ¨<code>Linux</code>ç³»ç»Ÿä¸­çš„å¯èƒ½ä½ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/etc/pip.conf</span><br><span class="line"></span><br><span class="line">~/.pip/pip.conf</span><br><span class="line"></span><br><span class="line">~/.config/pip/pip.conf</span><br></pre></td></tr></table></figure></p><p>å¦‚æœéƒ½æ²¡æœ‰çš„è¯ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¹‹åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[global]</span><br><span class="line">index-url = http://mirrors.aliyun.com/pypi/simple/      # æœ¬æœºä½¿ç”¨é˜¿é‡Œæºä»£ç†</span><br><span class="line">[install]</span><br><span class="line">trusted-host=mirrors.aliyun.com</span><br><span class="line"></span><br><span class="line"># globalå­—æ®µè¿˜çœ‹åˆ°å…¶ä»–å†™æ³•ï¼š</span><br><span class="line">[global]</span><br><span class="line">trusted-host = pypi.python.org</span><br><span class="line">               pypi.org</span><br><span class="line">               files.pythonhosted.org</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ¥æº-2"><a href="#å‚è€ƒæ¥æº-2" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h3><p><a href="https://stackoverflow.com/questions/16370583/pip-issue-installing-almost-any-library" target="_blank" rel="noopener">pip issue installing almost any library</a><br><a href="https://www.cnblogs.com/yudar/p/4657511.html" target="_blank" rel="noopener">linux è®¾ç½® pip é•œåƒ Pip Warningï¼šâ€“trusted-host é—®é¢˜è§£å†³æ–¹æ¡ˆ</a></p><h2 id="å®‰è£…MySQL-pythonæ—¶æç¤º"><a href="#å®‰è£…MySQL-pythonæ—¶æç¤º" class="headerlink" title="å®‰è£…MySQL-pythonæ—¶æç¤º"></a>å®‰è£…<code>MySQL-python</code>æ—¶æç¤º</h2><h3 id="é”™è¯¯æç¤º-3"><a href="#é”™è¯¯æç¤º-3" class="headerlink" title="é”™è¯¯æç¤º"></a>é”™è¯¯æç¤º</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">EnvironmentError: mysql_config not found</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ul><li>CentOS</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yumÂ installÂ libffi-devel </span><br><span class="line">pip install mysql-connector-python</span><br></pre></td></tr></table></figure><ul><li>Ubuntu</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt install default-libmysqlclient-dev</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ¥æº-3"><a href="#å‚è€ƒæ¥æº-3" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h3><p><a href="https://stackoverflow.com/questions/5178292/pip-install-mysql-python-fails-with-environmenterror-mysql-config-not-found" target="_blank" rel="noopener">pip install mysql-python fails with EnvironmentError: mysql_config not found</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> pip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DRBD å¤‡å¿˜è®°å½•</title>
      <link href="/blog/2018-09-11/Record-of-drbd/"/>
      <url>/blog/2018-09-11/Record-of-drbd/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>è¿™æ˜¯ä¸€ä¸ªå…³äº <code>DRBD</code> çš„ä½¿ç”¨å¤‡å¿˜å½•ã€‚<br><a id="more"></a></p><p><img src="https://docs.linbit.com/ug-src/users-guide-8.4/images/drbd-in-kernel.png" alt="DRBDåœ¨Linuxå†…æ ¸I/Oæ ˆçš„ä½ç½®"></p><p>å¼€å§‹é˜…è¯»ä¹‹å‰ï¼Œè¯·å…ˆæ³¨æ„ç¤ºä¾‹ä¸­ä½¿ç”¨çš„ DRBD ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm -V</span><br><span class="line"><span class="meta">#</span><span class="bash"> DRBDADM_VERSION=8.4.3</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå®‰è£…çš„ kernel-devel çš„å†…æ ¸æºç ï¼ˆå†…æ ¸æºç è·¯å¾„/usr/src/kernel/ï¼‰å’Œå½“å‰ç³»ç»Ÿçš„ kernel ç‰ˆæœ¬(uname -r)ä¸ä¸€è‡´çš„è¯éœ€è¦æŠŠå½“å‰å†…æ ¸æ›´æ–°ä¸€ä¸‹ã€‚<br>åœ¨<code>2.6.33</code>åŠä»¥ä¸Šç‰ˆæœ¬çš„å†…æ ¸é»˜è®¤ä¸­æœ‰<code>DRBD</code>,ä¹‹å‰åœ¨ç”¨çš„<code>DRBD</code>ä¸»è¦<code>8.0</code>ã€<code>8.2</code>ã€<code>8.3</code> ä¸‰ä¸ªç‰ˆæœ¬,å¯¹åº”çš„<code>rpm</code>åŒ…æ˜¯<code>drbd</code>,<code>drbd82</code>å’Œ<code>drbd83</code>ï¼Œå› æ­¤éœ€è¦å®‰è£…å¯¹åº”çš„å†…æ ¸æ¨¡å—ï¼Œå¯¹åº”çš„åå­—ä¸º<code>kmod-drbd</code>,<code>kmod-drbd82</code>,<code>kmod-drbd83</code>ã€‚<br>ç”±äº<code>drbd</code>æ˜¯ä½œä¸ºå†…æ ¸æ¨¡å—è¿›è¡Œå·¥ä½œçš„ï¼Œæ•…å»ºè®®ä½¿ç”¨ä¸å†…æ ¸å¯¹åº”çš„ç‰ˆæœ¬ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ã€‚</p><table><thead><tr><th style="text-align:left">Linux releases</th><th style="text-align:left">DRBD releases</th></tr></thead><tbody><tr><td style="text-align:left">2.6.33</td><td style="text-align:left">8.3.7</td></tr><tr><td style="text-align:left">2.6.34</td><td style="text-align:left">8.3.7</td></tr><tr><td style="text-align:left">2.6.35</td><td style="text-align:left">8.3.8</td></tr><tr><td style="text-align:left">2.6.36</td><td style="text-align:left">8.3.8.1</td></tr><tr><td style="text-align:left">2.6.37</td><td style="text-align:left">8.3.9</td></tr><tr><td style="text-align:left">2.6.38</td><td style="text-align:left">8.3.9</td></tr><tr><td style="text-align:left">2.6.39</td><td style="text-align:left">8.3.10</td></tr><tr><td style="text-align:left">3.0 - 3.4</td><td style="text-align:left">8.3.11</td></tr><tr><td style="text-align:left">3.5 - 3.7</td><td style="text-align:left">8.3.13</td></tr></tbody></table><p><strong>æ³¨æ„:</strong>ç›®å‰å®˜ç½‘ä¸Šé¢ 8.0 â€“ 8.3.x å·²æ ‡æ³¨ä¸º<code>Deprecated</code>å³ä¸å»ºè®®ä½¿ç”¨çŠ¶æ€ã€‚</p><h2 id="drbd-çŠ¶æ€è®°å½•"><a href="#drbd-çŠ¶æ€è®°å½•" class="headerlink" title="drbd çŠ¶æ€è®°å½•"></a>drbd çŠ¶æ€è®°å½•</h2><p><a href=".">æœ¬éƒ¨åˆ†å†…å®¹è¯¦è§æ­¤å¤„</a></p><h2 id="æ¸…é™¤å•ä¸ª-DRBD-èµ„æºé…ç½®ï¼š-ä»¥-drbd10-ä¸ºä¾‹"><a href="#æ¸…é™¤å•ä¸ª-DRBD-èµ„æºé…ç½®ï¼š-ä»¥-drbd10-ä¸ºä¾‹" class="headerlink" title="æ¸…é™¤å•ä¸ª DRBD èµ„æºé…ç½®ï¼š(ä»¥ drbd10 ä¸ºä¾‹)"></a>æ¸…é™¤å•ä¸ª <code>DRBD</code> èµ„æºé…ç½®ï¼š(ä»¥ drbd10 ä¸ºä¾‹)</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbd-overview       # drbdæ¦‚è§ˆ</span><br><span class="line">drbdadm down drbd10         #down drbd</span><br><span class="line">echo yes|drbdadm wipe-md drbd10     #æ¸…é™¤metadata</span><br><span class="line">cd /etc/drbd.d/         # æ³¨æ„ï¼Œæ­¤å¤„æ ¹æ®drbdç‰ˆæœ¬ä¸åŒä¹Ÿå¯èƒ½åœ¨/usr/local/etc/drbd.d/</span><br><span class="line">rm drbd10.res           #åˆ é™¤resourceæ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="é‡å¯-DRBD-æœåŠ¡"><a href="#é‡å¯-DRBD-æœåŠ¡" class="headerlink" title="é‡å¯ DRBD æœåŠ¡"></a>é‡å¯ <code>DRBD</code> æœåŠ¡</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service drbd stop </span><br><span class="line">service drbd start</span><br></pre></td></tr></table></figure><h2 id="DRBDæ‰©å®¹"><a href="#DRBDæ‰©å®¹" class="headerlink" title="DRBDæ‰©å®¹"></a><code>DRBD</code>æ‰©å®¹</h2><p>å½“é‡åˆ°æˆ‘ä»¬çš„<code>drbd resource</code>è®¾å¤‡å®¹é‡ä¸å¤Ÿçš„æ—¶å€™ï¼Œè€Œä¸”æˆ‘ä»¬çš„åº•å±‚è®¾å¤‡æ”¯æŒåœ¨çº¿å¢å¤§å®¹é‡çš„æ—¶å€™ï¼ˆæ¯”å¦‚ lvmï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¢å¤§åº•å±‚è®¾å¤‡çš„å¤§å°ï¼Œç„¶åå†é€šè¿‡<code>drbdadm resize resource_name</code>æ¥å®ç°å¯¹<code>resource</code>çš„æ‰©å®¹ã€‚<br>è¿™é‡Œæœ‰éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br>åªæœ‰åœ¨å•ä¸»æ¨¡å¼ä¸‹å¯ä»¥è¿™æ ·åšï¼Œè€Œä¸”éœ€è¦å…ˆåœ¨ä¸¤èŠ‚ç‚¹ä¸Šéƒ½å¢å¤§åº•å±‚è®¾å¤‡çš„å®¹é‡ï¼Œç„¶åä»…åœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ<code>resize</code>å‘½ä»¤ã€‚</p><p>åœ¨æ‰§è¡Œäº†<code>resize</code>å‘½ä»¤åï¼Œå°†è‡ªåŠ¨è§¦å‘ä¸€æ¬¡å½“å‰ä¸»èŠ‚ç‚¹åˆ°å…¶ä»–æ‰€æœ‰ä»èŠ‚ç‚¹çš„ re-synchronizationï¼›</p><p>å¦‚æœæˆ‘ä»¬åœ¨<code>drbd</code>éå·¥ä½œçŠ¶æ€ä¸‹å¯¹åº•å±‚è®¾å¤‡è¿›è¡Œäº†æ‰©å®¹ï¼Œç„¶åå†å¯åŠ¨<code>drbd</code>ï¼Œå°†ä¸éœ€è¦æ‰§è¡Œ<code>resize</code>å‘½ä»¤ï¼ˆå½“ç„¶å‰ææ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰å¯¹ disk å‚æ•°é¡¹æŒ‡å®šå¤§å°ï¼‰ï¼Œ<code>drbd</code>è‡ªå·±ä¼šçŸ¥é“å·²ç»å¢å¤§äº†å®¹é‡ï¼›</p><p>åœ¨è¿›è¡Œåº•å±‚è®¾å¤‡çš„å¢å®¹æ“ä½œçš„æ—¶å€™åƒä¸‡ä¸è¦ä¿®æ”¹åˆ°åŸè®¾å¤‡ä¸Šé¢çš„æ•°æ®ï¼Œå°¤å…¶æ˜¯<code>drbd</code>çš„<code>meta</code>ä¿¡æ¯ï¼Œå¦åˆ™æœ‰å¯èƒ½æ¯æ‰æ‰€æœ‰æ•°æ®ã€‚</p><h3 id="æµç¨‹ç®€å•ç¤ºä¾‹"><a href="#æµç¨‹ç®€å•ç¤ºä¾‹" class="headerlink" title="æµç¨‹ç®€å•ç¤ºä¾‹"></a>æµç¨‹ç®€å•ç¤ºä¾‹</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å…ˆåœ¨ä¸¤ç«¯æ‰©å±•Lunï¼ˆéœ€è¦ç›¸åŒå¤§å°ï¼‰     </span></span><br><span class="line">lvextend -Ll(50G) lvpath</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> drbdä»ç«¯ï¼šï¼ˆåŒä¸»æ¨¡å¼åˆ‡æ¢ä¸ºä¸»ä»æ¨¡å¼ï¼‰</span></span><br><span class="line">drbdadm secondary drbd[Num]     </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> drbdä¸»ç«¯ï¼š</span></span><br><span class="line">drbdadm resize drbd[Num]</span><br></pre></td></tr></table></figure><h2 id="global-common-conf-é…ç½®ï¼ˆç¤ºä¾‹ï¼‰"><a href="#global-common-conf-é…ç½®ï¼ˆç¤ºä¾‹ï¼‰" class="headerlink" title="global_common.conf é…ç½®ï¼ˆç¤ºä¾‹ï¼‰"></a>global_common.conf é…ç½®ï¼ˆç¤ºä¾‹ï¼‰</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">global &#123;</span><br><span class="line">    usage-count no;     # æ˜¯å¦å‘å®˜æ–¹å‘é€ç»Ÿè®¡æŠ¥å‘Šï¼ˆå½±å“æ€§èƒ½ï¼‰</span><br><span class="line">&#125;</span><br><span class="line">common &#123;            # å®šä¹‰drbdè®¾å¤‡å…±äº«çš„å±æ€§ä¿¡æ¯</span><br><span class="line">    handlers &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    startup &#123;       # å¯åŠ¨æ—¶å€™çš„ç›¸å…³è®¾ç½®</span><br><span class="line">        wfc-timeout 50;</span><br><span class="line">        become-primary-on both;     # å…è®¸åŒä¸»</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    disk &#123;</span><br><span class="line">        on-io-error detach;     # é…ç½®I/Oé”™è¯¯å¤„ç†ç­–ç•¥ä¸ºåˆ†ç¦»</span><br><span class="line">        no-disk-flushes ;</span><br><span class="line">        no-disk-barrier;</span><br><span class="line">        c-plan-ahead 0;</span><br><span class="line">        c-fill-target 24M;</span><br><span class="line">        c-min-rate 80M;</span><br><span class="line">        c-max-rate 720M;</span><br><span class="line">    &#125; </span><br><span class="line">    net &#123;               # ç½‘ç»œé…ç½®ç›¸å…³</span><br><span class="line">        protocol C;     # åŒæ­¥å¼‚æ­¥æ§åˆ¶ï¼ˆè§ä¸‹æ–¹ä»‹ç»ï¼‰</span><br><span class="line">        after-sb-0pri discard-younger-primary;  # è„‘è£‚ä¿®å¤</span><br><span class="line">        after-sb-1pri discard-secondary;</span><br><span class="line">        after-sb-2pri call-pri-lost-after-sb;</span><br><span class="line">        allow-two-primaries yes;        # å…è®¸åŒä¸»</span><br><span class="line">        max-buffers        36k;</span><br><span class="line">        sndbuf-size         1024k ;</span><br><span class="line">        rcvbuf-size      2048k;</span><br><span class="line">    &#125;</span><br><span class="line">    syncer &#123;    # åŒæ­¥ç›¸å…³çš„è®¾ç½®</span><br><span class="line">            rate                   4194304k;    # bytes/second</span><br><span class="line">            al-extents              6433;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Read_More:http://tech.sina.com.cn/smb/2008-12-22/1050926302.shtml</span></span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åŒæ­¥åè®®"><a href="#æ•°æ®åŒæ­¥åè®®" class="headerlink" title="æ•°æ®åŒæ­¥åè®®"></a>æ•°æ®åŒæ­¥åè®®</h3><p><code>DRBD</code>æœ‰ä¸‰ç§æ•°æ®åŒæ­¥æ¨¡å¼:åŒæ­¥ï¼Œå¼‚æ­¥ï¼ŒåŠåŒæ­¥</p><ol><li>å¼‚æ­¥ï¼šæŒ‡çš„æ˜¯å½“æ•°æ®å†™åˆ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”å¤åˆ¶çš„æ•°æ®å·²ç»è¢«æ”¾åˆ°æˆ‘ä»¬çš„<code>tcp</code>ç¼“å†²åŒºå¹¶ç­‰å¾…å‘é€ä»¥åï¼Œå°±è®¤ä¸ºå†™å…¥å®Œæˆï¼›</li><li>åŠåŒæ­¥ï¼šæŒ‡çš„æ˜¯æ•°æ®å·²ç»å†™åˆ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”è¿™äº›æ•°æ®å·²ç»å‘é€åˆ°å¯¹æ–¹å†…å­˜ç¼“å†²åŒºï¼Œå¯¹æ–¹çš„<code>tcp</code>å·²ç»æ”¶åˆ°æ•°æ®ï¼Œå¹¶å®£å¸ƒå†™å…¥ï¼›</li><li>åŒæ­¥ï¼šæŒ‡çš„æ˜¯ä¸»èŠ‚ç‚¹å·²å†™å…¥ï¼Œä»èŠ‚ç‚¹ç£ç›˜ä¹Ÿå†™å…¥ï¼›</li></ol><p><code>DRBD</code>çš„å¤åˆ¶æ¨¡å‹æ˜¯é <code>protocol</code>å…³é”®å­—æ¥å®šä¹‰çš„ï¼š<code>protocol A</code>è¡¨ç¤ºå¼‚æ­¥ï¼›<code>protocol B</code>è¡¨ç¤ºåŠåŒæ­¥ï¼›<code>protocol C</code>è¡¨ç¤ºåŒæ­¥ï¼Œé»˜è®¤ä¸º<code>protocol C</code>ã€‚</p><p>åœ¨åŒæ­¥æ¨¡å¼ä¸‹åªæœ‰ä¸»ã€ä»èŠ‚ç‚¹ä¸Šä¸¤å—ç£ç›˜åŒæ—¶æŸå®³æ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚åœ¨åŠåŒæ­¥æ¨¡å¼ä¸‹åªæœ‰ä¸»èŠ‚ç‚¹å®•æœºï¼ŒåŒæ—¶ä»èŠ‚ç‚¹å¼‚å¸¸åœç”µæ‰ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p><p><strong>æ³¨æ„:</strong></p><ol><li>ä¸»ä»æ‰€åœ¨çš„ç£ç›˜åˆ†åŒºæœ€å¥½å¤§å°ç›¸ç­‰,<code>DRBD</code>ç£ç›˜é•œåƒç›¸å½“äºç½‘ç»œ<code>RAID1</code>ï¼›ï¼ˆæœ¬äººä½¿ç”¨æ—¶å¼ºåˆ¶ç›¸ç­‰ï¼Œä½†ç½‘ä¸Šæ²¡æœ‰å…³äºåˆ†åŒºå¤§å°æ˜¯å¦ä¸€å®šè¦ç›¸åŒçš„ç¡®åˆ‡è¯´æ³•ï¼‰</li><li>ç½‘ç»œåŒæ­¥æ—¶éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨åŒæ­¥å®Œæˆä¹‹å‰æœ€å¥½ä¸è¦é‡å¯ï¼Œå¦åˆ™ä¼šé‡æ–°åŒæ­¥ï¼›</li><li><code>DRBD</code>çš„ä¸»èŠ‚ç‚¹ä¸ä¼šç›‘æ§ä»èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®é‡ä¼ ï¼›</li><li>æ ¼å¼åŒ–åªéœ€è¦åœ¨<code>primary</code>èŠ‚ç‚¹ä¸Šè¿›è¡Œ,ä¸”åªèƒ½åœ¨ä¸»èŠ‚ç‚¹ä¸ŠæŒ‚è½½ï¼›è‹¥ä¸»èŠ‚ç‚¹ä¸‹çº¿,ä»èŠ‚ç‚¹ä¸Šçº¿,åˆ™ä»èŠ‚ç‚¹å¯ä»¥ç›´æ¥æŒ‚è½½,ä¸éœ€è¦å†æ¬¡æ ¼å¼åŒ–ã€‚é›†ç¾¤ä¸­åªæœ‰ primary æœåŠ¡å™¨å¯ä»¥æŒ‚è½½è®¾å¤‡ï¼Œsecondary æŒ‚è½½ä¼šæŠ¥é”™ã€‚åªæœ‰åœ¨è¿›è¡Œæ•…éšœè¿ç§»å‡çº§ä¸ºä¸»æ—¶æ‰éœ€è¦æŒ‚è½½ã€‚</li><li>å¦‚æœ<code>DRBD</code>çŠ¶æ€ä¸‹å…³æœºåŒæ§æ¢å¤ä¸è¿‡æ¥ï¼Œå°è¯•åˆ é™¤<code>DRBD</code>é…ç½®ä¿¡æ¯ï¼Œç„¶ååœæ‰<code>DRBD</code>ç«¯ ODSP å’Œ<code>mysql</code>é‡å¯ä¹‹åå³å¯ï¼›(æ­¤æ¡ä»…é’ˆå¯¹å…¬å¸é¡¹ç›®)</li></ol><h2 id="å•ä¸ªdrbdé…ç½®æ–‡ä»¶ï¼ˆä»¥-drbd10-res-ä¸ºä¾‹ï¼‰"><a href="#å•ä¸ªdrbdé…ç½®æ–‡ä»¶ï¼ˆä»¥-drbd10-res-ä¸ºä¾‹ï¼‰" class="headerlink" title="å•ä¸ªdrbdé…ç½®æ–‡ä»¶ï¼ˆä»¥ drbd10.res ä¸ºä¾‹ï¼‰"></a>å•ä¸ª<code>drbd</code>é…ç½®æ–‡ä»¶ï¼ˆä»¥ drbd10.res ä¸ºä¾‹ï¼‰</h2><h3 id="é¡¹ç›®ä¸­çš„é…ç½®æ–¹æ¡ˆ"><a href="#é¡¹ç›®ä¸­çš„é…ç½®æ–¹æ¡ˆ" class="headerlink" title="é¡¹ç›®ä¸­çš„é…ç½®æ–¹æ¡ˆ"></a>é¡¹ç›®ä¸­çš„é…ç½®æ–¹æ¡ˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">resource drbd11 &#123;</span><br><span class="line">    on controller-1 &#123;</span><br><span class="line">        device /dev/drbd11;</span><br><span class="line">        disk /dev/StorPool11/SANLun11;</span><br><span class="line">        address 192.168.2.10:57811;</span><br><span class="line">        meta-disk internal;</span><br><span class="line">    &#125;</span><br><span class="line">    on controller-2 &#123;</span><br><span class="line">        device /dev/drbd11;</span><br><span class="line">        disk /dev/StorPool11/SANLun11;</span><br><span class="line">        address 192.168.2.18:57811;</span><br><span class="line">        meta-disk internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦å¤–ä¸€ç§é…ç½®æ–¹æ¡ˆ"><a href="#å¦å¤–ä¸€ç§é…ç½®æ–¹æ¡ˆ" class="headerlink" title="å¦å¤–ä¸€ç§é…ç½®æ–¹æ¡ˆ"></a>å¦å¤–ä¸€ç§é…ç½®æ–¹æ¡ˆ</h3><p>æ¥è‡ª<a href="https://www.suse.com/documentation/sle_ha/book_sleha/data/sec_ha_drbd_configure.html" target="_blank" rel="noopener">è¿™é‡Œ</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">resource r0 &#123;   # â‘ </span><br><span class="line">  device /dev/drbd0; # â‘¡</span><br><span class="line">  disk /dev/sda1;   # â‘¢</span><br><span class="line">  meta-disk internal;   # â‘£</span><br><span class="line">  on alice &#123;    # â‘¤</span><br><span class="line">    address  192.168.1.10:7788;     # â‘¥</span><br><span class="line">  &#125;</span><br><span class="line">  on bob &#123; </span><br><span class="line">    address 192.168.1.11:7788; </span><br><span class="line">  &#125;</span><br><span class="line">  syncer &#123;</span><br><span class="line">    rate  7M;   # â‘¦</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘ä»¥çœ‹æ‡‚ä¸ºç›®çš„ï¼š</p><p>1.å…è®¸æŸäº›ç³»ç»ŸæœåŠ¡é¡¹å…³è”çš„åç§°ï¼Œå¦‚ï¼šnfs, http, mysql_0, postgres_wal ç­‰ï¼›<br>Name that allows some association to the service that needs them. For example, nfs, http, mysql_0, postgres_wal, etc.</p><p>2.<code>DRBD</code>è®¾å¤‡åç§°åŠç¼–å·ï¼›<br>The device name for DRBD and its minor number.</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>drbd</code>çš„ç¼–å·æ˜¯<code>0</code>ã€‚udev é›†æˆè„šæœ¬æä¾›ç¬¦å·é“¾æ¥<code>/dev/drbd/by-res/nfs/0</code>ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥çœç•¥é…ç½®ä¸­çš„è®¾å¤‡èŠ‚ç‚¹åç§°ï¼Œç„¶åä½¿ç”¨ä¸‹é¢è¿™ç§å½¢å¼ä»£æ›¿ï¼š<br><code>drbd0 minor 0</code>ï¼ˆ/dev/å¯é€‰ï¼‰æˆ–<code>/dev/drbd0</code>ï¼›</p><p>In the example above, the minor number 0 is used for DRBD. The udev integration scripts will give you a symbolic link /dev/drbd/by-res/nfs/0. Alternatively, omit the device node name in the configuration and use the following line instead:<br>drbd0 minor 0 (/dev/ is optional) or /dev/drbd0</p><p>3.èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œå¤åˆ¶çš„åŸå§‹è®¾å¤‡ã€‚æ³¨æ„ï¼šåœ¨æœ¬ä¾‹ä¸­ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¸Šé¢çš„è®¾å¤‡æ˜¯ç›¸åŒçš„ã€‚è‹¥ä½¿ç”¨ä¸åŒè®¾å¤‡ï¼Œè¯·å°†ç£ç›˜å‚æ•°ç§»åŠ¨åˆ°ä¸»æœºä¸Šã€‚ï¼ˆï¼Ÿï¼‰</p><p>The raw device that is replicated between nodes. Note, in this example the devices are the same on both nodes. If you need different devices, move the disk parameter into the on host.</p><p>4.<code>meta-disk</code>å‚æ•°é€šå¸¸åŒ…å«éšå¼å€¼ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªæ˜¾å¼è®¾å¤‡ä¿å­˜å…ƒæ•°æ®ã€‚è¯¦æƒ…å‚è§ï¼š<a href="http://www.drbd.org/users-guide-emb/ch-internals.html#s-metadata" target="_blank" rel="noopener">è¿™é‡Œ&gt;&gt;&gt;</a></p><p>The meta-disk parameter usually contains the value internal, but it is possible to specify an explicit device to hold the meta data. See <a href="http://www.drbd.org/users-guide-emb/ch-internals.html#s-metadata" target="_blank" rel="noopener">http://www.drbd.org/users-guide-emb/ch-internals.html#s-metadata</a> for more information.</p><p>5.<code>on</code>èŠ‚é…ç½®æŒ‡æ˜æ”¹é…ç½®åº”ç”¨äºå…·ä½“å“ªä¸ª<code>host</code>ã€‚</p><p>The on section states which host this configuration statement applies to.</p><p>6.å„èŠ‚ç‚¹çš„<code>IP</code>åœ°å€å’Œç«¯å£å·ã€‚æ¯ä¸ªèµ„æºéœ€è¦ä¸€ä¸ªå•ç‹¬çš„ç«¯å£ï¼Œé€šå¸¸ä»¥<code>7788</code>å¼€å§‹ã€‚</p><p>The IP address and port number of the respective node. Each resource needs an individual port, usually starting with 7788.</p><p>7.åŒæ­¥ç‡ã€‚å°†å…¶è®¾ç½®ä¸ºç£ç›˜è¯»å†™å’Œç½‘ç»œå¸¦å®½çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚ä»…é™åˆ¶é‡æ–°åŒæ­¥ï¼Œè€Œä¸æ˜¯å¤åˆ¶ã€‚</p><p>The synchronization rate. Set it to one third of the lower of the disk- and network bandwidth. It only limits the resynchronization, not the replication.</p><h2 id="ä¸»ä»åˆ‡æ¢"><a href="#ä¸»ä»åˆ‡æ¢" class="headerlink" title="ä¸»ä»åˆ‡æ¢"></a>ä¸»ä»åˆ‡æ¢</h2><p>ä¸»å¤‡èŠ‚ç‚¹åˆ‡æ¢æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åœæ­¢<code>DRBD</code>æœåŠ¡åˆ‡æ¢å’Œæ­£å¸¸åˆ‡æ¢ã€‚</p><h3 id="æ­£å¸¸åˆ‡æ¢"><a href="#æ­£å¸¸åˆ‡æ¢" class="headerlink" title="æ­£å¸¸åˆ‡æ¢"></a>æ­£å¸¸åˆ‡æ¢</h3><p>ä¸»åˆ‡æ¢æˆä»ï¼Œéœ€è¦å…ˆå¸è½½æ–‡ä»¶ç³»ç»Ÿï¼Œå†æ‰§è¡Œé™çº§ä¸ºä»çš„å‘½ä»¤</p><h4 id="ä¸»ç«¯"><a href="#ä¸»ç«¯" class="headerlink" title="ä¸»ç«¯"></a>ä¸»ç«¯</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">umount /data/</span><br><span class="line">drbdadm secondary all</span><br></pre></td></tr></table></figure><h4 id="ä»ç«¯"><a href="#ä»ç«¯" class="headerlink" title="ä»ç«¯"></a>ä»ç«¯</h4><p>ä»åˆ‡æ¢æˆä¸»ï¼Œè¦å…ˆæ‰§è¡Œå‡ä¸»çš„å‘½ä»¤ï¼Œç„¶åæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm  primary all</span><br><span class="line">mount /dev/drbd0 /data/</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢-drbd-æœåŠ¡åˆ‡æ¢"><a href="#åœæ­¢-drbd-æœåŠ¡åˆ‡æ¢" class="headerlink" title="åœæ­¢ drbd æœåŠ¡åˆ‡æ¢"></a>åœæ­¢ drbd æœåŠ¡åˆ‡æ¢</h3><p>åŸºæœ¬æ€è·¯ï¼šå…³é—­ä¸»èŠ‚ç‚¹æœåŠ¡ï¼Œæ­¤æ—¶æŒ‚è½½çš„<code>DRBD</code>åˆ†åŒºå°±è‡ªåŠ¨åœ¨ä¸»èŠ‚ç‚¹å¸è½½äº†ï¼Œç„¶ååœ¨å¤‡ç”¨èŠ‚ç‚¹æ‰§è¡Œåˆ‡æ¢å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@drbd2 ~]#drbdadm primary all</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶æŠ¥é”™ï¼š</span></span><br><span class="line">2: State change failed: (-7) Refusing to be Primary while peer is not outdated</span><br><span class="line">Command 'drbdsetup 2 primary' terminated with exit code 11</span><br><span class="line"><span class="meta">#</span><span class="bash"> å› æ­¤ï¼Œå¿…é¡»åœ¨å¤‡ç”¨èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line">[root@drbd2 ~]#drbdsetup /dev/drbd0 primary â€“o</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line">[root@drbd2~]#drbdadm -- --overwrite-data-of-peer primary all</span><br></pre></td></tr></table></figure><p>å½“åœ¨å¤‡ç”¨èŠ‚ç‚¹æ‰§è¡Œåˆ‡æ¢åˆ°ä¸»èŠ‚ç‚¹å‘½ä»¤åï¼ŒåŸæ¥çš„ä¸»ç”¨èŠ‚ç‚¹è‡ªåŠ¨å˜ä¸ºå¤‡ç”¨èŠ‚ç‚¹ã€‚æ— éœ€åœ¨ä¸»ç”¨èŠ‚ç‚¹å†æ¬¡æ‰§è¡Œåˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹çš„å‘½ä»¤ã€‚</p><h2 id="è„‘è£‚ä¿®å¤"><a href="#è„‘è£‚ä¿®å¤" class="headerlink" title="è„‘è£‚ä¿®å¤"></a>è„‘è£‚ä¿®å¤</h2><p>å½“<code>DRBD</code>å‡ºç°è„‘è£‚åï¼Œä¼šå¯¼è‡´<code>DRBD</code>ä¸¤è¾¹çš„ç£ç›˜æ•°æ®ä¸ä¸€è‡´ï¼Œåœ¨ç¡®å®šè¦ä½œä¸ºä»çš„èŠ‚ç‚¹ä¸Šåˆ‡æ¢æˆ<code>secondary</code>ï¼Œå¹¶æ”¾å¼ƒè¯¥èµ„æºçš„æ•°æ®:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm secondary r0</span><br><span class="line">drbdadm -- --discard-my-data connect r0</span><br></pre></td></tr></table></figure><p>ç„¶åä½œä¸º<code>primary</code>çš„èŠ‚ç‚¹é‡æ–°è¿æ¥<code>secondary</code>ï¼ˆå¦‚æœè¿™ä¸ªèŠ‚ç‚¹å½“å‰çš„è¿æ¥çŠ¶æ€ä¸º<code>WFConnection</code>çš„è¯ï¼Œå¯ä»¥çœç•¥ï¼‰ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿æ¥ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm connect r0</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="åŒæ§é…ç½®äº’ä¿¡ï¼ˆå‡å®šåœ¨æ§-1-æ‰§è¡Œï¼‰"><a href="#åŒæ§é…ç½®äº’ä¿¡ï¼ˆå‡å®šåœ¨æ§-1-æ‰§è¡Œï¼‰" class="headerlink" title="åŒæ§é…ç½®äº’ä¿¡ï¼ˆå‡å®šåœ¨æ§ 1 æ‰§è¡Œï¼‰"></a>åŒæ§é…ç½®äº’ä¿¡ï¼ˆå‡å®šåœ¨æ§ 1 æ‰§è¡Œï¼‰</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo y|ssh-keygen -t dsa -f ~/.ssh/id_dsa -N ""</span><br><span class="line">cp ~/.ssh/id_dsa.pub ~/.ssh/authorized_keys</span><br><span class="line">scp -r ~/.ssh controller-2:         #åŒæ§å¯¹ç«¯hostname</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒé˜…è¯»"><a href="#å‚è€ƒé˜…è¯»" class="headerlink" title="å‚è€ƒé˜…è¯»"></a>å‚è€ƒé˜…è¯»</h2><ul><li><p><a href="https://docs.linbit.com/docs/users-guide-8.4/" target="_blank" rel="noopener">å®˜æ–¹æ‰‹å†Œ</a></p></li><li><p><a href="https://www.suse.com/documentation/sle_ha/book_sleha/data/cha_ha_drbd.html" target="_blank" rel="noopener">SUSE é«˜å¯ç”¨é…ç½®</a></p></li><li><p><a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1/html/Clusters_from_Scratch/ch07.html" target="_blank" rel="noopener">ä½¿ç”¨ DRBD å®ç°å¤åˆ¶å­˜å‚¨</a></p></li><li><p><a href="http://www.cnblogs.com/wxl-dede/p/5114696.html" target="_blank" rel="noopener">drbd é…ç½® - Rikewang - åšå®¢å›­</a></p></li><li><p><a href="http://www.3mu.me/centos%E4%B8%8B%E5%AE%9E%E7%8E%B0heartbeatdrbdmysql%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87%E7%A1%AC%E4%BB%B6%E6%95%85%E9%9A%9C%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2%E9%AB%98%E5%8F%AF%E7%94%A8ha/#respond" target="_blank" rel="noopener">CentOS ä¸‹å®ç° Heartbeat+DRBD+MySQL åŒæœºçƒ­å¤‡ç¡¬ä»¶æ•…éšœè‡ªåŠ¨åˆ‡æ¢é«˜å¯ç”¨(HA)æ–¹æ¡ˆ | ä¸‰æœ¨çš„äººç”Ÿâ€”â€”3mu.me</a></p></li><li><p><a href="https://www.ibm.com/developerworks/library/l-drbd/index.html" target="_blank" rel="noopener">High availability with the Distributed Replicated Block Device</a></p></li><li><p><a href="https://yq.aliyun.com/articles/52043" target="_blank" rel="noopener">è®°ä¸€æ¬¡ DRBD Unknown æ•…éšœå¤„ç†è¿‡ç¨‹</a></p></li><li><p><a href="https://www.linuxidc.com/wap.aspx?nid=93422&amp;cid=9&amp;sp=654" target="_blank" rel="noopener">DRBD ç®¡ç†ã€æ•…éšœå¤„ç†éƒ¨åˆ†</a>(<a href="https://www.linuxidc.com/Linux/2013-12/93422.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2013-12/93422.htm</a>)</p></li><li><p><a href="http://blog.csdn.net/t1anyuan/article/details/52143789" target="_blank" rel="noopener">DRBD ç¼–è¯‘å®‰è£…ä¸­å‡ºç°çš„é—®é¢˜åŠè§£å†³å°ç»“ - CSDN åšå®¢</a></p></li><li><p><a href="https://www.linuxidc.com/Linux/2012-01/51661.htm" target="_blank" rel="noopener">DRBD é…ç½®å‚æ•°</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> é›†ç¾¤ </tag>
            
            <tag> DRBD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DRBD çŠ¶æ€æŒ‡æ ‡è®°å½•</title>
      <link href="/blog/2018-08-29/state-of-drbd/"/>
      <url>/blog/2018-08-29/state-of-drbd/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>åœ¨ç®¡ç†<code>DRBD</code>çš„æ—¶å€™ï¼Œéœ€è¦å…³æ³¨<code>drbd</code>ç›¸å…³çš„å„ç§çŠ¶æ€æŒ‡æ ‡ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•ç›¸å…³çš„æŒ‡ä»¤åŠæ˜¾ç¤ºå«ä¹‰ã€‚<br><a id="more"></a></p><h2 id="DRBDçŠ¶æ€æ¦‚è§ˆ"><a href="#DRBDçŠ¶æ€æ¦‚è§ˆ" class="headerlink" title="DRBDçŠ¶æ€æ¦‚è§ˆ"></a><code>DRBD</code>çŠ¶æ€æ¦‚è§ˆ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbd-overview</span><br><span class="line">drbd status</span><br><span class="line">cat /proc/drbd      # 9.0åºŸæ­¢åœ¨drbd9ä¸­ï¼Œæ›´å¤šçš„æ˜¯ä½¿ç”¨drbdadmæˆ–drbdsetupæ¥è·å–èŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå‘½ä»¤ç•¥æœ‰ä¸åŒï¼Œå¯è‡ªè¡Œå¯¹ç…§</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@Storage drbd]# pwd</span><br><span class="line">/usr/lib/drbd</span><br><span class="line">[root@Storage drbd]# ./drbd status</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡ºç¤ºä¾‹</span></span><br><span class="line">drbd driver loaded OK; device status:</span><br><span class="line">version: 8.4.3 (api:1/proto:86-101)</span><br><span class="line">GIT-hash: 89a2942***221f964d3ee515 build by root@third, 2017-07-20 10:58:42</span><br><span class="line">m:res          cs            ro                 ds                 p       mounted       fstype</span><br><span class="line">0:drbd0        Connected     Primary/Secondary  UpToDate/UpToDate  C</span><br><span class="line">1:drbd1^^0     StandAlone    Primary/Unknown    UpToDate/DUnknown  r----s</span><br><span class="line">â€¦â€¦</span><br><span class="line">6:drbd6        Connected     Primary/Secondary  UpToDate/UpToDate  C       /xxx  ext4</span><br></pre></td></tr></table></figure><p>ç¼©å†™è§£é‡Š</p><ul><li>resï¼šèµ„æºåç§°</li><li>csï¼šconnect state,èµ„æºè¿æ¥çŠ¶æ€</li><li>roï¼šroleï¼Œè¡¨ç¤ºèŠ‚ç‚¹è§’è‰²ä¿¡æ¯<br>ç¬¬ä¸€æ¬¡å¯åŠ¨ drbd æ—¶ï¼Œä¸¤ä¸ª drbd èŠ‚ç‚¹é»˜è®¤éƒ½å¤„äº Secondary çŠ¶æ€ï¼Œ<br>Primary/Secondaryï¼ˆä»£è¡¨è¿™ä¸ªæ˜¯ä¸»èŠ‚ç‚¹ï¼‰<br>Secondary/Primaryï¼ˆä»£è¡¨è¿™ä¸ªæ˜¯å‰¯èŠ‚ç‚¹ï¼‰</li><li>dsï¼šdisk state,ç£ç›˜çŠ¶æ€ä¿¡æ¯<br>Inconsistent/Inconsistenï¼Œå³ä¸ºâ€œä¸ä¸€è‡´/ä¸ä¸€è‡´â€çŠ¶æ€ï¼Œè¡¨ç¤ºä¸¤ä¸ªèŠ‚ç‚¹çš„ç£ç›˜æ•°æ®å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚<br>UpToDate/Inconsistentï¼ˆæ­£åœ¨åŒæ­¥ï¼Œæ•°æ®è¿˜æ²¡æœ‰ä¸€è‡´ï¼‰<br>UpToDate/UpToDate ï¼ˆåŒæ­¥å®Œæˆï¼Œæ•°æ®ä¸€è‡´ï¼‰</li><li>C drbd çš„å¤åˆ¶åè®®ï¼Œå³ Aã€Bã€C åè®®ã€‚</li><li>râ€”â€“æ˜¯ IO æ ‡è®°ï¼Œåæ˜ çš„æ˜¯è¯¥èµ„æºçš„ IO çŠ¶æ€ä¿¡æ¯ã€‚å…±æœ‰ 6 ç§ IO çŠ¶æ€æ ‡è®°ç¬¦å·ã€‚</li></ul><h2 id="è¿æ¥çŠ¶æ€"><a href="#è¿æ¥çŠ¶æ€" class="headerlink" title="è¿æ¥çŠ¶æ€"></a>è¿æ¥çŠ¶æ€</h2><p>èŠ‚ç‚¹é—´é€šè¿‡ TCP è¿æ¥è¿›è¡Œé€šä¿¡ï¼Œåœ¨å»ºç«‹è¿æ¥ã€æ–­å¼€è¿æ¥ã€ç‰¹æ®Šæƒ…å†µä¸‹æœ‰å¾ˆå¤šç§è¿æ¥çŠ¶æ€ã€‚</p><p>DRBD è¿æ¥å»ºç«‹å®Œæˆï¼Œè¡¨ç¤ºå…ƒæ•°æ®åŒºã€æ•°æ®åŒºç­‰ä¸€åˆ‡éƒ½å·²å‡†å¤‡å¥½ï¼Œå¯ä»¥è¿›è¡Œä»»ä½•æ•°æ®åŒæ­¥çš„æ“ä½œã€‚<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# drbdadm cstate drbd20</span><br><span class="line">Connected</span><br></pre></td></tr></table></figure></p><p>ä¸€ä¸ªèµ„æºå¯èƒ½æœ‰ä»¥ä¸‹è¿æ¥çŠ¶æ€ä¸­çš„ä¸€ç§</p><ul><li>Unconfiguredï¼šè®¾å¤‡åœ¨ç­‰å¾…é…ç½®</li><li><strong>WFConnection</strong>ï¼šå½“å‰èŠ‚ç‚¹æ­£åœ¨ç­‰å¾…å¯¹ç«¯èŠ‚ç‚¹å‡ºç°ã€‚ä¾‹å¦‚å¯¹æ–¹èŠ‚ç‚¹<code>drbdadm down</code>åï¼Œæœ¬èŠ‚ç‚¹å°†å¤„äºæœ¬çŠ¶æ€ã€‚</li><li><strong>StandAlone</strong>ï¼šæ— è¿æ¥ã€‚å‡ºç°è¿™ç§çŠ¶æ€å¯èƒ½æ˜¯å› ä¸ºï¼šæœªè¿æ¥è¿‡ã€ä½¿ç”¨<code>drbdadm disconnect</code>æ–­å¼€è¿æ¥ã€èŠ‚ç‚¹ç”±äºèº«ä»½éªŒè¯çš„åŸå› æœªæˆåŠŸåŠ å…¥ drbd é›†ç¾¤ä½¿å¾—è¿æ¥è¢«åˆ é™¤ã€è„‘è£‚åæ–­å¼€è¿æ¥ã€‚</li><li>Disconnectingï¼šæ–­å¼€è¿æ¥çš„ä¸€ä¸ªä¸´æ—¶è¿‡æ¸¡çŠ¶æ€ã€‚å®ƒå¾ˆå¿«å°±ä¼šåˆ‡å…¥ä¸‹ä¸€çŠ¶æ€å°±æ˜¯<code>StandAlone</code>ã€‚</li><li>Unconnectedï¼šå°è¯•å†æ¬¡å‘èµ·<code>TCP</code>è¿æ¥æ—¶çš„ä¸€ä¸ªä¸´æ—¶è¿æ¥çŠ¶æ€(æ˜¯è¿æ¥è¶…æ—¶åå†æ¬¡å‘é€è¿æ¥è¯·æ±‚äº§ç”Ÿçš„çŠ¶æ€)ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªçŠ¶æ€å¯èƒ½æ˜¯<code>WFConnection</code>ï¼Œä¹Ÿå¯èƒ½æ˜¯<code>WFReportParams</code>ã€‚</li><li>Timeoutï¼šå’Œå¯¹ç«¯é€šä¿¡è¶…æ—¶æ—¶çš„ä¸´æ—¶çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€å°±æ˜¯<code>Unconnection</code>ã€‚</li><li>BrokenPipeï¼šå’Œå¯¹ç«¯è¿æ¥ä¸¢å¤±æ—¶çš„ä¸´æ—¶çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯<code>Unconnection</code>ã€‚</li><li>NetworkFailureï¼šå’Œå¯¹ç«¯è¿æ¥ä¸¢å¤±æ—¶çš„ä¸´æ—¶çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯<code>Unconnection</code>ã€‚(æ²¡é”™ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·)</li><li>ProtocolErrorï¼šå’Œå¯¹ç«¯è¿æ¥ä¸¢å¤±æ—¶çš„ä¸´æ—¶çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯<code>Unconnection</code>ã€‚(æ²¡é”™ï¼Œè¿˜æ˜¯å’Œä¸Šé¢çš„ä¸€æ ·)</li><li>TearDownï¼šå¯¹ç«¯å…³é—­ TCP è¿æ¥æ—¶çš„ä¸´æ—¶çŠ¶æ€ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯<code>Unconnection</code>ã€‚</li><li><strong>Connected</strong>ï¼šDRBD è¿æ¥å·²ç»å»ºç«‹å®Œæˆï¼Œæ•°æ®é•œåƒå·²ç»æ¿€æ´»æˆåŠŸã€‚è¿™ä¸ªçŠ¶æ€æ˜¯<code>drbd</code>æ­£å¸¸è¿è¡Œæ—¶çš„çŠ¶æ€ã€‚</li><li>WFReportParamsï¼šTCP è¿æ¥å·²ç»å»ºç«‹å®Œæˆï¼Œè¯¥èŠ‚ç‚¹æ­£åœ¨ç­‰å¾…å¯¹ç«¯çš„ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ã€‚</li><li>StartingSyncSï¼šå…¨ç›˜æ•°æ®åŒæ­¥ä¸­ã€‚åªæœ‰åœ¨åˆå§‹åŒ–æ—¶æ‰åº”è¯¥å…¨ç›˜åŒæ­¥ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯ï¼š<code>SyncSource</code>æˆ–<code>PauseSyncS</code>ã€‚</li><li>StartingSyncTï¼šå…¨ç›˜æ•°æ®åŒæ­¥ä¸­ã€‚åªæœ‰åœ¨åˆå§‹åŒ–æ—¶æ‰åº”è¯¥å…¨ç›˜åŒæ­¥ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯ï¼š<code>WFSyncUUID</code>ã€‚</li><li>WFBitMapSï¼šéƒ¨åˆ†æ•°æ®æ­£åœ¨åŒæ­¥ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯ï¼š<code>SyncSource</code>æˆ–<code>PauseSyncS</code>ã€‚</li><li>WFBitMapTï¼šéƒ¨åˆ†æ•°æ®æ­£åœ¨åŒæ­¥ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯ï¼š<code>WFSyncUUID</code>ã€‚</li><li>WFSyncUUIDï¼šåŒæ­¥é©¬ä¸Šå°±è¦å¼€å§‹äº†ã€‚ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼š<code>SyncTarget</code>æˆ–<code>PauseSyncT</code>ã€‚</li><li><strong>SyncSource</strong>ï¼šæ­£åœ¨åŒæ­¥ï¼Œä¸”æœ¬èŠ‚ç‚¹æ˜¯æ•°æ®åŒæ­¥çš„æºç«¯ã€‚</li><li><strong>SyncTartget</strong>ï¼šæ­£åœ¨åŒæ­¥ï¼Œä¸”æœ¬èŠ‚ç‚¹æ˜¯æ•°æ®åŒæ­¥çš„ç›®æ ‡ç«¯ã€‚</li><li>PauseSyncSï¼šæœ¬èŠ‚ç‚¹æ˜¯åŒæ­¥çš„æºç«¯èŠ‚ç‚¹ï¼Œä½†åŒæ­¥è¿‡ç¨‹å½“å‰è¢«æš‚åœã€‚å‡ºç°è¿™ç§çŠ¶æ€çš„åŸå› å¯èƒ½æ˜¯å½“å‰åŒæ­¥è¿›ç¨‹ä¾èµ–äºå¦ä¸€ä¸ªåŒæ­¥è¿›ç¨‹å®Œæˆï¼Œæˆ–è€…ä½¿ç”¨<code>drbdadm pause-sync</code>æ‰‹åŠ¨ä¸­æ–­äº†åŒæ­¥æ“ä½œã€‚</li><li>PauseSyncTï¼šæœ¬èŠ‚ç‚¹æ˜¯åŒæ­¥çš„ç›®æ ‡ç«¯ï¼Œä½†åŒæ­¥è¿‡ç¨‹å½“å‰è¢«æš‚åœã€‚å‡ºç°è¿™ç§çŠ¶æ€çš„åŸå› å¯èƒ½æ˜¯å½“å‰åŒæ­¥è¿›ç¨‹ä¾èµ–äºå¦ä¸€ä¸ªåŒæ­¥è¿›ç¨‹å®Œæˆï¼Œæˆ–è€…ä½¿ç”¨<code>drbdadm pause-sync</code>æ‰‹åŠ¨ä¸­æ–­äº†åŒæ­¥æ“ä½œã€‚</li><li>VerifySï¼šæ­£åœ¨è¿›è¡Œåœ¨çº¿è®¾å¤‡éªŒè¯ï¼Œä¸”æœ¬èŠ‚ç‚¹å°†æˆä¸ºéªŒè¯çš„æºç«¯ã€‚</li><li>VerifyTï¼šæ­£åœ¨è¿›è¡Œåœ¨çº¿è®¾å¤‡éªŒè¯ï¼Œä¸”æœ¬èŠ‚ç‚¹å°†æˆä¸ºéªŒè¯çš„ç›®æ ‡ç«¯ã€‚</li></ul><p>åœ¨ drbd9 ä¸­ï¼Œ<code>WFConnection</code>çŠ¶æ€æ”¹ä¸º<code>connecting</code>çŠ¶æ€ã€‚åˆ é™¤äº†<code>WFReportParams</code>çŠ¶æ€ã€‚æ·»åŠ äº†ä»¥ä¸‹å‡ ä¸ªåŒæ­¥ç›¸å…³çš„çŠ¶æ€ï¼š</p><ul><li>Offï¼šè¯¥å·ç»„è¿˜æœªåŒæ­¥ï¼Œå› ä¸ºè¿æ¥æœªå»ºç«‹ã€‚</li><li><strong>Established</strong>ï¼šæ‰€æœ‰å¯¹è¯¥å·ç»„çš„å†™æ“ä½œå·²ç»åœ¨çº¿å®ŒæˆåŒæ­¥ã€‚è¿™æ˜¯<code>drbd</code>æ­£å¸¸è¿è¡Œæ—¶çš„çŠ¶æ€ã€‚</li><li>Aheadï¼šæ•°æ®åŒæ­¥æ“ä½œè¢«æŒ‚èµ·ï¼Œå› ä¸ºç½‘ç»œå¥—æ¥å­—ä¸­è¾¾åˆ°äº†ä¸€å®šçš„å µå¡ç¨‹åº¦ï¼Œæ— æ³•åº”ä»˜æ›´å¤šçš„è´Ÿè½½ã€‚è¯¥çŠ¶æ€éœ€è¦é…ç½®<code>on-congestion</code>é€‰é¡¹æ¥å¯ç”¨ã€‚</li><li>Behindï¼šå¯¹ç«¯å°†æ•°æ®åŒæ­¥æ“ä½œæŒ‚èµ·ï¼Œå› ä¸ºç½‘ç»œå¥—æ¥å­—ä¸­è¾¾åˆ°äº†ä¸€å®šçš„å µå¡ç¨‹åº¦ï¼Œæ— æ³•åº”ä»˜æ›´å¤šçš„è´Ÿè½½ã€‚è¯¥çŠ¶æ€éœ€è¦åœ¨å¯¹ç«¯èŠ‚ç‚¹ä¸Šé…ç½®<code>on-congestion</code>é€‰é¡¹æ¥å¯ç”¨ã€‚</li></ul><h2 id="è§’è‰²çŠ¶æ€"><a href="#è§’è‰²çŠ¶æ€" class="headerlink" title="è§’è‰²çŠ¶æ€"></a>è§’è‰²çŠ¶æ€</h2><p>èµ„æºçš„è§’è‰²çŠ¶æ€æ—¢å¯ä»¥ä»/proc/drbd æ–‡ä»¶ä¸­è·å–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è·å–ã€‚<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@drbd1 ~]# drbdadm role data1</span><br><span class="line">Primary/Unknown</span><br></pre></td></tr></table></figure></p><p>åœ¨è§’è‰²çŠ¶æ€ä¿¡æ¯ä¸­ï¼Œæœ¬åœ°èŠ‚ç‚¹æ€»æ˜¯æ ‡è®°åœ¨ç¬¬ä¸€ä½ï¼Œè¿œç¨‹èŠ‚ç‚¹æ ‡è®°åœ¨ç»“å°¾ã€‚</p><p>å¯èƒ½çš„èŠ‚ç‚¹è§’è‰²çŠ¶æ€æœ‰ï¼š</p><ul><li>Primaryï¼šèµ„æºçš„ primary è§’è‰²ï¼Œè¯¥è§’è‰²çŠ¶æ€ä¸‹çš„ drbd è®¾å¤‡å¯ä»¥è¿›è¡ŒæŒ‚è½½ã€è¯»ã€å†™ç­‰ã€‚åœ¨æ²¡æœ‰å¯ç”¨å¤šä¸»å¤åˆ¶æ¨¡å‹(dual-primary mode)ï¼Œåªèƒ½æœ‰ä¸€ä¸ª primary èŠ‚ç‚¹ã€‚</li><li>Secondaryï¼šèµ„æºçš„ secondary è§’è‰²ã€‚è¯¥è§’è‰²çŠ¶æ€ä¸‹çš„ drbd è®¾å¤‡ä¼šæ¥æ”¶æ¥è‡ª primary ç«¯çš„æ•°æ®æ›´æ–°(é™¤éå’Œå¯¹ç«¯ä¸æ˜¯ primary)ã€‚ä¸”è¯¥è§’è‰²çš„ drbd è®¾å¤‡ä¸å¯æŒ‚è½½ã€ä¸å¯è¯»ã€ä¸å¯å†™ã€‚</li><li>Unknownï¼šèµ„æºçš„è§’è‰²æœªçŸ¥ã€‚æœ¬åœ°èŠ‚ç‚¹çš„è§’è‰²çŠ¶æ€ç»å¯¹ä¸å¯èƒ½ä¼šæ˜¯è¿™ç§çŠ¶æ€ã€‚åªæœ‰å¯¹ç«¯èŠ‚ç‚¹æ–­å¼€è¿æ¥æ—¶å¯¹ç«¯èŠ‚ç‚¹æ‰å¤„äº Unknown çŠ¶æ€ã€‚</li></ul><h2 id="ç¡¬ç›˜çŠ¶æ€"><a href="#ç¡¬ç›˜çŠ¶æ€" class="headerlink" title="ç¡¬ç›˜çŠ¶æ€"></a>ç¡¬ç›˜çŠ¶æ€</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# drbdadm dstate drbd20</span><br><span class="line">UpToDate/UpToDate</span><br></pre></td></tr></table></figure><p>åœ¨ç£ç›˜çŠ¶æ€ä¿¡æ¯ä¸­ï¼Œæœ¬åœ°èŠ‚ç‚¹çš„ç£ç›˜çŠ¶æ€æ€»æ˜¯æ ‡è®°åœ¨ç¬¬ä¸€ä½ï¼Œè¿œç¨‹èŠ‚ç‚¹æ ‡è®°åœ¨ç»“å°¾ã€‚æœ¬åœ°å’Œå¯¹ç­‰èŠ‚ç‚¹çš„ç¡¬ç›˜æœ‰å¯èƒ½ä¸ºä¸‹åˆ—çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li>Diskless æ— ç›˜ï¼šæœ¬åœ°æ²¡æœ‰å—è®¾å¤‡åˆ†é…ç»™<code>DRBD</code>ä½¿ç”¨ï¼Œè¿™æ„å‘³ç€èµ„æºå¯èƒ½ä»æ²¡æœ‰å’Œå®ƒçš„åº•å±‚å—è®¾å¤‡è¿›è¡Œå…³è”ç»‘å®š(attach)ï¼Œä¹Ÿå¯èƒ½æ˜¯æ‰‹åŠ¨ detach è§£é™¤äº†å…³è”ï¼Œè¿˜å¯èƒ½æ˜¯å‡ºç°äº†åº•å±‚ I/O é”™è¯¯æ—¶è‡ªåŠ¨åˆ†ç¦»ï¼ˆdetachï¼‰ã€‚</li><li>Attachingï¼šè¯»å–æ— æ•°æ®æ—¶å€™çš„ç¬é—´çŠ¶æ€</li><li>Failedï¼šå¤±è´¥ï¼Œæœ¬åœ°å—è®¾å¤‡æŠ¥å‘Š<code>I/O</code>é”™è¯¯çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œå…¶ä¸‹ä¸€ä¸ªçŠ¶æ€ä¸º<code>Diskless</code>æ— ç›˜</li><li>Negotiatingï¼šåœ¨å·²ç»è¿æ¥çš„ DRBD è®¾ç½®è¿›è¡Œ<code>Attach</code>è¯»å–æ— æ•°æ®å‰çš„ç¬é—´çŠ¶æ€</li><li>Inconsistentï¼šæ•°æ®ä¸ä¸€è‡´ï¼Œåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆåˆå§‹çš„å®Œå…¨åŒæ­¥å‰ï¼‰è¿™ç§çŠ¶æ€å‡ºç°åç«‹å³åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºã€‚æ­¤å¤–ï¼Œåœ¨åŒæ­¥æœŸé—´ï¼ˆåŒæ­¥ç›®æ ‡ç«¯ï¼‰æ­£æ¥æ”¶åŒæ­¥æ•°æ®æ—¶ï¼Œä¹Ÿä¼šè¿›å…¥ä¸ä¸€è‡´çŠ¶æ€ã€‚</li><li>Outdatedï¼šæ•°æ®èµ„æºæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯å·²ç»è¿‡æ—¶ã€‚(ä¾‹å¦‚ï¼Œå·²ç»åŒæ­¥å secondary ä¸‹çº¿äº†ï¼Œä¹‹ååˆä¸Šçº¿äº†ï¼Œåœ¨è¿˜æ²¡å¼€å§‹é‡æ–°åŒæ­¥çš„æ—¶å€™å°±æ˜¯ Outdated çŠ¶æ€)</li><li>DUnknownï¼šå½“å¯¹ç­‰èŠ‚ç‚¹ç½‘ç»œè¿æ¥ä¸å¯ç”¨æ—¶å‡ºç°è¿™ç§çŠ¶æ€</li><li>Consistentï¼šè¿æ¥æ–­å¼€æ—¶çš„æ•°æ®å¤„äºä¸€è‡´æ€§çŠ¶æ€ï¼Œå½“è¿æ¥å»ºç«‹åï¼Œå°†å†³å®šæ•°æ®æ˜¯<code>UpToDate</code>è¿˜æ˜¯<code>Outdated</code>çŠ¶æ€</li><li>UpToDateï¼šä¸€è‡´çš„ã€æœ€æ–°çš„æ•°æ®çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸ºæ­£å¸¸çŠ¶æ€</li></ul><h2 id="IO-çŠ¶æ€æ ‡è®°"><a href="#IO-çŠ¶æ€æ ‡è®°" class="headerlink" title="IO çŠ¶æ€æ ‡è®°"></a>IO çŠ¶æ€æ ‡è®°</h2><p>IO çŠ¶æ€æ ‡è®°è¡¨ç¤ºçš„æ˜¯å½“å‰èµ„æºçš„ IO æ“ä½œçŠ¶æ€ã€‚å…±æœ‰ 6 ç§çŠ¶æ€ï¼š</p><ul><li>IO æŒ‚èµ·ï¼šr æˆ– s éƒ½å¯èƒ½è¡¨ç¤º IO æŒ‚èµ·ï¼Œä¸€èˆ¬æ˜¯ rã€‚r=runningï¼Œs=suspendedã€‚</li><li>ä¸²è¡Œé‡æ–°åŒæ­¥ï¼šèµ„æºæ­£åœ¨ç­‰å¾…è¿›è¡Œé‡æ–°åŒæ­¥ï¼Œä½†è¢« resync-after é€‰é¡¹å»¶è¿Ÿäº†åŒæ­¥è¿›åº¦ã€‚è¯¥çŠ¶æ€æ ‡è®°ä¸ºâ€aâ€ï¼Œé€šå¸¸è¯¥çŠ¶æ€æ åº”è¯¥å¤„äºâ€-â€œã€‚</li><li>å¯¹ç«¯åˆå§‹åŒ–åŒæ­¥æŒ‚èµ·ï¼šèµ„æºæ­£åœ¨ç­‰å¾…è¿›è¡Œé‡æ–°åŒæ­¥ï¼Œä½†å¯¹ç«¯èŠ‚ç‚¹å› ä¸ºæŸäº›åŸå› è€Œ IO æŒ‚èµ·ã€‚è¯¥çŠ¶æ€æ ‡è®°ä¸ºâ€pâ€ï¼Œé€šå¸¸è¯¥çŠ¶æ€æ åº”è¯¥å¤„äºâ€-â€œã€‚</li><li>æœ¬åœ°åˆå§‹åŒ–åŒæ­¥æŒ‚èµ·ï¼šèµ„æºæ­£åœ¨ç­‰å¾…è¿›è¡Œé‡æ–°åŒæ­¥ï¼Œä½†æœ¬èŠ‚ç‚¹å› ä¸ºæŸäº›åŸå› è€Œ IO æŒ‚èµ·ã€‚è¯¥çŠ¶æ€æ ‡è®°ä¸ºâ€uâ€ï¼Œé€šå¸¸è¯¥çŠ¶æ€æ åº”è¯¥å¤„äºâ€-â€œã€‚</li><li>æœ¬åœ° IO é˜»å¡ï¼šé€šå¸¸è¯¥çŠ¶æ€æ åº”è¯¥å¤„äºâ€-â€œã€‚å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æ ‡è®°ï¼š<ul><li>dï¼šå› ä¸º DRBD å†…éƒ¨åŸå› å¯¼è‡´çš„ IO é˜»å¡ã€‚</li><li>bï¼šåç«¯è®¾å¤‡æ­£å¤„äº IO é˜»å¡ã€‚</li><li>nï¼šç½‘ç»œå¥—æ¥å­—é˜»å¡ã€‚</li><li>aï¼šç½‘ç»œå¥—æ¥å­—å’Œåç«¯å—è®¾å¤‡åŒæ—¶å¤„äºé˜»å¡çŠ¶æ€ã€‚</li></ul></li><li>Activity Log æ›´æ–°æŒ‚èµ·ï¼šå½“ al æ›´æ–°è¢«æŒ‚èµ·æ—¶ï¼Œå¤„äºè¯¥çŠ¶æ€ï¼Œæ ‡è®°ä¸ºâ€sâ€ï¼Œé€šå¸¸è¯¥çŠ¶æ€æ åº”è¯¥å¤„äºâ€-â€œã€‚(å¦‚æœä¸çŸ¥é“ä»€ä¹ˆæ˜¯ Active Logï¼Œè¯·æ— è§†æœ¬æ ‡è®°)</li></ul><h2 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h2><p>ä¹ æƒ¯ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨<code>cat /proc/drbd</code>è·å–<code>drbd</code>çŠ¶æ€ä¿¡æ¯ã€‚ä¸»è¦æ˜¯ä¸€äº›è®¡æ•°å™¨å’Œè®¡é‡å™¨çš„å€¼ã€‚<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@Storage ~]# cat /proc/drbd </span><br><span class="line">version: 8.4.3 (api:1/proto:86-101)</span><br><span class="line">srcversion: 9D811F04CD6DC2C9A9A608F </span><br><span class="line"></span><br><span class="line"> 3: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----</span><br><span class="line">    ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0</span><br><span class="line"></span><br><span class="line">301: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----</span><br><span class="line">    ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0</span><br></pre></td></tr></table></figure></p><p>drbd84 ä¸­ä½¿ç”¨ç¼©å†™ç¬¦å·æ¥æ ‡è®°æ€§èƒ½æŒ‡æ ‡ï¼Œè€Œ drbd9 ä¸­ä½¿ç”¨å…¨ç§°æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ drbd84 ä¸­çš„ ns å’Œ drbd9 ä¸­çš„ send æ˜¯åŒä¸€ä¸ªæ„æ€ã€‚</p><ul><li>ns/send (network send)ï¼šé€šè¿‡ç½‘ç»œè¿æ¥å‘é€ç»™å¯¹ç«¯çš„æ•°æ®é‡ï¼Œå•ä½ä¸º Kbã€‚</li><li>nr/receive (network receive)ï¼šé€šè¿‡ç½‘ç»œè¿æ¥æ¥æ”¶åˆ°å¯¹ç«¯å‘é€æ¥çš„æ•°æ®é‡ï¼Œå•ä½ä¸º Kbã€‚</li><li>dw/written (disk write)ï¼šè¯¥å·(volume)å†™å…¥æœ¬åœ°ç£ç›˜çš„æ•°æ®é‡ï¼Œå•ä½ä¸º Kbã€‚</li><li>dr/read (disk read)ï¼šè¯¥å·(volume)ä»æœ¬åœ°ç£ç›˜è¯»å–çš„æ•°æ®é‡ï¼Œå•ä½ä¸º Kbã€‚</li><li>al/al-writes (activity log)ï¼šå…ƒæ•°æ®åŒºä¸­ al æ›´æ–°çš„æ¬¡æ•°ã€‚</li><li>bm/bm-writes (bit map)ï¼šå…ƒæ•°æ®åŒºä¸­ bitmap æ›´æ–°çš„æ¬¡æ•°ã€‚</li><li>lo/lower-pending (local count)ï¼šDRBD å‘èµ·çš„æ‰“å¼€æœ¬åœ° IO å­ç³»ç»Ÿçš„è¯·æ±‚æ¬¡æ•°ã€‚</li><li>pe/pending (pending)ï¼šæœ¬åœ°å‘é€ç»™å¯¹ç«¯ä½†å´æ²¡æœ‰å›å¤çš„æ¬¡æ•°ã€‚</li><li>ua/unacked (unacknowledged)ï¼šæ¥æ”¶åˆ°å¯¹ç«¯å‘é€çš„è¯·æ±‚ä½†å´æ²¡æœ‰ç»™äºˆå›å¤çš„è¯·æ±‚æ•°é‡ã€‚</li><li>ap/upper-pending (application pending)ï¼šè½¬å‘ç»™ DRBD çš„ IO å—çš„è¯·æ±‚ï¼Œä½† DRBD è¿˜æ²¡ç»™äºˆå›å¤çš„è¯·æ±‚æ•°é‡ã€‚</li><li>ep (epochs):epoch å¯¹è±¡çš„æ•°é‡ã€‚é€šå¸¸ä¸º 1ã€‚drbd9 ä¸­æ²¡æœ‰è¯¥æŒ‡æ ‡ã€‚</li><li>wo/write-ordering (write order):å½“å‰æ­£åœ¨ä½¿ç”¨çš„ write order æ–¹æ³•ï¼šb(barrier), f(flush), d(drain)æˆ– n(none)ã€‚</li><li>oos/out-of-sync (out of sync):å½“å‰ä¸åŒæ­¥çš„æ•°æ®é‡ï¼Œå•ä½ä¸º Kbã€‚</li></ul><p>ä¸Šé¢æ‰€æœ‰â€æœªç»™äºˆå›å¤â€çš„æŒ‡æ ‡æ•°é‡éƒ½è¡¨ç¤ºåŠ¨ä½œè¿˜æœªå®Œæˆï¼Œéœ€è¦å›å¤åæ‰è¡¨ç¤ºæ“ä½œå®Œæˆã€‚è¿™äº›æœªå›å¤æ•°å€¼ä¸èƒ½å¤ªå¤§ã€‚</p><p>æ­¤å¤–ï¼Œdrbd9 ä¸­æ·»åŠ äº†ä»¥ä¸‹å‡ ä¸ªæŒ‡æ ‡ï¼š</p><ul><li>resync-suspendedï¼šé‡æ–°åŒæ­¥æ“ä½œå½“å‰æ˜¯å¦è¢«æŒ‚èµ·ã€‚å¯èƒ½çš„å€¼ä¸º no/user/peer/dependencyã€‚</li><li>blockedï¼šæœ¬åœ° IO çš„æ‹¥æŒ¤æƒ…å†µã€‚<ul><li>noï¼šæœ¬åœ° IO ä¸æ‹¥æŒ¤ã€‚</li><li>upperï¼šDRBD å±‚ä¹‹ä¸Šçš„ IO è¢«é˜»å¡ã€‚ä¾‹å¦‚åˆ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ IO é˜»å¡ã€‚å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼š<ul><li>ç®¡ç†å‘˜ä½¿ç”¨ drbdadm suspend-io å‘½ä»¤æŒ‚èµ·äº† I/O æ“ä½œã€‚</li><li>çŸ­æš‚çš„ IO é˜»å¡ï¼Œä¾‹å¦‚ attach/detach å¯¼è‡´çš„ã€‚</li><li>åˆ é™¤äº†ç¼“å†²åŒºã€‚</li><li>bitmap çš„ IO ç­‰å¾…ã€‚</li></ul></li><li>lowerï¼šåº•å±‚è®¾å¤‡å¤„äºæ‹¥æŒ¤çŠ¶æ€ã€‚</li></ul></li></ul><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="http://www.cnblogs.com/f-ck-need-u/p/8684648.html" target="_blank" rel="noopener">drbd(ä¸‰)ï¼šdrbd çš„çŠ¶æ€è¯´æ˜ - éªé©¬é‡‘é¾™ - åšå®¢å›­</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DRBD </tag>
            
            <tag> Linux </tag>
            
            <tag> é«˜å¯ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº DRBD ä½¿ç”¨å¤–éƒ¨å…ƒæ•°æ®</title>
      <link href="/blog/2018-08-28/drbd-with-external-disk/"/>
      <url>/blog/2018-08-28/drbd-with-external-disk/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>è£‚è„‘ä¸€æ—¦å‘ç”Ÿï¼Œéœ€è¦åŠæ—¶æ’æŸ¥é—®é¢˜æ‰€åœ¨ï¼Œæœ€å¤§é™åº¦ä¿æŠ¤æ•°æ®å®Œæ•´æ€§ã€‚mathjax<br><a id="more"></a></p><h2 id="meta-dataå­˜æ”¾ä½ç½®ä¼˜ç¼ºç‚¹æ¯”è¾ƒ"><a href="#meta-dataå­˜æ”¾ä½ç½®ä¼˜ç¼ºç‚¹æ¯”è¾ƒ" class="headerlink" title="meta dataå­˜æ”¾ä½ç½®ä¼˜ç¼ºç‚¹æ¯”è¾ƒ"></a><code>meta data</code>å­˜æ”¾ä½ç½®ä¼˜ç¼ºç‚¹æ¯”è¾ƒ</h2><h3 id="internal-meta-data"><a href="#internal-meta-data" class="headerlink" title="internal meta-data"></a>internal meta-data</h3><p>meta-data å’Œæ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ªåº•å±‚è®¾å¤‡ä¹‹ä¸Šï¼Œå®ƒé€šè¿‡åœ¨è®¾å¤‡æœ«ç«¯é¢„ç•™ä¸€ä¸ªåŒºåŸŸä»¥å­˜å‚¨å…ƒæ•°æ®åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><ul><li>ä¼˜ç‚¹ï¼š</li></ul><p>ä¸€æ—¦ meta-data åˆ›å»ºä¹‹åï¼Œå°±å’Œå®é™…æ•°æ®ç»‘åœ¨äº†ä¸€èµ·ï¼Œåœ¨ç»´æŠ¤ä¸Šä¼šæ›´ç®€å•æ–¹ä¾¿ï¼Œä¸ç”¨æ‹…å¿ƒ meta-data ä¼šå› ä¸ºæŸäº›æ“ä½œè€Œä¸¢å¤±ã€‚å¦å¤–åœ¨ç¡¬ç›˜æŸåä¸¢å¤±æ•°æ®çš„åŒæ—¶ï¼Œmeta-data ä¹Ÿè·Ÿç€ä¸€èµ·ä¸¢å¤±ï¼Œå½“æ›´æ¢ç¡¬ç›˜ä¹‹åï¼Œåªéœ€è¦æ‰§è¡Œé‡å»º meta-data çš„å‘½ä»¤å³å¯ï¼Œä¸¢å¤±çš„æ•°æ®ä¼šå¾ˆå®¹æ˜“çš„ä»å…¶ä»–èŠ‚ç‚¹åŒæ­¥è¿‡æ¥ã€‚</p><ul><li>ç¼ºç‚¹ï¼š</li></ul><p>å¦‚æœåº•å±‚è®¾å¤‡æ˜¯å•ä¸€çš„ç£ç›˜ï¼Œæ²¡æœ‰åš raidï¼Œä¹Ÿä¸æ˜¯ lvm ç­‰ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¹å†™å…¥ååé‡äº§ç”Ÿè´Ÿé¢å½±å“ã€‚å› ä¸ºæ¯ä¸€æ¬¡å†™ io éƒ½éœ€è¦æ›´æ–° meta-data é‡Œé¢çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæ¯æ¬¡å†™ io éƒ½ä¼šæœ‰ä¸¤æ¬¡ï¼Œè€Œä¸”è‚¯å®šä¼šæœ‰ç£å¤´çš„è¾ƒå¤§å¯»é“ç§»åŠ¨ï¼Œå› ä¸º meta-data éƒ½æ˜¯è®°å½•åœ¨è®¾å¤‡çš„æœ€æœ«ç«¯çš„ï¼Œè¿™æ ·å°±ä¼šé€ æˆå†™ io çš„æ€§èƒ½é™ä½ã€‚</p><h3 id="external-meta-data"><a href="#external-meta-data" class="headerlink" title="external meta data"></a>external meta data</h3><p><code>meta-data</code>å­˜æ”¾åœ¨ç‹¬ç«‹çš„ï¼Œä¸å­˜æ”¾æ•°æ®çš„è®¾å¤‡åˆ†å¼€çš„è®¾å¤‡ä¹‹ä¸Šã€‚</p><ul><li>ä¼˜ç‚¹ï¼š</li></ul><p>ä¸ internal meta-data çš„ç¼ºç‚¹å®Œå…¨ç›¸å¯¹ã€‚å¯¹äºæŸäº›å†™æ“ä½œ, ä½¿ç”¨å¤–éƒ¨å…ƒæ•°æ®ä¼šç¨å¾®æ”¹è¿›å»¶è¿Ÿè¡Œä¸ºã€‚</p><ul><li>ç¼ºç‚¹ï¼š</li></ul><p>ç”±äº meta-data å­˜æ”¾åœ¨ä¸æ•°æ®è®¾å¤‡åˆ†å¼€çš„åœ°æ–¹ï¼Œå°±æ„å‘³ç€å¦‚æœç£ç›˜æ•…éšœä¸”ä»…ç ´åç”Ÿäº§æ•°æ® (è€Œä¸æ˜¯ DRBD å…ƒæ•°æ®), åˆ™å¯ä»¥é€šè¿‡æ‰‹åŠ¨å¹²é¢„, ä»¥ä½¿å‘èµ·ä»å¹¸å­˜çš„èŠ‚ç‚¹åˆ°åç»­æ›´æ¢çš„ç£ç›˜ä¸Šçš„å®Œæ•´æ•°æ®åŒæ­¥ã€‚ä¹Ÿå°±æ˜¯ç®¡ç†ç»´æŠ¤ä¼šç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼Œå¾ˆå°çš„ä¸€ç‚¹ç‚¹ã€‚</p><p><strong>æ³¨æ„ï¼š</strong> å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å·²ç»å­˜åœ¨æ•°æ®çš„è®¾å¤‡ä¸Šé¢å»ºç«‹ drbd çš„èµ„æºï¼Œå¹¶ä¸”ä¸å¸Œæœ›ä¸¢å¤±è¯¥è®¾å¤‡ä¸Šé¢çš„æ•°æ®ï¼Œåˆæ²¡åŠæ³•å¢å¤§åº•å±‚è®¾å¤‡çš„å®¹é‡ï¼Œè€Œä¸”ä¸Šå±‚æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒæ”¶ç¼©ï¼Œæˆ‘ä»¬å°±åªèƒ½å°† meta data åˆ›å»ºæˆ external æ–¹å¼ã€‚</p><h2 id="ä¼°ç®—å…ƒæ•°æ®å¤§å°"><a href="#ä¼°ç®—å…ƒæ•°æ®å¤§å°" class="headerlink" title="ä¼°ç®—å…ƒæ•°æ®å¤§å°"></a>ä¼°ç®—å…ƒæ•°æ®å¤§å°</h2><p>æ³¨æ„ï¼šå¦‚æœå…¬å¼æ¸²æŸ“å‡ºé”™ï¼Œå¯ä»¥å»<a href="https://zohooo.github.io/jaxedit/" target="_blank" rel="noopener">è¿™é‡Œ</a>é¢„è§ˆ</p><p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®— DRBD å…ƒæ•°æ®çš„ç²¾ç¡®ç©ºé—´è¦æ±‚:</p><p><img src="https://docs.linbit.com/ug-src/users-guide-8.4/images/metadata-size-exact.png" alt="ç²¾ç¡®è®¡ç®—å…ƒæ•°æ®å¤§å°"></p><p>$$M<em>{S}= \lceil\frac{C</em>{s}}{2^{18}} \rceil \ast 8 \ast N + 72$$</p><p>Cs æ˜¯å­˜å‚¨è®¾å¤‡æ‰‡åŒºå¤§å°ã€‚N æ˜¯å¯¹ç«¯çš„æ•°é‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ drbd å®ç°çš„æ˜¯åŒèŠ‚ç‚¹ï¼Œå› æ­¤ N=1ï¼Œå¯ä»¥ä¸ç”¨è€ƒè™‘ã€‚</p><p>æ‚¨å¯ä»¥é€šè¿‡å‘å‡º blockdev â€“getsz <device>æ¥æ£€ç´¢è®¾å¤‡å¤§å°ã€‚</device></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@Storage ~]# blockdev --getsz /dev/StorPool1/SANLun2</span><br><span class="line">2097152</span><br></pre></td></tr></table></figure><p>ç»“æœä¸­çš„ Ms çš„å¤§å°ä¹Ÿæ˜¯ç”¨æ‰‡åŒºè¡¨ç¤ºçš„,è¦è½¬æ¢ä¸º MB, è¯·é™¤ä»¥ 2048ã€‚(å¯¹äº 512 å­—èŠ‚çš„æ‰‡åŒºå¤§å°, è¿™æ˜¯é™¤ s390 ä¹‹å¤–çš„æ‰€æœ‰ Linux å¹³å°ä¸Šçš„é»˜è®¤å€¼)ã€‚<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">23</span>]: (math.ceil(<span class="number">2097152</span>/<span class="number">2</span>**<span class="number">18</span>)*<span class="number">8</span>+<span class="number">72</span>)/float(<span class="number">2048</span>)</span><br><span class="line">Out[<span class="number">23</span>]: <span class="number">0.06640625</span></span><br></pre></td></tr></table></figure></p><p>åœ¨å®è·µä¸­, ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåˆç†çš„å¥½çš„è¿‘ä¼¼, ä¸‹é¢ç»™å‡ºã€‚è¯·æ³¨æ„, åœ¨æ­¤å…¬å¼ä¸­, å•ä½ä¸ºå…†å­—èŠ‚(megabytes), è€Œéæ‰‡åŒº:</p><p><img src="https://docs.linbit.com/ug-src/users-guide-8.4/images/metadata-size-approx.png" alt="é¢„ä¼°è®¡ç®—å…ƒæ•°æ®å¤§å°"></p><p>$$M<em>{MB} \lt \frac{C</em>{MB}}{32768} \ast N + 1$$</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–å—è®¾å¤‡å¤§å°</span></span><br><span class="line">[root@Storage ~]# lsblk /dev/StorPool1/SANLun2</span><br><span class="line">NAME              MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">StorPool1-SANLun2 253:3    0   1G  0 lvm</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¢„ä¼°å…ƒæ•°æ®è®¾å¤‡å¤§å°</span></span><br><span class="line">In [<span class="number">30</span>]: <span class="number">1024</span>/float(<span class="number">32768</span>)+<span class="number">1</span></span><br><span class="line">Out[<span class="number">30</span>]: <span class="number">1.03125</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„æ’æ’­ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹,æ¥æºå‚è€ƒ<a href="https://blog.csdn.net/starshine/article/details/8226320" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼ˆè§£é‡Šï¼‰å’Œ<a href="http://www.maixj.net/ict/kbkib-mbmib-gbgib-15095" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼ˆåŒºåˆ«ï¼‰ã€‚</p><table><thead><tr><th style="text-align:left">åå­—</th><th style="text-align:left">ç¼©å†™</th><th style="text-align:left">æ¬¡æ–¹</th><th style="text-align:left">åå­—</th><th style="text-align:left">ç¼©å†™</th><th style="text-align:left">æ¬¡æ–¹</th></tr></thead><tbody><tr><td style="text-align:left">kilobyte</td><td style="text-align:left">KB</td><td style="text-align:left">10^3</td><td style="text-align:left">kibibyte</td><td style="text-align:left">KiB</td><td style="text-align:left">2^10</td></tr><tr><td style="text-align:left">megabyte</td><td style="text-align:left">MB</td><td style="text-align:left">10^6</td><td style="text-align:left">mebibyte</td><td style="text-align:left">MiB</td><td style="text-align:left">2^20</td></tr><tr><td style="text-align:left">gigabyte</td><td style="text-align:left">GB</td><td style="text-align:left">10^9</td><td style="text-align:left">gibibyte</td><td style="text-align:left">GiB</td><td style="text-align:left">2^30</td></tr><tr><td style="text-align:left">terabyte</td><td style="text-align:left">TB</td><td style="text-align:left">10^12</td><td style="text-align:left">tebibyte</td><td style="text-align:left">TiB</td><td style="text-align:left">2^40</td></tr><tr><td style="text-align:left">petabyte</td><td style="text-align:left">PB</td><td style="text-align:left">10^15</td><td style="text-align:left">pebibyte</td><td style="text-align:left">PiB</td><td style="text-align:left">2^50</td></tr><tr><td style="text-align:left">exabyte</td><td style="text-align:left">EB</td><td style="text-align:left">10^18</td><td style="text-align:left">exbibyte</td><td style="text-align:left">EiB</td><td style="text-align:left">2^60</td></tr><tr><td style="text-align:left">zettabyte</td><td style="text-align:left">ZB</td><td style="text-align:left">10^21</td><td style="text-align:left">zebibyte</td><td style="text-align:left">ZiB</td><td style="text-align:left">2^70</td></tr><tr><td style="text-align:left">yottabyte</td><td style="text-align:left">YB</td><td style="text-align:left">10^24</td><td style="text-align:left">yobibyte</td><td style="text-align:left">YiB</td><td style="text-align:left">2^80</td></tr></tbody></table><h2 id="é‡ç½®èµ„æºçš„å¤§å°"><a href="#é‡ç½®èµ„æºçš„å¤§å°" class="headerlink" title="é‡ç½®èµ„æºçš„å¤§å°"></a>é‡ç½®èµ„æºçš„å¤§å°</h2><h3 id="åœ¨çº¿å¢åŠ "><a href="#åœ¨çº¿å¢åŠ " class="headerlink" title="åœ¨çº¿å¢åŠ "></a>åœ¨çº¿å¢åŠ </h3><p>éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li><p>æ”¯æŒè®¾å¤‡å¿…é¡»æ˜¯é€»è¾‘å·</p></li><li><p>å½“å‰çš„èµ„æºå¿…é¡»å¤„äº<code>connected</code>çš„è¿æ¥çŠ¶æ€ã€‚</p></li></ol><p>åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ç»™è®¾å¤‡å¢åŠ å¤§å°åï¼Œå†ç¡®è®¤åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¤„äº<code>primary</code>çŠ¶æ€ã€‚ç„¶åè¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm resize &lt;resource&gt;</span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä¼šè§¦å‘æ–°æ‰‡åŒºçš„åŒæ­¥ï¼Œå®Œæˆä¸»èŠ‚ç‚¹åˆ°å¤‡ç”¨èŠ‚ç‚¹é—´çš„åŒæ­¥ã€‚</p><p>å¦‚æœä½ æ·»åŠ çš„ç©ºé—´æ˜¯å¹²å‡€æ²¡æœ‰æ•°æ®çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>--assume-clean</code>é€‰é¡¹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm -- --assume-clean resize &lt;resource&gt;</span><br></pre></td></tr></table></figure><p>æ¥è·³è¿‡é¢å¤–çš„ç©ºé—´åŒæ­¥ã€‚</p><h3 id="ç¦»çº¿å¢åŠ "><a href="#ç¦»çº¿å¢åŠ " class="headerlink" title="ç¦»çº¿å¢åŠ "></a>ç¦»çº¿å¢åŠ </h3><p>ï¼ˆæ­¤ä¸ºé«˜çº§åŠŸèƒ½ï¼Œè¯·è‡ªå®¡ä¹‹åä½¿ç”¨ã€‚ï¼‰</p><ol><li>èµ„æºè¢«é…ç½®ä¸º external meta data æ—¶</li></ol><p>å½“ DRBD åœ¨å¤„äºéæ´»åŠ¨æƒ…å†µä¸‹ï¼Œåœ¨ä¸¤ä¸ªèŠ‚ç‚¹çš„æ”¯æŒè®¾å¤‡è¢«æ‰©å±•æ—¶ï¼Œä¸” DRBD èµ„æºä½¿ç”¨çš„æ˜¯ external meta dataï¼Œé‚£ä¹ˆæ–°çš„å¤§å°ä¼šè‡ªåŠ¨è¢«è¯†åˆ«ï¼Œä¸éœ€è¦ç®¡ç†å‘˜å¹²é¢„ã€‚DRBD è®¾å¤‡å°†åœ¨ä¸‹æ¬¡ä¸¤ä¸ªèŠ‚ç‚¹æ´»åŠ¨å¹¶ä¸”æˆåŠŸå»ºç«‹ç½‘ç»œè¿æ¥ä¹‹åï¼Œæ˜¾ç¤ºå¢åŠ åçš„æ–°å®¹é‡ã€‚</p><ol><li>èµ„æºè¢«é…ç½®ä¸º internal meta data æ—¶</li></ol><p>å½“ DRBD èµ„æºè¢«é…ç½®ä¸ºä½¿ç”¨ internal meta data æ—¶ï¼Œåœ¨æ–°å¤§å°å˜ä¸ºå¯ç”¨ä¹‹å‰, åˆ™å¿…é¡»å°†æ­¤å…ƒæ•°æ®ç§»åŠ¨åˆ°å·²æ‰©å®¹è®¾å¤‡çš„æœ«å°¾ã€‚ä¸ºæ­¤, è¯·å®Œæˆä»¥ä¸‹æ­¥éª¤:</p><ul><li>down æ‰ DRBD èµ„æº:</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm down &lt;resource&gt;</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ”¶ç¼©ä¹‹å‰å°†å…ƒæ•°æ®ä¿å­˜åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm dump-md &lt;resource&gt; &gt; /tmp/metadata</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸Šæ­¥éª¤å¿…é¡»åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«è¿è¡Œã€‚ä¸èƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¿å­˜äº†å…ƒæ•°æ®ç„¶ååœ¨æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦åˆ™å°±æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p><ul><li><p>åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šç»™æ”¯æŒçš„å—è®¾å¤‡å¢åŠ å®¹é‡</p></li><li><p>åˆ†åˆ«åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šè°ƒæ•´/tmp/metadata æ–‡ä»¶ä¸­<code>la-size-sect</code>çš„å¤§å°ä¿¡æ¯ã€‚æ³¨ï¼šè¿™é‡Œ la-size-sect æŒ‡å®šçš„æ˜¯æ‰‡åŒºæ•°é‡</p></li><li><p>é‡æ–°åˆå§‹åŒ–å…ƒæ•°æ®åŒºåŸŸ</p></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm create-md &lt;resource&gt;</span><br></pre></td></tr></table></figure><ul><li>åˆ†åˆ«åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šé‡æ–°å¯¼å…¥ä¿®æ­£çš„å…ƒæ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ­¤å¤„ä½¿ç”¨bashè„šæœ¬ï¼Œéœ€è¦ç¡®è®¤å¯ç”¨æ€§</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> drbdmeta_cmd=$(drbdadm -d dump-md &lt;resource&gt;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;drbdmeta_cmd/dump-md/restore-md&#125;</span> /tmp/metadata</span></span><br><span class="line">Valid meta-data in place, overwrite? [need to type 'yes' to confirm]</span><br><span class="line">yes</span><br><span class="line">Successfully restored meta data</span><br></pre></td></tr></table></figure><ul><li>é‡æ–°å¯ç”¨ DRBD èµ„æº</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm up &lt;resource&gt;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè®¾ç½® DRBD ä¸º primary</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm primary &lt;resource&gt;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå·²å®Œæˆ DRBD è®¾å¤‡å¤§å°çš„æ‰©å®¹ã€‚</p><h3 id="åœ¨çº¿ç¼©å°å®¹é‡"><a href="#åœ¨çº¿ç¼©å°å®¹é‡" class="headerlink" title="åœ¨çº¿ç¼©å°å®¹é‡"></a>åœ¨çº¿ç¼©å°å®¹é‡</h3><p>æ³¨ï¼šåœ¨çº¿ç¼©å°å®¹é‡ï¼Œä»…æ”¯æŒ<code>external metadata</code></p><p>åœ¨ç¼©å° DRBD è®¾å¤‡æ—¶å¿…é¡»é¦–å…ˆç¼©å° DRBD çš„ä¸Šå±‚å—è®¾å¤‡ã€‚ä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿã€‚ç”±äº DRBD æ— æ³•è·çŸ¥æ–‡ä»¶ç³»ç»Ÿåˆ°åº•ä½¿ç”¨äº†å¤šå°‘ç©ºé—´ï¼Œæ‰€ä»¥åœ¨ç¼©å°æ–‡ä»¶ç³»ç»Ÿæ—¶éœ€è¦æ ¼å¤–å°å¿ƒé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¯ä»¥è¢«ç¼©å°å–å†³äºæ‰€ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿã€‚å¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒåœ¨çº¿ç¼©å‡ã€‚XFS ä¹Ÿä¸æ”¯æŒåœ¨çº¿ç¼©å‡ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç¼©å°æ–‡ä»¶ç³»ç»Ÿåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨çº¿ç¼©å° DRBD è®¾å¤‡å®¹é‡ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm resize --size=&lt;new-size&gt;  &lt;resource&gt;</span><br></pre></td></tr></table></figure><h3 id="ç¦»çº¿æ”¶ç¼©å®¹é‡"><a href="#ç¦»çº¿æ”¶ç¼©å®¹é‡" class="headerlink" title="ç¦»çº¿æ”¶ç¼©å®¹é‡"></a>ç¦»çº¿æ”¶ç¼©å®¹é‡</h3><p>ï¼ˆæ­¤ä¸ºé«˜çº§åŠŸèƒ½ï¼Œè¯·è‡ªå®¡ä¹‹åä½¿ç”¨ã€‚ï¼‰</p><p>å¦‚æœåœ¨ DRBD å¤„äºéæ´»åŠ¨çŠ¶æ€æ—¶æ”¶ç¼©åå¤‡å—è®¾å¤‡, DRBD å°†æ‹’ç»åœ¨ä¸‹æ¬¡å°è¯•<code>attach</code>æœŸé—´<code>attach</code>åˆ°æ­¤å—è®¾å¤‡, å› ä¸ºå®ƒç°åœ¨å¤ªå° (external meta-data), æˆ–è€…å®ƒå°†æ— æ³•æ‰¾åˆ°å…¶å…ƒæ•°æ® (internal meta-data)ã€‚è¦å˜é€šè§£å†³è¿™äº›é—®é¢˜, è¯·ä½¿ç”¨æ­¤è¿‡ç¨‹ (å¦‚æœä¸èƒ½ä½¿ç”¨ä¸Šé¢çš„åœ¨çº¿æ”¶ç¼©):</p><ul><li><p>åœ¨ DRBD è¿˜å¤„äºé…ç½®è¿è¡ŒçŠ¶æ€æ—¶ï¼Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šç¼©å°æ–‡ä»¶ç³»ç»Ÿ</p></li><li><p>down æ‰ DRBD èµ„æº</p></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm down &lt;resource&gt;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ç¼©å°å‰ä¿å­˜å…ƒæ•°æ®åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm dump-md &lt;resource&gt; &gt; /tmp/metadata</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸Šæ­¥éª¤å¿…é¡»åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šåˆ†åˆ«è¿è¡Œã€‚ä¸èƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¿å­˜äº†å…ƒæ•°æ®ç„¶ååœ¨æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦åˆ™å°±æ— æ³•æ­£å¸¸å·¥ä½œã€‚</p><ul><li><p>åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šç»™æ”¯æŒçš„å—è®¾å¤‡ç¼©å°å®¹é‡</p></li><li><p>åˆ†åˆ«åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šè°ƒæ•´/tmp/metadata æ–‡ä»¶ä¸­<code>la-size-sect</code>çš„å¤§å°ä¿¡æ¯ã€‚æ³¨ï¼šè¿™é‡Œ la-size-sect æŒ‡å®šçš„æ˜¯æ‰‡åŒºæ•°é‡</p></li><li><p>é‡æ–°åˆå§‹åŒ–å…ƒæ•°æ®åŒºåŸŸ</p></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm create-md &lt;resource&gt;</span><br></pre></td></tr></table></figure><ul><li>åˆ†åˆ«åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šé‡æ–°å¯¼å…¥ä¿®æ­£çš„å…ƒæ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ­¤å¤„ä½¿ç”¨bashè„šæœ¬ï¼Œéœ€è¦ç¡®è®¤å¯ç”¨æ€§</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> drbdmeta_cmd=$(drbdadm -d dump-md &lt;resource&gt;)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;drbdmeta_cmd/dump-md/restore-md&#125;</span> /tmp/metadata</span></span><br><span class="line">Valid meta-data in place, overwrite? [need to type 'yes' to confirm]</span><br><span class="line">yes</span><br><span class="line">Successfully restored meta data</span><br></pre></td></tr></table></figure><ul><li>é‡æ–°å¯ç”¨ DRBD èµ„æº</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm up &lt;resource&gt;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–è¯´æ˜"><a href="#å…¶ä»–è¯´æ˜" class="headerlink" title="å…¶ä»–è¯´æ˜"></a>å…¶ä»–è¯´æ˜</h2><h3 id="æŸ¥çœ‹å…ƒæ•°æ®"><a href="#æŸ¥çœ‹å…ƒæ•°æ®" class="headerlink" title="æŸ¥çœ‹å…ƒæ•°æ®"></a>æŸ¥çœ‹å…ƒæ•°æ®</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> down æ‰drbd</span></span><br><span class="line">[root@Storage ~]# drbdadm down drbds2</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å…ƒæ•°æ®å‡ºé”™</span></span><br><span class="line">[root@Storage ~]# drbdadm dump-md drbds2</span><br><span class="line">Found meta data is "unclean", please apply-al first</span><br><span class="line">Command 'drbdmeta 2 v08 /dev/StorPool1/SANLun2 internal dump-md' terminated with exit code 255</span><br><span class="line"><span class="meta">#</span><span class="bash"> æš‚æ—¶ä¸æ˜ç™½è¿™å¥æ“ä½œçš„å«ä¹‰ï¼Œå¾…æŸ¥</span></span><br><span class="line">[root@Storage ~]# drbdadm apply-al drbds2</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹meata-data</span></span><br><span class="line">[root@Storage ~]# drbdadm dump-md drbds2</span><br><span class="line"><span class="meta">#</span><span class="bash"> DRBD meta data dump</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2018-08-29 01:48:20 +0800 [1535478500]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Storage&gt; drbdmeta 2 v08 /dev/StorPool1/SANLun2 internal dump-md</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"></span><br><span class="line">version "v08";</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> md_size_sect 136</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> md_offset 1073737728</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> al_offset 1073704960</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bm_offset 1073672192</span></span><br><span class="line"></span><br><span class="line">uuid &#123;</span><br><span class="line">    0xDDB03F0DAF07DEDC; 0x0000000000000000; 0xE4689A94FBB0E78B; 0xE4679A94FBB0E78B;</span><br><span class="line">    flags 0x00000000;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> al-extents 1237;</span></span><br><span class="line">la-size-sect 2097016;</span><br><span class="line">bm-byte-per-bit 4096;</span><br><span class="line">device-uuid 0x625F486D2CB120D1;</span><br><span class="line">la-peer-max-bio-size 1048576;</span><br><span class="line">al-stripes 1;</span><br><span class="line">al-stripe-size-4k 8;</span><br><span class="line"><span class="meta">#</span><span class="bash"> bm-bytes 32768;</span></span><br><span class="line">bm &#123;</span><br><span class="line"><span class="meta">   #</span><span class="bash"> at 0kB</span></span><br><span class="line">    4096 times 0x0000000000000000;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash"> bits-set 0;</span></span><br></pre></td></tr></table></figure><p>ä»æ­¤å‘½ä»¤ä¸­å¯ä»¥è·çŸ¥ä¸åŒæ ‡è®°ä»£æ•°çš„ uuid å€¼ï¼Œä»¥åŠ metadata çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚ md_size_sect=1951744 è¡¨ç¤ºå…ƒæ•°æ®æ‰€åœ¨åˆ†åŒºå ç”¨äº† 1951744 ä¸ªæ‰‡åŒºã€‚æ³¨æ„ï¼Œè¯¥å‘½ä»¤ä¸è¦åœ¨ drbd è®¾å¤‡å·²å¯åŠ¨çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚</p><p>çŸ¥é“è¿™ä¸¤ä¸ªå‘½ä»¤å¯ä»¥è·å–ä¸€äº›ä¿¡æ¯åï¼Œç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯è®¡ç®— metadata éƒ¨åˆ†çš„æ•°æ®å¤§å°ã€‚è¿™ä¸ªå¤§å°åœ¨â€ä¿®æ”¹ drbd è®¾å¤‡ç©ºé—´å¤§å°â€æ—¶æœ‰ç”¨ã€‚</p><p>é¦–å…ˆè·å–å…ƒæ•°æ®æ‰€åœ¨åˆ†åŒºçš„æ‰‡åŒºæ•°ã€‚å³ä¸Šé¢ç»“æœä¸­çš„â€md_size_sectâ€ã€‚ä¸è¿‡ä¹Ÿå¯ä»¥ä½¿ç”¨å—è®¾å¤‡å·¥å…· blockdev æ¥è·å–ã€‚</p><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><ul><li><a href="https://docs.linbit.com/docs/users-guide-8.4/#s-metadata" target="_blank" rel="noopener">16.1. DRBD meta data</a></li><li><a href="https://www.wenzizone.cn/2009/10/29/drbd%E4%B8%ADmetadata%E7%9A%84%E7%90%86%E8%A7%A3%E5%8E%9F%E5%88%9B.html" target="_blank" rel="noopener">åŸåˆ› | drbd ä¸­ metadata çš„ç†è§£</a></li><li><a href="https://blog.csdn.net/yuanhangq220/article/details/46634249" target="_blank" rel="noopener">drbd é…ç½®ç®€è¿°</a></li><li><a href="http://www.cnblogs.com/f-ck-need-u/p/8678883.html" target="_blank" rel="noopener">drbd(äºŒ)ï¼šé…ç½®å’Œä½¿ç”¨ - éªé©¬é‡‘é¾™ - åšå®¢å›­</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> DRBD </tag>
            
            <tag> meta-data </tag>
            
            <tag> å…ƒæ•°æ® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DRBD ç”¨æˆ·æ‰‹å†Œä¹‹å‘½ä»¤ç¯‡</title>
      <link href="/blog/2018-06-22/commonds-of-drbd/"/>
      <url>/blog/2018-06-22/commonds-of-drbd/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ¬æ–‡åŸºäº<code>DRBD-8.4</code>ç‰ˆç¼–å†™ã€‚<br><a id="more"></a></p><h1 id="drbd-conf-é…ç½®æ–‡ä»¶"><a href="#drbd-conf-é…ç½®æ–‡ä»¶" class="headerlink" title="drbd.conf-é…ç½®æ–‡ä»¶"></a>drbd.conf-é…ç½®æ–‡ä»¶</h1><p>TODO</p><h1 id="drbdmeata-å…ƒæ•°æ®"><a href="#drbdmeata-å…ƒæ•°æ®" class="headerlink" title="drbdmeata-å…ƒæ•°æ®"></a>drbdmeata-å…ƒæ•°æ®</h1><p>TODO</p><h1 id="drbd"><a href="#drbd" class="headerlink" title="drbd"></a>drbd</h1><p>TODO</p><h1 id="drbdadm-ç®¡ç†å·¥å…·"><a href="#drbdadm-ç®¡ç†å·¥å…·" class="headerlink" title="drbdadm-ç®¡ç†å·¥å…·"></a>drbdadm-ç®¡ç†å·¥å…·</h1><h2 id="åç§°"><a href="#åç§°" class="headerlink" title="åç§°"></a>åç§°</h2><p>drbdadm - <code>DRBD</code>ç®¡ç†å·¥å…·</p><h2 id="æ¦‚è¦"><a href="#æ¦‚è¦" class="headerlink" title="æ¦‚è¦"></a>æ¦‚è¦</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drbdadm [-d] [-c &#123; file&#125;] [-t &#123;file&#125;] [-s &#123;cmd&#125;] [-m &#123; cmd&#125;] [-S] [-h &#123;host&#125;] [-- &#123; backend-options&#125;] &#123;command&#125; [&#123;all&#125; | &#123; resource[/volume&gt;]...&#125;]</span><br></pre></td></tr></table></figure><h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p><code>Drbdadm</code>æ˜¯<code>DRBD</code>ç¨‹åºå¥—ä»¶çš„é«˜çº§å·¥å…·ã€‚ <code>Drbdadm</code>ä¸<code>drbdsetup</code>å’Œ<code>drbdmeta</code>çš„å…³ç³»å¯ç±»æ¯”äº <code>ifup / ifdown</code>ä¸<code>ifconfig</code> ã€‚ <code>Drbdadm</code>é€šè¿‡è°ƒç”¨<code>drbdsetup</code>å’Œï¼ˆæˆ–ï¼‰<code>drbdmeta</code>ç¨‹åºè¯»å–ç›¸å…³é…ç½®æ–‡ä»¶å¹¶æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚<br><code>Drbdadm</code>å¯ä»¥è¿è¡Œæ•´ä¸ªèµ„æºæˆ–èµ„æºä¸­çš„å•ä¸ªå·ã€‚ å­å‘½ä»¤ï¼š <code>attach</code> ï¼Œ <code>detach</code> ï¼Œ <code>primary</code> ï¼Œ <code>secondary</code>ï¼Œ <code>invalidate</code> ï¼Œ <code>invalidate-remote</code> ï¼Œ <code>outdate</code> ï¼Œ <code>resize</code> ï¼Œ <code>verify</code> ï¼Œ <code>pause-sync</code> ï¼Œ <code>resume-sync</code> ï¼Œ <code>role</code> ï¼Œ <code>cstate</code> ï¼Œ <code>dstate</code> ï¼Œ <code>create-md</code> ï¼Œ <code>show-gi</code> ï¼Œ <code>get-gi</code> ï¼Œ <code>dump-md</code> ï¼Œ <code>wipe-md</code>å¯ä»¥ä½œç”¨äºæ•´ä¸ªèµ„æºå’Œå•ä¸ªå·ä¸Šã€‚<br>ä»…é™èµ„æºçº§åˆ«çš„å‘½ä»¤æœ‰ï¼š<code>connect</code>, <code>disconnect</code>, <code>up</code>, <code>down</code>, <code>wait-connect</code> å’Œ <code>dump</code> ã€‚</p><h2 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h2><ul><li>-d ï¼Œâ€“ dry-run</li></ul><p>ä»…å°†<code>drbdsetup</code>çš„è°ƒç”¨æ‰“å°åˆ°<code>stdout</code>ï¼Œä½†ä¸ä¼šè¿è¡Œè¿™äº›å‘½ä»¤ã€‚</p><ul><li>-c ï¼Œâ€“ config-file æ–‡ä»¶</li></ul><p>æŒ‡å®š<code>drbdadm</code>å°†ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚ å¦‚æœæœªæŒ‡å®šæ­¤å‚æ•°ï¼Œåˆ™<code>drbdadm</code>å°†æŸ¥æ‰¾<code>/etc/drbd-84.conf</code>ã€<code>/etc/drbd-83.conf</code>ã€<code>/etc/drbd-08.conf</code>å’Œ<code>/etc/drbd.conf</code> ã€‚</p><ul><li>-t ï¼Œâ€“ config-to-test æ–‡ä»¶</li></ul><p>æŒ‡å®šä¸€ä¸ªé¢å¤–çš„<code>drbdadm</code>æ£€æŸ¥æ–‡ä»¶ã€‚ è¯¥é€‰é¡¹ä»…é€‚ç”¨äº<code>dump</code>å’Œ<code>sh-nop</code>å‘½ä»¤ã€‚</p><ul><li>-s ï¼Œâ€“ drbdsetup æ–‡ä»¶</li></ul><p>æŒ‡å®š<code>drbdsetup</code>ç¨‹åºçš„å®Œæ•´è·¯å¾„ã€‚ å¦‚æœçœç•¥æ­¤é€‰é¡¹ï¼Œ<code>drbdadm</code>å°†é¦–å…ˆå†…éƒ¨æŸ¥æ‰¾å®ƒï¼Œç„¶ååœ¨<code>PATH</code>ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾å®ƒã€‚</p><ul><li>-m ï¼Œâ€“ drbdmeta æ–‡ä»¶</li></ul><p>æŒ‡å®š<code>drbdmeta</code>ç¨‹åºçš„å®Œæ•´è·¯å¾„ã€‚ å¦‚æœçœç•¥æ­¤é€‰é¡¹ï¼Œ<code>drbdadm</code>å°†é¦–å…ˆå†…éƒ¨æŸ¥æ‰¾å®ƒï¼Œç„¶ååœ¨<code>PATH</code>ä¸­æŸ¥æ‰¾å®ƒã€‚</p><ul><li>-S ï¼Œ â€“stacked</li></ul><p>æŒ‡å®šåº”è¯¥åœ¨å †å èµ„æºä¸Šæ‰§è¡Œæ­¤å‘½ä»¤ã€‚</p><ul><li>-P ï¼Œ â€“peer</li></ul><p>æŒ‡å®šè¦è¿æ¥çš„å¯¹ç­‰èŠ‚ç‚¹ã€‚ åªæœ‰å½“æ‚¨æ­£åœ¨ä½¿ç”¨çš„èµ„æºä¸­æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„ä¸»æœºæ—¶æ‰éœ€è¦æ­¤é€‰é¡¹ã€‚</p><ul><li>åç«¯é…ç½®é€‰é¡¹</li></ul><p>åŒè¿å­—ç¬¦ï¼ˆâ€“ï¼‰åé¢çš„æ‰€æœ‰é€‰é¡¹éƒ½è¢«è§†ä¸ºåç«¯é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹ä¼šä¼ é€’ç»™åç«¯å‘½ä»¤ã€‚ å³<code>drbdsetup</code>ã€<code>drbdmeta</code>æˆ–<code>drbd-proxy-ctl</code> ã€‚</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul><li>attach</li></ul><p>å°†æœ¬åœ°æ”¯æŒå—è®¾å¤‡è¿æ¥åˆ° DRBD èµ„æºçš„è®¾å¤‡ã€‚</p><ul><li>detach</li></ul><p>ä» DRBD èµ„æºçš„è®¾å¤‡ä¸­åˆ é™¤å¤‡ä»½å­˜å‚¨è®¾å¤‡ã€‚</p><ul><li>connect</li></ul><p>å»ºç«‹èµ„æºè®¾å¤‡çš„ç½‘ç»œé…ç½®ã€‚ å¦‚æœå¯¹ç­‰è®¾å¤‡å·²é…ç½®ï¼Œåˆ™ä¸¤ä¸ª<code>DRBD</code>è®¾å¤‡å°†è¿æ¥ã€‚ å¦‚æœèµ„æºä¸­æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„ä¸»æœºéƒ¨åˆ†ï¼Œåˆ™éœ€è¦ä½¿ç”¨<code>--peer</code>é€‰é¡¹æ¥é€‰æ‹©è¦è¿æ¥çš„å¯¹ç­‰ç«¯ã€‚</p><ul><li>disconnect</li></ul><p>ä»èµ„æºä¸­åˆ é™¤ç½‘ç»œé…ç½®ã€‚ è®¾å¤‡å°†è¿›å…¥<code>StandAlone</code>çŠ¶æ€ã€‚</p><ul><li>syncerï¼ˆæ³¨ï¼š<code>drbdadm --help</code> æœªå‘ç°è¯¥å‘½ä»¤ï¼‰</li></ul><p>å°†é‡æ–°åŒæ­¥å‚æ•°åŠ è½½åˆ°è®¾å¤‡ä¸­ã€‚</p><ul><li>up</li></ul><p>æ˜¯<code>attach</code>ã€<code>syncer</code>å’Œ <code>connect</code>çš„å¿«æ·æ–¹å¼ã€‚</p><p>å®é™…ä¸Šï¼Œå¯ä»¥å°†<code>drbdadm up</code>æ‹†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªåŠ¨ä½œï¼š</p><ol><li><p>å°† drbd çš„èµ„æºå…³è”åˆ°åº•å±‚è®¾å¤‡(metadata å’Œ data åŒº)ä¸Šï¼Œä½¿ä¹‹èƒ½é€šè¿‡åº•å±‚è®¾å¤‡å­˜ã€å–æ•°æ®ã€‚è¯¥è¿‡ç¨‹è°ƒç”¨çš„æ˜¯ drbdsetup ç¨‹åºã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drbdadm attach drbd1</span><br></pre></td></tr></table></figure></li><li><p>åŠ è½½ drbd èµ„æºçš„åŒæ­¥å‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drbdadm syncer drbd1</span><br></pre></td></tr></table></figure></li><li><p>è¿æ¥å¯¹ç«¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drbdadm connect drbd1</span><br></pre></td></tr></table></figure></li></ol><p>è¿™äº›å‘½ä»¤åœ¨<code>drbdadm</code>ä¸­éƒ¨åˆ†å·²å¼ƒç”¨ï¼Œæ”¾åœ¨è¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜<code>up</code>æ—¶æ‰€æ‰§è¡Œçš„å‡ ä¸ªæ­¥éª¤ã€‚</p><ul><li>down</li></ul><p>æ˜¯<code>disconnect</code> å’Œ <code>detach</code>çš„æ·å¾„ã€‚</p><ul><li>primary</li></ul><p>å°†èµ„æºè®¾å¤‡è½¬åŒ–ä¸ºä¸»è¦è§’è‰²ã€‚ æ‚¨éœ€è¦åœ¨è®¿é—®è®¾å¤‡ä¹‹å‰æ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚åˆ›å»ºæˆ–æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿã€‚</p><ul><li>secondary</li></ul><p>å°†è®¾å¤‡è½¬å›æ¬¡è¦è§’è‰²ã€‚ è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºåœ¨è¿æ¥çŠ¶æ€çš„ DRBD è®¾å¤‡å¯¹ä¸­ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¸­åªèƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸»ç«¯ï¼ˆé™¤éåœ¨é…ç½®æ–‡ä»¶ä¸­æ˜ç¡®è®¾ç½®äº†<strong>allow-two-primaries</strong> ï¼‰ã€‚</p><ul><li>invalidate</li></ul><p>å¼ºåˆ¶ DRBD å°†æœ¬åœ°å­˜å‚¨è®¾å¤‡ä¸Šçš„æ•°æ®è§†ä¸ºä¸åŒæ­¥ï¼ˆout-of-syncï¼‰ã€‚ å› æ­¤ï¼ŒDRBD å°†å¤åˆ¶å…¶å¯¹ç­‰ä½“ä¸­çš„æ¯ä¸ªå—ï¼Œä»¥ä½¿æœ¬åœ°å­˜å‚¨è®¾å¤‡é‡æ–°åŒæ­¥ã€‚ ä¸ºé¿å…ç«äº‰ï¼Œä½ éœ€è¦å»ºç«‹äº†çš„å¤åˆ¶é“¾æ¥ï¼Œæˆ–æ–­å¼€è¿æ¥çš„æ¬¡ç«¯ã€‚</p><ul><li>invalidate-remote</li></ul><p>è¯¥å‘½ä»¤ç±»ä¼¼äº<code>invalidate</code>å‘½ä»¤ï¼Œä½†æ˜¯æ˜¯å¯¹ç­‰ç«¯çš„å¤‡ä»½å­˜å‚¨è¢«è§†ä¸ºæ— æ•ˆï¼Œå› æ­¤å¯¹ç«¯è¢«æœ¬åœ°èŠ‚ç‚¹çš„æ•°æ®é‡å†™ã€‚ ä¸ºé¿å…ç«äº‰ï¼Œæ‚¨éœ€è¦å·²å»ºç«‹çš„å¤åˆ¶é“¾æ¥ï¼Œæˆ–æ–­å¼€è¿æ¥çš„ä¸»ç«¯ã€‚</p><ul><li>resize</li></ul><p><code>DRBD</code>é‡æ–°æ£€æŸ¥æ‰€æœ‰å¤§å°é™åˆ¶ï¼Œå¹¶ç›¸åº”è°ƒæ•´èµ„æºçš„è®¾å¤‡å¤§å°ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¢åŠ äº†å¤‡ä»½å­˜å‚¨è®¾å¤‡çš„å¤§å°ï¼ˆå½“ç„¶æ˜¯åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šå‡è¿›è¡Œæ¬¡æ“ä½œï¼‰ï¼Œé‚£ä¹ˆåœ¨æ‚¨çš„æŸä¸ªèŠ‚ç‚¹ä¸Šè°ƒç”¨æ­¤å‘½ä»¤åï¼ŒDRBD å°†é‡‡ç”¨æ–°çš„å¤§å°ã€‚ ç”±äºå¿…é¡»åŒæ­¥æ–°çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤åªæœ‰å­˜åœ¨è‡³å°‘ä¸€ä¸ªä¸»èŠ‚ç‚¹æ—¶ï¼Œæ­¤å‘½ä»¤æ‰å¯ç”¨ã€‚<br><code>--size</code>é€‰é¡¹å¯ç”¨äºè”æœºç¼©å°<code>drbd</code>è®¾å¤‡çš„å¯ç”¨å¤§å°ã€‚ ç”¨æˆ·å¿…é¡»è´Ÿè´£ç¡®ä¿è®¾å¤‡ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿä¸è¢«è¯¥æ“ä½œæˆªæ–­ã€‚<br><code>--assume-peer-have-space</code>å…è®¸ä½ è°ƒæ•´å½“å‰æœªè¿æ¥åˆ°å¯¹ç­‰è®¾å¤‡çš„è®¾å¤‡ã€‚ ä½¿ç”¨æ—¶éœ€è¦å°å¿ƒï¼Œå› ä¸ºå¦‚æœæ‚¨ä¸é‡æ–°è°ƒæ•´å¯¹ç­‰ç£ç›˜çš„å¤§å°ï¼Œåˆ™ä¸¤è€…çš„è¿›ä¸€æ­¥è¿æ¥å°è¯•å°†å¤±è´¥ã€‚<br><code>--assume-clean</code>å…è®¸æ‚¨è°ƒæ•´ç°æœ‰è®¾å¤‡çš„å¤§å°å¹¶é¿å…åŒæ­¥æ–°çš„ç©ºé—´ã€‚ å°†é™„åŠ ç©ºç™½å­˜å‚¨æ·»åŠ åˆ°è®¾å¤‡æ—¶ï¼Œè¿™æ ·æ“ä½œéå¸¸æœ‰ç”¨ã€‚ ä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># drbdadm -- --assume-clean resize r0</span><br></pre></td></tr></table></figure></p><p>é€‰é¡¹<code>-al-stripes</code>å’Œ<code>--al-stripe-size-kB</code>å¯ç”¨äºåœ¨çº¿æ›´æ”¹ <code>activity log</code>çš„å¸ƒå±€ã€‚ åœ¨ä½¿ç”¨å†…éƒ¨å…ƒæ•°æ®çš„æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½ä¼šåŒæ—¶ç¼©å°ç”¨æˆ·å¯è§å¤§å°ï¼ˆä½¿ç”¨<code>--size</code> ï¼‰æˆ–å¢åŠ åå¤‡è®¾å¤‡ä¸Šçš„å¯ç”¨ç©ºé—´ã€‚</p><ul><li>check-resize</li></ul><p>è°ƒç”¨<code>drbdmeta</code>è¾¾åˆ°ç§»åŠ¨å†…éƒ¨å…ƒæ•°æ®çš„ç›®çš„ã€‚ å¦‚æœåå°è®¾å¤‡çš„å¤§å°å·²è°ƒæ•´ï¼Œè€Œ<code>DRBD</code>æœªè¿è¡Œï¼Œåˆ™å¿…é¡»å°†å…ƒæ•°æ®ç§»è‡³è®¾å¤‡çš„æœ«å°¾ï¼Œä»¥ä¾¿æ¥ä¸‹æ¥çš„ <code>attach</code> å‘½ä»¤å¯ä»¥æˆåŠŸã€‚</p><ul><li>create-md</li></ul><p>åˆå§‹åŒ–å…ƒæ•°æ®å­˜å‚¨ã€‚ è¿™éœ€è¦åœ¨<code>DRBD</code>èµ„æºé¦–æ¬¡ä¸Šçº¿ä¹‹å‰å®Œæˆã€‚ å¦‚æœæœ‰å…³äºè¯¥å‘½ä»¤çš„é—®é¢˜è¯·çœ‹<a href="https://docs.linbit.com/man/v84/drbdmeta-8/" target="_blank" rel="noopener">drbdmeta</a></p><ul><li>get-gi</li></ul><p>æ˜¾ç¤ºæ•°æ®ç”Ÿæˆæ ‡è¯†ç¬¦(<code>GIå…ƒç¥–</code>)çš„ç®€çŸ­æ–‡å­—è¡¨ç¤ºã€‚</p><ul><li>show-gi</li></ul><p>æ‰“å°åŒ…å«è¯´æ˜ä¿¡æ¯çš„æ•°æ®ç”Ÿæˆæ ‡è¯†ç¬¦çš„æ–‡æœ¬è¡¨ç¤ºã€‚</p><ul><li>dump-md</li></ul><p>ä»¥æ–‡æœ¬å½¢å¼è½¬å‚¨å…ƒæ•°æ®å­˜å‚¨çš„å…¨éƒ¨å†…å®¹ï¼ŒåŒ…æ‹¬å­˜å‚¨çš„ä½å›¾å’Œæ´»åŠ¨æ—¥å¿—ã€‚</p><ul><li>outdate</li></ul><p>è®¾ç½®å…ƒæ•°æ®ä¸­çš„è¿‡æœŸæ ‡å¿—ã€‚</p><ul><li>adjust</li></ul><p>å°†è®¾å¤‡çš„é…ç½®ä¸ä½ çš„é…ç½®æ–‡ä»¶åŒæ­¥ã€‚ åœ¨å®é™…æ‰§è¡Œæ­¤å‘½ä»¤ä¹‹å‰ï¼Œåº”å§‹ç»ˆæ£€æŸ¥<code>dry-run</code>æ¨¡å¼çš„è¾“å‡ºã€‚</p><ul><li>wait-connect</li></ul><p>ç­‰å¾…è®¾å¤‡è¿æ¥åˆ°å¯¹ç­‰è®¾å¤‡ã€‚</p><ul><li>role</li></ul><p>æ˜¾ç¤ºè®¾å¤‡çš„å½“å‰è§’è‰²ï¼ˆlocal/peerï¼‰ã€‚ ä¾‹å¦‚ï¼š<code>Primary/Secondary</code></p><ul><li>state</li></ul><p>ä¸èµæˆä½¿ç”¨ï¼ˆåºŸæ­¢ï¼‰ï¼Œâ€œè§’è‰²â€çš„åˆ«åï¼Œå‚è§ä¸Šæ–‡ã€‚</p><ul><li>cstate</li></ul><p>æ˜¾ç¤ºè®¾å¤‡çš„å½“å‰è¿æ¥çŠ¶æ€ã€‚å¦‚ï¼šConnectedã€StandAlone ç­‰</p><ul><li>dump</li></ul><p>è§£æé…ç½®æ–‡ä»¶å¹¶å°†å…¶è½¬å‚¨åˆ°<code>stdout</code>ã€‚ å¯ç”¨äºæ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•æ­£ç¡®æ€§ã€‚</p><ul><li>outdate</li></ul><p>ç”¨äºå°†èŠ‚ç‚¹çš„æ•°æ®æ ‡è®°ä¸ºè¿‡æ—¶ã€‚ é€šå¸¸ç”±å¯¹ç­‰æ–¹çš„ fence-peer å¤„ç†ç¨‹åºä½¿ç”¨ã€‚</p><ul><li>verify</li></ul><p>å¼€å§‹åœ¨çº¿éªŒè¯ã€‚ åœ¨çº¿éªŒè¯æœŸé—´ï¼Œæ¯”è¾ƒä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®æ˜¯å¦ç›¸ç­‰ã€‚ è¯·å‚é˜…<code>/proc/drbd</code>è¿›è¡Œåœ¨çº¿éªŒè¯ã€‚ å¦‚æœå‘ç°ä¸åŒæ­¥å—ï¼Œåˆ™å®ƒä»¬ä¸ä¼šè‡ªåŠ¨é‡æ–°åŒæ­¥ã€‚å› æ­¤ï¼Œè¯·åœ¨éªŒè¯å®Œæˆåä½¿ç”¨<code>disconnect</code> å’Œ<code>connect</code>æ–­å¼€å¹¶è¿æ¥èµ„æºã€‚<br>å¦è¯·å‚é˜…<code>drbd.conf</code>è”æœºå¸®åŠ©é¡µä¸Šæœ‰å…³æ•°æ®å®Œæ•´æ€§çš„æ³¨æ„äº‹é¡¹ã€‚</p><ul><li>pause-sync</li></ul><p>é€šè¿‡è®¾ç½®æœ¬åœ°æš‚åœæ ‡å¿—æš‚æ—¶ä¸­æ­¢æ­£åœ¨è¿›è¡Œçš„é‡æ–°åŒæ­¥ã€‚ å¦‚æœæœ¬åœ°å’Œè¿œç¨‹æš‚åœæ ‡å¿—å‡æœªè®¾ç½®ï¼Œåˆ™åŒæ­¥è¿›è¡Œã€‚ å¯èƒ½éœ€è¦æ¨è¿Ÿ<code>DRBD</code>çš„é‡æ–°åŒæ­¥åˆ°æ”¯æŒå­˜å‚¨çš„<code>RAID</code>è®¾ç½®é‡æ–°åŒæ­¥ä¹‹åè¿›è¡Œã€‚</p><ul><li>resume-sync</li></ul><p>å–æ¶ˆè®¾ç½®æœ¬åœ°åŒæ­¥æš‚åœæ ‡å¿—ã€‚</p><ul><li>new-current-uuid</li></ul><p>ç”Ÿæˆæ–°çš„<code>å½“å‰ UUID</code>å¹¶æ—‹è½¬æ‰€æœ‰å…¶ä»– UUID å€¼ã€‚<br>è¿™å¯ä»¥ç”¨æ¥ç¼©çŸ­é›†ç¾¤çš„åˆå§‹å†åŒæ­¥ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<code>drbdsetup</code>è”æœºå¸®åŠ©é¡µã€‚</p><ul><li>dstate</li></ul><p>ä»¥<code>local/peer</code>å½¢å¼æ˜¾ç¤ºåå¤‡å­˜å‚¨è®¾å¤‡çš„å½“å‰çŠ¶æ€ã€‚ å¦‚ï¼šUpToDate/UpToDate</p><ul><li>hidden-commands</li></ul><p>æ˜¾ç¤ºæ‰€æœ‰å‘½ä»¤æ²¡æœ‰è®°å½•çš„å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[root@imoyao ~]# drbdadm hidden-commands</span><br><span class="line"></span><br><span class="line">These additional commands might be useful for writing   # å†™è„šæœ¬æˆ–è®¸æœ‰ç”¨</span><br><span class="line">nifty shell scripts around drbdadm:</span><br><span class="line"></span><br><span class="line"> sh-nop                             sh-resources                       </span><br><span class="line"> sh-resource                        sh-mod-parms                       </span><br><span class="line"> sh-dev                             sh-udev                            </span><br><span class="line"> sh-minor                           sh-ll-dev                          </span><br><span class="line"> sh-md-dev                          sh-md-idx                          </span><br><span class="line"> sh-ip                              sh-lr-of                           </span><br><span class="line"> sh-b-pri                           sh-status                          </span><br><span class="line"> proxy-up                           proxy-down                         </span><br><span class="line"> new-resource                       </span><br><span class="line"></span><br><span class="line">These commands are used by the kernel part of DRBD to   # drbdå†…æ ¸</span><br><span class="line">invoke user mode helper programs:</span><br><span class="line"></span><br><span class="line"> before-resync-target               after-resync-target                </span><br><span class="line"> before-resync-source               pri-on-incon-degr                  </span><br><span class="line"> pri-lost-after-sb                  fence-peer                         </span><br><span class="line"> local-io-error                     pri-lost                           </span><br><span class="line"> initial-split-brain                split-brain                        </span><br><span class="line"> out-of-sync                        </span><br><span class="line"></span><br><span class="line">These commands ought to be used by experts and developers:  # å¼€å‘äººå‘˜</span><br><span class="line"></span><br><span class="line"> sh-new-minor                       new-minor                          </span><br><span class="line"> suspend-io                         resume-io                          </span><br><span class="line"> set-gi                             new-current-uuid                   </span><br><span class="line"> check-resize</span><br></pre></td></tr></table></figure><h1 id="drbddisk-8"><a href="#drbddisk-8" class="headerlink" title="drbddisk.8"></a>drbddisk.8</h1><p>TODO</p><h1 id="drbdsetup-8-é…ç½®å†…æ ¸æ¨¡å—"><a href="#drbdsetup-8-é…ç½®å†…æ ¸æ¨¡å—" class="headerlink" title="drbdsetup.8-é…ç½®å†…æ ¸æ¨¡å—"></a>drbdsetup.8-é…ç½®å†…æ ¸æ¨¡å—</h1><p>TODO</p><h1 id="ç‰ˆæœ¬ä¿¡æ¯"><a href="#ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="ç‰ˆæœ¬ä¿¡æ¯"></a>ç‰ˆæœ¬ä¿¡æ¯</h1><p>æœ¬æ–‡æ¡£é’ˆå¯¹ DRBD å‘è¡Œç‰ˆæœ¬ 8.4.0 è¿›è¡Œäº†ä¿®è®¢ã€‚</p><h1 id="ä½œè€…"><a href="#ä½œè€…" class="headerlink" title="ä½œè€…"></a>ä½œè€…</h1><p>ç”± Philipp Reisner <a href="&#109;&#x61;&#105;&#108;&#116;&#x6f;&#58;&#112;&#104;&#105;&#x6c;&#105;&#112;&#112;&#46;&#114;&#x65;&#x69;&#115;&#x6e;&#101;&#114;&#x40;&#x6c;&#105;&#110;&#x62;&#105;&#116;&#46;&#x63;&#x6f;&#109;">&#112;&#104;&#105;&#x6c;&#105;&#112;&#112;&#46;&#114;&#x65;&#x69;&#115;&#x6e;&#101;&#114;&#x40;&#x6c;&#105;&#110;&#x62;&#105;&#116;&#46;&#x63;&#x6f;&#109;</a>å’Œ Lars Ellenberg æ’°å†™<a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#x6c;&#x61;&#114;&#115;&#x2e;&#x65;&#108;&#x6c;&#x65;&#110;&#98;&#101;&#x72;&#x67;&#64;&#x6c;&#x69;&#x6e;&#x62;&#105;&#x74;&#46;&#x63;&#x6f;&#x6d;">&#x6c;&#x61;&#114;&#115;&#x2e;&#x65;&#108;&#x6c;&#x65;&#110;&#98;&#101;&#x72;&#x67;&#64;&#x6c;&#x69;&#x6e;&#x62;&#105;&#x74;&#46;&#x63;&#x6f;&#x6d;</a>ã€‚ä¸­è¯‘ç‰ˆç”±<code>imoyao</code>é¦–å‘äºåˆ«é™¢ç‰§å¿—ï¼ˆ<code>idealyard</code>ï¼‰</p><h1 id="æŠ¥å‘Šé”™è¯¯"><a href="#æŠ¥å‘Šé”™è¯¯" class="headerlink" title="æŠ¥å‘Šé”™è¯¯"></a>æŠ¥å‘Šé”™è¯¯</h1><p>å°†é”™è¯¯æŠ¥å‘Šç»™<a href="&#109;&#97;&#105;&#x6c;&#x74;&#111;&#x3a;&#100;&#114;&#98;&#100;&#45;&#x75;&#x73;&#x65;&#114;&#x40;&#x6c;&#x69;&#115;&#116;&#115;&#46;&#108;&#x69;&#110;&#x62;&#105;&#x74;&#46;&#99;&#x6f;&#109;">&#100;&#114;&#98;&#100;&#45;&#x75;&#x73;&#x65;&#114;&#x40;&#x6c;&#x69;&#115;&#116;&#115;&#46;&#108;&#x69;&#110;&#x62;&#105;&#x74;&#46;&#99;&#x6f;&#109;</a>ã€‚</p><h1 id="ç‰ˆæƒ"><a href="#ç‰ˆæƒ" class="headerlink" title="ç‰ˆæƒ"></a>ç‰ˆæƒ</h1><p>ç‰ˆæƒæ‰€æœ‰ 2001-2011 LINBIT ä¿¡æ¯æŠ€æœ¯å…¬å¸ï¼ŒPhilipp Reisnerï¼ŒLars Ellenbergã€‚ è¿™æ˜¯å…è´¹è½¯ä»¶; è¯·å‚é˜…å¤åˆ¶æ¡ä»¶çš„æ¥æºã€‚ æ²¡æœ‰ä¿ä¿®; ç”šè‡³ä¸é€‚ç”¨äºé€‚é”€æ€§æˆ–é’ˆå¯¹ç‰¹å®šç”¨é€”çš„é€‚ç”¨æ€§ã€‚</p><h1 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h1><p>drbd.conf ï¼ˆ5ï¼‰ï¼Œ drbd ï¼ˆ8ï¼‰ï¼Œ drbddisk ï¼ˆ8ï¼‰ï¼Œ drbdsetup ï¼ˆ8ï¼‰ï¼Œ drbdmeta ï¼ˆ8ï¼‰å’Œ DRBD é¡¹ç›®ç½‘ç«™ [1]</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul><li><a href="https://docs.linbit.com/man/v84/" target="_blank" rel="noopener">DRBD 8.4 Manual Pages</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> DRBD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº DRBD è£‚è„‘é—®é¢˜çš„æ€»ç»“</title>
      <link href="/blog/2018-05-27/Split-Brain-Of-DRBD/"/>
      <url>/blog/2018-05-27/Split-Brain-Of-DRBD/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>è£‚è„‘ä¸€æ—¦å‘ç”Ÿï¼Œéœ€è¦åŠæ—¶æ’æŸ¥é—®é¢˜æ‰€åœ¨ï¼Œæœ€å¤§é™åº¦ä¿æŠ¤æ•°æ®å®Œæ•´æ€§ã€‚<br><a id="more"></a></p><h2 id="ä»€ä¹ˆæ˜¯DRBDè£‚è„‘"><a href="#ä»€ä¹ˆæ˜¯DRBDè£‚è„‘" class="headerlink" title="ä»€ä¹ˆæ˜¯DRBDè£‚è„‘"></a>ä»€ä¹ˆæ˜¯<code>DRBD</code>è£‚è„‘</h2><p>è£‚è„‘(<code>split brain</code>)å®é™…ä¸Šæ˜¯æŒ‡åœ¨æŸç§æƒ…å†µä¸‹ï¼Œç”±é›†ç¾¤èŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥ä¸´æ—¶æ•…éšœã€é›†ç¾¤è½¯ä»¶ç®¡ç†å¹²é¢„æˆ–è€…æ˜¯äººä¸ºé”™è¯¯ï¼Œå¯¼è‡´ä¸¤ä¸ªèŠ‚ç‚¹éƒ½åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼ˆ<code>primary</code>ï¼‰è€Œæ–­å¼€è¿æ¥ã€‚è¿™ç§çŠ¶æ€æ˜¯ä¸€ä¸ªæ½œåœ¨çš„æœ‰å®³çŠ¶æ€ï¼Œå› ä¸ºå®ƒæ„å‘³ç€ä¸èƒ½å¤åˆ¶æ•°æ®åˆ°å¯¹ç­‰èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯èƒ½å¯¼è‡´ä¸¤ä¸ªèŠ‚ç‚¹çš„æ•°æ®äº§ç”Ÿåˆ†æ­§ï¼Œäº§ç”Ÿä¸å¯åˆå¹¶çš„åˆ†è£‚ã€‚</p><h2 id="æ€ä¹ˆåˆ¤å®šè£‚è„‘"><a href="#æ€ä¹ˆåˆ¤å®šè£‚è„‘" class="headerlink" title="æ€ä¹ˆåˆ¤å®šè£‚è„‘"></a>æ€ä¹ˆåˆ¤å®šè£‚è„‘</h2><h3 id="æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯"><a href="#æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯"></a>æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯</h3><p>å¦‚æœ<code>DRBD</code>å‡ºç°è£‚è„‘ï¼Œä¼šåœ¨ <code>/var/log/message</code> å‡ºç°ä¸€æ¡æ—¥å¿—ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Split-Brain detected but unresolved, dropping connection!</span><br></pre></td></tr></table></figure><p>å½“å‘ç”Ÿ<code>split brain</code>ä¹‹åï¼Œå¦‚æœæŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼Œå…¶ä¸­è‡³å°‘ä¼šæœ‰ä¸€ä¸ªæ˜¯<code>StandAlone</code>çŠ¶æ€ï¼Œå¦å¤–ä¸€ä¸ªå¯èƒ½ä¹Ÿæ˜¯<code>StandAlone</code>ï¼ˆå¦‚æœæ˜¯åŒæ—¶å‘ç°<code>split brain</code>çŠ¶æ€ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ <code>WFConnection</code> çŠ¶æ€ã€‚</p><h3 id="è£‚è„‘è‡ªåŠ¨é€šçŸ¥"><a href="#è£‚è„‘è‡ªåŠ¨é€šçŸ¥" class="headerlink" title="è£‚è„‘è‡ªåŠ¨é€šçŸ¥"></a>è£‚è„‘è‡ªåŠ¨é€šçŸ¥</h3><p>å¦‚æœè¿›è¡Œé…ç½®ï¼ŒDRBD ä¼šè°ƒç”¨è£‚è„‘å¤„ç†ç¨‹åºï¼Œå½“è£‚è„‘å‘ç”Ÿæ—¶å°±ä¼šè¢«æ¢æµ‹åˆ°ã€‚è¦é…ç½®è¿™ä¸ªç¨‹åºï¼Œéœ€è¦å¯¹èµ„æº<code>/etc/drbd.d/global_common.conf</code>æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">resource &lt;resource&gt;</span><br><span class="line"></span><br><span class="line">  handlers &#123;</span><br><span class="line"></span><br><span class="line">    split-brain &lt;handler&gt;;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>&lt;handler&gt;</code>å¯èƒ½æ˜¯ç›®å‰ç³»ç»Ÿä¸­ä¸€ä¸ªå¯æ‰§è¡Œçš„æ–‡ä»¶ã€‚</p><p><code>Drbd</code>è‡ªå¸¦ä¸€ä¸ªè£‚è„‘å¤„ç†ç¨‹åºè„šæœ¬<code>/usr/lib/drbd/notify-split-brain.sh</code>ã€‚å®ƒå¯ä»¥é€šè¿‡ç”µå­é‚®ä»¶çš„æ–¹å¼å‘é€åˆ°æŒ‡å®šçš„åœ°å€ã€‚è¦é…åˆç¨‹åºå‘é€ä¿¡æ¯åˆ° root@localhostï¼ˆè¿™å‡è®¾æ˜¯è®¾ç½®çš„ç³»ç»Ÿç®¡ç†å‘˜çš„é‚®ä»¶åœ°å€ï¼‰ï¼Œé…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">resource &lt;resource&gt;</span><br><span class="line"></span><br><span class="line">  handlers &#123;</span><br><span class="line"></span><br><span class="line">    split-brain "/usr/lib/drbd/notify-split-brain.sh root";</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å½“é…ç½®å·²ç»åœ¨èµ„æºä¸Šè¿›è¡Œä¿®æ”¹ï¼ˆåŒæ­¥åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼‰ï¼Œå°±ä¸éœ€è¦æ·»åŠ å…¶ä»–çš„å¤„ç†å°±å¯ä»¥å¯åŠ¨å¤„ç†ç¨‹åºã€‚<code>Drbd</code>ä¼šåœ¨ä¸‹ä¸€æ¬¡æ£€æµ‹åˆ°è£‚è„‘æ—¶ç›´æ¥è°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚</p><p>å¦‚æœè¦é…ç½®çœŸå®å¯ç”¨çš„æŠ¥è­¦é‚®ç®±åœ°å€ï¼Œåˆ™é™¤äº†å°†ä¸Šé¢çš„é€šçŸ¥åœ°å€æ”¹ä¸ºçœŸå®é‚®ä»¶åœ°å€:<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">split-brain "/usr/lib/drbd/notify-split-brain.sh foo@bar.com</span><br></pre></td></tr></table></figure></p><p>è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹<code>ssmtp</code>é…ç½®æ–‡ä»¶ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/ssmtp/ssmtp.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¡«å†™çœŸå®æ”¶ä»¶æœåŠ¡å™¨ä¿¡æ¯</span></span><br><span class="line">mailhub=idealyard.imoyao.com:25</span><br></pre></td></tr></table></figure></p><p>æ›´å¤šé…ç½®å‚è§ <a href="http://iqjar.com/jar/sending-emails-from-the-raspberry-pi/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><h3 id="ä¸–ä»£æ ‡è¯†ç¬¦å…ƒç»„ï¼ˆGIï¼‰"><a href="#ä¸–ä»£æ ‡è¯†ç¬¦å…ƒç»„ï¼ˆGIï¼‰" class="headerlink" title="ä¸–ä»£æ ‡è¯†ç¬¦å…ƒç»„ï¼ˆGIï¼‰"></a>ä¸–ä»£æ ‡è¯†ç¬¦å…ƒç»„ï¼ˆGIï¼‰</h3><p>å‚è§<a href="https://docs.linbit.com/docs/users-guide-8.4/#s-gi" target="_blank" rel="noopener">16.2. Generation Identifiers</a></p><p>DRBD å°†å…¶å¤‡ä»½çš„æ•°æ®çš„æ›´æ–°å˜åŒ–è¿‡ç¨‹æ¯”æ‹Ÿæˆäººç±»ä¸–ä»£ç¹è¡çš„è¿‡ç¨‹ã€‚æ¯ä¸ªæ—¶ç‚¹åŒä¸€ä¸ªåŒæœºçš„ DRBD çš„ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®éƒ½æ¥è‡ªäºåŒä¸€ä»½åŸå§‹æ•°æ®ï¼Œæˆ‘ä»¬å¯è®¤ä¸ºè¿™ä¸ªæ—¶ç‚¹ä¸Šä¸¤åˆ†æ•°æ®æºäºåŒä¸€ç¥–å…ˆã€‚ä¸»å¤‡èŠ‚ç‚¹çš„ DRBD éƒ½ä¼šç”¨ä¸€ä¸ªå«ä½œ GI(Generation ID)çš„æ ‡è¯†ç¬¦æ¥æ ‡è¯†å½“å‰çš„æ•°æ®æ˜¯å“ªä¸ªä¸–ä»£çš„ï¼ŒåŒæ ·ä¹Ÿä¼šè®°å½•æœ€è¿‘ä¸¤ä¸ªæ•°æ®ç¥–å…ˆçš„ GI ç”¨äºè¿½æœ”å½“å‰æ•°æ®çš„å†å²æ¥æºã€‚DRBD å¯ä»¥æ®æ­¤æ¥åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯å±äºåŒä¸€ä¸ªåŒæœº,å› ä¸ºåŒä¸€ä¸ªåŒæœºçš„ä¸¤ä»½æ•°æ®åº”è¯¥æ˜¯ä»åŒä¸€ä¸ªç¥–å…ˆè€Œæ¥ã€‚<br>GI ä½œä¸º DRBD çš„å†…éƒ¨æœºåˆ¶ä¸»è¦è¢«ç”¨æ¥ï¼š</p><ol><li>ç¡®å®šè¿™ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯äº‹å®ä¸Šçš„åŒä¸€ä¸ªé›†ç¾¤çš„æˆå‘˜ï¼ˆè€Œä¸æ˜¯æ„å¤–è¿æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼‰ï¼›</li><li>ç¡®å®šè§¦å‘å…¨ç›˜åŒæ­¥ï¼ˆ<code>full re-synchronization</code>ï¼‰è¿˜æ˜¯åªè§¦å‘éƒ¨åˆ†åŒæ­¥ï¼ˆ<code>partial re-synchronization</code>ï¼‰ã€‚</li><li>ç¡®å®šåå°é‡æ–°åŒæ­¥çš„æ–¹å‘ï¼ˆå¦‚æœéœ€è¦å…¨ç›˜åŒæ­¥ï¼‰ï¼›</li><li>ç¡®å®šè£‚è„‘ã€‚</li></ol><h4 id="æ•°æ®è¿­ä»£"><a href="#æ•°æ®è¿­ä»£" class="headerlink" title="æ•°æ®è¿­ä»£"></a>æ•°æ®è¿­ä»£</h4><p>å½“å‡ºç°ä¸‹åˆ—æƒ…å½¢é‡Œ<code>DRBD</code>ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>GI</code>ï¼Œç”¨æ¥æ ‡è¯†æ–°ä¸€ä»£çš„æ•°æ®ï¼š</p><ol><li>ç¬¬ä¸€æ¬¡å…¨ç›˜åŒæ­¥æ—¶ï¼›</li><li>ä¸€ä¸ª<code>Disconnected</code>çš„èµ„æºè½¬æ¢ä¸º<code>Primary</code>æ—¶ï¼›</li><li>ä¸€ä¸ª<code>Primary</code>çš„èµ„æºè½¬æ¢ä¸º<code>Disconnected</code>æ—¶ã€‚</li></ol><p>å› æ­¤,æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼šåªè¦ä¸€ä¸ª<code>DRBD</code>èµ„æºå¤„äº<code>Connected</code>çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¸¤è¾¹ç£ç›˜çš„çŠ¶æ€ä¸º<code>UpToDate</code>ï¼Œé‚£ä¹ˆæ­¤<code>DRBD</code>èµ„æºåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„<code>GI</code>ä¸€å®šæ˜¯ä¸€æ ·çš„ã€‚æ­¤ç»“è®ºåè¿‡æ¥ä¹ŸåŒæ ·æˆç«‹ã€‚è¯·æ³¨æ„ï¼Œ<strong>å½“å‰å®ç°ä½¿ç”¨æœ€ä½ä½æ¥ç¼–ç èŠ‚ç‚¹çš„è§’è‰²(<code>Primary/Secondary</code>)ã€‚ å› æ­¤ï¼Œå³ä½¿å®ƒä»¬è¢«è®¤ä¸ºå…·æœ‰ç›¸åŒçš„æ•°æ®ç”Ÿæˆï¼Œæœ€ä½ä½åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šä¹Ÿå¯èƒ½ä¸åŒã€‚</strong></p><p>æ¯ä¸ªæ–°çš„æ•°æ®ç”Ÿæˆéƒ½ç”±ä¸€ä¸ª<code>8</code>å­—èŠ‚çš„é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆ<code>UUID</code>ï¼‰æ¥æ ‡è¯†ã€‚</p><h4 id="GIå…ƒç¥–"><a href="#GIå…ƒç¥–" class="headerlink" title="GIå…ƒç¥–"></a><code>GI</code>å…ƒç¥–</h4><p><code>DRBD</code>åœ¨æœ¬åœ°èµ„æºå…ƒæ•°æ®ä¸­ä¿å­˜æœ‰å…³å½“å‰å’Œå†å²æ•°æ®ç”Ÿæˆçš„å››æ¡ä¿¡æ¯ï¼š</p><ul><li><p>å½“å‰<code>UUID(C-UUID)</code><br>ä»æœ¬åœ°èŠ‚ç‚¹çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯å½“å‰æ•°æ®ç”Ÿæˆçš„ç”Ÿæˆæ ‡è¯†ç¬¦ã€‚ å½“èµ„æºè¢«è¿æ¥å¹¶å®Œå…¨åŒæ­¥æ—¶ï¼Œå½“å‰<code>UUID</code>åœ¨èŠ‚ç‚¹ä¹‹é—´æ˜¯ç›¸åŒçš„ã€‚</p></li><li><p>ä½å›¾<code>UUID(B-UUID)</code><br>è¿™æ˜¯ç£ç›˜ä¸ŠåŒæ­¥ä½å›¾è·Ÿè¸ªçš„ç”Ÿæˆçš„<code>UUID</code>æ›´æ”¹ã€‚ ä½œä¸ºç£ç›˜ä¸Šçš„åŒæ­¥ä½å›¾æœ¬èº«ï¼Œæ­¤æ ‡è¯†ç¬¦ä»…åœ¨æ–­å¼€æ¨¡å¼ä¸‹æ‰æœ‰ç”¨ã€‚ å¦‚æœèµ„æºå·²è¿æ¥ï¼Œåˆ™æ­¤<code>UUID</code>å§‹ç»ˆä¸ºç©ºï¼ˆé›¶ï¼‰ã€‚</p></li><li><p>ä¸¤ä¸ª<code>å†å²UUID</code></p></li></ul><p>è¿™äº›æ˜¯å½“å‰ä¹‹å‰ä¸¤ä¸ªæ•°æ®ä¸–ä»£çš„æ ‡è¯†ç¬¦ã€‚</p><ol><li>ä¸Šä¸€ä»£æ•°æ®çš„<code>UUID(H1-UUID)</code>ï¼›</li><li>æœ€è¿‘ç¬¬äºŒä»£æ•°æ®çš„<code>UUID(H2-UUID)</code>ï¼Œå³ä¸Šä¸€ä»£æ•°æ®çš„ä¸Šä¸€ä»£æ•°æ®çš„<code>UUID</code>ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼Œè¿™å››ä¸ªé¡¹ç›®è¢«ç§°ä¸ºä»£ç æ ‡è¯†ç¬¦å…ƒç»„ï¼Œæˆ–ç®€ç§°ä¸º<code>GIå…ƒç»„</code>ã€‚</p><h4 id="GIå¦‚ä½•å˜åŒ–"><a href="#GIå¦‚ä½•å˜åŒ–" class="headerlink" title="GIå¦‚ä½•å˜åŒ–"></a><code>GI</code>å¦‚ä½•å˜åŒ–</h4><ul><li>å¼€å§‹æ–°çš„æ•°æ®ç”Ÿæˆä»£</li></ul><p>å½“èŠ‚ç‚¹ä¸å…¶å¯¹ç­‰æ–¹å¤±å»è¿æ¥æ—¶ï¼ˆç½‘ç»œæ•…éšœæˆ–äººå·¥å¹²é¢„éƒ½æœ‰å¯èƒ½ï¼‰ï¼ŒDRBD å°†æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ä¿®æ”¹å…¶æœ¬åœ°ç”Ÿæˆæ ‡è¯†ç¬¦ï¼š</p><p><img src="https://docs.linbit.com/ug-src/users-guide-8.4/images/gi-changes-newgen.png" alt="å›¾1 GIå…ƒç¥–åœ¨ç”Ÿæˆæ–°çš„æ•°æ®ä»£æ—¶æ”¹å˜"></p><ol><li>ä¸ºæ–°çš„æ•°æ®ä»£ç”Ÿæˆæ–°çš„<code>UUID</code>ï¼Œå˜ä¸ºä¸»èŠ‚ç‚¹çš„<code>C-UUID</code>ï¼›</li><li>ä¹‹å‰çš„ UUID ç°åœ¨æŒ‡å‘ä½å›¾ï¼ˆ<code>B-UUID</code>ï¼‰ä»¥è·Ÿè¸ªæ•°æ®å˜åŒ–ï¼Œå› æ­¤å®ƒæˆä¸ºä¸»èŠ‚ç‚¹çš„æ–°ä½å›¾<code>UUID</code>ï¼›</li><li>å¤‡èŠ‚ç‚¹ GI å…ƒç¥–ä¿æŒä¸å˜ã€‚</li></ol><ul><li>å¼€å§‹é‡æ–°åŒæ­¥</li></ul><p>åœ¨å¼€å§‹é‡æ–°åŒæ­¥æ—¶ï¼Œ<code>DRBD</code>åœ¨æœ¬åœ°ä»£æ ‡è¯†ç¬¦ä¸Šæ‰§è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p><p><img src="https://docs.linbit.com/ug-src/users-guide-8.4/images/gi-changes-syncstart.png" alt="å›¾2 GIå…ƒç¥–åœ¨é‡æ–°å¼€å§‹åŒæ­¥æ˜¯æ”¹å˜"></p><ol><li>åœ¨åŒæ­¥æºç«¯çš„<code>å½“å‰UUID</code>ï¼ˆC-UUIDï¼‰ä¿æŒä¸å˜ï¼›</li><li>åŒæ­¥æºç«¯çš„<code>ä½å›¾UUID</code>è½®è½¬ä¸º<code>ç¬¬ä¸€å†å²UUID</code>ï¼ˆH1-UUIDï¼‰ï¼›</li><li>åŒæ­¥æºç«¯ç”Ÿæˆæ–°çš„<code>ä½å›¾UUID</code>ï¼ˆB-UUIDï¼‰;</li><li>è¯¥ UUIDï¼ˆ<em>åº”æŒ‡åŒæ­¥æºç«¯ç”Ÿæˆçš„<code>B-UUID</code></em>ï¼‰å˜ä¸ºåŒæ­¥ç›®æ ‡ç«¯çš„æ–°çš„<code>å½“å‰UUID</code>ï¼ˆC-UUIDï¼‰ï¼›</li><li>åŒæ­¥ç›®æ ‡ç«¯çš„<code>ä½å›¾UUID</code>ï¼ˆB-UUIDï¼‰å’Œ<code>å†å²UUID</code>ï¼ˆH1-UUID,H2-UUIDï¼‰ä¿æŒä¸å˜ã€‚</li></ol><ul><li>é‡æ–°åŒæ­¥ç»“æŸ</li></ul><p>å½“é‡æ–°åŒæ­¥ç»“æŸåï¼Œå°†æ‰§è¡Œä»¥ä¸‹æ›´æ”¹ï¼š</p><p><img src="https://docs.linbit.com/ug-src/users-guide-8.4/images/gi-changes-synccomplete.png" alt="å›¾3 å½“é‡æ–°åŒæ­¥ç»“æŸåï¼ŒGIå…ƒç¥–å‘ç”Ÿæ”¹å˜"></p><ol><li>åŒæ­¥æºç«¯<code>å½“å‰UUID</code>(C-UUID)ä¿æŒä¸å˜ï¼›</li><li>åŒæ­¥æºç«¯çš„<code>ä½å›¾UUID</code>(B-UUID)è½®è½¬ä¸º<code>ç¬¬ä¸€å†å²UUID</code>ï¼ˆH1-UUIDï¼‰ï¼ŒåŒæ—¶è¯¥ UUID(æŒ‡<code>H1-UUID</code>)è½®è½¬ä¸º<code>ç¬¬äºŒå†å²UUID</code>(ç°æœ‰çš„ç¬¬äºŒå†å² uuid è¢«ä¸¢å¼ƒ)ï¼›</li><li>åŒæ­¥æºç«¯çš„<code>ä½å›¾UUID</code>(B-UUID)æ¸…ç©ºï¼ˆç½®é›¶ï¼‰ï¼›</li><li>åŒæ­¥ç›®æ ‡ç«¯é‡‡ç”¨åŒæ­¥æºç«¯æ•´ä¸ª<code>GIå…ƒç¥–</code>ã€‚</li></ol><p>å½“èŠ‚ç‚¹ä¹‹é—´å»ºç«‹è¿æ¥ä¹‹åï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼šäº¤æ¢å½“å‰å¯ç”¨çš„ä»£æ ‡è¯†ç¬¦,ç„¶åæ ¹æ®æ¯”å¯¹çš„ç»“æœé‡‡å–ç›¸åº”çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯å¯èƒ½çš„å‡ ç§ç»“æœï¼š</p><ul><li>ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„å½“å‰<code>UUID(C-UUID)</code>éƒ½ä¸ºç©º</li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å®ƒçš„å½“å‰<code>UUID</code>å’Œå¯¹æ–¹çš„å½“å‰<code>UUID</code>éƒ½æ˜¯ç©ºçš„ã€‚è¿™é€šå¸¸æ˜¯å‘ç”Ÿäºå°šæœªå¯åŠ¨åˆå§‹å®Œå…¨åŒæ­¥çš„æ–°é…ç½®èµ„æºçš„æ­£å¸¸æƒ…å†µã€‚æ­¤æ—¶æ²¡æœ‰åŒæ­¥å‘ç”Ÿ;é¡»æ‰‹åŠ¨äººä¸ºè§¦å‘å¯åŠ¨ã€‚</p><ul><li>å•ä¸€èŠ‚ç‚¹ä¸Šçš„å½“å‰<code>UUID(C-UUID)</code>ä¸ºç©º</li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å¯¹æ–¹çš„å½“å‰<code>UUID</code>ä¸ºç©ºï¼Œè€Œå…¶æœ¬èº«éç©ºã€‚è¿™æ˜¯æ–°é…ç½®èµ„æºçš„æ­£å¸¸æƒ…å†µï¼Œæ­¤æ—¶åˆå§‹å…¨ç›˜åŒæ­¥åˆšåˆšè§¦å‘ï¼Œæœ¬åœ°èŠ‚ç‚¹è¢«é€‰ä¸ºåˆå§‹åŒæ­¥æºï¼ˆ<code>sync source</code>ï¼‰ã€‚ <code>DRBD</code>å°†ç£ç›˜ä¸Šçš„åŒæ­¥ä½å›¾(<code>sync bitmap</code>)ä¸­çš„æ‰€æœ‰ä½å…¨éƒ¨ç½®ä½ï¼ˆæ„å‘³ç€å®ƒè®¤ä¸ºæ•´ä¸ªè®¾å¤‡ä¸åŒæ­¥ï¼‰ï¼Œå¹¶å¼€å§‹å°†å…¶ä½œä¸ºåŒæ­¥æºåŒæ­¥ã€‚ç›¸åï¼Œï¼ˆå³æœ¬åœ°å½“å‰<code>UUID</code>ä¸ºç©ºï¼Œå¯¹ç­‰èŠ‚ç‚¹éç©ºï¼‰ï¼Œé™¤äº†æœ¬åœ°èŠ‚ç‚¹æˆä¸ºåŒæ­¥ç›®æ ‡ï¼ˆ<code>sync target</code>ï¼‰ä¹‹å¤–ï¼Œ<code>DRBD</code>æ‰§è¡Œç›¸åŒçš„æ­¥éª¤ã€‚</p><ul><li>å½“å‰<code>UUID(C-UUID)</code>ç›¸ç­‰</li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å®ƒçš„å½“å‰<code>UUID</code>å’Œå¯¹ç­‰èŠ‚ç‚¹çš„å½“å‰<code>UUID</code>éç©ºä¸”ç›¸ç­‰æ—¶ã€‚è¿™æ˜¯èµ„æºåœ¨<code>secondary</code>çŠ¶æ€è¿›å…¥æ–­å¼€è¿æ¥ï¼ˆ<code>disconnected</code>ï¼‰æ¨¡å¼æ—¶çš„æ­£å¸¸æƒ…å†µï¼Œå¹¶ä¸”åœ¨æ–­å¼€è¿æ¥æ—¶å¹¶æœªåœ¨ä»»ä¸€èŠ‚ç‚¹ä¸Šå‡ä¸º <code>primary</code> çŠ¶æ€ã€‚æ­¤æ—¶ä¸ä¼šè§¦å‘åŒæ­¥ï¼Œå› ä¸ºä¸¤è¾¹çš„æ•°æ®ä¸€è‡´ï¼Œæ²¡æœ‰å¿…è¦ã€‚</p><ul><li>ä½å›¾<code>UUIDï¼ˆB-UUIDï¼‰</code>åŒ¹é…å¯¹ç­‰èŠ‚ç‚¹çš„å½“å‰<code>UUIDï¼ˆ`C-UUID`ï¼‰</code></li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å…¶ä½å›¾<code>UUID</code>åŒ¹é…å¯¹ç­‰èŠ‚ç‚¹çš„å½“å‰<code>UUID</code>ï¼Œä¸”å¯¹ç­‰èŠ‚ç‚¹çš„ä½å›¾<code>UUID</code>ä¸ºç©ºã€‚è¿™æ˜¯æœ¬åœ°èŠ‚ç‚¹å¤„äº <code>primary</code> çŠ¶æ€ï¼Œæ¬¡è¦èŠ‚ç‚¹æ•…éšœåæ­£å¸¸ä¸”é¢„æœŸçš„æƒ…å†µã€‚è¿™æ„å‘³ç€å¯¹ç«¯åœ¨æ­¤æœŸé—´æ°¸è¿œä¸ä¼šå˜ä¸º<code>primary</code>çŠ¶æ€ï¼Œå¹¶å§‹ç»ˆä»¥ç›¸åŒçš„æ•°æ®ç”Ÿæˆä¸ºå‰æè¿è¡Œã€‚ <code>DRBD</code>æ­¤æ—¶ä»¥æœ¬åœ°èŠ‚ç‚¹ä½œä¸ºåŒæ­¥æºï¼ˆ<code>sync source</code>ï¼‰å¯åŠ¨æ­£å¸¸çš„åå°é‡æ–°åŒæ­¥ï¼ˆ<code>re-sync</code>ï¼‰ã€‚ç›¸åï¼Œå¦‚æœæœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å…¶ä½å›¾<code>UUID</code>ä¸ºç©ºï¼Œä¸”å¯¹ç­‰èŠ‚ç‚¹çš„ä½å›¾ä¸æœ¬åœ°èŠ‚ç‚¹çš„å½“å‰<code>UUID</code>åŒ¹é…ï¼Œé‚£ä¹ˆè¿™æ˜¯æœ¬åœ°èŠ‚ç‚¹å¤±è´¥åçš„æ­£å¸¸å’Œé¢„æœŸæƒ…å†µã€‚åŒæ ·åœ°ï¼Œ<code>DRBD</code>æ­¤æ—¶å¯åŠ¨æ­£å¸¸çš„åå°é‡æ–°åŒæ­¥ï¼Œåªä¸è¿‡æœ¬åœ°èŠ‚ç‚¹æˆä¸ºåŒæ­¥ç›®æ ‡ï¼ˆ<code>sync target</code>ï¼‰ã€‚</p><ul><li>å½“å‰<code>UUID(C-UUID)</code>åŒ¹é…å¯¹ç­‰èŠ‚ç‚¹çš„å†å²<code>UUIDï¼ˆh-UUIDï¼‰</code></li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å…¶å½“å‰<code>UUID</code>ä¸å¯¹ç­‰èŠ‚ç‚¹çš„å†å²<code>UUID</code>ä¹‹ä¸€(<code>h1/h2</code>)åŒ¹é…ã€‚è¿™æ„å‘³ç€å°½ç®¡ä¸¤ä¸ªæ•°æ®é›†å…±äº«ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆä¸”å¯¹ç­‰èŠ‚ç‚¹å…·æœ‰æœ€æ–°çš„æ•°æ®ï¼Œä½†ä¿å­˜åœ¨å¯¹ç­‰èŠ‚ç‚¹çš„ä½å›¾ä¸­çš„ä¿¡æ¯å·²è¿‡æ—¶å¹¶ä¸”ä¸å¯ç”¨ã€‚å› æ­¤ï¼Œç®€å•çš„æ­£å¸¸åŒæ­¥ä¸å¤Ÿçš„ã€‚ <code>DRBD</code>æ­¤æ—¶å°†æ•´ä¸ªè®¾å¤‡æ ‡è®°ä¸ºæœªåŒæ­¥ï¼ˆ<code>out-of-sync</code>ï¼‰å¹¶å¯åŠ¨ä»¥æœ¬åœ°èŠ‚ç‚¹ä½œä¸ºåŒæ­¥ç›®æ ‡ï¼ˆ<code>sync target</code>ï¼‰çš„å…¨ç›˜åå°é‡æ–°åŒæ­¥ã€‚åœ¨ç›¸åçš„æƒ…å†µä¸‹ï¼ˆæœ¬åœ°èŠ‚ç‚¹çš„æŸä¸ªå†å²<code>UUID</code>ä¸å¯¹ç­‰èŠ‚ç‚¹çš„å½“å‰<code>UUID</code>ç›¸åŒ¹é…ï¼‰ï¼Œé™¤äº†æœ¬åœ°èŠ‚ç‚¹æˆä¸ºåŒæ­¥æºï¼ˆ<code>sync source</code>ï¼‰ä¹‹å¤–ï¼Œ<code>DRBD</code>æ‰§è¡Œç›¸åŒçš„æ­¥éª¤ã€‚</p><ul><li>ä½å›¾<code>UUIDï¼ˆB-UUIDï¼‰</code>åŒ¹é…ï¼Œå½“å‰ <code>UUID(C-UUID)</code>ä¸åŒ¹é…</li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å…¶å½“å‰<code>UUID</code>ä¸å¯¹ç­‰èŠ‚ç‚¹çš„å½“å‰<code>UUID</code>ä¸åŒä¸”ä½å›¾<code>UUID</code>åŒ¹é…ã€‚è¿™æ˜¯è£‚è„‘ï¼ˆ<code>split brain</code>ï¼‰çš„ä¸€ç§æƒ…å†µï¼Œä¸¤ä»½æ•°æ®æœ‰ç›¸åŒçš„çˆ¶ä»£ã€‚è¿™æ„å‘³ç€<code>DRBD</code>å¯ä»¥è°ƒç”¨è£‚è„‘è‡ªåŠ¨æ¢å¤ç­–ç•¥è¿›è¡Œæ•°æ®æ¢å¤ï¼ˆå¦‚æœå·²é…ç½®ï¼‰ã€‚å¦åˆ™ï¼Œ<code>DRBD</code>æ–­å¼€è¿æ¥å¹¶ç­‰å¾…æ‰‹åŠ¨æ¢å¤ã€‚</p><ul><li>å½“å‰<code>UUIDï¼ˆC-UUIDï¼‰</code>å’Œä½å›¾<code>UUID(B-UUID)</code>éƒ½ä¸åŒ¹é…</li></ul><p>æœ¬åœ°èŠ‚ç‚¹æ£€æµ‹åˆ°å®ƒçš„å½“å‰<code>UUID</code>ä¸å¯¹ç­‰èŠ‚ç‚¹çš„å½“å‰<code>UUID</code>ä¸åŒï¼Œå¹¶ä¸”ä½å›¾<code>UUID</code>ä¸åŒ¹é…ã€‚è¿™æ˜¯ä¸¤ä»½æ•°æ®ä¸æ— å…³çˆ¶ä»£äº§ç”Ÿçš„ä¸€ç§è£‚è„‘ï¼Œå› æ­¤å³ä½¿é…ç½®äº†è‡ªåŠ¨æ¢å¤ç­–ç•¥ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚ <code>DRBD</code>å¤„äºæ–­å¼€è¿æ¥å¹¶ç­‰å¾…æ‰‹åŠ¨æ¢å¤çŠ¶æ€ã€‚</p><ul><li>æ²¡æœ‰<code>UUID</code>åŒ¹é…</li></ul><p>æœ€åï¼Œå¦‚æœ<code>DRBD</code>æœªèƒ½æ£€æµ‹åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„<code>GI</code>å…ƒç»„ä¸­çš„å•ä¸ªå…ƒç´ åŒ¹é…ï¼Œåˆ™ä¼šè®°å½•å…³äºæ— å…³æ•°æ®ï¼ˆ<code>unrelated data</code>ï¼‰çš„è­¦å‘Šå¹¶æ–­å¼€è¿æ¥ã€‚è¿™æ˜¯<code>DRBD</code>çš„é˜²èŒƒæªæ–½ï¼Œå¯é˜²æ­¢ä¹‹å‰æ— å…³è”çš„ä¸¤ä¸ªé›†ç¾¤èŠ‚ç‚¹çš„æ„å¤–è¿æ¥å¯¼è‡´æ•°æ®ç ´åã€‚</p><p>ä»¥ä¸Šé€»è¾‘ä½¿ç”¨ä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">empty_uuid = <span class="string">'0000000000000000'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">slice_seq</span><span class="params">(seq)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å¯¹GIå…ƒç¥–å†…å…ƒç´ è¿›è¡Œåˆ‡ç‰‡æ“ä½œ</span></span><br><span class="line"><span class="string">    :param seq: GIå…ƒç¥–</span></span><br><span class="line"><span class="string">    :return:type:list</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">global</span> empty_uuid</span><br><span class="line">    sliced_seq = [item[:<span class="number">-1</span>] <span class="keyword">if</span> item != empty_uuid <span class="keyword">else</span> item <span class="keyword">for</span> item <span class="keyword">in</span> seq]</span><br><span class="line">    <span class="keyword">return</span> sliced_seq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmp_both</span><span class="params">(seqa,seqb)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> seqa:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> seqb:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_gi_action</span><span class="params">(drbdname)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è°ƒç”¨'drbdadm get-gi DRBDNAME'å‘½ä»¤è·å–drbdçš„ GI(Generation ID) ä¿¡æ¯</span></span><br><span class="line"><span class="string">    :param drbdname:type:str,drbdåç§° like:'drbds1/drbdn301'</span></span><br><span class="line"><span class="string">    :return:è·å–æ­£å¸¸è¿”å›å…ƒç¥–(c_uuid, b_uuid, h1_uuid, h2_uuid)ï¼Œè·å–å¤±è´¥è¿”å›None</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    get_gi_cmd = <span class="string">"drbdadm get-gi %s |awk -F: '&#123;print $1,$2,$3,$4&#125;'"</span>%(drbdname)</span><br><span class="line">    retcode,proc = utils.cust_popen(get_gi_cmd)</span><br><span class="line">    message = proc.stderr.read(), proc.stdout.read()</span><br><span class="line">    retstr = message[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> retstr:</span><br><span class="line">        c_uuid,b_uuid,h1_uuid,h2_uuid = tuple(retstr.split())</span><br><span class="line">        <span class="keyword">return</span> c_uuid,b_uuid,h1_uuid,h2_uuid</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        debug.write_debug(debug.LINE(), <span class="string">"peradrbd"</span>, message)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">  </span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_remote_gi</span><span class="params">(params)</span>:</span></span><br><span class="line">    rtndata = &#123;&#125;</span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    drbdname = <span class="string">'drbdname'</span> <span class="keyword">in</span> params <span class="keyword">and</span> params[<span class="string">'drbdname'</span>] <span class="keyword">or</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> drbdname:</span><br><span class="line">        <span class="keyword">if</span> hasthedrbd(drbdname):</span><br><span class="line">            gi_uuids = get_gi_action(drbdname)</span><br><span class="line">            <span class="keyword">if</span> gi_uuids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                rtndata[<span class="string">'state'</span>] = <span class="string">'0'</span></span><br><span class="line">                result[<span class="string">'message'</span>] = <span class="string">''</span></span><br><span class="line">                result[<span class="string">'gi_id'</span>] = gi_uuids</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rtndata[<span class="string">'state'</span>] = <span class="string">'1'</span></span><br><span class="line">                result[<span class="string">'message'</span>] = <span class="string">'11069'</span>     <span class="comment"># è·å– gi_id å‡ºé”™</span></span><br><span class="line">                result[<span class="string">'gi_id'</span>] = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rtndata[<span class="string">'state'</span>] = <span class="string">'1'</span></span><br><span class="line">            result[<span class="string">'message'</span>] = <span class="string">'11060'</span>  <span class="comment"># the drbd not found</span></span><br><span class="line"></span><br><span class="line">        rtndata[<span class="string">'result'</span>] = result</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rtndata = &#123;<span class="string">'state'</span>: <span class="string">'1'</span>, <span class="string">'result'</span>: &#123;<span class="string">'message'</span>: <span class="string">'11059'</span>&#125;&#125;  <span class="comment"># drbdname error</span></span><br><span class="line">    <span class="keyword">return</span> rtndata</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exchange_gi_process</span><span class="params">(drbdname)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    see:https://docs.linbit.com/docs/users-guide-8.4/#s-gi (16.2.4. How DRBD uses generation identifiers)</span></span><br><span class="line"><span class="string">    :param drbdname:</span></span><br><span class="line"><span class="string">    :return:type:str</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    local_gis = get_gi_action(drbdname)</span><br><span class="line">    remote_gis = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">global</span> remoteip</span><br><span class="line">    retresult = hautils.socketclient(ip=remoteip,</span><br><span class="line">                                     **&#123;<span class="string">'target'</span>: <span class="string">'drbd'</span>, <span class="string">'op'</span>: <span class="string">'getremotegi'</span>, <span class="string">'params'</span>: &#123;<span class="string">'drbdname'</span>:drbdname&#125;&#125;)</span><br><span class="line">    <span class="keyword">if</span> retresult:</span><br><span class="line">        <span class="keyword">if</span> retresult[<span class="string">'state'</span>] == <span class="string">'0'</span>:</span><br><span class="line">            remote_gis = retresult[<span class="string">'result'</span>][<span class="string">'gi_id'</span>]</span><br><span class="line">        drbd_next = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> local_gis <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> remote_gis <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            local_gis_sliced = slice_seq(local_gis)</span><br><span class="line">            remote_gis_sliced = slice_seq(remote_gis)</span><br><span class="line">            <span class="keyword">global</span> empty_uuid</span><br><span class="line">            print(<span class="string">'sliced'</span>, local_gis_sliced, remote_gis_sliced)</span><br><span class="line">            <span class="keyword">if</span> local_gis_sliced[<span class="number">0</span>] == empty_uuid <span class="keyword">and</span> remote_gis_sliced[<span class="number">0</span>] == empty_uuid:</span><br><span class="line">                drbd_next = <span class="string">'no_sync:(manual_sync)'</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> local_gis_sliced[<span class="number">0</span>] == empty_uuid <span class="keyword">or</span> remote_gis_sliced[<span class="number">0</span>] == empty_uuid:</span><br><span class="line">                <span class="keyword">if</span> remote_gis_sliced[<span class="number">0</span>] == empty_uuid <span class="keyword">and</span> local_gis_sliced[<span class="number">0</span>] != empty_uuid:</span><br><span class="line">                    drbd_next = <span class="string">'full_re_sync:(local_source)'</span></span><br><span class="line">                <span class="keyword">elif</span> local_gis_sliced[<span class="number">0</span>] == empty_uuid <span class="keyword">and</span> remote_gis_sliced[<span class="number">0</span>] != empty_uuid:</span><br><span class="line">                    drbd_next = <span class="string">'full_re_sync:(local_target)'</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> local_gis_sliced[<span class="number">0</span>] != empty_uuid <span class="keyword">and</span> remote_gis_sliced[<span class="number">0</span>] != empty_uuid <span class="keyword">and</span> local_gis_sliced[<span class="number">0</span>] == remote_gis_sliced[<span class="number">0</span>]:</span><br><span class="line">                drbd_next = <span class="string">'consistent:(both_secondary)'</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> local_gis_sliced[<span class="number">1</span>] == remote_gis_sliced[<span class="number">0</span>] <span class="keyword">and</span> remote_gis_sliced[<span class="number">1</span>] == empty_uuid:</span><br><span class="line">                drbd_next = <span class="string">'partial_re_sync:(local_source)'</span></span><br><span class="line">            <span class="keyword">elif</span> local_gis_sliced[<span class="number">1</span>] == empty_uuid <span class="keyword">and</span> remote_gis_sliced[<span class="number">1</span>] == local_gis_sliced[<span class="number">0</span>]:</span><br><span class="line">                drbd_next = <span class="string">'partial_re_sync:(local_target)'</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> local_gis_sliced[<span class="number">0</span>] <span class="keyword">in</span> [remote_gis_sliced[<span class="number">2</span>], remote_gis_sliced[<span class="number">3</span>]]:</span><br><span class="line">                drbd_next = <span class="string">'full_re_sync:(local_target)'</span></span><br><span class="line">            <span class="keyword">elif</span> remote_gis_sliced[<span class="number">0</span>] <span class="keyword">in</span> [local_gis_sliced[<span class="number">2</span>], local_gis_sliced[<span class="number">3</span>]]:</span><br><span class="line">                drbd_next = <span class="string">'full_re_sync:(local_source)'</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> local_gis_sliced[<span class="number">0</span>] != remote_gis_sliced[<span class="number">0</span>]:</span><br><span class="line">                <span class="keyword">if</span> local_gis_sliced[<span class="number">1</span>] == remote_gis_sliced[<span class="number">1</span>]:</span><br><span class="line">                    drbd_next = <span class="string">'split_brain:(auto_recover_able)'</span></span><br><span class="line">                <span class="keyword">elif</span> local_gis_sliced[<span class="number">1</span>] != remote_gis_sliced[<span class="number">1</span>]:</span><br><span class="line">                    drbd_next = <span class="string">'split_brain:(wait_for_manual_recover)'</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> cmp_both(local_gis_sliced,remote_gis_sliced):</span><br><span class="line">                drbd_next = <span class="string">'unrelated_data:(wait_for_manual_recover)'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                debug.write_debug(debug.LINE(), <span class="string">"peradrbd"</span>, (local_gis_sliced, remote_gis_sliced))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            debug.write_debug(debug.LINE(), <span class="string">"peradrbd"</span>, (local_gis,remote_gis))</span><br><span class="line">        <span class="keyword">return</span> drbd_next</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">**æ³¨æ„**ï¼š</span><br><span class="line"></span><br><span class="line">ç»åˆ†æå®˜æ–¹æ–‡æ¡£ä¸­çš„<span class="string">'matches'</span>å¹¶ä¸æ˜¯å®Œå…¨ç›¸ç­‰ï¼Œè€Œ <span class="string">'UUID is always empty (zero)'</span> æ˜¯æŒ‡ <span class="string">"'0'*16"</span> çš„å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ª `Split-Brain`çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> å¾€ä¸»èŠ‚ç‚¹å†™å…¥å¤§æ–‡ä»¶ï¼Œåœ¨æœªå†™å…¥å®Œå‰åœæ­¢å¤‡èŠ‚ç‚¹çš„`DRBD`ï¼›</span><br><span class="line">```plain</span><br><span class="line"><span class="comment"># on secondary</span></span><br><span class="line">drbdadm down drbdxx</span><br></pre></td></tr></table></figure><ol><li><p>åœæ­¢ä¸»èŠ‚ç‚¹çš„<code>DRBD</code>ï¼›</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># on primary</span><br><span class="line">drbdadm down drbdxx</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å¤‡èŠ‚ç‚¹çš„<code>DRBD</code>ï¼Œè®¾ç½®ä¸ºä¸»èŠ‚ç‚¹ï¼›</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># on secondary</span><br><span class="line">drbdadm up drbdxx</span><br><span class="line">drbdadm primary drbdxx</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨åŸä¸»èŠ‚ç‚¹çš„<code>DRBD</code>ï¼Œè¿™æ—¶å‘ç°å®ƒçš„çŠ¶æ€å°±æ˜¯<code>StandAlone Secondary/Unknown UpToDate/DUnknown</code>ï¼Œ<code>Split-Brain</code> æƒ…å†µå‡ºç°ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># on primary</span><br><span class="line">drbdadm up drbdxx</span><br></pre></td></tr></table></figure></li></ol><h2 id="è§£å†³-DRBD-è£‚è„‘çŠ¶æ€"><a href="#è§£å†³-DRBD-è£‚è„‘çŠ¶æ€" class="headerlink" title="è§£å†³ DRBD è£‚è„‘çŠ¶æ€"></a>è§£å†³ DRBD è£‚è„‘çŠ¶æ€</h2><h3 id="è®¾ç½®è‡ªåŠ¨ä¿®å¤"><a href="#è®¾ç½®è‡ªåŠ¨ä¿®å¤" class="headerlink" title="è®¾ç½®è‡ªåŠ¨ä¿®å¤"></a>è®¾ç½®è‡ªåŠ¨ä¿®å¤</h3><p><a href="https://docs.linbit.com/docs/users-guide-8.4/#s-configure-split-brain-behavior" target="_blank" rel="noopener">5.17.2. Automatic split brain recovery policies</a></p><p><strong>è­¦å‘Š</strong>ï¼šé…ç½®<code>DRBD</code>è‡ªåŠ¨ä¿®å¤è£‚è„‘ï¼ˆæˆ–å…¶ä»–çŠ¶å†µï¼‰å¯¼è‡´çš„æ•°æ®åˆ†æ­§æƒ…å†µå¯èƒ½æ˜¯æ­£åœ¨é…ç½®çš„æ•°æ®ä¸¢å¤±ï¼Œå¦‚æœä½ ä¸çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆï¼Œé‚£æœ€å¥½åˆ«å¹²ã€‚ï¼ˆNO ZUO NO DIEï¼‰</p><p><em>æç¤º</em> ï¼šæ‚¨æ›´åº”è¯¥æŸ¥çœ‹ç³»ç»Ÿé˜²æŠ¤ç­–ç•¥ï¼Œé›†ç¾¤ç®¡ç†é›†æˆå’Œå†—ä½™é›†ç¾¤ç®¡ç†å™¨é€šä¿¡è¿æ¥çŠ¶æ€ï¼Œä»¥é¿å…å‡ºç°æ•°æ®åˆ†æ­§ã€‚ï¼ˆé˜²æ‚£äºæœªç„¶è€Œä¸æ˜¯äº¡ç¾Šè¡¥ç‰¢ï¼‰<br>åœ¨å¯ç”¨å’Œé…ç½®<code>DRBD</code>çš„è‡ªåŠ¨è£‚è„‘æ¢å¤ç­–ç•¥ä¹‹å‰ï¼Œæ‚¨å¿…é¡»äº†è§£<code>DRBD</code>ä¸ºæ­¤æä¾›äº†å¤šç§é…ç½®é€‰é¡¹ã€‚ DRBD æ ¹æ®æ£€æµ‹åˆ°è£‚è„‘æ—¶ä¸»èŠ‚ç‚¹ï¼ˆ<code>Primary role</code>ï¼‰çš„æ•°é‡åº”ç”¨å…¶è£‚è„‘æ¢å¤ç¨‹åºã€‚ä¸ºæ­¤ï¼ŒDRBD æ£€æŸ¥ä»¥ä¸‹å…³é”®å­—ï¼Œè¿™äº›å…³é”®å­—å‡å¯åœ¨èµ„æºçš„ç½‘ç»œé…ç½®éƒ¨åˆ†ä¸­æ‰¾åˆ°ï¼š</p><h4 id="after-sb-0pri"><a href="#after-sb-0pri" class="headerlink" title="after-sb-0pri"></a>after-sb-0pri</h4><p>è£‚è„‘è¢«æ£€æµ‹åˆ°çš„åŒæ—¶è¯¥èµ„æºåœ¨ä»»ä¸€èŠ‚ç‚¹ä¸æ˜¯ä¸»èŠ‚ç‚¹ã€‚å¯¹äºè¿™ç§çŠ¶å†µï¼Œ<code>DRBD</code>å¯ä»¥ç†è§£ä»¥ä¸‹å…³é”®å­—ï¼š</p><ul><li>disconnect: ä¸è‡ªåŠ¨æ¢å¤ï¼Œåªè°ƒç”¨è£‚è„‘é€šçŸ¥ç¨‹åºï¼ˆå¦‚æœå·²é…ç½®ï¼‰ï¼Œæ–­å¼€è¿æ¥å¹¶ä¿æŒæ–­å¼€ï¼›</li><li>discard-younger-primary: ä¸¢å¼ƒå¹¶å›æ»šæœ€åå‡ä¸»èŠ‚ç‚¹çš„æ”¹åŠ¨ï¼›</li><li>discard-least-changes: ä¸¢å¼ƒå¹¶å›æ»šä¿®æ”¹æ›´å°‘èŠ‚ç‚¹çš„ä¿®æ”¹ï¼›</li><li>discard-zero-changes: å¦‚æœæœ‰æŸä¸€èŠ‚ç‚¹ä¸€ç‚¹æœªæ”¹åŠ¨ï¼Œåªéœ€åº”ç”¨å¯¹å¦ä¸€ä¸»æœºæ‰€åšçš„ä¿®æ”¹å¹¶ç»§ç»­ï¼›</li></ul><h4 id="after-sb-1pri"><a href="#after-sb-1pri" class="headerlink" title="after-sb-1pri"></a>after-sb-1pri</h4><p>è£‚è„‘åˆšè¢«æ£€æµ‹åˆ°çš„åŒæ—¶è¯¥èµ„æºåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ˜¯ä¸»èŠ‚ç‚¹ã€‚å¯¹äºè¿™ç§çŠ¶å†µï¼Œ<code>DRBD</code>ç†è§£ä»¥ä¸‹å…³é”®å­—ï¼š</p><ul><li>disconnect:åŒä¸Š</li><li>consensusï¼šåº”ç”¨ä¸Šä¸€æ­¥çš„ç­–ç•¥ä¹‹åï¼Œå¦‚æœè£‚è„‘å—å®³è€…å¯ä»¥é€‰æ‹©æ‹†åˆ†åˆ™ä¼šè‡ªåŠ¨è§£å†³ã€‚å¦åˆ™ï¼Œä¸<code>disconnect</code>æŒ‡ä»¤ç›¸åŒã€‚</li><li>call-pri-lost-after-sbï¼šåº”ç”¨ä¸Šä¸€æ­¥çš„ç­–ç•¥ä¹‹åï¼Œå¦‚æœè£‚è„‘å—å®³è€…èŠ‚ç‚¹å¯ä»¥é€‰æ‹©æ‹†åˆ†åˆ™è°ƒç”¨<code>pri-lost-after-sb</code>å¤„ç†ç¨‹åºï¼Œè¯¥å¤„ç†ç¨‹åºå¿…é¡»åœ¨å¤„ç†ç¨‹åºä¸­è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”éœ€è¦å¼ºåˆ¶ä»é›†ç¾¤ä¸­åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</li><li>discard-secondaryï¼šå°†ä»ç«¯ï¼ˆ<code>Secondary role</code>ï¼‰èŠ‚ç‚¹è§†ä¸ºè£‚è„‘å—å®³è€…ã€‚</li></ul><h4 id="after-sb-2pri"><a href="#after-sb-2pri" class="headerlink" title="after-sb-2pri"></a>after-sb-2pri</h4><p>è£‚è„‘åˆšè¢«æ£€æµ‹åˆ°æ—¶è¯¥èµ„æºåœ¨ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å¤„äºä¸»ç«¯ã€‚è¯¥é€‰é¡¹æ¥å—ä¸é™¤<code>discard-secondary</code> å’Œ <code>consensus</code> ä¹‹å¤–ä¸ <code>after-sb-1pri</code> ç›¸åŒçš„å…³é”®å­—ã€‚</p><p><em>æç¤º</em>ï¼š<code>DRBD</code>è¿˜å¯ä»¥ç†è§£è¿™ä¸‰ä¸ªé€‰é¡¹ä¸‹é¢å¤–çš„å…³é”®å­—ï¼Œè¿™äº›å…³é”®å­—åœ¨è¿™é‡Œè¢«çœç•¥ï¼Œå› ä¸ºå®ƒä»¬å¾ˆå°‘è¢«ä½¿ç”¨ã€‚è¯·å‚é˜…<code>drbd.conf</code>çš„æ‰‹å†Œé¡µä»¥è·å–æœ‰å…³è£‚è„‘æ¢å¤å…³é”®å­—çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ­¤å¤„ä¸å†è®¨è®ºã€‚<br>ä¾‹å¦‚ï¼Œç”¨ä½œåŒä¸»æ¨¡å¼ä¸‹<code>GFS</code>æˆ–<code>OCFS2</code>æ–‡ä»¶ç³»ç»Ÿçš„å—è®¾å¤‡çš„èµ„æºå¯èƒ½ä¼šå°†å…¶æ¢å¤ç­–ç•¥å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">resource &lt;resource&gt; &#123;</span><br><span class="line">  handlers &#123;</span><br><span class="line">    split-brain "/usr/lib/drbd/notify-split-brain.sh root"      # è„šæœ¬é€šçŸ¥rootç”¨æˆ·ï¼Œæ­¤å¤„å¯ä»¥ä½¿ç”¨é‚®ä»¶æé†’</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  net &#123;</span><br><span class="line">    after-sb-0pri discard-zero-changes;</span><br><span class="line">    after-sb-1pri discard-secondary;</span><br><span class="line">    after-sb-2pri disconnect;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰‹åŠ¨æ¢å¤"><a href="#æ‰‹åŠ¨æ¢å¤" class="headerlink" title="æ‰‹åŠ¨æ¢å¤"></a>æ‰‹åŠ¨æ¢å¤</h3><p><a href="https://docs.linbit.com/docs/users-guide-8.4/#s-resolve-split-brain" target="_blank" rel="noopener">6.3. Manual split brain recovery</a></p><p>åœ¨æ£€æµ‹åˆ°è£‚è„‘åï¼Œä¸€ä¸ªèŠ‚ç‚¹å°†å§‹ç»ˆä½¿èµ„æºå¤„äº<code>StandAlone</code>è¿æ¥çŠ¶æ€ã€‚å¦ä¸€ä¸ªå¯èƒ½ä¹Ÿå¤„äº<code>StandAlone</code>çŠ¶æ€ï¼ˆå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶æ£€æµ‹åˆ°è£‚è„‘ï¼‰æˆ–<code>WFConnection</code>ï¼ˆå¦‚æœæŸæ–¹èŠ‚ç‚¹åœ¨å¦ä¸€èŠ‚ç‚¹æ£€æµ‹åˆ°è£‚è„‘ä¹‹å‰æ–­å¼€è¿æ¥ï¼‰ã€‚</p><p>æ­¤æ—¶ï¼Œé™¤éå·²å°†<code>DRBD</code>é…ç½®ä¸ºè‡ªåŠ¨ä»è£‚è„‘çŠ¶æ€ä¸­æ¢å¤ï¼Œå¦åˆ™å¿…é¡»é€šè¿‡é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ‰‹åŠ¨å¹²é¢„ï¼Œè¯¥èŠ‚ç‚¹çš„ä¿®æ”¹å°†è¢«ä¸¢å¼ƒï¼ˆæ­¤èŠ‚ç‚¹ç§°ä¸ºè£‚è„‘å—å®³è€…ï¼‰ã€‚è¿™ä¸ªå¹²é¢„ä½¿ç”¨ä¸‹é¢æ­¥éª¤å®Œæˆï¼š</p><p>è£‚è„‘å—å®³è€…éœ€è¦å¤„äº<code>StandAlone</code>çš„è¿æ¥çŠ¶æ€ï¼Œå¦åˆ™ä»¥ä¸‹å‘½ä»¤å°†è¿”å›é”™è¯¯ã€‚æ‚¨å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹å†…å®¹ç¡®ä¿å®ƒæ˜¯<code>StandAlone</code>çš„ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm disconnect &lt;resource&gt;</span><br><span class="line">drbdadm secondary &lt;resource&gt;</span><br><span class="line">drbdadm connect --discard-my-data &lt;resource&gt;    # 8.4+  if 8.3,use 'drbdadm -- --discard-my-data connect &lt;resource&gt;' instead</span><br></pre></td></tr></table></figure></p><p>åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè£‚è„‘å¹¸å­˜è€…ï¼‰ä¸Šï¼Œå¦‚æœå®ƒçš„è¿æ¥çŠ¶æ€ä¹Ÿæ˜¯<code>StandAlone</code>ï¼Œä½ å¯ä»¥è¾“å…¥ï¼š<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm connect &lt;resource&gt;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœèŠ‚ç‚¹å·²å¤„äº<code>WFConnection</code>çŠ¶æ€ï¼Œåˆ™å¯ä»¥çœç•¥æ­¤æ­¥éª¤;å®ƒä¼šè‡ªåŠ¨é‡æ–°è¿æ¥ã€‚</p><p>å¦‚æœå—è£‚è„‘å½±å“çš„èµ„æºæ˜¯<strong>å †å </strong>èµ„æºï¼Œè¯·ä½¿ç”¨<code>drbdadm --stacked</code>è€Œä¸æ˜¯<code>drbdadm</code>ã€‚</p><p>è¿æ¥åï¼Œè£‚è„‘å—å®³è€…ç«‹å³å°†å…¶è¿æ¥çŠ¶æ€æ›´æ”¹ä¸º<code>SyncTarget</code>ï¼Œå¹¶å°†å…¶å¯¼è‡´è£‚è„‘çš„ä¿®æ”¹ç”±å…¶ä½™ä¸»èŠ‚ç‚¹çš„æ•°æ®è¦†ç›–ã€‚</p><p>è£‚è„‘å—å®³è€…ä¸ä¼šå¼•å‘å…¨ç›˜åŒæ­¥ã€‚ç›¸åï¼Œå®ƒçš„å±€éƒ¨ä¿®æ”¹å·²ç»è¢«å›æ»šï¼Œå¯¹è£‚è„‘å¹¸å­˜è€…çš„ä»»ä½•ä¿®æ”¹éƒ½ä¼šä¼ é€’ç»™å—å®³è€…ã€‚<br>é‡æ–°åŒæ­¥å®Œæˆåï¼Œè£‚è„‘è¢«è§†ä¸ºå·²è§£å†³ï¼ˆ<code>resolved</code>ï¼‰ï¼Œä¸¤ä¸ªèŠ‚ç‚¹å†æ¬¡å½¢æˆå®Œå…¨ä¸€è‡´çš„å†—ä½™å¤åˆ¶å­˜å‚¨ç³»ç»Ÿï¼ˆ<code>DRBD</code>ï¼‰ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://docs.linbit.com/docs/users-guide-8.4/" target="_blank" rel="noopener">Userâ€™s Guide 8.4.x</a></li><li><a href="http://blog.sina.com.cn/s/blog_a30f2be401016d04.html" target="_blank" rel="noopener">å…³äº DRBD v8.3 çš„åŒæ­¥æœºåˆ¶</a></li><li><a href="http://myhat.blog.51cto.com/391263/606318/" target="_blank" rel="noopener">ä¸€æ¬¡ DRBD è£‚è„‘è¡Œä¸ºçš„æ¨¡æ‹Ÿ</a></li><li><a href="http://itindex.net/detail/50197-drbd" target="_blank" rel="noopener">drbd è£‚è„‘å¤„ç† | IT ç˜¾</a></li></ul><p><a href="http://www.3mu.me/%E4%BB%80%E4%B9%88%E6%98%AFdrbd%E8%84%91%E8%A3%82%E5%8F%8A%E5%A6%82%E4%BD%95%E6%A8%A1%E6%8B%9Fdrbd%E8%84%91%E8%A3%82/" target="_blank" rel="noopener">http://www.3mu.me/%E4%BB%80%E4%B9%88%E6%98%AFdrbd%E8%84%91%E8%A3%82%E5%8F%8A%E5%A6%82%E4%BD%95%E6%A8%A1%E6%8B%9Fdrbd%E8%84%91%E8%A3%82/</a></p><p>drbd ä¸­ metadata çš„ç†è§£(åŸåˆ›) â€“ èšŠå­ä¸–ç•Œ<br><a href="http://www.wenzizone.cn/2009/10/29/drbd%e4%b8%admetadata%e7%9a%84%e7%90%86%e8%a7%a3%e5%8e%9f%e5%88%9b.html" target="_blank" rel="noopener">http://www.wenzizone.cn/2009/10/29/drbd%e4%b8%admetadata%e7%9a%84%e7%90%86%e8%a7%a3%e5%8e%9f%e5%88%9b.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> DRBD </tag>
            
            <tag> è£‚è„‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºåœ¨ Python ä¸­ MySQL çš„ WHERE å­å¥ä¸­æ‰§è¡Œ IN æ“ä½œï¼ˆlistï¼Œtupleï¼‰çš„é—®é¢˜</title>
      <link href="/blog/2018-05-10/executing-select-where-in-using-mysqldb/"/>
      <url>/blog/2018-05-10/executing-select-where-in-using-mysqldb/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ä»Šå¤©åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€å¤„æŸ¥è¯¢è¯­å¥éœ€è¦æ‰§è¡Œ <code>IN</code> æ“ä½œï¼Œç»“æœç›´æ¥<code>join</code>æ“ä½œä¼šå‡ºé”™ã€‚<br><a id="more"></a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list_of_datas = [<span class="string">u'sde'</span>, <span class="string">u'sdf'</span>, <span class="string">u'sdb'</span>, <span class="string">u'sdc'</span>]</span><br><span class="line">sql = <span class="string">"SELECT DiskId,Name,Sg,PhyId,ExpanderId,EProduct FROM Disk WHERE Used='2' AND Name IN (%s)"</span> % <span class="string">','</span>.join(list_of_datas)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DiskId, <span class="keyword">Name</span>, Sg, PhyId, ExpanderId</span><br><span class="line">, EProduct</span><br><span class="line"><span class="keyword">FROM</span> Disk</span><br><span class="line"><span class="keyword">WHERE</span> Used = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">Name</span> <span class="keyword">IN</span> (sde, sdf, sdb, sdc)</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ä¸é¢„æœŸçš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚å› ä¸º <code>IN</code> æ“ä½œä¸­çš„é€‰å–å­—æ®µåº”è¯¥æ˜¯å¸¦å¼•å·çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ç›´æ¥æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æœŸæœ›çš„<code>WHERE</code>å­å¥ä¸­æ˜¯<code>WHERE Used = &#39;2&#39; AND Name IN (&#39;sde&#39;, &#39;sdf&#39;, &#39;sdb&#39;, &#39;sdc&#39;)</code>å½¢å¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sql1 = <span class="string">"SELECT DiskId,Name,Sg,PhyId,ExpanderId,EProduct FROM Disk WHERE Used='2' AND Name IN (%s)"</span> % <span class="string">','</span>.join([<span class="string">"'%s'"</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> list_of_datas])</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DiskId, <span class="keyword">Name</span>, Sg, PhyId, ExpanderId</span><br><span class="line">, EProduct</span><br><span class="line"><span class="keyword">FROM</span> Disk</span><br><span class="line"><span class="keyword">WHERE</span> Used = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">Name</span> <span class="keyword">IN</span> (<span class="string">'sde'</span>, <span class="string">'sdf'</span>, <span class="string">'sdb'</span>, <span class="string">'sdc'</span>)</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚ä¸è¿‡ï¼Œç”±äºä¸Šé¢å­—ç¬¦åŒ–æ“ä½œæ„Ÿè§‰æœ‰ç‚¹æš´åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®æ”¹è¿›ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">format_strings= <span class="string">','</span>.join([repr(item) <span class="keyword">for</span> item <span class="keyword">in</span> list_of_datas])</span><br><span class="line">print(format_strings)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">u'sde'</span>,<span class="string">u'sdf'</span>,<span class="string">u'sdb'</span>,<span class="string">u'sdc'</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ <code>SQL</code> è¯­å¥å˜æˆ:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DiskId,<span class="keyword">Name</span>,Sg,PhyId,ExpanderId,EProduct <span class="keyword">FROM</span> Disk <span class="keyword">WHERE</span> Used=<span class="string">'2'</span> <span class="keyword">AND</span> <span class="keyword">Name</span> <span class="keyword">IN</span> (u<span class="string">'sde'</span>,u<span class="string">'sdf'</span>,u<span class="string">'sdb'</span>,u<span class="string">'sdc'</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯æ²¡åŠæ³•æ­£å¸¸æŸ¥è¯¢å‡ºç»“æœçš„ï¼Œå› ä¸ºæŸ¥è¯¢å­—æ®µæ˜¯ <code>unicode</code> ç¼–ç ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">format_unicode_strings = <span class="string">','</span>.join([repr(item.encode(<span class="string">'utf-8'</span>)) <span class="keyword">if</span> isinstance(item,unicode) <span class="keyword">else</span> repr(item) <span class="keyword">for</span> item <span class="keyword">in</span> list_of_datas])</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç»“æœæ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼š</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DiskId, <span class="keyword">Name</span>, Sg, PhyId, ExpanderId</span><br><span class="line">, EProduct</span><br><span class="line"><span class="keyword">FROM</span> Disk</span><br><span class="line"><span class="keyword">WHERE</span> Used = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">AND</span> <span class="keyword">Name</span> <span class="keyword">IN</span> (<span class="string">'sde'</span>, <span class="string">'sdf'</span>, <span class="string">'sdb'</span>, <span class="string">'sdc'</span>)</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ”¶å·¥ã€‚</p><p>å› ä¸ºå…¬å¸çš„ä»£ç å°è£…å‡½æ•°æ˜¯åªèƒ½æ‰§è¡ŒçœŸæ­£çš„ <code>SQL</code> è¯­å¥çš„ï¼Œæ‰€ä»¥åªèƒ½ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼ŒæŸ¥è¯¢ç½‘ç»œä¸Šåˆ«äººçš„è§£å†³æ–¹æ¡ˆå‘ç°ä¸‹é¢çš„å†™æ³•ï¼Œä»¥å¤‡å‚è€ƒã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>alist = [<span class="string">'1.1.1.1'</span>,<span class="string">'2.2.2.2'</span>,<span class="string">'3.3.3.3'</span>]                                                    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>select_str = <span class="string">'select * from server where ip in (%s)'</span> % <span class="string">','</span>.join([<span class="string">'%s'</span>] * len(alist))       </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>select_str  </span><br><span class="line"><span class="string">'select * from server where ip in (%s,%s,%s)'</span> </span><br><span class="line"> <span class="comment"># æ‰§è¡ŒsqlæŸ¥è¯¢</span></span><br><span class="line">cursor.execute(select_str,a)</span><br></pre></td></tr></table></figure><p>åé¢çš„å†™æ³•æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">in_p = <span class="string">', '</span>.join((map(<span class="keyword">lambda</span> x: <span class="string">'%s'</span>, args)))</span><br><span class="line">realsql = sql % in_p</span><br><span class="line">cursor.execute(realsql, args)</span><br></pre></td></tr></table></figure><p>å†æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">args = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">in_p = <span class="string">', '</span>.join(itertools.repeat(<span class="string">'%s'</span>, len(args)))</span><br><span class="line">cursor.execute(sql % in_p, args)</span><br></pre></td></tr></table></figure><p>å®Œæ•´ç¤ºä¾‹ä»£ç :</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created by imoyao at 2018/5/18 17:17</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">excute_sql</span><span class="params">(sql)</span>:</span></span><br><span class="line">    db = MySQLdb.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"imoyao"</span>, passwd=<span class="string">"111111"</span>, db=<span class="string">"ODSP"</span>, charset=<span class="string">"utf8"</span>)</span><br><span class="line">    cr = db.cursor()</span><br><span class="line">    cr.execute(sql)</span><br><span class="line">    data = cr.fetchall()</span><br><span class="line">    cr.close()</span><br><span class="line">    db.close()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">excute_sql_datas</span><span class="params">(sqlstr, tupledata)</span>:</span></span><br><span class="line">    db = MySQLdb.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"imoyao"</span>, passwd=<span class="string">"111111"</span>, db=<span class="string">"ODSP"</span>, charset=<span class="string">"utf8"</span>)</span><br><span class="line">    cr = db.cursor()</span><br><span class="line">    cr.execute(sqlstr,tupledata)</span><br><span class="line">    data = cr.fetchall()</span><br><span class="line">    cr.close()</span><br><span class="line">    db.close()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    list_of_datas = [<span class="string">u'sde'</span>, <span class="string">u'sdf'</span>, <span class="string">u'sdb'</span>, <span class="string">u'sdc'</span>]</span><br><span class="line">    format_strings = <span class="string">','</span>.join(</span><br><span class="line">        [repr(item.encode(<span class="string">'utf-8'</span>)) <span class="keyword">if</span> isinstance(item, unicode) <span class="keyword">else</span> repr(item) <span class="keyword">for</span> item <span class="keyword">in</span> list_of_datas])</span><br><span class="line">    sql = <span class="string">"SELECT DiskId,Name,Sg,PhyId,ExpanderId,EProduct FROM Disk WHERE Used='2' AND Name IN (%s)"</span> % format_strings</span><br><span class="line">    print(excute_sql(sql))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'*'</span>*<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">    sql2 = <span class="string">"SELECT DiskId,Name,Sg,PhyId,ExpanderId,EProduct FROM Disk WHERE Used='2' AND Name IN (%s)"</span></span><br><span class="line">    <span class="comment"># format_strings2 = ', '.join(map(lambda x: '%s', list_of_datas))</span></span><br><span class="line">    <span class="comment"># format_strings2 = ', '.join(['%s'] * len(list_of_datas))</span></span><br><span class="line">    format_strings2 = <span class="string">', '</span>.join(itertools.repeat(<span class="string">'%s'</span>, len(list_of_datas)))</span><br><span class="line">    sqlstr = sql2 % format_strings2</span><br><span class="line">    print(excute_sql_datas(sqlstr, list_of_datas))</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š</p><ol><li><p><a href="https://blog.csdn.net/u011085172/article/details/79044490" target="_blank" rel="noopener">python mysql where in å¯¹åˆ—è¡¨ï¼ˆlist,,arrayï¼‰é—®é¢˜ - CSDN åšå®¢</a></p></li><li><p><a href="https://stackoverflow.com/questions/4574609/executing-select-where-in-using-mysqldb" target="_blank" rel="noopener">python - Executing â€œSELECT â€¦ WHERE â€¦ IN â€¦â€ using MySQLdb - Stack Overflow</a></p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> MySQL </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Python ä¸­çš„ä¸‹åˆ’çº¿ç”¨æ³•çš„è®°å½•</title>
      <link href="/blog/2018-04-28/the-underline-of-Python/"/>
      <url>/blog/2018-04-28/the-underline-of-Python/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h2 id="Py-ä¹™å·±"><a href="#Py-ä¹™å·±" class="headerlink" title="Py ä¹™å·±"></a>Py ä¹™å·±</h2><p>å­”ä¹™å·±è‡ªå·±çŸ¥é“ä¸èƒ½å’Œæ¶æ„å¸ˆè°ˆå¤©ï¼Œä¾¿åªå¥½å‘å®ä¹ ç”Ÿè¯´è¯ã€‚</p><p>æœ‰ä¸€å›å¯¹æˆ‘è¯´é“ï¼Œâ€œä½ å†™è¿‡<code>Python</code>ä¹ˆï¼Ÿâ€æˆ‘ç•¥ç•¥ç‚¹ä¸€ç‚¹å¤´ã€‚</p><p>ä»–è¯´ï¼Œâ€œå†™è¿‡ä»£ç ï¼Œâ€¦â€¦æˆ‘ä¾¿è€ƒä½ ä¸€è€ƒã€‚<code>Python</code>ä¸­çš„ä¸‹åˆ’çº¿ï¼Œæ€æ ·ç”¨çš„ï¼Ÿâ€</p><p>æˆ‘æƒ³ï¼Œæ¬ç –ä¸€æ ·çš„äººï¼Œä¹Ÿé…è€ƒæˆ‘ä¹ˆï¼Ÿä¾¿å›è¿‡è„¸å»ï¼Œä¸å†ç†ä¼šã€‚</p><p>å­”ä¹™å·±ç­‰äº†è®¸ä¹…ï¼Œå¾ˆæ³åˆ‡çš„è¯´é“ï¼Œâ€œä¸èƒ½å†™ç½¢ï¼Ÿâ€¦â€¦æˆ‘æ•™ç»™ä½ ï¼Œè®°ç€ï¼è¿™äº›ç”¨æ³•åº”è¯¥è®°ç€ã€‚å°†æ¥åšé¢è¯•å®˜çš„æ—¶å€™è¦ç”¨ã€‚â€</p><p>æˆ‘æš—æƒ³æˆ‘å’Œé¢è¯•å®˜çš„ç­‰çº§è¿˜å¾ˆè¿œå‘¢ï¼Œè€Œä¸”æˆ‘ä»¬é¢è¯•å®˜ä¹Ÿä»ä¸å°†è¿™äº›é—®é¢˜æ‹¿æ¥è€ƒåº”è˜è€…ï¼›åˆå¥½ç¬‘ï¼Œåˆä¸è€çƒ¦ï¼Œæ‡’æ‡’çš„ç­”ä»–é“ï¼Œâ€œè°è¦ä½ æ•™ï¼Œä¸å°±æ˜¯å‘½åå˜é‡ï¼Œå¢åŠ ä»£ç çš„å¯è¯»æ€§å—ï¼Ÿâ€</p><p>å­”ä¹™å·±æ˜¾å‡ºæé«˜å…´çš„æ ·å­ï¼Œå°†ä¸¤ä¸ªæŒ‡å¤´çš„é•¿æŒ‡ç”²æ•²ç€é”®ç›˜ï¼Œç‚¹å¤´è¯´ï¼Œâ€œå¯¹å‘€å¯¹å‘€ï¼â€¦â€¦ä¸‹åˆ’çº¿æœ‰å››ç§å†™æ³•ï¼Œä½ çŸ¥é“ä¹ˆï¼Ÿâ€</p><p>æˆ‘æ„ˆä¸è€çƒ¦äº†ï¼ŒåŠªç€å˜´èµ°è¿œã€‚å­”ä¹™å·±åˆšç”¨çº¸å·¾æ“¦äº†æ“¦é”®ç›˜ä¸Šçš„å’–å•¡æ¸ï¼Œæƒ³åœ¨<code>IDE</code>é‡Œå†™ä»£ç ï¼Œè§æˆ‘æ¯«ä¸çƒ­å¿ƒï¼Œä¾¿åˆå¹ä¸€å£æ°”ï¼Œæ˜¾å‡ºææƒ‹æƒœçš„æ ·å­ã€‚<br><a id="more"></a></p><h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><ul><li>åœ¨äº¤äº’å¼è§£é‡Šå™¨ä¸­è·å–ä¸Šä¸€ä¸ªè¯­å¥æ‰§è¡Œçš„ç»“æœï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span>+<span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>_</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>_ * <span class="number">5</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure><ul><li>ç”¨æ¥åœ¨å‡½æ•°ã€æ¨¡å—ã€åŒ…ã€å˜é‡åä¸­åˆ†éš”å•è¯ï¼Œå¢åŠ å¯è¯»æ€§ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">var_foo_bar = <span class="string">'hello,world!'</span></span><br></pre></td></tr></table></figure><ul><li>å†…éƒ¨ä½¿ç”¨çš„å˜é‡ã€å±æ€§ã€æ–¹æ³•ã€å‡½æ•°ã€ç±»æˆ–æ¨¡å—ï¼Œï¼ˆçº¦å®šï¼‰åˆç§°ä¸ºå†…éƒ¨å®ç°ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡å®šå­˜åœ¨foo.pyä¸­å®šä¹‰å˜é‡ï¼š</span></span><br><span class="line">_var = <span class="number">9527</span></span><br><span class="line"><span class="comment"># åœ¨bar.pyä¸­å¯¼å…¥</span></span><br><span class="line"><span class="keyword">from</span> foo <span class="keyword">import</span> *   <span class="comment"># ä¸ä¼šå¯¼å…¥ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„å¯¹è±¡</span></span><br><span class="line">print(_var)</span><br><span class="line"><span class="comment"># è¿”å›ï¼š</span></span><br><span class="line">NameError: name <span class="string">'_var'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line">å½“ç„¶ä¹Ÿå¯ä»¥å¼ºåˆ¶å¯¼å…¥ï¼ˆä¸æ¨èï¼‰</span><br><span class="line"><span class="keyword">from</span> foo <span class="keyword">import</span> _var        <span class="comment"># Access to a protected member _var of a module</span></span><br><span class="line">print(_var)</span><br><span class="line"><span class="comment"># è¿”å›ï¼š</span></span><br><span class="line"><span class="number">9527</span></span><br></pre></td></tr></table></figure><ul><li>é¿å…ä¸ <code>Python</code> ä¿ç•™çš„å…³é”®å­—å†²çªï¼ˆçº¦å®šï¼‰ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Tkinter.Toplevel(master, class_=<span class="string">'ClassName'</span>)        <span class="comment"># æ³¨æ„classä¸ºPythonå…§å»ºåç§°</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨ç±»å†…çš„ç§æœ‰å˜é‡ï¼ˆ<code>private</code>ï¼‰ï¼Œç±»å¤–éƒ¨æ— æ³•ç›´æ¥ä½¿ç”¨åŸåç§°è®¿é—®ï¼Œéœ€è¦é€šè¿‡<code>instance._ClassName__var</code>çš„å½¢å¼è®¿é—®ï¼ˆ<code>name mangling</code>ï¼‰ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    __say_hello = <span class="string">'Hello,world'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pi = Person(<span class="string">'Peter'</span>, <span class="number">26</span>)</span><br><span class="line">    <span class="comment"># print(pi.__say_hello)       # AttributeError: 'Person' object has no attribute '__say_hello'</span></span><br><span class="line">    print(pi._Person__say_hello)</span><br><span class="line">    print(pi.get_age())</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>dir(pi)</code>çœ‹ä¸€ä¸‹å¯¹è±¡ä¸­çš„ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">['_Person__say_hello', '__class__', '__delattr__', '__dict__', '__doc__', '__format__', '__getattribute__', '__hash__', '__init__', '__module__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'age', 'get_age', 'get_name', 'name']</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>Python</code> è§£é‡Šå™¨è§¦å‘åç§°ä¿®é¥°ï¼Œå®ƒè¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢å˜é‡åœ¨å­ç±»ä¸­è¢«é‡å†™ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªé›†æˆPersonçš„AIç±»</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AI</span><span class="params">(Person)</span>:</span></span><br><span class="line"></span><br><span class="line">    __say_hello = <span class="string">'ALL in AI'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    ai_attr = [<span class="string">'ALL in AI'</span>]*<span class="number">3</span></span><br><span class="line">    ai = AI(*ai_attr)</span><br><span class="line">    print(dir(ai))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»§æ‰¿å…³ç³»ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿”å›</span></span><br><span class="line">[<span class="string">'_AI__say_hello'</span>, <span class="string">'_Person__gender'</span>, <span class="string">'_Person__say_hello'</span>, <span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__format__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__module__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'_age'</span>, <span class="string">'name'</span>]</span><br></pre></td></tr></table></figure><p>è¿™ç‚¹åœ¨ <code>ã€ŠPython Cookbookã€‹- 8.5 åœ¨ç±»ä¸­å°è£…å±æ€§å</code> ä¸­å¯¹äºå•ä¸‹åˆ’çº¿å’ŒåŒä¸‹åˆ’çº¿çš„ä½¿ç”¨åœºæ™¯ä¹Ÿæœ‰æåŠå’Œè§£é‡Šï¼š</p><blockquote><p>å¤§å¤šæ•°è€Œè¨€ï¼Œä½ åº”è¯¥è®©ä½ çš„éå…¬å…±åç§°ä»¥å•ä¸‹åˆ’çº¿å¼€å¤´ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æ¸…æ¥šä½ çš„ä»£ç ä¼šæ¶‰åŠåˆ°å­ç±»ï¼Œå¹¶ä¸”æœ‰äº›å†…éƒ¨å±æ€§åº”è¯¥åœ¨å­ç±»ä¸­éšè—èµ·æ¥ï¼Œé‚£ä¹ˆæ‰è€ƒè™‘ä½¿ç”¨åŒä¸‹åˆ’çº¿æ–¹æ¡ˆã€‚</p></blockquote><ul><li>åœ¨ç±»å†…çš„ä¿æŠ¤å˜é‡ï¼ˆè¿™ä¸€æ¡å­˜ç–‘ï¼‰ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_var_</span><br></pre></td></tr></table></figure><ul><li><code>Python</code> å†…ç½®çš„â€œé­”æ³•â€æ–¹æ³•æˆ–å±æ€§ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ï¼Œä½†å¼ºçƒˆ <strong>ä¸æ¨è</strong>ã€‚æ¯”å¦‚ï¼š</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__init__, __file__, __main__</span><br></pre></td></tr></table></figure><ul><li>ä½œä¸ºå†…éƒ¨ä½¿ç”¨çš„ä¸€æ¬¡æ€§å˜é‡ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">é€šå¸¸åœ¨å¾ªç¯é‡Œä½¿ç”¨,æ¯”å¦‚ï¼š</span><br><span class="line">foo_list = [_ <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">æˆ–æ˜¯ç”¨ä½œå ä½ï¼Œä¸å®é™…ä½¿ç”¨çš„å˜é‡,æ¯”å¦‚ï¼š</span><br><span class="line"><span class="keyword">for</span> _, a <span class="keyword">in</span> [(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>)]:</span><br><span class="line">    <span class="keyword">print</span> a</span><br></pre></td></tr></table></figure><ul><li><code>i18n</code> é‡Œä½œä¸º <code>gettext()</code> çš„ç¼©å†™ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_()</span><br></pre></td></tr></table></figure><ul><li>ç”¨æ¥åˆ†éš”æ•°å€¼ä»¥å¢åŠ å¯è¯»æ€§ï¼ˆ<code>Python 3.6</code> æ–°å¢ï¼‰ï¼›</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = <span class="number">1</span>_000_000 </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num</span><br><span class="line"><span class="number">1000000</span></span><br><span class="line"><span class="number">1</span>_000_000</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h3><ol><li><p><a href="http://pep8.org/#descriptive-naming-styles" target="_blank" rel="noopener">PEP 8 â€“ Style Guide for Python Code</a></p></li><li><p><a href="https://www.pythonsheets.com/notes/python-basic.html#python-naming-rule" target="_blank" rel="noopener">Python basic cheatsheet</a></p></li><li><p><a href="https://dbader.org/blog/meaning-of-underscores-in-python" target="_blank" rel="noopener">The Meaning of Underscores in Python â€“ dbader.org</a></p></li><li><p><a href="https://www.zhihu.com/question/268940585/answer/344852737" target="_blank" rel="noopener">Python ä¸­çš„ä¸‹åˆ’çº¿_æœ‰å¤šå°‘ä¸ªæ„æ€ï¼Ÿ- çŸ¥ä¹</a></p></li></ol><h2 id="æ´¾æ£®å¤šä¸€ç‚¹"><a href="#æ´¾æ£®å¤šä¸€ç‚¹" class="headerlink" title="æ´¾æ£®å¤šä¸€ç‚¹"></a>æ´¾æ£®å¤šä¸€ç‚¹</h2><p><code>Python</code>ä¸­çš„<code>dunder</code></p><p>å‚è§<a href="https://nedbatchelder.com/blog/200605/dunder.html" target="_blank" rel="noopener">è¿™é‡Œ</a></p><blockquote><p>å…³äº<code>Python</code> ç¼–ç¨‹çš„ä¸€ä¸ªå°´å°¬çš„äº‹æƒ…æ˜¯ï¼šæœ‰å¾ˆå¤šç§åŒä¸‹åˆ’çº¿ã€‚ ä¾‹å¦‚ï¼Œè¯­æ³•ç³–ä¸‹é¢çš„æ ‡å‡†æ–¹æ³•åç§°å…·æœ‰ <code>__getattr__</code> è¿™æ ·çš„åç§°ï¼Œæ„é€ å‡½æ•°æ˜¯ <code>__init__</code> ï¼Œå†…ç½®è¿ç®—ç¬¦å¯ä»¥ç”¨ <code>__add__</code> é‡è½½ï¼Œç­‰ç­‰ã€‚ åœ¨ <code>Django</code> æ¡†æ¶ä¸­ï¼ˆè‡³å°‘åœ¨ä»–ä»¬æ•´åˆäº† <code>magic-removal</code> åˆ†æ”¯ä¹‹å‰ï¼‰ï¼Œå¯¹è±¡å…³ç³»æ˜ å°„å™¨ä½¿ç”¨äº†åä¸º <code>user__id__exact</code> çš„å…³é”®å­—å‚æ•°ã€‚</p><p>åŒä¸‹åˆ’çº¿çš„é—®é¢˜æ˜¯å¾ˆéš¾å‘åˆ«äººæè¿°ã€‚ ä½ æ€ä¹ˆè¯» <code>__init__</code> ï¼Ÿ â€œä¸‹åˆ’çº¿ä¸‹åˆ’çº¿ <code>init</code> ä¸‹åˆ’çº¿ä¸‹åˆ’çº¿â€ï¼Ÿ â€œåŒä¸‹åˆ’çº¿ <code>init</code> åŒä¸‹åˆ’çº¿â€ï¼Ÿ ç®€å•çš„ â€œ<code>init</code>â€ ä¼¼ä¹æ¼æ‰äº†ä¸€äº›é‡è¦çš„ä¸œè¥¿ã€‚</p><p>æˆ‘æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šåŒä¸‹åˆ’çº¿åº”è¯¥å‘éŸ³ä¸º â€œ<code>dunder</code>â€ ã€‚ æ‰€ä»¥ <code>__init__</code> å¿µæˆâ€œ<code>dunder init dunder</code>â€ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ç®€è¯»ä¸º â€œ<code>dunder init</code>â€ ã€‚</p><p>ç°åœ¨æˆ‘æœŸå¾…æŸä¸ªäººå®šä¹‰ä¸€ä¸‹ â€œ<code>dunderhead</code>â€ æ˜¯ä»€ä¹ˆæ„æ€ï¼Œhahaâ€¦â€¦</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…æ Python ä¸­çš„å»¶è¿Ÿç»‘å®šé—®é¢˜</title>
      <link href="/blog/2018-04-10/late-binding-of-Python/"/>
      <url>/blog/2018-04-10/late-binding-of-Python/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><h1 id="å»¶è¿Ÿç»‘å®š-late-binding-é—­åŒ…"><a href="#å»¶è¿Ÿç»‘å®š-late-binding-é—­åŒ…" class="headerlink" title="å»¶è¿Ÿç»‘å®š(late binding)é—­åŒ…"></a>å»¶è¿Ÿç»‘å®š(<code>late binding</code>)é—­åŒ…</h1><p><code>Python</code> ä½¿ç”¨ä¸­ä¸€ä¸ªå¸¸è§çš„å›°æƒ‘æ˜¯ <code>Python</code> åœ¨é—­åŒ…(æˆ–åœ¨å‘¨å›´å…¨å±€ä½œç”¨åŸŸï¼ˆ<code>surrounding global scope</code>ï¼‰)ä¸­ç»‘å®šå˜é‡çš„æ–¹å¼ã€‚<br><a id="more"></a><br>ä½ æ‰€å†™çš„å‡½æ•°ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_expression</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">lambda</span> n: n*i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br></pre></td></tr></table></figure></p><p>ä½ æ‰€æœŸæœ›çš„ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([mult(<span class="number">10</span>) <span class="keyword">for</span> mult <span class="keyword">in</span> multi_expression()])</span><br></pre></td></tr></table></figure></p><p>ä¸€ä¸ªåŒ…å«äº”ä¸ªå‡½æ•°è¿”å›å€¼çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå‡½æ•°æœ‰å®ƒä»¬è‡ªå·±çš„å°é—­å˜é‡ <code>i</code> ä¹˜ä»¥å®ƒä»¬çš„å‚æ•°ï¼Œå¾—åˆ°:<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>]</span><br></pre></td></tr></table></figure></p><p>è€Œå®é™…ç»“æœæ˜¯ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span>]</span><br></pre></td></tr></table></figure></p><p>åˆ›å»ºäº†äº”ä¸ªå‡½æ•°ï¼Œå®ƒä»¬å…¨éƒ½æ˜¯ <code>4</code> ä¹˜ä»¥ <code>n</code> ã€‚<br><code>Python</code> çš„é—­åŒ…æ˜¯<em>è¿Ÿç»‘å®š</em> ã€‚è¿™æ„å‘³ç€é—­åŒ…ä¸­ç”¨åˆ°çš„å˜é‡çš„å€¼æ˜¯åœ¨å†…éƒ¨å‡½æ•°è¢«è°ƒç”¨æ—¶æŸ¥è¯¢å¾—åˆ°çš„ã€‚<br>åœ¨è¿™é‡Œ, æ¯å½“è°ƒç”¨<em>ä»»ä½•</em>å‡½æ•°è¿”å›æ—¶, <code>i</code> çš„å€¼æ˜¯è°ƒç”¨æ—¶åœ¨å‘¨å›´ä½œç”¨åŸŸï¼ˆ <code>surrounding scope</code>ï¼‰ä¸­æŸ¥è¯¢åˆ°çš„ã€‚åˆ°é‚£ä¸ªæ—¶å€™ï¼Œå¾ªç¯å·²ç»å®Œæˆï¼Œ <code>i</code> çš„å€¼æœ€ç»ˆå˜æˆ <code>4</code> ã€‚<br>å…³äºè¿™ä¸ªé™·é˜±æœ‰ä¸€ä¸ªæ™®éä¸¥é‡çš„è¯¯è§£ï¼Œå®ƒå¾ˆå®¹æ˜“è¢«ç”©é”…ç»™ <code>Python</code> çš„ <a href="http://docs.python.org/reference/expressions.html#lambda" target="_blank" rel="noopener">lambda</a>è¡¨è¾¾å¼ã€‚å®é™…ä¸Šï¼Œ <code>lambda</code> è¡¨è¾¾å¼æ˜¯è¢«å†¤æ‰æ»´ã€‚æˆ‘ä»¬å°è¯•æŠŠå®ƒæ”¹å†™æˆæ™®é€šå‡½æ•°ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_func</span><span class="params">()</span>:</span></span><br><span class="line">    foo = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> n * i</span><br><span class="line">        foo.append(func)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> foo</span><br></pre></td></tr></table></figure></p><h2 id="ä¸ºäº†å®ç°ç›®æ ‡ï¼Œä½ åº”è¯¥è¿™æ ·"><a href="#ä¸ºäº†å®ç°ç›®æ ‡ï¼Œä½ åº”è¯¥è¿™æ ·" class="headerlink" title="ä¸ºäº†å®ç°ç›®æ ‡ï¼Œä½ åº”è¯¥è¿™æ ·"></a>ä¸ºäº†å®ç°ç›®æ ‡ï¼Œä½ åº”è¯¥è¿™æ ·</h2><ol><li>æœ€ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆå¯ä»¥è¯´æ˜¯æœ‰ç‚¹å–å·§ï¼ˆ <code>hack</code> ï¼‰ã€‚ç”±äº <code>Python</code> æ‹¥æœ‰åœ¨å‰æ–‡æåˆ°çš„ä¸ºå‡½æ•°é»˜è®¤å‚æ•°èµ‹å€¼çš„è¡Œä¸ºï¼ˆå‚è§ <a href="http://docs.python-guide.org/en/latest/writing/gotchas/#default-args" target="_blank" rel="noopener">å¯å˜é»˜è®¤å‚æ•°</a> ï¼‰,ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·åˆ›å»ºä¸€ä¸ªç«‹å³ç»‘å®šå‚æ•°çš„é—­åŒ…ï¼š</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_expression_hack</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">lambda</span> n, i=i: n * i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]     <span class="comment"># æ­¤å¤„ç”¨æ³•å‚è§ã€ŠPython Cookbookã€‹7.7 åŒ¿åå‡½æ•°æ•è·å˜é‡å€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([func(<span class="number">10</span>) <span class="keyword">for</span> func <span class="keyword">in</span> multi_expression_hack()])</span><br></pre></td></tr></table></figure><ol><li>æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>functools.partial</code> å‡½æ•°ï¼ˆåå‡½æ•°ï¼‰ï¼š</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [partial(mul, i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([func(<span class="number">10</span>) <span class="keyword">for</span> func <span class="keyword">in</span> partial_func()])</span><br></pre></td></tr></table></figure><ol><li>ä¼˜é›…çš„å†™æ³•ï¼Œç›´æ¥ç”¨ç”Ÿæˆå™¨æ¨å¯¼å¼ï¼š</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_expression</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">lambda</span> n: n * i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([gen(<span class="number">10</span>) <span class="keyword">for</span> gen <span class="keyword">in</span> gen_expression()])</span><br></pre></td></tr></table></figure><ol><li>åˆ©ç”¨ <code>yield</code> çš„æƒ°æ€§æ±‚å€¼æ€æƒ³ç¼–å†™ç”Ÿæˆå™¨å‡½æ•°ï¼š</li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">lambda</span> n: i * n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([gen(<span class="number">10</span>) <span class="keyword">for</span> gen <span class="keyword">in</span> gen_func()])</span><br></pre></td></tr></table></figure><h2 id="å½“é™·é˜±ä¸æ˜¯ä¸€ä¸ªé™·é˜±"><a href="#å½“é™·é˜±ä¸æ˜¯ä¸€ä¸ªé™·é˜±" class="headerlink" title="å½“é™·é˜±ä¸æ˜¯ä¸€ä¸ªé™·é˜±"></a>å½“é™·é˜±ä¸æ˜¯ä¸€ä¸ªé™·é˜±</h2><p>æœ‰æ—¶, ä½ é¢„æœŸé—­åŒ…æ˜¯è¿™æ ·çš„ï¼ˆè¿Ÿç»‘å®šçš„è¡¨ç°å½¢å¼ï¼‰ã€‚å»¶è¿Ÿç»‘å®šåœ¨å¤šæ•°æƒ…å†µä¸‹æ˜¯æ­£å¸¸çš„ã€‚ä¸å¹¸çš„æ˜¯, å¾ªç¯åˆ›å»ºç‹¬ç‰¹çš„å‡½æ•°å¯èƒ½ä¼šå¯¼è‡´æœªçŸ¥çš„å°é—®é¢˜ã€‚</p><h2 id="æ´¾æ£®å¤šä¸€ç‚¹"><a href="#æ´¾æ£®å¤šä¸€ç‚¹" class="headerlink" title="æ´¾æ£®å¤šä¸€ç‚¹"></a>æ´¾æ£®å¤šä¸€ç‚¹</h2><p>å…³äºç”Ÿæˆå™¨çš„æƒ°æ€§æ±‚å€¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ç‚¹ç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(m_num, m_gen_num)</span>:</span></span><br><span class="line">    base = gen(m_gen_num)</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(m_num):</span><br><span class="line">        base = (add(i, n) <span class="keyword">for</span> i <span class="keyword">in</span> base)</span><br><span class="line">    <span class="keyword">return</span> base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    num = <span class="number">5</span></span><br><span class="line">    gen_num = <span class="number">10</span></span><br><span class="line">    print(list(main(num, gen_num)))</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>]</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å¯¹ä¹‹å‰æ”¹å†™çš„<code>multi_func()</code>å‡½æ•°å†ç¨å¾®æ”¹å†™ä¸€ä¸‹ï¼Œè®©å†…éƒ¨å‡½æ•°ä¼ å€¼<code>*args</code>ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_func_starred</span><span class="params">()</span>:</span></span><br><span class="line">    foo = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*n)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> n * i</span><br><span class="line">        foo.append(func)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> foo</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([func(<span class="number">10</span>) <span class="keyword">for</span> func <span class="keyword">in</span> multi_func_starred()])</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>), (<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>), (<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>), (<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>), (<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>)]</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šï¼Œ<code>*args</code>ç›¸å½“äºä¸€ä¸ªç”Ÿæˆå™¨æ¨å¯¼å¼ï¼Œè¿™ç‚¹å¾ˆå®¹æ˜“éªŒè¯ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_expression_starred</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># print(type(lambda *n: n*i for i in range(5)))     # å»æ‰æ³¨é‡Š &gt;&gt;&gt;: &lt;class 'generator'&gt;</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">lambda</span> *n: n * i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print([func(<span class="number">10</span>) <span class="keyword">for</span> func <span class="keyword">in</span> multi_expression_starred()])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> å»¶è¿Ÿç»‘å®š </tag>
            
            <tag> ç”Ÿæˆå™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ç¯å¢ƒç®¡ç†ä»‹ç»</title>
      <link href="/blog/2018-01-18/python-env-introduce/"/>
      <url>/blog/2018-01-18/python-env-introduce/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>venv, pyvenv, pyenv, virtualenv, virtualenvwrapper, pipenv ç­‰å·¥å…·çš„åŒºåˆ«ä¸ä»‹ç»ã€‚<br>é¡¹ç›®å¼€å‘ä¸­å¯èƒ½éœ€è¦ç”¨åˆ°ä¸åŒç‰ˆæœ¬çš„<code>Python</code>åŠç›¸å…³çš„å¼€å‘ç¯å¢ƒã€‚æ¯”å¦‚<code>Python2</code>åŠ<code>Python3</code>ï¼Œæˆ–è€…æœ‰çš„é¡¹ç›®éœ€è¦ <code>Django1.5</code> ï¼Œæœ‰çš„éœ€è¦<code>2.0</code>ï¼Œè¿™ä¸ªæ—¶å€™å€ŸåŠ©ä¸€äº›å·¥å…·ï¼Œå¾€å¾€å¯ä»¥è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚</p><a id="more"></a><p><img src="https://farm5.staticflickr.com/4290/35294660055_42c02b2316_k_d.jpg" alt="Python"></p><h2 id="ç¬¬ä¸‰æ–¹åº“"><a href="#ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“"></a>ç¬¬ä¸‰æ–¹åº“</h2><h3 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h3><p><code>virtualenv</code>æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å·¥å…·ï¼Œä¸º<code>Python</code>åº“åˆ›å»ºç‹¬ç«‹çš„<code>Python</code>ç¯å¢ƒã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰è¿™ä¸ªå·¥å…·ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ å­¦ä¹ å®ƒï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œæˆ‘å°†åœ¨è¿™ä¸ªç­”æ¡ˆçš„å…¶ä½™éƒ¨åˆ†å¯¹æ­¤è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å®ƒé€šè¿‡åœ¨ä¸€ä¸ªç›®å½•ï¼ˆä¾‹å¦‚ï¼š<code>env/</code>ï¼‰ä¸­å®‰è£…ä¸€å †æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹<code>PATH</code>ç¯å¢ƒå˜é‡æ¥ä¸ºè‡ªå®šä¹‰<code>bin</code>ç›®å½•ï¼ˆä¾‹å¦‚ï¼š<code>env/bin/</code>ï¼‰æ·»åŠ å‰ç¼€ã€‚ <code>python</code>æˆ–<code>python3</code>äºŒè¿›åˆ¶æ–‡ä»¶çš„ç²¾ç¡®æ‹·è´ä¼šè¢«æ”¾ç½®åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œä½†<code>Python</code>è¢«ç¼–ç¨‹ä¸ºé¦–å…ˆåœ¨ç¯å¢ƒç›®å½•ä¸­æŸ¥æ‰¾ç›¸å¯¹äºå…¶è·¯å¾„çš„åº“ã€‚å®ƒä¸æ˜¯<code>Python</code>æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯è·å¾—<code>PyPA</code>ï¼ˆPython Packaging Authorityï¼‰æ­£å¼ç§°èµã€‚æ¿€æ´»ä¹‹åï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>pip</code>åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…è½¯ä»¶åŒ…ã€‚</p><h4 id="virtualenvwrapper"><a href="#virtualenvwrapper" class="headerlink" title="virtualenvwrapper"></a>virtualenvwrapper</h4><p><code>virtualenvwrapper</code>æ˜¯<code>virtualenv</code>çš„ä¸€ç»„æ‰©å±•ï¼ˆå‚è§<a href="http://virtualenvwrapper.readthedocs.io/en/latest/" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼‰ã€‚å®ƒæä¾›ä¾‹å¦‚<code>mkvirtualenv</code>ã€<code>lssitepackages</code>è¿™æ ·çš„å‘½ä»¤ï¼Œç‰¹åˆ«æ˜¯<code>workon</code>å‘½ä»¤ï¼Œå®ƒå¯ä»¥åœ¨ä¸åŒçš„<code>virtualenv</code>ç›®å½•ä¹‹é—´åˆ‡æ¢ã€‚å¦‚æœä½ æƒ³è¦å¤šä¸ª<code>virtualenv</code>ç›®å½•ï¼Œè¿™ä¸ªå·¥å…·ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="pyenv"><a href="#pyenv" class="headerlink" title="pyenv"></a>pyenv</h3><p><code>pyenv</code>æ˜¯<code>Python</code>çš„<strong>ç‰ˆæœ¬</strong>ç®¡ç†å™¨,ç”¨äºéš”ç¦»<code>Python</code>ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦é’ˆå¯¹<code>Python 2.6</code>,<code>2.7</code>,<code>3.3</code>,<code>3.4</code>å’Œ<code>3.5</code>æµ‹è¯•ä½ çš„ä»£ç ï¼Œå› æ­¤ä½ éœ€è¦åœ¨ä¸åŒ<code>Python</code>ç‰ˆæœ¬ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚ä¸€æ—¦æ¿€æ´»ï¼Œå®ƒå°±ä¼šåœ¨<code>PATH</code>ç¯å¢ƒå˜é‡å‰åŠ ä¸Š<code>~/.pyenv/shims</code>ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¸<code>Python</code>å‘½ä»¤ï¼ˆ<code>python</code>ï¼Œ<code>pip</code>ï¼‰åŒ¹é…çš„ç‰¹æ®Šæ–‡ä»¶ã€‚è¿™äº›ä¸æ˜¯<code>Python</code>æä¾›çš„å‘½ä»¤çš„å‰¯æœ¬;å®ƒä»¬æ˜¯æ ¹æ®<code>PYENV_VERSION</code>ç¯å¢ƒå˜é‡æˆ–<code>.python-version</code>æ–‡ä»¶æˆ–<code>~/.pyenv/version</code>æ–‡ä»¶å†³å®šè¿è¡Œå“ªä¸ªç‰ˆæœ¬çš„<code>Python</code>çš„ç‰¹æ®Šè„šæœ¬ã€‚ <code>pyenv</code>ä¹Ÿä½¿ä¸‹è½½å’Œå®‰è£…å¤šä¸ª<code>Python</code>ç‰ˆæœ¬çš„è¿‡ç¨‹å˜å¾—æ›´ç®€å•ï¼Œä½¿ç”¨å‘½ä»¤<code>pyenv install</code>å³å¯ã€‚</p><h4 id="pyenv-virtualenv"><a href="#pyenv-virtualenv" class="headerlink" title="pyenv-virtualenv"></a>pyenv-virtualenv</h4><p><code>pyenv-virtualenv</code>æ˜¯<code>pyenv</code>çš„ä¸€ä¸ªæ’ä»¶ï¼Œå’Œ<code>pyenv</code>ä¸€æ ·ï¼Œå…è®¸ä½ åœ¨åŒä¸€æ—¶é—´æ–¹ä¾¿åœ°ä½¿ç”¨<code>pyenv</code>å’Œ<code>virtualenv</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨<code>Python 3.3</code>æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œåˆ™<code>pyenv-virtualenv</code>ä¼šå°è¯•è¿è¡Œ<code>python -m venv</code>ï¼ˆå¦‚æœå¯ç”¨ï¼‰ï¼Œè€Œä¸æ˜¯<code>virtualenv</code>ã€‚å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ä¾¿åˆ©åŠŸèƒ½ï¼Œåˆ™å¯ä»¥æ­é…ä½¿ç”¨<code>virtualenv</code>å’Œ<code>pyenv</code>è€Œä¸ä½¿ç”¨<code>pyenv-virtualenv</code>ã€‚</p><h4 id="pyenv-virtualenvwrapper"><a href="#pyenv-virtualenvwrapper" class="headerlink" title="pyenv-virtualenvwrapper"></a>pyenv-virtualenvwrapper</h4><p><code>pyenv-virtualenvwrapper</code>æ˜¯<code>pyenv</code>çš„ä¸€ä¸ªæ’ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†<code>virtualenvwrapper</code>é›†æˆåˆ°<code>pyenv</code>ä¸­ã€‚</p><h3 id="pipenv"><a href="#pipenv" class="headerlink" title="pipenv"></a>pipenv</h3><p><code>pipenv</code>æ˜¯<code>Python</code>çš„<strong>åŒ…</strong>ç®¡ç†å™¨ã€‚ç”±<code>Kennetth Reitz</code>ï¼ˆ<code>requests</code>çš„ä½œè€…ï¼‰ç¼–å†™ç»´æŠ¤ï¼Œæ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„è¿™äº›é¡¹ç›®é‡Œé¢æœ€æ–°çš„ã€‚å®ƒçš„ç›®æ ‡æ˜¯åœ¨å‘½ä»¤è¡Œä¸­å°†<code>Pipfile</code>ã€<code>pip</code>å’Œ<code>virtualenv</code>åˆå¹¶ä¸ºä¸€ä¸ªå‘½ä»¤ã€‚</p><h2 id="æ ‡å‡†åº“"><a href="#æ ‡å‡†åº“" class="headerlink" title="æ ‡å‡†åº“"></a>æ ‡å‡†åº“</h2><h3 id="pyvenv"><a href="#pyvenv" class="headerlink" title="pyvenv"></a>pyvenv</h3><p><code>pyvenv</code>æ˜¯ä¸€ä¸ª<code>Python 3</code>é™„å¸¦çš„è„šæœ¬ï¼Œä½†åœ¨<strong>Python 3.6 ä¸­è¢«å¼ƒç”¨</strong>ï¼Œï¼ˆå‚è§<a href="https://docs.python.org/dev/whatsnew/3.6.html#id8" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼‰å› ä¸ºå®ƒæœ‰é—®é¢˜ï¼ˆæš‚ä¸”ä¸è¯´åå­—è¿˜å®¹æ˜“é€ æˆæ··æ·†ï¼‰ã€‚åœ¨<code>Python 3.6+</code>ä¸­ï¼Œå®é™…ä¸Šç­‰ä»·äºå‘½ä»¤<code>python3 -m venv</code>ã€‚</p><h3 id="venv"><a href="#venv" class="headerlink" title="venv"></a>venv</h3><p><code>venv</code>æ˜¯<code>Python 3</code>é™„å¸¦çš„ä¸€ä¸ªåŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>python3 -m venv</code>è¿è¡Œï¼ˆè™½ç„¶ç”±äºæŸäº›åŸå› ï¼Œä¸€äº›å‘è¡Œç‰ˆæŠŠå®ƒåˆ†ç¦»æˆä¸€ä¸ªå•ç‹¬çš„å‘è¡ŒåŒ…ï¼Œæ¯”å¦‚<code>Ubuntu / Debian</code>ä¸Šçš„<code>python3-venv</code>ï¼‰ã€‚å®ƒçš„ä½œç”¨ä¸<code>virtualen</code>v ç›¸ä¼¼ï¼Œå·¥ä½œæ–¹å¼ä¹Ÿéå¸¸ç›¸ä¼¼ï¼Œä½†ä¸éœ€è¦å¤åˆ¶<code>Python</code>äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ<code>Windows</code>ä¸‹é™¤å¤–ï¼‰ã€‚å¦‚æœä½ çš„ä»£ç ä¸éœ€è¦æ”¯æŒ<code>Python 2</code>ï¼Œå¯ä»¥ä½¿ç”¨å®ƒã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œ<code>Python</code>ç¤¾åŒºä¼¼ä¹å¯¹<code>virtualenv</code>æ„Ÿåˆ°æ»¡æ„ï¼Œ<code>venv</code>ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå°ä¼—ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p>1.<a href="https://stackoverflow.com/questions/41573587/what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe" target="_blank" rel="noopener">Python - What is the difference between venv, pyvenv, pyenv, virtualenv, virtualenvwrapper, pipenv, etc? - Stack Overflow</a></p><p>2.<a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/" target="_blank" rel="noopener">Pipenv &amp; Virtual Environments â€” The Hitchhikerâ€™s Guide to Python</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7 ç¯å¢ƒä¸‹é…ç½® DRBD</title>
      <link href="/blog/2018-01-11/how-to-configure-drbd-on-CentOS7/"/>
      <url>/blog/2018-01-11/how-to-configure-drbd-on-CentOS7/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ¬æ–‡ä¸»è¦è®°å½•<code>DRBD</code>çš„é…ç½®è¿‡ç¨‹å’ŒåŠŸèƒ½éªŒè¯ã€‚<br><a id="more"></a></p><p>æœ¬æ–‡ä½¿ç”¨<code>64</code>ä½<code>CentOS</code>ï¼ŒåŸºæœ¬ç¯å¢ƒï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">+-----------------------+              |               +----------------------+</span><br><span class="line">| [ DRBD_A (Server#1) ] | 10.10.17.18  |  10.10.17.19  | [DRBD_B (Server#2) ] |</span><br><span class="line">|       node01          +--------------+---------------+         node02       |</span><br><span class="line">|                       |                              |                      |</span><br><span class="line">+-----------------------+                              +----------------------+</span><br><span class="line"></span><br><span class="line">DRBD æœåŠ¡å™¨A ï¼šip:10.10.17.18ï¼Œhostnameï¼šDRBD_A</span><br><span class="line">DRBD æœåŠ¡å™¨B ï¼šip:10.10.17.19ï¼Œhostnameï¼šDRBD_B</span><br></pre></td></tr></table></figure><h2 id="å»ºç«‹ç£ç›˜åˆ†åŒº"><a href="#å»ºç«‹ç£ç›˜åˆ†åŒº" class="headerlink" title="å»ºç«‹ç£ç›˜åˆ†åŒº"></a>å»ºç«‹ç£ç›˜åˆ†åŒº</h2><ul><li>åˆ†åŒºä¹‹å‰</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@DRBD_A ~]# lsblk      # æŸ¥è¯¢å—è®¾å¤‡ä¿¡æ¯</span><br><span class="line">NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">fd0                     2:0    1    4K  0 disk</span><br><span class="line">sda                     8:0    0   16G  0 disk</span><br><span class="line">â”œâ”€sda1                  8:1    0  500M  0 part /boot</span><br><span class="line">â””â”€sda2                  8:2    0 15.5G  0 part</span><br><span class="line">  â”œâ”€centos_bogon-root 253:0    0 13.9G  0 lvm  /</span><br><span class="line">  â””â”€centos_bogon-swap 253:1    0  1.6G  0 lvm  [SWAP]</span><br><span class="line">sdb                     8:16   0    5G  0 disk</span><br><span class="line">â””â”€StorPool-SANLun10   253:2    0    2G  0 lvm</span><br><span class="line">sr0                    11:0    1 1024M  0 rom</span><br><span class="line">drbd0                 147:0    0    2G  1 disk</span><br></pre></td></tr></table></figure><ul><li>è¿›è¡Œåˆ†åŒº</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@DRBD_A ~]# fdisk /dev/sdb     # åœ¨sdbä¸Šæ–°å»ºåˆ†åŒº</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0xb25d5d26.</span><br><span class="line"></span><br><span class="line">Command (m for help): n         #  æ–°å»º</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p):</span><br><span class="line">Using default response p</span><br><span class="line">Partition number (1-4, default 1):</span><br><span class="line">First sector (2048-10485759, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-10485759, default 10485759): +1G</span><br><span class="line">Partition 1 of type Linux and of size 1 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): w         #  å†™å…¥</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure><ul><li>åˆ†åŒºä¹‹å</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@DRBD_A ~]# lsblk</span><br><span class="line">NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">fd0                     2:0    1    4K  0 disk</span><br><span class="line">sda                     8:0    0   16G  0 disk</span><br><span class="line">â”œâ”€sda1                  8:1    0  500M  0 part /boot</span><br><span class="line">â””â”€sda2                  8:2    0 15.5G  0 part</span><br><span class="line">  â”œâ”€centos_bogon-root 253:0    0 13.9G  0 lvm  /</span><br><span class="line">  â””â”€centos_bogon-swap 253:1    0  1.6G  0 lvm  [SWAP]</span><br><span class="line">sdb                     8:16   0    5G  0 disk</span><br><span class="line">â”œâ”€sdb1                  8:17   0    1G  0 part      # æ–°åˆ†åŒº</span><br><span class="line">â””â”€StorPool-SANLun10   253:2    0    2G  0 lvm</span><br><span class="line">sr0                    11:0    1 1024M  0 rom</span><br><span class="line">drbd0                 147:0    0    2G  0 disk /media</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="æ›´æ”¹-DRBD-å…¨å±€é…ç½®"><a href="#æ›´æ”¹-DRBD-å…¨å±€é…ç½®" class="headerlink" title="æ›´æ”¹ DRBD å…¨å±€é…ç½®"></a>æ›´æ”¹ DRBD å…¨å±€é…ç½®</h3><p>é¦–å…ˆæ ¹æ®éœ€æ±‚æ›´æ”¹<code>DRBD</code>å…¨å±€é…ç½®<code>/etc/drbd.d/global_common.conf</code>:</p><p>æ­¤å¤„å¯å‚é˜…å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://imoyao.github.io/blog/2017-09-11/Record_of_drbd/#global-common-confé…ç½®ï¼ˆç¤ºä¾‹ï¼‰">DRBD å…¨å±€é…ç½®</a></p><h3 id="åˆ›å»ºDRBDé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºDRBDé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºDRBDé…ç½®æ–‡ä»¶"></a>åˆ›å»º<code>DRBD</code>é…ç½®æ–‡ä»¶</h3><p>ç”±äº<code>DRBD</code>æ˜¯åŸºäºå—è®¾å¤‡çš„å­˜å‚¨å¤åˆ¶è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨<code>Lun</code>ä½œä¸ºæ¼”ç¤ºã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi r0.res</span><br><span class="line">resource r0 &#123;</span><br><span class="line">    # DRBD device</span><br><span class="line">    device /dev/drbd0;</span><br><span class="line">    # block device</span><br><span class="line">    disk /dev/StorPool/SANLun10;    # ç£ç›˜è·¯å¾„ï¼Œè‹¥ä¸ºdiskåˆ™ä¿®æ”¹ä¸º/dev/sdb1</span><br><span class="line">    meta-disk internal;</span><br><span class="line">    on DRBD_A &#123;</span><br><span class="line">        # IP address:port</span><br><span class="line">        address 10.10.17.18:7788;</span><br><span class="line">    &#125;</span><br><span class="line">    on DRBD_B &#123;</span><br><span class="line">        address 10.10.17.19:7788;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>æ³¨æ„ï¼š</code>æœ¬æœºä¸»æœºå(<code>hostname</code>)å’Œåœ°å€(<code>ip</code>)å¿…é¡»ä¸¥æ ¼æŒ‰ç…§çœŸå®æƒ…å†µé…ç½®ï¼Œä¸¤è¾¹<code>.res</code>æ–‡ä»¶å†…å®¹å°½é‡ä¿æŒä¸€è‡´ã€‚</p><p>é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆä¹‹åï¼Œåœ¨ä¸¤ä¸ªæœåŠ¡å™¨ä¸Šåˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»º<code>DRBD</code>èµ„æºï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡<code>scp</code>æŠŠé…ç½®æ–‡ä»¶æ‹·è¿‡å»ï¼Œç„¶åæ‰§è¡Œç›¸å…³å‘½ä»¤ã€‚</p><p>å…¶ä¸­ä¸Šè¿°é…ç½®æ–‡ä»¶çš„ meta-disk æœ‰ä¸‰ç§è®°å½•æ–¹å¼ï¼šinternal/device/device[index_num]ã€‚å…¶ä¸­ä¸ç®¡æ˜¯å“ªç§æ–¹å¼ï¼Œmetadata å­˜æ”¾çš„åˆ†åŒºä¸èƒ½æ ¼å¼åŒ–ï¼Œå“ªæ€•ä½¿ç”¨ internal æ—¶ metadata å’Œä¸€èˆ¬ data åœ¨åŒä¸€ä¸ªåˆ†åŒºä¹Ÿä¸èƒ½æ ¼å¼åŒ–è¯¥åˆ†åŒºã€‚</p><p>internal æ˜¯å°†å…ƒæ•°æ®ä¹Ÿå†™å…¥åˆ°æ•°æ®åˆ†åŒºçš„å°¾éƒ¨ï¼Œå³æ•°æ®å’Œå…ƒæ•°æ®åŒåˆ†åŒºã€‚å¦‚æœæŒ‡å®šçš„ device æ²¡æœ‰ç»™å®š index æ—¶ï¼Œåˆ™è¡¨ç¤ºå…ƒæ•°æ®å­˜å‚¨åˆ°è¯¥è®¾å¤‡ä¸­ã€‚å¦‚æœæŸèŠ‚ç‚¹æŒ‡å®š device[index_num]ï¼Œé‚£ä¹ˆæŒ‡å®šå‡ æ¬¡å…ƒæ•°æ®åˆ†åŒºç´¢å¼•å°±å¿…é¡»å¤§äº 128M çš„å‡ å€ï¼Œä¾‹å¦‚ä¸Šè¿°æ–‡ä»¶ä¸­ drbd1.longshuai.com èŠ‚ç‚¹æŒ‡å®šäº†/dev/sdb1[0]ï¼Œé‚£ä¹ˆ sdb1 å°±å¿…é¡»å¤§äº 128Mï¼Œå¦‚æœæ­¤æ—¶å…¶ä»–èµ„æºçš„èŠ‚ç‚¹ä¹ŸæŒ‡å®šäº†åŒä¸€å°æœåŠ¡å™¨çš„/dev/sdb1[1]ï¼Œåˆ™æŒ‡å®šäº†ä¸¤æ¬¡å°±å¿…é¡»å¤§äº 256Mã€‚æŒ‡å®šä¸º internal å’Œ device æ—¶ï¼Œå…ƒæ•°æ®åŒºçš„å¤§å°æ˜¯ drbd è‡ªè¡Œè®¡ç®—çš„ã€‚<br>ä¸Šé¢ index çš„è¯´æ³•æ¥è‡ª<a href="http://www.cnblogs.com/f-ck-need-u/p/8678883.html#1-drbd-" target="_blank" rel="noopener">è¿™é‡Œ</a>ï¼Œå…·ä½“æ²¡æœ‰å®é™…éªŒè¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm create-md r0</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨ DRBDï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm up r0</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨æµ‹è¯•æ—¶æ²¡æœ‰æ“ä½œä¸‹ä¸€æ­¥æ“ä½œï¼Œä½†æ˜¯æ•°æ®ä¹Ÿå¯ä»¥å®ŒæˆåŒæ­¥ã€‚æŸ¥è¯¢äº†ä¸€ä¸‹ï¼Œç½‘ä¸Šè¯´<code>drbdadm up</code>è¿™ä¸ªå‘½ä»¤ç›¸å½“äº<code>attach</code>ã€<code>syncer</code>ã€<code>connect</code>çš„æ€»é›†åˆã€‚ä½†æ˜¯åå°ä½¿ç”¨<code>systemctl status drbd</code>è·å–åˆ°çš„çŠ¶æ€è¿˜æ˜¯<code>inactive (dead)</code>ï¼Œæ¬¢è¿å¤§å®¶æå‡ºè‡ªå·±çš„çœ‹æ³•ã€‚</p><hr><p>åœ¨ä¸¤ä¸ªæœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨<code>DRBD</code>æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/etc/init.d/drbd start</span><br></pre></td></tr></table></figure><hr><p>æŠŠ<code>DRBD_A</code>åšä¸ºä¸»æœåŠ¡å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ— æ•°æ®æ—¶</span></span><br><span class="line">drbdadm primary r0</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ‰æ•°æ®æ—¶ï¼ŒæŠŠæœ¬ç«¯ä½œä¸ºprimaryç«¯ï¼Œæœ¬åœ°æ•°æ®åˆ†å‘åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</span></span><br><span class="line">drbdadm -- --overwrite-data-of-peer primary r0</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹<code>DRBD</code>æœåŠ¡çš„çŠ¶æ€ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/etc/init.d/drbd status</span><br><span class="line"><span class="meta">#</span><span class="bash">æˆ–è€…</span></span><br><span class="line">drbd-overview</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå†™å…¥<code>DRBD_A</code>ç«¯(<code>/dev/drbd1</code>)çš„æ•°æ®éƒ½ä¼šåŒæ­¥åˆ°<code>DRBD_B</code>ç«¯ã€‚</p><h2 id="æµ‹è¯•æ•°æ®åŒæ­¥"><a href="#æµ‹è¯•æ•°æ®åŒæ­¥" class="headerlink" title="æµ‹è¯•æ•°æ®åŒæ­¥"></a>æµ‹è¯•æ•°æ®åŒæ­¥</h2><h3 id="Primaryç«¯"><a href="#Primaryç«¯" class="headerlink" title="Primaryç«¯"></a><code>Primary</code>ç«¯</h3><ul><li>æ ¼å¼åŒ–<code>drbd</code></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkfs.xfs /dev/drbd0</span><br></pre></td></tr></table></figure><ul><li>æŒ‚è½½è®¾å¤‡</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount /dev/drbd0 /media</span><br></pre></td></tr></table></figure><ul><li>å†™å…¥æ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /media/</span><br><span class="line">mkdir drbd_test</span><br><span class="line">cd drbd_test/</span><br><span class="line">echo "hello World" &gt; hello.txt</span><br></pre></td></tr></table></figure><ul><li>å¸è½½è®¾å¤‡</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~</span><br><span class="line">umount /media</span><br></pre></td></tr></table></figure><ul><li>æœ¬ç«¯é™çº§</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm secondary r0</span><br></pre></td></tr></table></figure><h3 id="Secondaryç«¯"><a href="#Secondaryç«¯" class="headerlink" title="Secondaryç«¯"></a><code>Secondary</code>ç«¯</h3><ul><li>ä»ç«¯å‡ä¸»</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">drbdadm primary r0</span><br></pre></td></tr></table></figure><ul><li>æŒ‚è½½è®¾å¤‡</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mount /dev/drbd0 /media</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> æ­¤æ—¶ä»ç«¯ä¸éœ€è¦å†æ¬¡æ ¼å¼åŒ–ï¼Œå¦åˆ™æ•°æ®ä¸¢å¤±ã€‚</p><ul><li>éªŒè¯æ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /media</span><br><span class="line">ls</span><br><span class="line">cat ./drbd_test/hello.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿”å›</span></span><br><span class="line">hello World</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ¥æº</p><ul><li><a href="https://www.server-world.info/en/note?os=CentOS_7&amp;p=drbd&amp;f=2" target="_blank" rel="noopener">CentOS 7 : DRBD : Configure : Server World</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ä½œæ—¥å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DRBD </tag>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7 ä¸‹æºç å®‰è£… DRBD</title>
      <link href="/blog/2018-01-11/how-to-install-drbd-on-CentOS7/"/>
      <url>/blog/2018-01-11/how-to-install-drbd-on-CentOS7/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>æœ€è¿‘å¼€å‘ä¸­åˆè¦ç”¨åˆ°<code>DRBD</code>åšè¿œç¨‹å¤åˆ¶çš„åŠŸèƒ½ï¼Œç½‘ä¸Šæœåˆ°å¾ˆå¤šéƒ½æ˜¯<code>yum</code>å®‰è£…çš„åŠæ³•ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹æºç å®‰è£…çš„åŠæ³•ã€‚<br><a id="more"></a></p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl disable firewalld</span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure><h3 id="å…³é—­-SELinux"><a href="#å…³é—­-SELinux" class="headerlink" title="å…³é—­ SELinux"></a>å…³é—­ SELinux</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed -i -e "s/=enforcing/=disabled/g" /etc/selinux/config</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y update </span><br><span class="line">yum -y install gcc make automake autoconf libxslt libxslt-devel flex rpm-build wget</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> å®‰è£…<code>kernel-devel</code>ä¸€å®šè¦å’Œ<code>uname -r</code>è·å–ç»“æœä¸€è‡´ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -q kernel-devel</span><br><span class="line">uname -r</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.10.0-327.el7.x86_64</span></span><br></pre></td></tr></table></figure><p>è¿”å›çš„å†…æ ¸ç‰ˆæœ¬åº”å½“ä¸€è‡´ï¼Œå¦åˆ™å»ºè®®ç”¨æœ¬åœ°æºå®‰è£…<code>kernel-devel</code>ã€‚</p><h2 id="ä¸‹è½½-è§£å‹æºç "><a href="#ä¸‹è½½-è§£å‹æºç " class="headerlink" title="ä¸‹è½½/è§£å‹æºç "></a>ä¸‹è½½/è§£å‹æºç </h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">å®˜æ–¹åœ°å€ï¼šhttps://www.linbit.com/en/drbd-community/drbd-download/</span><br><span class="line">æ—§ç‰ˆæœ¬ï¼šhttp://www.linbit.com/en/drbd-community/old-releases/</span><br><span class="line">MOREï¼šhttp://www.linbit.com/www.linbit.com/downloads/drbd/</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> åœ¨<code>DRBD 8.4.3</code>(?)ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯¹<code>drbd</code>å’Œ<code>utils</code>åšäº†æ‹†åˆ†ï¼Œéœ€è¦åˆ†åˆ«è¿›è¡Œä¸‹è½½ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://xxx.tar.gz</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œå¦‚æœéœ€è¦ä½ ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘çš„åˆ†äº«ä¸‹è½½ç¼–è¯‘å¥½çš„<code>rpm</code>åŒ…ï¼ˆç¤ºä¾‹ç‰ˆæœ¬ï¼‰ï¼š</p><blockquote><p>é“¾æ¥:  <a href="https://pan.baidu.com/s/1huncgDI" target="_blank" rel="noopener">https://pan.baidu.com/s/1huncgDI</a>       å¯†ç :  b41i</p></blockquote><h3 id="è§£å‹ä¸‹è½½çš„ä¸¤ä¸ªtaråŒ…"><a href="#è§£å‹ä¸‹è½½çš„ä¸¤ä¸ªtaråŒ…" class="headerlink" title="è§£å‹ä¸‹è½½çš„ä¸¤ä¸ªtaråŒ…"></a>è§£å‹ä¸‹è½½çš„ä¸¤ä¸ª<code>tar</code>åŒ…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -zxvf drbd-8.*.tar.gz</span><br><span class="line">tar -zxvf drbd-utils-*.tar.gz</span><br></pre></td></tr></table></figure><h2 id="ç¼–è¯‘rpm"><a href="#ç¼–è¯‘rpm" class="headerlink" title="ç¼–è¯‘rpm"></a>ç¼–è¯‘<code>rpm</code></h2><h3 id="åˆ›å»ºæ„å»ºDRBDéœ€è¦çš„ç›®å½•"><a href="#åˆ›å»ºæ„å»ºDRBDéœ€è¦çš„ç›®å½•" class="headerlink" title="åˆ›å»ºæ„å»ºDRBDéœ€è¦çš„ç›®å½•"></a>åˆ›å»ºæ„å»º<code>DRBD</code>éœ€è¦çš„ç›®å½•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p rpmbuild/&#123;BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘DRBD"><a href="#ç¼–è¯‘DRBD" class="headerlink" title="ç¼–è¯‘DRBD"></a>ç¼–è¯‘<code>DRBD</code></h3><h4 id="åˆ¶ä½œ-rpm-åŒ…"><a href="#åˆ¶ä½œ-rpm-åŒ…" class="headerlink" title="åˆ¶ä½œ rpm åŒ…"></a>åˆ¶ä½œ <code>rpm</code> åŒ…</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd drbd-8.4.5/</span><br><span class="line">make clean</span><br><span class="line">make km-rpm KDIR=/usr/src/kernels/`uname -r`/       # å¯ç”¨å†…æ ¸æ¨¡å— è‡ªåŠ¨è¯†åˆ«å†…æ ¸ç‰ˆæœ¬    </span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿”å›ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You have now:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /root/rpmbuild/RPMS/x86_64/drbd-km-3.10.0_693.11.6.el7.x86_64-8.4.5-1.x86_64.rpm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> /root/rpmbuild/RPMS/x86_64/drbd-km-debuginfo-8.4.5-1.x86_64.rpmmakeinsta</span></span><br></pre></td></tr></table></figure><hr><h4 id="ç›´æ¥ç¼–è¯‘å®‰è£…"><a href="#ç›´æ¥ç¼–è¯‘å®‰è£…" class="headerlink" title="ç›´æ¥ç¼–è¯‘å®‰è£…"></a>ç›´æ¥ç¼–è¯‘å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># drbdæ¨¡å—</span></span></span><br><span class="line"></span><br><span class="line">cd drbd</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">lsmod|grep drbd</span><br><span class="line">cp drbd.ko /lib/modules/`uname -r`/kernel/lib/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å®‰è£…æ¨¡å—</span></span></span><br><span class="line">modprobe drbd</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># éªŒè¯drbdæ¨¡å—æ˜¯å¦åŠ è½½ï¼ˆéƒ¨åˆ†ç³»ç»Ÿé»˜è®¤æœ‰è¯¥æ¨¡å—ï¼‰</span></span></span><br><span class="line">lsmod|grep drbd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> drbd                  364858  0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> libcrc32c              12644  4 xfs,drbd,nf_nat,nf_conntrack</span></span><br></pre></td></tr></table></figure><hr><h3 id="ç¼–è¯‘-drbd-utils-ç»„ä»¶"><a href="#ç¼–è¯‘-drbd-utils-ç»„ä»¶" class="headerlink" title="ç¼–è¯‘ drbd-utils ç»„ä»¶"></a>ç¼–è¯‘ drbd-utils ç»„ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ../../drbd-utils-8.9.0/   </span><br><span class="line">./configure</span><br><span class="line">make rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿”å›ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br><span class="line">+ exit 0</span><br><span class="line">You have now:</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-km-3.10.0_693.11.6.el7.x86_64-8.4.5-1.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-km-debuginfo-8.4.5-1.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-utils-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-xen-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-udev-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-pacemaker-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-bash-completion-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line">/root/rpmbuild/RPMS/x86_64/drbd-debuginfo-8.9.0-1.el7.centos.x86_64.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##</span></span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æœ‰å¯èƒ½æç¤ºé”™è¯¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/xsltproc \</span><br><span class="line">        --xinclude \</span><br><span class="line">        http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl drbdsetup.xml</span><br><span class="line">error : Operation in progress</span><br><span class="line">warning: failed to load external entity "http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl"</span><br><span class="line">cannot parse http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl</span><br><span class="line">make[1]: *** [drbdsetup.8] Error 4</span><br></pre></td></tr></table></figure><p>æç¤ºæœ‰ä¸€ä¸ªåœ°å€æ–‡ä»¶æ²¡èƒ½æ‰¾åˆ°ï¼Œè§£å†³æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install docbook-style-xsl</span><br></pre></td></tr></table></figure><p>TODO: æ­¤å¤„æš‚æœªæ‰¾åˆ°åˆ«çš„è§£å†³æ–¹æ³•ï¼Œæ¬¢è¿è¯»è€…ç•™è¨€ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="å®‰è£…ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶"><a href="#å®‰è£…ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶" class="headerlink" title="å®‰è£…ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶"></a>å®‰è£…ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /root/rpmbuild/RPMS/x86_64/</span><br><span class="line">rpm -ivh drbd-* --force</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½æ¨¡å—ï¼ˆå‚è§åˆ†å‰²çº¿éƒ¨åˆ†ï¼‰"><a href="#åŠ è½½æ¨¡å—ï¼ˆå‚è§åˆ†å‰²çº¿éƒ¨åˆ†ï¼‰" class="headerlink" title="åŠ è½½æ¨¡å—ï¼ˆå‚è§åˆ†å‰²çº¿éƒ¨åˆ†ï¼‰"></a>åŠ è½½æ¨¡å—ï¼ˆå‚è§åˆ†å‰²çº¿éƒ¨åˆ†ï¼‰</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">modprobe drbd</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯å®‰è£…ç»“æœ"><a href="#éªŒè¯å®‰è£…ç»“æœ" class="headerlink" title="éªŒè¯å®‰è£…ç»“æœ"></a>éªŒè¯å®‰è£…ç»“æœ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lsmod|grep drbd</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿”å›ï¼ˆ`depends` å¯èƒ½ç•¥æœ‰ä¸åŒï¼‰ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> drbd                  373375  4</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> libcrc32c              12644  2 xfs,drbd</span></span><br><span class="line"></span><br><span class="line">drbd-overview  </span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»¥ä¸‹ä¸¤è€…è¿”å›ç¨æœ‰ä¸åŒ    </span></span><br><span class="line">cat /proc/drbd</span><br><span class="line">drbdadm -V</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿”å›</span></span><br><span class="line"></span><br><span class="line">DRBDADM_BUILDTAG=GIT-hash:\ 79677f4***7ca6b99929\ build\ by\ root@imoyao\,\ 2018-01-06\ 14:25:03</span><br><span class="line">DRBDADM_API_VERSION=1</span><br><span class="line">DRBD_KERNEL_VERSION_CODE=0x080405</span><br><span class="line">DRBDADM_VERSION_CODE=0x080900</span><br><span class="line">DRBDADM_VERSION=8.9.0</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><ul><li><p><a href="https://www.server-world.info/en/note?os=CentOS_7&amp;p=drbd&amp;f=1" target="_blank" rel="noopener">CentOS 7 : DRBD : Install : Server World</a></p></li><li><p><a href="http://blog.topspeedsnail.com/archives/8381" target="_blank" rel="noopener">CentOS å®‰è£…é…ç½® DRBD â€“ WTF Daily Blog</a></p></li><li><p><a href="http://www.3mu.me/centos%E4%B8%8B%E5%AE%9E%E7%8E%B0heartbeatdrbdmysql%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87%E7%A1%AC%E4%BB%B6%E6%95%85%E9%9A%9C%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2%E9%AB%98%E5%8F%AF%E7%94%A8ha/#respond" target="_blank" rel="noopener">CentOS ä¸‹å®ç° Heartbeat+DRBD+MySQL åŒæœºçƒ­å¤‡ç¡¬ä»¶æ•…éšœè‡ªåŠ¨åˆ‡æ¢é«˜å¯ç”¨(HA)æ–¹æ¡ˆ | ä¸‰æœ¨çš„äººç”Ÿâ€”â€”3mu.me</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DRBD </tag>
            
            <tag> Linux </tag>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸPyTricks | Python æŠ€å·§å†™æ³•è®°å½•</title>
      <link href="/blog/2018-01-02/pytricks-collection/"/>
      <url>/blog/2018-01-02/pytricks-collection/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å†™å‡º<code>Pythonic</code>çš„ä»£ç åº”è¯¥æ˜¯æ¯ä¸ª<code>Pythonista</code>çš„åŸºæœ¬è¿½æ±‚ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•åœ¨å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›æœ‰å…³<code>Python</code>æŠ€å·§ã€‚</p><a id="more"></a><h2 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h2><ul><li><code>JSON</code>å­—å…¸å†…æŒ‰ç…§æŸä¸ªé”®å€¼æ’åº</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: alist = [&#123;<span class="string">'create'</span>: <span class="string">'2017-12-28 11:05:48'</span>, <span class="string">'id'</span>: <span class="string">'0_1'</span>, <span class="string">'path'</span>: <span class="string">'foo.py'</span>, <span class="string">'size'</span>: <span class="number">0</span>&#125;,</span><br><span class="line">   ....:  &#123;<span class="string">'create'</span>: <span class="string">'2017-12-28 11:00:29'</span>, <span class="string">'id'</span>: <span class="string">'0_2'</span>, <span class="string">'path'</span>: <span class="string">'bar.py'</span>, <span class="string">'size'</span>: <span class="number">0</span>&#125;,</span><br><span class="line">   ....:  &#123;<span class="string">'create'</span>: <span class="string">'2017-12-28 11:05:55'</span>, <span class="string">'id'</span>: <span class="string">'0_3'</span>, <span class="string">'path'</span>: <span class="string">'baz.py'</span>, <span class="string">'size'</span>: <span class="number">0</span>&#125;]</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: alist.sort(key=<span class="keyword">lambda</span> x:x[<span class="string">'create'</span>])    <span class="comment"># æŒ‰ç…§åˆ›å»ºæ—¶é—´æ’åº </span></span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: alist</span><br><span class="line">Out[<span class="number">17</span>]:``</span><br><span class="line">[&#123;<span class="string">'create'</span>: <span class="string">'2017-12-28 11:00:29'</span>, <span class="string">'id'</span>: <span class="string">'0_2'</span>, <span class="string">'path'</span>: <span class="string">'bar.py'</span>, <span class="string">'size'</span>: <span class="number">0</span>&#125;,</span><br><span class="line"> &#123;<span class="string">'create'</span>: <span class="string">'2017-12-28 11:05:48'</span>, <span class="string">'id'</span>: <span class="string">'0_1'</span>, <span class="string">'path'</span>: <span class="string">'foo.py'</span>, <span class="string">'size'</span>: <span class="number">0</span>&#125;,</span><br><span class="line"> &#123;<span class="string">'create'</span>: <span class="string">'2017-12-28 11:05:55'</span>, <span class="string">'id'</span>: <span class="string">'0_3'</span>, <span class="string">'path'</span>: <span class="string">'baz.py'</span>, <span class="string">'size'</span>: <span class="number">0</span>&#125;]</span><br></pre></td></tr></table></figure><ul><li>å­—å…¸æ’åº</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: languages = &#123;<span class="string">'JAVA'</span>:<span class="number">15</span>,<span class="string">'Python'</span>:<span class="number">12</span>,<span class="string">'Go'</span>:<span class="number">13</span>,<span class="string">'PHP'</span>:<span class="number">14</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: sorted(languages.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">0</span>])        <span class="comment"># ä»¥keyæ’åº</span></span><br><span class="line">Out[<span class="number">35</span>]: [(<span class="string">'Go'</span>, <span class="number">13</span>), (<span class="string">'JAVA'</span>, <span class="number">15</span>), (<span class="string">'PHP'</span>, <span class="number">12</span>), (<span class="string">'Python'</span>, <span class="number">12</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">36</span>]: sorted(languages.items(),key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])        <span class="comment"># ä»¥valueæ’åº</span></span><br><span class="line">Out[<span class="number">36</span>]: [(<span class="string">'Python'</span>, <span class="number">12</span>), (<span class="string">'PHP'</span>, <span class="number">12</span>), (<span class="string">'Go'</span>, <span class="number">13</span>), (<span class="string">'JAVA'</span>, <span class="number">15</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">37</span>]: sorted(languages.items(),key=<span class="keyword">lambda</span> x:-x[<span class="number">1</span>])       <span class="comment"># ä»¥valueå€’åº</span></span><br><span class="line">Out[<span class="number">37</span>]: [(<span class="string">'JAVA'</span>, <span class="number">15</span>), (<span class="string">'Go'</span>, <span class="number">13</span>), (<span class="string">'Python'</span>, <span class="number">12</span>), (<span class="string">'PHP'</span>, <span class="number">12</span>)]</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>sort()</code>ä¸<code>sorted()</code>çš„åŒºåˆ«ï¼Œå‰è€…è¿”å›å€¼ä¸º<code>None</code>ï¼Œåè€…å¯é‡æ–°èµ‹å€¼ï¼›</p><p>å‚è€ƒé˜…è¯»</p><ul><li><a href="https://www.python.org/dev/peps/pep-0008/" target="_blank" rel="noopener">PEP 8 â€“ Style Guide for Python Code | Python.org</a></li><li><a href="https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/contents/" target="_blank" rel="noopener">Python é£æ ¼æŒ‡å— â€” Google å¼€æºé¡¹ç›®é£æ ¼æŒ‡å—</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2017 å¹´è¿‡å»äº†ï¼Œæˆ‘å¾ˆæ€€å¿µå®ƒ</title>
      <link href="/blog/2017-12-28/Annual-record-of-2017/"/>
      <url>/blog/2017-12-28/Annual-record-of-2017/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>é©¬ä¸Šæ¯•ä¸šä¸‰å¹´ï¼Œä»å‰é€”è¿·èŒ«,è‡ªæˆ‘å¦å®šåˆ°é€æ¸çœ‹åˆ°ä¸€ç‚¹åŠªåŠ›çš„æ–¹å‘ï¼Œç»™è‡ªå·±åšä¸€ä¸ªç®€å•çš„è®°å½•è¿˜æ˜¯å¿…è¦çš„ã€‚</p><a id="more"></a><p>å¹´åˆï¼Œå…¥èŒä¸€å®¶åŒ—å¤§æ•°å­¦ç³»æŸç ”ç©¶ç”Ÿåˆ›åŠçš„å†œä¸šç§‘æŠ€å…¬å¸ã€‚ç¬¬ä¸€æ¬¡çœ‹åˆ°æ‰€è°“çš„åˆ›ä¸šå…¬å¸æ‹¿ç€é«˜æ ¡åŠå…¬è®¡ç®—æœºå½“ä½œè‡ªå·±åŠå…¬ç”¨å“ä½¿ç”¨ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡çœ‹è§å‡Œæ™¨ä¸¤ç‚¹é’Ÿçš„åŒ—äº¬ã€‚ä¹Ÿæ›¾æ¢¦æƒ³è·Ÿç€è‡ªå¸¦å…‰èŠ’çš„äººå¹²ä¸€ç•ªå¤§äº‹ä¸šï¼Œå´ä¸æ–™åœ¨çŸ­æš‚çš„æ—¶é—´ä¹‹åå°±è¢«å¹²æ‰ã€‚æŠ›å¼€å¥³è€æ¿ä¸æ‡‚æŠ€æœ¯ã€æ²¡æŠ€æœ¯å¤§ç‰›å¸¦ã€æŠ€æœ¯å›¢é˜Ÿå°±ä¸€è‰å°ç­å­ï¼Œå½’æ ¹ç»“åº•è¿˜å¾—æ€ªè‡ªå·±æ‰‹è‰ºä¸ç²¾ã€‚æ‰€ä»¥è¿‡å¹´å›å®¶é‚£æ®µæ—¶é—´ä¸€ç›´æŒºå¤±è½çš„ï¼Œæ•´ä¸ªäººå¯ä»¥è¯´æ˜¯ç›¸å½“ã€Œæ„äº‘æƒ¨æ·¡ä¸‡é‡Œå‡ã€äº†ã€‚å¹¸å¥½è¿˜æœ‰é«˜ä¸­çš„å¥³åŒå­¦ Y çš„æš–å¿ƒå®‰æ…°ï¼Œæ‰ä¸è‡³äºå¯¹ç”Ÿæ´»å¤±å»ä¿¡å¿ƒã€‚å›å¿†è¿‡å¾€ï¼Œå†…å¿ƒæ³ªæµæ»¡é¢çš„åŒæ—¶å¯¹æœ‹å‹ä»¬çš„é¼“åŠ±è¡¨ç¤ºé»˜é»˜æ„Ÿè°¢ã€‚</p><p>è¿‡å¹´æ¥è¿˜ç®—é¡ºåˆ©ï¼Œåœ¨ç»è¿‡æ¼«é•¿è€ŒçŸ­æš‚çš„å·®ä¸å¤šåŠä¸ªæœˆé¢è¯•ä¹‹åç»ˆäºè¿›å…¥ç°åœ¨çš„å…¬å¸ã€‚å¯¹äºä¸€ä¸ªæ²¡æœ‰å·¥ä½œçš„äººï¼Œå¯ä»¥è¯´æ¯ä¸€å¤©éƒ½å¾ˆç…ç†¬ï¼Œè€Œä¸”é¢è¯•ä¸­å¸¦æ¥çš„æŒ«è´¥æ„Ÿä¼šé€æ¸è®©äººå¯¹è‡ªå·±ä¸§å¤±ä¿¡å¿ƒã€‚åº†å¹¸çš„æ˜¯ï¼ŒæŸ³æš—èŠ±æ˜ä¹‹åï¼Œç»ˆäºæ”¶åˆ°ä¸‰ä»½<code>Offer</code>ï¼Œæœ¬ç€å‘é’±çœ‹é½çš„æŒ‡å¯¼æ–¹é’ˆé€‰æ‹©äº†ç°åœ¨çš„å…¬å¸ã€‚è™½ç„¶è°ˆä¸ä¸Šå¤šå¥½ï¼Œä½†æ˜¯å¿«é¥¿æ­»çš„äººæ˜¯æ²¡æœ‰èµ„æ ¼æŒ‘é£Ÿçš„ï¼Œæœ€é‡è¦è¿˜æ˜¯å…ˆå…»æ´»è‡ªå·±ã€‚</p><p>å›é¡¾åœ¨æ–°å…¬å¸çš„è¿‘ä¸€å¹´æ—¶é—´ï¼Œä»å¼€å§‹çš„ä»€ä¹ˆä¸¤çœ¼ä¸€æŠ¹é»‘åˆ°ç°åœ¨å¯ä»¥å®ç°æ–°å¢åŠŸèƒ½çš„ç‹¬ç«‹å®Œæˆï¼Œéš¾å…å”å˜˜ã€‚å½“ç„¶ï¼Œä¹Ÿæš´éœ²å‡ºè‡ªå·±åœ¨æŠ€æœ¯æ–¹é¢çš„æ¬ ç¼ºï¼šå‰ç«¯<code>JavaScript</code>æœ‰æ—¶éœ€è¦åŒäº‹å¸®åŠ©æ‰å¯ä»¥æå®šï¼Œå¯¹<code>Python</code>ä¸­çš„ç³»ç»Ÿç¼–ç¨‹äº†è§£ä¸å¤Ÿæ·±å…¥ï¼Œç›®å‰é™·å…¥ä¸€ç§å›°éš¾çš„æä¸å®šï¼Œç®€å•çš„åˆä¸å±‘åšçš„å°´å°¬å¢ƒåœ°ã€‚åªèƒ½é€è‡ªå·±ä¸€å¥é©å‘½ä»æœªæˆåŠŸï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ã€‚</p><p>äº†è§£ä¸€ä¸ªäººæœ€å¿«çš„æ–¹å¼æ˜¯ï¼šå’Œä¸€ä¸ªç”·æ€§å‘ç”Ÿé‡‘é’±å…³ç³»ï¼Œå’Œä¸€ä¸ªå¥³æ€§å‘ç”Ÿè‚‰ä½“å…³ç³»ã€‚å¼‚æ€§é—´çš„è‚‰ä½“å…³ç³»è¿‘æœŸæˆ‘å¤šåŠæ˜¯ä¸åŠè§äº†ï¼Œå€’æ˜¯å¯ä»¥èŠèŠä»Šå¹´å’Œåˆ«äººä¹‹é—´é’±çš„é—®é¢˜ã€‚å¤§æ¦‚æ˜¯ 6 æœˆçš„æ—¶å€™ï¼ŒæŸå¤§å­¦åŒå­¦è”ç³»æˆ‘è¯´å’Œå®¤å‹åˆç§Ÿä½ä¸ä¸‹å»äº†ï¼Œé—®æˆ‘æ˜¯å¦èƒ½å¤Ÿå‡‘åˆä¸€ä¸‹ï¼Œç§Ÿé‡‘å‡æ‘Šã€‚è™½ç„¶æˆ‘ä¹ æƒ¯ç‹¬å±…ï¼Œä½†æ˜¯è€ƒè™‘åˆ°åº”è¯¥ä¹Ÿä¸ä¼šå¤ªä¹…å°±åŒæ„äº†ã€‚åæ¥ä½åˆ°ä¸€å—æ‰çŸ¥é“æ˜¯å› ä¸ºä»–æ™šä¸Šæ•´å®¿ç£¨ç‰™è¢«å®¤å‹èµ¶å‡ºæ¥äº†ã€‚ä½äº†ä¸åˆ°ä¸¤ä¸ªæœˆä»–æ‰¾åˆ°æˆ¿å­è¯´è¦æ¬èµ°ï¼Œæˆ¿é’±å¤§æ¦‚ç®—äº† <code>1000</code> å¤šç‚¹ï¼Œç»“æœç»™æˆ‘æ¥äº†å¥ã€Œèƒ½ä¸èƒ½æŠ¹ä¸ªé›¶ï¼Œå°±å½“è¯·æˆ‘æŠ½åŒ…çƒŸï¼Ÿã€æˆ‘è„¸ä¸Šç¬‘å˜»å˜»ï¼Œå¿ƒé‡Œ<code>MMP</code>åœ°æ‹’ç»äº†ä»–ã€‚åˆšå¥½ä»–é‚£æ—¶æ‰æ‰¾åˆ°å·¥ä½œï¼Œäºæ˜¯åˆè¯´å®½é™ä»–åå¤šå¤©ï¼Œæœˆåˆå‘å·¥èµ„å°±è¿˜æˆ‘ã€‚åˆ°äº†æœˆåˆï¼Œæˆ‘ä»¥ä¸ºæ˜¯å¿˜äº†ï¼Œ10 å·å·¦å³è¦çš„æ—¶å€™è¯´èŠ±å…‰äº†ï¼Œä¸‹ä¸ªæœˆå§ã€‚ä¸‹ä¸ªæœˆå†è¦ï¼Œåˆè¯´ä»€ä¹ˆçˆ·çˆ·å»ä¸–ï¼Œé’±éƒ½ç”¨æ¥æ–™ç†åäº‹äº†ï¼Œäº‹æƒ…å¤„ç†å®Œå›å»æƒ³åŠæ³•ã€‚åˆ°äº†æœˆåº•ï¼Œæˆ‘ä¹Ÿæ²¡ç­‰åˆ°å…¶æƒ³åˆ°çš„åŠæ³•ã€‚ç”µå½±é‡Œé¢è¯´ã€Œæˆå¹´äººçš„å´©æºƒéƒ½æ˜¯ä»å€Ÿé’±å¼€å§‹çš„ã€ï¼Œè€Œæˆ‘è¦è¯´æˆå¹´äººçš„å´©æºƒéƒ½æ˜¯ä»è¦é’±å¼€å§‹çš„ã€‚ä¸€ä¸ªæœˆè–ª 13K çš„æ¬ åˆ«äºº 1.3K è¿˜è¦æ‹–é‚£ä¹ˆä¹…ï¼Œæœ€ååˆ°äº† 10 æœˆå‘å·¥èµ„æ‰ç»™æˆ‘ã€‚æˆ‘çš„å†…å¿ƒåªèƒ½å“èµ·æ¢æœä¼Ÿçš„é‚£å¥ã€Œæ˜æ˜è¯´å¥½ä¸‰å¹´ï¼Œä¸‰å¹´ä¹‹ååˆä¸‰å¹´ï¼Œä¸‰å¹´ä¹‹ååˆä¸‰å¹´ï¼Œéƒ½å¿«åå¹´äº†è€å¤§ï¼ã€å½“ç„¶è¿™è¿˜ä¸æ˜¯æœ€å¥‡è‘©çš„ï¼Œæœ€å¥‡è‘©çš„æ˜¯è¿˜é’±ä¹‹åï¼Œå±…ç„¶ä¸è”ç³»æˆ‘äº†ã€‚æˆ‘æƒ³ï¼Œå¤§æŠµæ˜¯å› ä¸ºæˆ‘è¿ 1000 å—é’±éƒ½è¦å¾—ç½ªäººå®¶äº†å§ï¼Ÿæ¯•ç«Ÿï¼Œäººå®¶å¯èƒ½ä»æ¥æ²¡æƒ³ç€ä½åŒå­¦ç§Ÿçš„æˆ¿å­è¿˜è¦ç»™é’±ã€‚å…¶å®ï¼Œæˆ‘æƒ³é—®ä¸€å¥ã€Œå“ï¼Œ<strong>æ¬å®¶æ—¶è¯´å¥½äº¬ä¸œä¸‹å•ä¹‹åå°±è¿˜æˆ‘çš„é¼ æ ‡ç”¨åäº†æ²¡å‘€</strong>ï¼Ÿã€</p><p>å†ä¸€ä¸ªå°±æ˜¯ä»Šå¹´çˆ¶æ¯å¼€å§‹æ—¶ä¸æ—¶æš—ç¤ºè¯¥æ‰¾ä¸ªå¥³æœ‹å‹äº†ï¼Œå®¶äººçš„å…³å¿ƒä¹Ÿä¸æ— é“ç†ï¼Œæ²¡æœ‰ç»„ç»‡å…³å¿ƒçš„äººæ˜¯å¾—æå‰è€ƒè™‘è‡ªå·±çš„ä¸ªäººé—®é¢˜ã€‚éš¾å ªçš„æ˜¯è™½ç„¶æˆ‘æœ¬äººè‡ªè§‰å¥³ç”Ÿç¼˜ä¸é”™ï¼Œä½†æ˜¯å¯èƒ½å¥³äººç¼˜å®åœ¨æ˜¯å·®äº†ç‚¹ï¼Œè‡ªä» 14 å¹´å’Œå‰å¥³å‹åˆ†æ‰‹ä¹‹åï¼Œè‡³ä»Šè¿˜å±äºæ¼«é•¿çš„ç©ºçª—æœŸã€‚è€Œåœ¨è¿™ä¸ªç‹¼å¤šè‚‰å°‘çš„æ—¶ä»£ï¼Œé¡¹ç›®ç»„ä¸­çš„èƒ½å¤Ÿæ¿€å‘ä¸¤æ€§æƒ…æ„Ÿçš„å¦¹å­ä»¬éƒ½æ—©æ—©åœ°è¢«åˆ«äººæ·è¶³å…ˆç™»äº†ã€‚ä»ä¸ªäººå±‚é¢æ¥è¯´å€’ä¹Ÿä¸æ˜¯ç€æ€¥ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªéã€Œä¸å©šæ—ã€ä¸ªä½“ï¼Œè¿™ä¸ªé—®é¢˜æˆ–è®¸æ˜¯å¾—è®¤çœŸè€ƒè™‘ä¸€ä¸‹å•¦ã€‚</p><p>è¿˜æœ‰æœ€è¿‘æœ‰ä»¶æ¯”è¾ƒå›°æ‰°æˆ‘çš„äº‹ï¼Œå› ä¸ºæˆ‘æåº¦ä¸å–œæ¬¢è¿åŠ¨ï¼Œæ‰€ä»¥ä¸€å¹´æ¥ä½“é‡æé€Ÿé£™å‡ï¼Œè¿™çœŸæ˜¯ä¸€ä»¶æ®‹é…·è€Œå±é™©çš„äº‹æƒ…ï¼Œå¸Œæœ›èƒ½å¤Ÿå…‹æœå›°éš¾ï¼Œé€šè¿‡èŠ‚é£ŸåŠ é”»ç‚¼æ§åˆ¶åœ¨å¯æ¥å—çš„èŒƒå›´ä¹‹å†…ã€‚</p><p><img src="/images/letter-from-PanXiao.jpg" alt="æ½˜æ™“æ¥ä¿¡"></p><center><a href="https://finance.sina.com.cn/roll/2019-02-12/doc-ihrfqzka5080346.shtml" target="_blank" rel="noopener">æ½˜æ™“æ¥ä¿¡</a></center><p>æ¯ä¸ªæ—¶ä»£ï¼Œä¸ªä½“éƒ½æœ‰å„è‡ªçš„æ— å¥ˆå’Œè‹¦éš¾ã€‚è£¹æŒŸåœ¨è¥¿äºŒæ——æ—©é«˜å³°äººæµä¸­æ„æ°”é£å‘çš„å°‘å¹´è¢«å²æœˆæ—©æ—©åœ°ç›˜å‡ºäº†æ²¹è…»çš„åŒ…æµ†ï¼›å›ä¸å»çš„å®¶ä¹¡å’Œè§¦ä¸åˆ°çš„æ¢¦æƒ³å¦‚çƒ§çº¢çš„é“æ¿çš„åè¦†ç…ç†¬ç€èº«å¿ƒï¼›é«˜ä¸å¯æ”€çš„æˆ¿ä»·å’Œæ—¥ç›Šå¹´è¿ˆçš„çˆ¶æ¯ä¹Ÿå¼€å§‹å¾€äººçš„è‚©è†€ä¸Šå¢æ·»é‡é‡æ„Ÿã€‚äººç”Ÿçš„è·¯å‘µï¼Œæ€ä¹ˆè¶Šèµ°è¶Šçª„â€¦â€¦</p><p>å½“ç„¶ï¼Œå¹³å¿ƒè€Œè®ºè§‰å¾—è‡ªå·±è¿˜æ˜¯å¾ˆå¹¸è¿çš„ã€‚åœ¨çˆ¶æ¯çš„ç»æµæ”¯æŒä¸‹æ¥åˆ°è¿™è¾¹ç«™ä½è„šï¼Œèµ·ç åˆ°åŒ—äº¬ä¹‹åçš„æ—¥å­é‡Œï¼Œç»“ä½™å¤šè¿‡ä¹‹å‰çš„å·¥èµ„ï¼Œè€Œä¸”ä¹Ÿä¸å†åƒä¹‹å‰åšæ²¡æœ‰æŠ€æœ¯å«é‡çš„å‘å¾®æ´»è®¡ã€‚å¯¹è¿™ä»½å·¥ä½œè°ˆä¸ä¸Šçƒ­çˆ±ï¼Œä¹Ÿæ²¡æœ‰æ”¹å˜ä¸–ç•Œçš„å‹‡æ°”å’Œèƒ½åŠ›ï¼Œç›®å‰åªå¸Œæœ›å°½åŠ›åšå¥½æœ¬èŒå·¥ä½œå§ã€‚</p><p>ç¹åä¸–ç•Œï¼Œä¸æ•¢çˆ±æ…•ï¼Œä¸æ•¢æ†§æ†¬ï¼Œä¸çŸ¥ä¸è§‰åœ¨å¼€å¿ƒæ—¶ä¹Ÿå°å¿ƒç¿¼ç¿¼ã€‚æ„çŠ¹æœªå°½ï¼Œè§å¥½å°±æ”¶ã€‚</p><p>çµ®çµ®å¨å¨å†™äº†è¿™ä¹ˆäº›ï¼Œå‘ç°ä¹Ÿæ²¡å•¥é‡ç‚¹å¯ä»¥çªå‡ºä¸€ä¸‹ï¼Œçœ‹æ¥é£è¯é€ å¥èƒ½åŠ›é€€åŒ–ä¸å°‘ã€‚è¡Œå§ï¼Œæˆ‘æ»¡æ–Ÿçƒˆé…’ï¼šä¸€æ¯æ•¬æ˜å¤©ï¼Œä¸€æ¯æ•¬è¿‡å¾€ï¼Œç»™æ‰€æœ‰<a href="http://www.juzimi.com/ju/3766577" target="_blank" rel="noopener">åƒæˆ‘è¿™æ ·çš„äºº</a>ã€‚</p><blockquote><p>åƒæˆ‘è¿™æ ·ä¼˜ç§€çš„äºº<br>æœ¬è¯¥ç¿çƒ‚è¿‡ä¸€ç”Ÿ<br>æ€ä¹ˆäºŒåå¤šå¹´åˆ°å¤´æ¥<br>è¿˜åœ¨äººæµ·é‡Œæµ®æ²‰    </p><p>åƒæˆ‘è¿™æ ·èªæ˜çš„äºº<br>æ—©å°±å‘Šåˆ«äº†å•çº¯<br>æ€ä¹ˆè¿˜æ˜¯ç”¨äº†ä¸€æ®µæƒ…<br>å»æ¢ä¸€èº«ä¼¤ç—•   </p><p>åƒæˆ‘è¿™æ ·è¿·èŒ«çš„äºº<br>åƒæˆ‘è¿™æ ·å¯»æ‰¾çš„äºº<br>åƒæˆ‘è¿™æ ·ç¢Œç¢Œæ— ä¸ºçš„äºº<br>ä½ è¿˜è§è¿‡å¤šå°‘äºº<br>åƒæˆ‘è¿™æ ·åº¸ä¿—çš„äºº  </p><p>åƒæˆ‘è¿™æ ·æ‡¦å¼±çš„äºº<br>å‡¡äº‹éƒ½è¦ç•™å‡ åˆ†<br>æ€ä¹ˆæ›¾ç»ä¹Ÿä¼šä¸ºäº†è°<br>æƒ³è¿‡å¥‹ä¸é¡¾èº«   </p><p>ä½ è¿˜è§è¿‡å¤šå°‘äºº<br>åƒæˆ‘è¿™æ ·å­¤å•çš„äºº<br>åƒæˆ‘è¿™æ ·å‚»çš„äºº<br>åƒæˆ‘è¿™æ ·ä¸ç”˜å¹³å‡¡çš„äºº<br>åƒæˆ‘è¿™æ ·è«åå…¶å¦™çš„äºº   </p></blockquote><div align="right"> <font size="2">ä»¥ä¸Šæ–‡å­—å¼•ç”¨ç•¥æœ‰åˆ æ”¹ </font> </div>]]></content>
      
      
      <categories>
          
          <category> ä¸ªäººæ—¥è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Diary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Storcli å¸¸ç”¨ç®¡ç†å‘½ä»¤æ±‡æ€»</title>
      <link href="/blog/2017-12-27/storcli-command-share/"/>
      <url>/blog/2017-12-27/storcli-command-share/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>ç›®å‰<code>LSI RAID</code>å¡ä½¿ç”¨çš„é…ç½®å·¥å…·ä¸»è¦æœ‰ï¼š<code>Megaraid Storage Manager</code>ï¼ˆMSMï¼Œå›¾å½¢ç¯å¢ƒï¼‰ã€<code>MegaCLI</code>ï¼ˆå­—ç¬¦ç•Œé¢ï¼‰ã€<code>StorCLI</code>ï¼ˆå­—ç¬¦ç•Œé¢ï¼‰ã€‚å…¶ä¸­<code>StorCLI</code>ä½œä¸º<code>MegaCLI</code>åç»§è€…æ•´åˆäº†<code>LSI</code>å’ŒåŸæ¥<code>3ware</code>çš„äº§å“æ”¯æŒï¼Œå…¼å®¹<code>MegaCLI</code>å‘½ä»¤çš„åŒæ—¶æ›´åŠ ç®€æ´ã€‚<a href="https://imoyao.github.io/blog/2017-11-20/megacli_command_share/">å‰é¢çš„æ–‡ç« </a>è®°å½•äº†<code>MegaCli</code>å¸¸ç”¨ç®¡ç†å‘½ä»¤ï¼Œæœ¬ç¯‡ä¸»è¦è®°å½•<code>StorCLI</code>çš„ä½¿ç”¨ã€‚</p><a id="more"></a><h2 id="å®‰è£…Storcli"><a href="#å®‰è£…Storcli" class="headerlink" title="å®‰è£…Storcli"></a>å®‰è£…<code>Storcli</code></h2><h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unzip ul_avago_storcli_1.18.11_anyos.zip</span><br><span class="line">dpkg -i storcli_all_os/Ubuntu/storcli_1.18.11_all.deb</span><br><span class="line">dpkg -l | grep -i storcli</span><br></pre></td></tr></table></figure><h3 id="Centos"><a href="#Centos" class="headerlink" title="Centos"></a>Centos</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unzip ul_avago_storcli_1.18.11_anyos.zip</span><br><span class="line">rpm -ivh storcli_all_os/Linux/storcli-1.18.11-1.noarch.rpm</span><br><span class="line">rpm -qi storcli</span><br><span class="line">ln -s /opt/MegaRAID/storcli/storcli64 /usr/local/bin/storcli</span><br></pre></td></tr></table></figure><h3 id="ESXi-5-5-amp-ESXi-6-0"><a href="#ESXi-5-5-amp-ESXi-6-0" class="headerlink" title="ESXi 5.5 &amp; ESXi 6.0"></a>ESXi 5.5 &amp; ESXi 6.0</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unzip ul_avago_storcli_1.18.11_anyos.zip</span><br><span class="line">esxcli software vib install -v=vmware-esx-storcli-1.21.06.vib --no-sig-check</span><br><span class="line">ln -s /opt/lsi/storcli/storcli /sbin/storcli</span><br><span class="line">storcli -V</span><br></pre></td></tr></table></figure><h2 id="storcliä½¿ç”¨"><a href="#storcliä½¿ç”¨" class="headerlink" title="storcliä½¿ç”¨"></a><code>storcli</code>ä½¿ç”¨</h2><p>ä¸“æœ‰åè¯è§£é‡Šï¼š</p><p><code>/cx, /vx</code> è¡¨ç¤º <code>Controller/Virtual Drive Number</code>.</p><p><code>/ex, /sx</code>è¡¨ç¤º <code>Enclosure/Slot ID</code>.</p><p><code>VD</code>è¡¨ç¤º <code>Virtual Drive</code>.</p><p>è¦è¾“å‡º<code>json</code>æ ¼å¼çš„è¿”å›,åœ¨å‘½ä»¤è¡Œæœ€åæ·»åŠ <code>J</code>.</p><ul><li>å›ºä»¶å‡çº§</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx download file=/path/to/firmware.rom</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æ§åˆ¶å™¨å’Œé…ç½®ä¿¡æ¯</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx show all</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ¿€æ´»ç æ¿€æ´»ç‰¹æ€§(å¦‚ CacheCade, FastPath,â€¦)</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx set aso key=AAAAAAAABBBBBBBBCCCCCCCC</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç°æœ‰ç¡¬ç›˜åŠå…¶çŠ¶æ€çš„ä¿¡æ¯ (IDs,â€¦)</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /eall /sall show (all)</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Controller = 0</span><br><span class="line">Status = Success</span><br><span class="line">Description = Show Drive Information Succeeded.</span><br><span class="line"></span><br><span class="line">Drive Information :</span><br><span class="line">=================</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">EID:Slt DID State DG     Size Intf Med SED PI SeSz Model                  Sp</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line">252:0     1 Onln   1 3.637 TB SATA HDD N   N  512B WDC WD4000FYYZ-03UL1B3 U</span><br><span class="line">252:1     3 Onln   1 3.637 TB SATA HDD N   N  512B WDC WD4000FYYZ-03UL1B3 U</span><br><span class="line">......</span><br><span class="line">252:6    85 Onln   0 3.637 TB SATA HDD N   N  512B WDC WD4000FYYZ-03UL1B3 U</span><br><span class="line">252:7     2 UGood  - 3.637 TB SATA HDD N   N  512B WDC WD4000FYYZ-03UL1B3 D</span><br><span class="line">-----------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EID-Enclosure Device ID|Slt-Slot No.|DID-Device ID|DG-DriveGroup</span><br><span class="line">DHS-Dedicated Hot Spare|UGood-Unconfigured Good|GHS-Global Hotspare</span><br><span class="line">UBad-Unconfigured Bad|Onln-Online|Offln-Offline|Intf-Interface</span><br><span class="line">Med-Media Type|SED-Self Encryptive Drive|PI-Protection Info</span><br><span class="line">SeSz-Sector Size|Sp-Spun|U-Up|D-Down|T-Transition|F-Foreign</span><br><span class="line">UGUnsp-Unsupported|UGShld-UnConfigured shielded|HSPShld-Hotspare shielded</span><br><span class="line">CFShld-Configured shielded|Cpybck-CopyBack|CBShld-Copyback Shielded</span><br></pre></td></tr></table></figure><ul><li>ç°æœ‰è™šæ‹Ÿç¡¬ç›˜åŠå…¶çŠ¶æ€çš„ä¿¡æ¯</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /vall show (all)</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å½“å‰æ‰€æœ‰é‡å»ºçš„çŠ¶æ€</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /eall /sall show rebuild</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»º-åˆå§‹åŒ–-raid"><a href="#åˆ›å»º-åˆå§‹åŒ–-raid" class="headerlink" title="åˆ›å»º/åˆå§‹åŒ– raid"></a>åˆ›å»º/åˆå§‹åŒ– <code>raid</code></h2><ul><li><code>shell</code>åˆ›å»º<code>VD</code></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx add vd type=[RAID0(r0)|RAID1(r1)|...] drives=[EnclosureID:SlotID|:SlotID-SlotID|:SlotID,SlotID]</span><br><span class="line"><span class="meta">#</span><span class="bash">more</span></span><br><span class="line">storcli /cx add vd type=raid[0|1|5|6|00|10|50|60(r0|r1|...)] [Size=&lt;VD1_Sz&gt;,&lt;VD2_Sz&gt;,..|all] [name=&lt;VDNAME1&gt;,..] drives=e:s|e:s-x,y;e:s-x,y,z [PDperArray=x] [SED] [pdcache=on|off|default] [pi] [DimmerSwitch(ds)=default|automatic(auto)|none|maximum(max)|MaximumWithoutCaching(maxnocache)] [wt|wb] [nora|ra] [direct|cached] [CachedBadBBU|NoCachedBadBBU][cachevd] [Strip=&lt;8|16|32|64|128|256|1024&gt;] [AfterVd=X] [Spares = [e:]s|[e:]s-x|[e:]s-x,y] [force][ExclusiveAccess]</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ç¡¬ç›˜0-2åˆ›å»ºraid1</span></span><br><span class="line">storcli /cx add vd type=r1 drives=252:0-2</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»º raid5,write-bakc,<span class="built_in">read</span>-ahead</span></span><br><span class="line">storcli /cx add vd type=raid5  size=all names=VD1 drives=32:2-7 wb ra</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»º raid10/50/60,å¿…é¡»è®¾å®šPDperArrayå‚æ•°,write-bakc,<span class="built_in">read</span>-ahead</span></span><br><span class="line">storcli /cx add vd type=raid10 size=all names=VD1 drives=32:2-7 PDperArray=2 wb ra</span><br></pre></td></tr></table></figure><ul><li><code>shell</code>ä¹‹åˆå§‹åŒ–<code>VD</code></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">storcli /cx/vx start init (force)</span><br></pre></td></tr></table></figure><ul><li>ç›‘è§†åˆå§‹åŒ–è¿›åº¦</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx/vx show init</span><br></pre></td></tr></table></figure><ul><li><code>shell</code>ä¹‹ç§»é™¤<code>VD</code></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx/vx del (force)</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜åŠ é€Ÿ"><a href="#ç¼“å­˜åŠ é€Ÿ" class="headerlink" title="ç¼“å­˜åŠ é€Ÿ"></a>ç¼“å­˜åŠ é€Ÿ</h2><ul><li><code>shell</code>ä¹‹åˆ›å»º<code>CacheCade</code>è®¾å¤‡ï¼ˆSSD ç¼“å­˜åŠ é€Ÿï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx add vd cc type=r[0,1,10] drives=[EnclosureID:SlotID|:SlotID-SlotID|:SlotID,SlotID]  WT|WB (assignvds=0,1,2)</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /c0 add vd cc type=r1 drives=252:2-3 WB</span><br></pre></td></tr></table></figure><ul><li><code>shell</code>ä¹‹<code>CacheCade</code>æ¿€æ´»/åœç”¨</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx/[vx|vall] set ssdCaching=[on|off]</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /c0/v1 set ssdCaching=on</span><br></pre></td></tr></table></figure><ul><li><code>shell</code>ä¹‹ç§»é™¤<code>CacheCade</code></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx/vx del cc</span><br></pre></td></tr></table></figure><h2 id="è¯¯æ’æ‹”è®¾å¤‡åˆå¹¶"><a href="#è¯¯æ’æ‹”è®¾å¤‡åˆå¹¶" class="headerlink" title="è¯¯æ’æ‹”è®¾å¤‡åˆå¹¶"></a>è¯¯æ’æ‹”è®¾å¤‡åˆå¹¶</h2><p>å¦‚æœä¸æ­£ç¡®åœ°ç§»é™¤è®¾å¤‡å¹¶é‡æ–°è¿æ¥åˆ° RAID æ§åˆ¶å™¨ï¼Œå®ƒå°†è¢«è¯†åˆ«ä¸º UBAD(Unconfigured Bad)ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /c0 /eall /sall show</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„è¿”å›ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Controller = 0</span><br><span class="line">Status = Success</span><br><span class="line">Description = Show Drive Information Succeeded.</span><br><span class="line"></span><br><span class="line">Drive Information :</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">EID:Slt DID State DG       Size Intf Med SED PI SeSz Model                  Sp </span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">252:0     7 Onln   0  465.25 GB SATA HDD N   N  512B WDC WD5003ABYX-01WERA1 U  </span><br><span class="line">252:1     6 Onln   1  465.25 GB SATA HDD N   N  512B WDC WD5003ABYX-01WERA1 U  </span><br><span class="line">252:2     5 UGood  -  465.25 GB SATA HDD N   N  512B WDC WD5003ABYX-01WERA1 U  </span><br><span class="line">252:3     4 UBad   - 223.062 GB SATA SSD N   N  512B INTEL SSDSC2CW240A3    U  </span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>252:3</code>å¿…éœ€ç½®ä¸º<code>UGOOD</code></p><ul><li><code>UBad</code>ç½®ä¸º<code>UGOOD</code></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /ex /sx set good</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Controller = 0</span><br><span class="line">Status = Success</span><br><span class="line">Description = Show Drive Information Succeeded.</span><br><span class="line"></span><br><span class="line">Drive Information :</span><br><span class="line">=================</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">EID:Slt DID State DG       Size Intf Med SED PI SeSz Model                  Sp </span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">252:0     7 Onln   0  465.25 GB SATA HDD N   N  512B WDC WD5003ABYX-01WERA1 U  </span><br><span class="line">252:1     6 Onln   1  465.25 GB SATA HDD N   N  512B WDC WD5003ABYX-01WERA1 U  </span><br><span class="line">252:2     5 UGood  -  465.25 GB SATA HDD N   N  512B WDC WD5003ABYX-01WERA1 U  </span><br><span class="line">252:3     4 UGood  F 223.062 GB SATA SSD N   N  512B INTEL SSDSC2CW240A3    U  </span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><ul><li><code>foreign</code>ç®¡ç†</li></ul><p>æ­¤æ—¶ç¡¬ç›˜ä¸º<code>foreign</code>çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /fall show</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Controller = 0</span><br><span class="line">Status = Success</span><br><span class="line">Description = Operation on foreign configuration Succeeded</span><br><span class="line"></span><br><span class="line">FOREIGN CONFIGURATION :</span><br><span class="line">=====================</span><br><span class="line">----------------------------------------</span><br><span class="line">DG EID:Slot Type State       Size NoVDs </span><br><span class="line">----------------------------------------</span><br><span class="line"> 0 -        Cac0 Frgn  223.062 GB     1 </span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">NoVDs - Number of VDs in disk group|DG - Diskgroup</span><br><span class="line">Total foreign drive groups = 1</span><br></pre></td></tr></table></figure><p>ç°åœ¨å®ƒå¯ä»¥é‡æ–°åŒ…å«åœ¨é…ç½®ä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /fall import</span><br></pre></td></tr></table></figure><p>å¦‚æœè®¾å¤‡æ˜¯ RAID çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™ä¼šè‡ªåŠ¨æ‰§è¡Œé‡å»ºï¼ˆè¯·å‚é˜…æ¦‚è¿°ä¸­çš„çŠ¶æ€ï¼šRbldï¼‰ã€‚ å¯ç”¨ä»¥ä¸‹å‘½ä»¤ç›‘è§†è¿›åº¦ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">storcli /cx /ex /sx show rebuild</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹VDå¥åº·çŠ¶æ€ç­‰,è·å–åˆ°åç›˜çš„E:Sç¼–å·,ç„¶åæŸ¥çœ‹å¯¹åº”ç›˜çš„SN</span></span><br><span class="line">storcli /c0 /vall show [all]</span><br><span class="line">storcli /c0 /eX /sY show all |grep SN</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é˜µåˆ—å¡</span></span><br><span class="line">storcli show ctrlcount</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ virtual disk 0 @controlor 0</span></span><br><span class="line">storcli /cx /v0 show</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ Controlor-0, Enclosure-7, Slot-7çš„ç£ç›˜ä¿¡æ¯</span></span><br><span class="line">storcli /cx/e252/s7 show all</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æŠ¥è­¦ä¿¡æ¯</span></span><br><span class="line">storcli /cx show alarm</span><br><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­beepèœ‚é¸£å™¨æŠ¥è­¦</span></span><br><span class="line">storcli /cx set alarm=&lt;on|off|silence&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®šä½ç£ç›˜ä»“ä½</span></span><br><span class="line">storcli /c0/e8/s2 start/stop locate</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒæ¥æº"><a href="#å‚è€ƒæ¥æº" class="headerlink" title="å‚è€ƒæ¥æº"></a>å‚è€ƒæ¥æº</h2><ul><li><a href="https://www.broadcom.com/site-search?q=storcli" target="_blank" rel="noopener">å®˜æ–¹ç›¸å…³èµ„æºä¸‹è½½-broadcom</a></li><li><a href="https://docs.broadcom.com/docs-and-downloads/raid-controllers/raid-controllers-common-files/StorCLI_RefMan_revf.pdf" target="_blank" rel="noopener">StorCLI å®˜æ–¹æ‰‹å†Œä¸‹è½½</a></li><li><a href="https://www.thomas-krenn.com/en/wiki/StorCLI" target="_blank" rel="noopener">StorCLI _Thomas-Krenn</a></li><li><a href="https://www.xargs.cn/doku.php/lsi:storcli%E6%89%8B%E5%86%8C" target="_blank" rel="noopener">STORCLI-wikiï¼ˆä¸ªäººåšä¸»ç»´æŠ¤ï¼‰</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> Linux </tag>
            
            <tag> RAID </tag>
            
            <tag> Storcli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python èµ„æºæ¨è--[ä¹¦ç±ç¯‡]</title>
      <link href="/blog/2017-12-03/recommend-books-for-Python-learner/"/>
      <url>/blog/2017-12-03/recommend-books-for-Python-learner/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>å› ä¸ºæˆ‘ç›®å‰åš<code>Python</code>ç›¸å…³å¼€å‘ï¼Œå¾ˆå¤šæƒ³å…¥é—¨<code>Python</code>çš„æœ‹å‹æˆ–è€…ä»äº‹å…¶ä»–è¯­è¨€å¼€å‘çš„åŒå­¦ç§èŠè®¨è®ºä¹¦ç±èµ„æ–™æ¨èçš„è¯é¢˜ï¼Œå…¶å®ç½‘ä¸Šæœ‰å¾ˆå¤šå…³äºè¿™ä¸ªé—®é¢˜çš„è¯é¢˜æ€»ç»“ï¼Œæˆ‘ä¸ªäººçš„æ¨èå¹¶ä¸è§å¾—æ¯”å¤§ç¥æ›´å¥½ï¼Œå¸Œæœ›çœŸæ­£æƒ³æ²‰ä¸‹å¿ƒæ¥å­¦ä¹ çš„äººèƒ½å¤Ÿæ—©ç‚¹æ˜ç™½â€œè‡ªå·±åŠ¨æ‰‹ï¼Œä¸°è¡£è¶³é£Ÿâ€çš„é“ç†ã€‚åœ¨è¿™é‡Œåšä¸ªç®€å•æ•´ç†ä¹Ÿç®—æ˜¯ç»™å¤§å®¶ä¸€ä¸ªäº¤ä»£ï¼Œä»¥ä¸ç•™ä¸‹ç››æ°”å‡Œäººçš„å‚²æ…¢å°è±¡ä¸ºç›¼ã€‚</p><a id="more"></a><h2 id="çº¢è¯ä¸¸è¿˜æ˜¯è“è¯ä¸¸"><a href="#çº¢è¯ä¸¸è¿˜æ˜¯è“è¯ä¸¸" class="headerlink" title="çº¢è¯ä¸¸è¿˜æ˜¯è“è¯ä¸¸"></a>çº¢è¯ä¸¸è¿˜æ˜¯è“è¯ä¸¸</h2><p>åˆšå¼€å§‹å­¦ä¹ ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¾ˆå¤šäººä¼šæœ‰å„ç§å›°æƒ‘ï¼šé€‰æ‹©å“ªé—¨è¯­è¨€ï¼Ÿé€‰æ‹©è¯­è¨€çš„å“ªä¸ªç‰ˆæœ¬ï¼Ÿç”¨ä»€ä¹ˆç¼–è¾‘å™¨/å¼€å‘å¹³å°â€¦â€¦</p><p>ç›¸ä¿¡çœ‹è¿™ç¯‡æ–‡ç« çš„å¯¹ç¬¬ä¸€ä¸ªé—®é¢˜å·²ç„¶æœ‰äº†è‡ªå·±çš„é€‰æ‹©ï¼Œåœ¨æ­¤ä¸å¤šèµ˜è¿°ã€‚å…³äº Python ç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ—¶è‡³ä»Šæ—¥ï¼ˆ2017 å¹´ï¼‰ï¼Œé™¤éå…¬å¸é¡¹ç›®éœ€è¦ï¼Œä¸ç„¶è¯·æœæ–­é€‰æ‹© Python3ï¼Œæ¯•ç«Ÿå¤§å¤šæ•°ç¬¬ä¸‰æ–¹åº“å·²ç»åšå‡ºæ”¾å¼ƒ Python2 ç»´æŠ¤çš„ç›¸å…³è¯´æ˜ã€‚ç¬¬ä¸‰ä¸ªé—®é¢˜å€’æ˜¯ä¸ç”¨è¿‡åˆ†çº ç»“ï¼Œæ¯•ç«Ÿåªè¦èƒ½å¤Ÿ runï¼Œå“ªæ€•æ˜¯ç”¨è®°äº‹æœ¬å†™çš„ä¹Ÿæ²¡äººä¼šåœ¨æ„ã€‚ä¸ªäººç›®å‰ä½¿ç”¨ Sublime Text 3 æ­é… IDE PyCharmã€‚</p><h2 id="å…¥é—¨ç¯‡"><a href="#å…¥é—¨ç¯‡" class="headerlink" title="å…¥é—¨ç¯‡"></a>å…¥é—¨ç¯‡</h2><ul><li>ã€Šâ€ç¬¨åŠæ³•â€å­¦ Pythonã€‹    ï¼ˆã€ŠLearn Python the Hard Wayã€‹ï¼‰</li></ul><p><a href="https://www.gitbook.com/book/flyouting/learn-python-the-hard-way-cn/details" target="_blank" rel="noopener">ç¬¨åŠæ³•å­¦ Python -Gitbook</a></p><p>å­¦ä¹ ä¸€é—¨è¯­è¨€çš„æœ€å¥½åŠæ³•å°±æ˜¯å¤šæ•²å¤šç”¨ï¼Œå¦„å›¾é çœ¼ç›<strong>çœ‹</strong>ä¼šä¸€é—¨æŠ€æœ¯çš„äººï¼Œå¸Œæœ›èƒ½å¤Ÿæ—©ç‚¹ä¸¢æ‰å¹»æƒ³ï¼Œå‡†å¤‡æˆ˜æ–—ï¼</p><blockquote><p>è¿™æœ¬ç®€å•ä¹¦çš„ç›®çš„æ˜¯è®©ä½ èµ·æ­¥ç¼–ç¨‹ã€‚ è™½ç„¶ä¹¦åè¯´æ˜¯â€œç¬¨åŠæ³•â€,ä½†å…¶å®å¹¶éå¦‚æ­¤. æ‰€è°“çš„â€œç¬¨åŠæ³•â€æ˜¯æŒ‡æœ¬ä¹¦æ•™æˆçš„æ–¹å¼ã€‚è¿™æœ¬ä¹¦çš„<br>æ•™å­¦æ–¹å¼å°±æ˜¯æŒ‰ç…§æˆ‘å‘Šè¯‰ä½ çš„æ–¹å¼å»åšä¸€ç³»åˆ—çš„ç»ƒä¹ ï¼Œç›®çš„æ˜¯é€šè¿‡é‡å¤ç»ƒä¹ æŒæ¡ä¸€ç§æŠ€èƒ½ã€‚è¿™å¯¹äºä¸€äº›ä»€ä¹ˆéƒ½ä¸çŸ¥é“çš„åˆå­¦è€…ï¼Œåœ¨ç†è§£æ›´å¤æ‚çš„ç§‘ç›®ä¹‹å‰è·å–åŸºæœ¬èƒ½åŠ›æ˜¯å¾ˆæœ‰æ•ˆçš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºä¸€åˆ‡é¢†åŸŸï¼Œä»æ­¦æœ¯åˆ°éŸ³ä¹ç”šè‡³åŸºæœ¬çš„æ•°å­¦å’Œé˜…è¯»æŠ€å·§ã€‚<br>è¿™æœ¬ä¹¦ä»¥ä¹ é¢˜çš„æ–¹å¼å¼•å¯¼è¯»è€…ä¸€æ­¥ä¸€æ­¥å­¦ä¹ ç¼–ç¨‹ï¼Œä»ç®€å•çš„æ‰“å°ä¸€ç›´è®²åˆ°å®Œæ•´é¡¹ç›®çš„å®ç°ã€‚ä¹Ÿè®¸è¯»å®Œè¿™æœ¬ä¹¦å¹¶ä¸<br>æ„å‘³ç€ä½ å·²ç»å­¦ä¼šäº†ç¼–ç¨‹ï¼Œä½†è‡³å°‘ä½ ä¼šå¯¹ç¼–ç¨‹è¯­è¨€ä»¥åŠç¼–ç¨‹è¿™ä¸ªè¡Œä¸šæœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£ã€‚</p></blockquote><ul><li>ã€Šç®€æ˜ Python æ•™ç¨‹ã€‹    ï¼ˆã€ŠA Byte of Pythonã€‹ï¼‰</li></ul><p><a href="https://www.gitbook.com/book/lenkimo/byte-of-python-chinese-edition/details" target="_blank" rel="noopener">ç®€æ˜ Python æ•™ç¨‹-Gitbook</a></p><p>çœ‹ä¸€ä¸‹æ¿€åŠ¨äººå¿ƒçš„å‰è¨€ä»‹ç»ï¼š</p><blockquote><p>æœ¬ä¹¦å°†ä»¥æŒ‡å—æˆ–æ•™ç¨‹çš„å½¢å¼å‘ä½ ä»‹ç»<code>Python</code>è¿™é—¨ç¼–ç¨‹è¯­è¨€ã€‚å®ƒä»¥æ–°æ‰‹ä¸ºä¸»è¦ç›®æ ‡ã€‚åŒæ—¶æœ¬ä¹¦ä¹Ÿå¯¹æœ‰ç»éªŒçš„ç¨‹åºå‘˜æœ‰æ‰€å¸®åŠ©ã€‚<br>å¦‚æœä½ å¯¹ç”µè„‘çš„æ‰€æœ‰äº†è§£ä»…æ­¢æ­¥äºå¦‚ä½•ä¿å­˜æ–‡æœ¬æ–‡ä»¶çš„è¯ï¼Œé‚£æœ¬ä¹¦çš„ç›®æ ‡ä¾¿æ˜¯ååŠ©ä½ é€šè¿‡æœ¬ä¹¦å­¦ä¹ <code>Python</code>ã€‚å¦‚æœåœ¨æ­¤ä¹‹å‰ä½ å·²ç»æœ‰äº†ç¼–ç¨‹ç»éªŒï¼Œä½ åŒæ ·å¯ä»¥é€šè¿‡æœ¬ä¹¦æ¥å­¦ä¹ <code>Python</code>ã€‚<br>å¦‚æœä½ å·²ç»æœ‰è¿‡ç¼–ç¨‹ç»éªŒï¼Œä½ æˆ–è®¸ä¼šå¯¹<code>Python</code>ä¸å…¶å®ƒä½ æ‰€å–œçˆ±çš„ç¼–ç¨‹è¯­è¨€é—´æœ‰ä½•åŒºåˆ«æŠ±æœ‰å…´è¶£â€”â€”è€Œæˆ‘å°†ä¼šä½ å±•ç°è®¸å¤šè¿™ç§åŒºåˆ«ã€‚é¡ºä¾¿æé†’ä½ ä¸€ä¸‹ï¼Œ<code>Python</code>å°†ä¼šå¾ˆå¿«æˆä¸ºä½ æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€ï¼</p></blockquote><ul><li>ã€Š Python 3.3 å®˜æ–¹æ•™ç¨‹ã€‹</li></ul><p><a href="http://www.pythondoc.com/pythontutorial3/index.html" target="_blank" rel="noopener">Python å…¥é—¨æŒ‡å—ä¸­æ–‡ç‰ˆ</a><br><a href="https://docs.python.org/3/" target="_blank" rel="noopener">Python å®˜æ–¹æ•™ç¨‹ï¼ˆè‹±æ–‡åŸç‰ˆï¼‰</a></p><p>æ›´æ–°ã€æƒå¨ã€æ¡ç†åŒ–çš„å®˜æ–¹<code>tutorial</code> ï¼Œæœ€åŸæ±åŸå‘³çš„<code>Python</code>æŒ‡å—ã€‚</p><ul><li>ã€Šé›¶åŸºç¡€å­¦ Pythonã€‹/ã€Šè·Ÿè€é½å­¦ Pythonã€‹</li></ul><p><a href="https://www.gitbook.com/book/looly/python-basic/details" target="_blank" rel="noopener">é›¶åŸºç¡€å­¦ Python</a></p><p>è¿™æœ¬æ•™ç¨‹æ˜¯æˆ‘å½“åˆå¼€å§‹è‡ªå­¦çš„æ—¶å€™çœ‹è¿‡çš„ï¼Œç”±äºæ˜¯å›½å†…ä½œè€…ï¼Œè¯­è¨€ä¹ æƒ¯æ›´é€‚åˆæˆ‘ä»¬ï¼Œé¡ºä¾¿ä¹Ÿæ¨èç»™å¤§å®¶ã€‚</p><blockquote><p>åœ¨æˆ‘çœ‹æ¥ï¼Œ<code>Python</code>æ˜¯éå¸¸é€‚åˆä½œä¸ºå­¦ä¹ é«˜çº§è¯­è¨€ç¼–ç¨‹çš„ç¬¬ä¸€é—¨è¯­è¨€çš„ã€‚æœ‰ä¸€æœ¬ä¹¦ï¼Œåå­—å«ã€Šä¸å­©å­ä¸€èµ·å­¦ç¼–ç¨‹ã€‹ï¼Œè¿™æœ¬ä¹¦çš„å®šä½ï¼Œæ˜¯å°† python å®šä½ä¸ºå­¦ä¹ è€…å­¦ä¹ çš„ç¬¬ä¸€é—¨é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚ç„¶è€Œï¼Œç”±äºè¯»è€…å¯¹è±¡æ˜¯å­©å­ï¼Œå¾ˆå¤šâ€œæˆå¹´äººâ€ä¸å±‘ä¸€é¡¾ï¼Œå½“ç„¶ï¼Œé‡Œé¢çš„è®²æ³•ä¸â€œå®æˆ˜â€æœ‰ç‚¹è·ç¦»ï¼Œå¯¼è‡´ä»¥â€œæ‰¾å·¥ä½œâ€ã€â€œå·¥ä½œéœ€è¦â€ä¸ºç›®æ ‡çš„å­¦ä¹ è€…ï¼Œè®¤ä¸ºè¿™æœ¬ä¹¦è·Ÿè‡ªå·±è¦å­¦çš„æ–¹å‘ç›¸å·®ç”šè¿œã€‚<br>ä¸ºäº†å¼¥è¡¥é‚£æœ¬ä¹¦çš„ç¼ºæ†¾ï¼Œæˆ‘åœ¨è¿™é‡Œæ¨å‡ºé¢å‘æˆå¹´äººâ€”â€”å¤§å­¦ç”Ÿã€æˆ–è€…å…¶ä»–æƒ³å­¦ä¹ ç¨‹åºä½†æ˜¯æ²¡æœ‰ä»»ä½•ç¼–ç¨‹åŸºç¡€çš„æœ‹å‹â€”â€”å­¦ä¹ ç¬¬ä¸€é—¨ç¼–ç¨‹é«˜çº§è¯­è¨€çš„æ•™ç¨‹ã€‚</p></blockquote><p>è¯»å®Œä¸Šé¢çš„ä¹¦ï¼Œä½ å·²ç»æŒæ¡<code>Python</code>çš„è¯­æ³•ç‰¹ç‚¹ï¼Œå¯ä»¥çœ‹æ‡‚è¯­è¨€é€»è¾‘ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•å†™ä¸€ç‚¹å°<code>demo</code>äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæ‰“ç®—ä»äº‹ç›¸å…³å·¥ä½œï¼Œå¯ä»¥å°è¯•è¿ˆå‡ºç¬¬ä¸€æ­¥å•¦ã€‚éœ€è¦æé†’å¤§å®¶çš„æ˜¯ï¼šè¯»ä¹¦å’Œåšå†™ä»£ç åº”è¯¥æ˜¯å¹¶é©¾é½é©±çš„ï¼Œä¸èƒ½ä¸€å‘³åœ°å»è¯»ä¹¦ï¼Œä¹Ÿä¸è¦ä¸€å‘³æ•²ä»£ç ã€‚ï¼ˆå½“ç„¶ï¼Œä½ å¯èƒ½ä¹Ÿå†™ä¸å‡ºæ¥ï¼‰åªæœ‰ç›¸äº’æœ‰æœºç»“åˆï¼Œæ‰èƒ½è®°å¾—ç¨³å›ºï¼Œå­¦å¾—ç‰¢é ã€‚</p><h2 id="è¿›é˜¶ç¯‡"><a href="#è¿›é˜¶ç¯‡" class="headerlink" title="è¿›é˜¶ç¯‡"></a>è¿›é˜¶ç¯‡</h2><ul><li>ã€Šæµç•…çš„ Pythonã€‹   (ã€ŠFluent Python-Clear, Concise, and Effective Programmingã€‹)</li></ul><p><a href="https://github.com/cundi/fluent-python" target="_blank" rel="noopener">æµç•…çš„ Python(æœªå®Œæˆ)</a></p><blockquote><p>è¿™æœ¬ä¹¦å¹¶ä¸æ˜¯ä¸€æœ¬å®Œå¤‡çš„ <code>Python</code> ä½¿ç”¨æ‰‹å†Œï¼Œè€Œæ˜¯ä¼šå¼ºè°ƒ <code>Python</code> ä½œä¸ºç¼–ç¨‹è¯­è¨€ç‹¬æœ‰çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§æˆ–è€…æ˜¯åªæœ‰ <code>Python</code> æ‰å…·å¤‡çš„ï¼Œæˆ–è€…æ˜¯åœ¨å…¶ä»–å¤§ä¼—è¯­è¨€é‡Œå¾ˆå°‘è§çš„ã€‚æœ¬ä¹¦çš„ç›®æ ‡è¯»è€…æ˜¯é‚£äº›æ­£åœ¨ä½¿ç”¨ <code>Python</code>ï¼Œåˆæƒ³ç†Ÿæ‚‰ <code>Python 3</code> çš„ç¨‹åºå‘˜ã€‚æœ¬ä¹¦çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å……åˆ†åœ°å±•ç° <code>Python 3.4</code> çš„é­…åŠ›ã€‚</p></blockquote><ul><li>ã€Šã€ŠPython Cookbookã€‹3rd Edition ã€‹</li></ul><p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/" target="_blank" rel="noopener">Python Cookbook</a></p><blockquote><p>è¿™æœ¬ä¹¦çš„ç›®æ ‡è¯»è€…æ˜¯é‚£äº›æƒ³æ·±å…¥ç†è§£<code>Python</code>è¯­è¨€æœºåˆ¶å’Œç°ä»£ç¼–ç¨‹é£æ ¼çš„æœ‰ç»éªŒçš„<code>Python</code>ç¨‹åºå‘˜ã€‚æœ¬ä¹¦å¤§éƒ¨åˆ†å†…å®¹é›†ä¸­äºåœ¨æ ‡å‡†åº“ï¼Œæ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¸­å¹¿æ³›ä½¿ç”¨çš„é«˜çº§æŠ€æœ¯ã€‚<br>æœ¬ä¹¦æ‰€æœ‰ç¤ºä¾‹å‡å‡è®¾è¯»è€…å…·æœ‰ä¸€å®šçš„ç¼–ç¨‹èƒŒæ™¯å¹¶ä¸”å¯ä»¥è¯»æ‡‚ç›¸å…³ä¸»é¢˜ ï¼ˆæ¯”å¦‚åŸºæœ¬çš„è®¡ç®—æœºç§‘å­¦çŸ¥è¯†ï¼Œæ•°æ®ç»“æ„çŸ¥è¯†ï¼Œç®—æ³•å¤æ‚åº¦ï¼Œç³»ç»Ÿç¼–ç¨‹ï¼Œå¹¶è¡Œï¼ŒC è¯­è¨€ç¼–ç¨‹ç­‰ï¼‰ã€‚ å¦å¤–ï¼Œæ¯ä¸ªç¤ºä¾‹éƒ½åªæ˜¯ä¸€ä¸ªå…¥é—¨æŒ‡å¯¼ï¼Œå¦‚æœè¯»è€…æƒ³æ·±å…¥ç ”ç©¶ï¼Œéœ€è¦è‡ªå·±å»æŸ¥é˜…æ›´å¤šèµ„æ–™ã€‚æˆ‘ä»¬å‡å®šè¯»è€…å¯ä»¥å¾ˆç†Ÿç»ƒçš„ä½¿ç”¨æœç´¢å¼•æ“ä»¥åŠçŸ¥é“æ€æ ·æŸ¥è¯¢åœ¨çº¿çš„<code>Python</code>æ–‡æ¡£ã€‚</p></blockquote><p>è¯»å®Œä¸Šé¢çš„ä¹¦ï¼Œä½ å·²ç»å¯ä»¥å†™å‡º<code>Pythonic</code>çš„ä»£ç äº†ï¼Œåº”è¯¥å¯¹<code>Python</code>æœ‰äº†è‡ªå·±çš„ç†è§£ï¼Œå¹¶ä¸”ä¹Ÿä¼šæœ‰è‡ªå·±çš„æ–¹å‘ï¼Œå¯ä»¥ç¡®å®šè‡ªå·±çš„å‘å±•æ–¹å‘ï¼šWeb åº”ç”¨å¼€å‘ã€çˆ¬è™«æ•°æ®åˆ†æã€ç½‘ç»œå®‰å…¨ã€è¿ç»´æµ‹è¯•ã€<code>Linux</code>ç³»ç»Ÿå¼€å‘ã€äººå·¥æ™ºèƒ½/æœºå™¨å­¦ä¹ ã€‚ç›¸ä¿¡è¿™ä¸ªæ—¶å€™ä½ å·²ç»ä¸å†éœ€è¦åˆ«äººçš„æ¨èï¼Œé‚£ä¹ˆæ˜¯æ—¶å€™ä¸º<code>Python</code>çš„è“¬å‹ƒå‘å±•è´¡çŒ®è‡ªå·±çš„åŠ›é‡å•¦ï¼</p><h2 id="More"><a href="#More" class="headerlink" title="More"></a>More</h2><p><a href="https://foofish.net/python-free-ebook.html" target="_blank" rel="noopener">å…è´¹ä¸­æ–‡ Python ç”µå­ä¹¦ï¼ˆæ•™ç¨‹ï¼‰</a><br><a href="https://github.com/Junnplus/awesome-python-books/blob/master/README-ZH_CN.md" target="_blank" rel="noopener">Awesome Python Books</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ Python è¿›è¡Œè®¡æ•°ç»Ÿè®¡</title>
      <link href="/blog/2017-11-21/how-to-count-sequense-with-python/"/>
      <url>/blog/2017-11-21/how-to-count-sequense-with-python/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>from collections import Counter</p><a id="more"></a><h2 id="ä½¿ç”¨å¸¸è§„forå¾ªç¯"><a href="#ä½¿ç”¨å¸¸è§„forå¾ªç¯" class="headerlink" title="ä½¿ç”¨å¸¸è§„forå¾ªç¯"></a>ä½¿ç”¨å¸¸è§„<code>for</code>å¾ªç¯</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">53</span>]: test_seq = <span class="string">'asfsdgfads'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">54</span>]: count_dict = dict()</span><br><span class="line"></span><br><span class="line">In [<span class="number">55</span>]: <span class="keyword">for</span> item <span class="keyword">in</span> test_seq:</span><br><span class="line">    ...:     <span class="keyword">if</span> item <span class="keyword">in</span> count_dict:</span><br><span class="line">    ...:         count_dict[item] += <span class="number">1</span></span><br><span class="line">    ...:     <span class="keyword">else</span>:</span><br><span class="line">    ...:         count_dict[item] = <span class="number">0</span></span><br><span class="line">    ...:</span><br><span class="line"></span><br><span class="line">In [<span class="number">56</span>]: count_dict</span><br><span class="line">Out[<span class="number">56</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'d'</span>: <span class="number">1</span>, <span class="string">'f'</span>: <span class="number">1</span>, <span class="string">'g'</span>: <span class="number">0</span>, <span class="string">'s'</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨collectionsåº“ä¸­çš„defaultdict"><a href="#ä½¿ç”¨collectionsåº“ä¸­çš„defaultdict" class="headerlink" title="ä½¿ç”¨collectionsåº“ä¸­çš„defaultdict"></a>ä½¿ç”¨<code>collections</code>åº“ä¸­çš„<code>defaultdict</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">57</span>]: <span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">In [<span class="number">58</span>]: cd_dict = defaultdict()</span><br><span class="line"></span><br><span class="line">In [<span class="number">59</span>]: cd_dict = defaultdict(int)</span><br><span class="line"></span><br><span class="line">In [<span class="number">60</span>]: <span class="keyword">for</span> item <span class="keyword">in</span> test_seq:</span><br><span class="line">    ...:     cd_dict[item] += <span class="number">1</span></span><br><span class="line">    ...:</span><br><span class="line">In [<span class="number">62</span>]: cd_dict</span><br><span class="line">Out[<span class="number">62</span>]: defaultdict(int, &#123;<span class="string">'a'</span>: <span class="number">2</span>, <span class="string">'d'</span>: <span class="number">2</span>, <span class="string">'f'</span>: <span class="number">2</span>, <span class="string">'g'</span>: <span class="number">1</span>, <span class="string">'s'</span>: <span class="number">3</span>&#125;)</span><br><span class="line">In [<span class="number">63</span>]: cd_dict.items()</span><br><span class="line">Out[<span class="number">63</span>]: [(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="string">'s'</span>, <span class="number">3</span>), (<span class="string">'d'</span>, <span class="number">2</span>), (<span class="string">'g'</span>, <span class="number">1</span>), (<span class="string">'f'</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨collectionsåº“ä¸­çš„Counter"><a href="#ä½¿ç”¨collectionsåº“ä¸­çš„Counter" class="headerlink" title="ä½¿ç”¨collectionsåº“ä¸­çš„Counter"></a>ä½¿ç”¨<code>collections</code>åº“ä¸­çš„<code>Counter</code></h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">64</span>]: <span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">In [<span class="number">65</span>]: Counter(test_data)</span><br><span class="line">Out[<span class="number">65</span>]: Counter(&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'d'</span>: <span class="number">3</span>, <span class="string">'g'</span>: <span class="number">3</span>, <span class="string">'h'</span>: <span class="number">1</span>, <span class="string">'s'</span>: <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">84</span>]: counter = Counter(test_seq)</span><br><span class="line"></span><br><span class="line">In [<span class="number">85</span>]: counter.items()</span><br><span class="line">Out[<span class="number">85</span>]: [(<span class="string">'a'</span>, <span class="number">2</span>), (<span class="string">'s'</span>, <span class="number">3</span>), (<span class="string">'d'</span>, <span class="number">2</span>), (<span class="string">'g'</span>, <span class="number">1</span>), (<span class="string">'f'</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒä¹¦ç±"><a href="#å‚è€ƒä¹¦ç±" class="headerlink" title="å‚è€ƒä¹¦ç±"></a>å‚è€ƒä¹¦ç±</h2><ul><li>ã€Šç¼–å†™é«˜è´¨é‡ä»£ç ï¼šæ”¹å–„ Python ç¨‹åºçš„ 91 ä¸ªå»ºè®®ã€‹è¿·ä½ ä¹¦-å»ºè®® 39ï¼šä½¿ç”¨ Counter è¿›è¡Œè®¡æ•°ç»Ÿè®¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> HOWTO </tag>
            
            <tag> ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç£ç›˜é˜µåˆ—æ§åˆ¶å¡ï¼ˆRAID å¡ï¼‰MegaCli å¸¸ç”¨ç®¡ç†å‘½ä»¤æ±‡æ€»</title>
      <link href="/blog/2017-11-20/megacli-command-share/"/>
      <url>/blog/2017-11-20/megacli-command-share/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>è¿›è¡Œå­˜å‚¨å¼€å‘æ—¶éœ€è¦åˆ›å»ºç£ç›˜é˜µåˆ—ï¼Œæœ¬æ–‡ä¸»è¦è®°å½• RAID å¡ç®¡ç†å·¥å…·<code>MegaCli</code>çš„ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰è¯¥ç®¡ç†å·¥å…·å› ä¸ºå•†ä¸šæ”¶è´­å·²ç»è¢«å®˜æ–¹â€œå¼ƒå‘â€ï¼Œ<code>StorCLI</code>ä½œä¸ºåç»§è€…æ•´åˆäº†<code>LSI</code>å’ŒåŸæ¥<code>3ware</code>çš„äº§å“æ”¯æŒï¼Œå…¼å®¹<code>MegaCLI</code>å‘½ä»¤çš„åŒæ—¶æ›´åŠ ç®€æ´ï¼Œå‚é˜…<a href="https://imoyao.github.io/blog/2017-12-27/storcli_command_share/">æ­¤ç¯‡</a>ã€‚<br><a id="more"></a></p><h2 id="å·¡è¯»"><a href="#å·¡è¯»" class="headerlink" title="å·¡è¯»"></a>å·¡è¯»</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç«‹å³æ¿€æ´»</span></span><br><span class="line">MegaCli -adppr -enblauto -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®æˆæ‰‹åŠ¨æ¨¡å¼ï¼Œéœ€è¦ç”¨MegaCli -adppr -start â€“a0 æ¥æ¿€æ´»</span></span><br><span class="line">MegaCli -adppr -enblman -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹å·¡è¯»çš„æ¨¡å¼ï¼Œæœ¬æ¬¡å·¡è¯»ç»“æŸä¸ä¸‹ä¸€æ¬¡å¼€å§‹å·¡è¯»çš„é—´éš”ï¼Œå½“å‰çŠ¶æ€ç­‰ä¿¡æ¯</span></span><br><span class="line">MegaCli -adppr -info -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹å·¡è¯»çš„è¿›åº¦</span></span><br><span class="line">MegaCli -fwtermlog -dsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç»“æŸå·¡è¯»ï¼Œåœ¨å·¡è¯»è¿‡ç¨‹ä¸­ï¼Œå¤šæ¬¡è¿ç”¨MegaCli -adppr -stop -a0æˆ–MegaCli -adppr -start -a0ä¼šä½¿å ä»£æ•°å¢åŠ ï¼Œæ­¤æ—¶å¯èƒ½ä¸èƒ½å¼€å§‹æˆ–ç»“æŸå·¡è¯»ï¼Œç”¨MegaCli -adppr -dsbl -a0æ¥ç¦æ­¢å·¡è¯»ï¼Œé‡æ–°å¼€å§‹ã€‚</span></span><br><span class="line">MegaCli -adppr -stop -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®æœ¬æ¬¡å·¡è¯»ç»“æŸä¸ä¸‹ä¸€æ¬¡å·¡è¯»å¼€å§‹çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯168å°æ—¶ï¼Œå½“val=0æ—¶, æœ¬æ¬¡å·¡è¯»ç»“æŸåï¼Œç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡å·¡è¯»</span></span><br><span class="line">MegaCli -adppr -setdelay val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å·¡è¯»æ—¶æ˜¯å¦çº æ­£åª’ä»‹é”™è¯¯</span></span><br><span class="line">MegaCli -AdpSetProp -PrCorrectUncfgdAreas -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®å®šæ—¶å·¡è¯» yyyymmdd hhï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š20120108 16è¡¨ç¤º2012å¹´01æœˆ08æ—¥16ç‚¹</span></span><br><span class="line">MegaCli -AdpPR -SetStartTime yyyymmdd hh -a0</span><br></pre></td></tr></table></figure><h2 id="cc-æ ¡éªŒ"><a href="#cc-æ ¡éªŒ" class="headerlink" title="cc æ ¡éªŒ"></a>cc æ ¡éªŒ</h2><ul><li>ç«‹å³å¼€å§‹ cc æ ¡éªŒ</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">L0è¡¨ç¤ºTarget ID ä¸º0çš„raidç»„</span></span><br><span class="line">MegaCli -ldcc -start -L0 â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœæ²¡æœ‰å®Œå…¨åˆå§‹åŒ–æˆ–åå°åˆå§‹åŒ–</span></span><br><span class="line"><span class="meta">#</span><span class="bash">The virtual disk has not been initializedã€ Running a consistency check may result <span class="keyword">in</span> inconsistent messages <span class="keyword">in</span> the <span class="built_in">log</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯ä»¥å¼ºè¡Œccæ ¡éªŒ</span></span><br><span class="line">MegaCli -ldcc -start -force â€“L0 â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºå½“å‰ccæ ¡éªŒçš„è¿›åº¦</span></span><br><span class="line">MegaCli -ldcc -progdsply -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å…³æ‰å½“å‰çš„ccæ ¡éªŒ</span></span><br><span class="line">MegaCli -ldcc -abort -L0 -a0</span><br></pre></td></tr></table></figure><ul><li>è®¡åˆ’ cc æ ¡éªŒ<br>å¦‚æœæ¨¡å¼ä¸º disable(MegaCli -adpccsched -info -a0 æ¥æŸ¥çœ‹)ï¼Œåˆ™ä¸‹ä¸€æ¬¡å¼€å§‹æ—¶é—´ä¸º 07/28/2135, 02:00:00ï¼ŒçŠ¶æ€ä¸º Stoppedï¼Œå»¶æœŸä¸º 168 ä¸ªå°æ—¶;<br>åªæœ‰æ¨¡å¼ä¸º Sequential å’Œ Concurrent æ¨¡å¼æ—¶ï¼Œæ‰å¯ä»¥è®¾å®šå®šæœŸæ—¶é—´ï¼Œæ‰€ä»¥è¦é¦–å…ˆè®¾å®šæ¨¡å¼;<br>å¦‚æœæ¨¡å¼ä¸º Sequential æ—¶ï¼Œæ‰€æœ‰è™šæ‹Ÿç£ç›˜ç»„é¡ºåºè¿›è¡Œ cc æ ¡éªŒ;<br>å¦‚æœæ¨¡å¼ä¸º Concurrent æ—¶ï¼Œæ‰€æœ‰è™šæ‹Ÿç£ç›˜ç»„åŒæ—¶è¿›è¡Œ cc æ ¡éªŒ;<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">è®¾å®šCCæ¨¡å¼</span></span><br><span class="line">MegaCli -adpccsched -modeconc -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æˆ–è€…</span></span><br><span class="line">MegaCli -adpccsched -modeseq -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç„¶åè®¾å®šå¼€å§‹æ—¶é—´</span></span><br><span class="line">MegaCli -adpccsched setstarttime 20101122 18 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®æœ¬æ¬¡ccæ ¡éªŒç»“æŸå’Œä¸‹æ¬¡ccæ ¡éªŒå¼€å§‹çš„æ—¶é—´é—´éš”</span></span><br><span class="line">MegaCli -adpccsched -setdelay 2 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç¦æ­¢è®¡åˆ’ccæ ¡éªŒ</span></span><br><span class="line">MegaCli -AdpCcSched -dsbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®é”™è¯¯å‘ç”Ÿæ—¶æ”¾å¼ƒccæ ¡éªŒ</span></span><br><span class="line">MegaCli -adpsetprop -AbortCC -1 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹ccæ ¡éªŒçš„äº‹ä»¶æ—¥å¿—</span></span><br><span class="line">MegaCli -AdpEventLog -GetCCIncon â€“f filename â€“L0 â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœè®¾ç½®å»¶æœŸæ—¶é—´ä¸º0ï¼Œæœ¬æ¬¡ccæ ¡éªŒç»“æŸåï¼Œä¸‹ä¸€æ¬¡ccæ ¡éªŒä¼šç«‹å³å¼€å§‹</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="å¿«é€Ÿåˆå§‹åŒ–å’Œå®Œå…¨åˆå§‹åŒ–"><a href="#å¿«é€Ÿåˆå§‹åŒ–å’Œå®Œå…¨åˆå§‹åŒ–" class="headerlink" title="å¿«é€Ÿåˆå§‹åŒ–å’Œå®Œå…¨åˆå§‹åŒ–"></a>å¿«é€Ÿåˆå§‹åŒ–å’Œå®Œå…¨åˆå§‹åŒ–</h2><p>å¿«é€Ÿåˆå§‹åŒ–å€¼æ˜¯å¾€ raid ç»„çš„å‰ 8M å’Œå 8M å†™ 0<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¿«é€Ÿåˆå§‹åŒ–</span></span><br><span class="line">MegaCli -LDInit -start â€“L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å®Œå…¨åˆå§‹åŒ–</span></span><br><span class="line">MegaCli -LDInit -start -full â€“L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºåˆå§‹åŒ–çš„è¿›åº¦</span></span><br><span class="line">MegaCli -LDInit -progdsply -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç»“æŸå®Œå…¨åˆå§‹åŒ–</span></span><br><span class="line">MegaCli -LDInit -abort -L0 -a0</span><br></pre></td></tr></table></figure></p><h2 id="åå°åˆå§‹åŒ–"><a href="#åå°åˆå§‹åŒ–" class="headerlink" title="åå°åˆå§‹åŒ–"></a>åå°åˆå§‹åŒ–</h2><p>Raid5 éœ€è¦ 5 ä¸ªæ•°æ®ç›˜æ‰å¯ä»¥åå°åˆå§‹åŒ–(5 ä¸ªç›˜ä¸­ä¸åŒ…å«çƒ­å¤‡ç›˜)<br>åå°åˆå§‹åŒ–æ˜¯åˆ›å»º raid å 5 åˆ†é’Ÿå¼€å§‹çš„(å¥½åƒæœ‰æ—¶ä¸æ˜¯è¿™æ ·çš„)<br>åå°åˆå§‹åŒ–å’Œ cc æ ¡éªŒä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œåå°åˆå§‹åŒ–å¯ä»¥è‡ªåŠ¨å¼€å§‹<br>æ”¹å˜åå°åˆå§‹åŒ–ç‡æ—¶ï¼Œéœ€è¦åœæ­¢åå°åˆå§‹åŒ–ï¼Œå¦åˆ™æ²¡æœ‰æ•ˆæœ<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¦æ­¢åå°åˆå§‹åŒ–</span></span><br><span class="line">MegaCli -LDBI -dsbl -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç»“æŸæ­£åœ¨è¿›è¡Œçš„åå°åˆå§‹åŒ–</span></span><br><span class="line">MegaCli -LDBI -abort -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹åå°åˆå§‹åŒ–çš„è®¾ç½®</span></span><br><span class="line">MegaCli -LDBI -getsetting -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºåå°åˆå§‹åŒ–è¿›åº¦</span></span><br><span class="line">MegaCli -LDBI -progdsply -L0 -a0</span><br></pre></td></tr></table></figure></p><h2 id="copyback"><a href="#copyback" class="headerlink" title="copyback"></a>copyback</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¼€å¯æˆ–ç¦ç”¨copyback</span></span><br><span class="line">MegaCli -AdpSetProp â€“CopyBackDsbl -0 -a0 (å¼€å¯)</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºcopybackè®¾ç½®æƒ…å†µ</span></span><br><span class="line">MegaCli â€“AdpGetProp -CopyBackDsbl â€“a0</span><br></pre></td></tr></table></figure><p>å½“è®¾ç½® copyback ä¸º enable æ—¶ï¼Œæ‹”å‡ºåç›˜ï¼Œæ¢ä¸Šä¸€ä¸ª UNCONF çš„æ–°ç›˜ï¼Œå…ˆç”¨çƒ­å¤‡ç›˜è¿›è¡Œé‡å»ºï¼Œç„¶åè¿›è¡Œ copyback æ“ä½œï¼Œå¦‚æœ copyback ä¸º disable æ—¶ï¼Œä¸è¿›è¡Œ copyback æ“ä½œï¼Œå¯ä»¥è®¾å®š copyback ä¸º enableï¼Œç„¶åç”¨ MegaCli -PDCpyBk -Start -PhysDrv[E0:S0,E1:S1] â€“a0 å¼€å§‹ copyback æ“ä½œï¼Œå…¶ä¸­[E0ï¼šS0]æ˜¯ raid ç»„ä¸­çš„ç£ç›˜(æºç›˜)ï¼Œè€Œ[E1ï¼šS1]ä¸æ˜¯ raid ç»„ä¸­çš„ç£ç›˜(ç›®çš„ç›˜)</p><p>å½“æŸä¸ªç›˜å‡ºç°ç¬¬ä¸€ä¸ª smart é”™è¯¯æ—¶ï¼Œå¯ä»¥åœ¨è¿™ä¸ªç›˜å’Œçƒ­å¤‡ç›˜ä¹‹é—´è¿›è¡Œ copyback æ“ä½œï¼Œçƒ­å¤‡ç›˜ä½œä¸ºç›®çš„ç›˜ï¼Œå®Œæˆäº† copyback æ“ä½œæ—¶ï¼Œsmart é”™è¯¯ç›˜æ‰æ ‡è®°ä¸º failed çŠ¶æ€ã€‚<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœåœ¨copybackæ—¶ï¼Œraidç»„åˆ é™¤ï¼Œç›®çš„ç›˜å›åˆ°çƒ­å¤‡ç›˜çŠ¶æ€æˆ–Unconfigured Good</span></span><br><span class="line">MegaCli -AdpGetProp SMARTCpyBkEnbl -a0</span><br></pre></td></tr></table></figure></p><h2 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æ‰€æœ‰çš„informationæ—¥å¿—</span></span><br><span class="line">MegaCli -adpalilog -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹å›ºä»¶è°ƒè¯•æ—¥å¿—(å›ºä»¶ç»ˆç«¯æ—¥å¿—)</span></span><br><span class="line">MegaCli -fwtermlog -dsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹raidå¡æ—¥å¿—</span></span><br><span class="line">MegaCli -adpeventlog -getevents -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…é™¤æ—¥å¿—</span></span><br><span class="line">MegaCli -AdpEventLog -Clear â€“a0</span><br></pre></td></tr></table></figure><h2 id="raid5-æ‰©å®¹"><a href="#raid5-æ‰©å®¹" class="headerlink" title="raid5 æ‰©å®¹"></a>raid5 æ‰©å®¹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">raid5çš„æ‰©å®¹</span></span><br><span class="line">MegaCli -LDRecon -Start -r5 -Add -Physdrv[E0:S0] -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æ‰©å®¹çš„è¿›åº¦</span></span><br><span class="line">MegaCli -LDRecon -progdsply -L0 â€“a0</span><br></pre></td></tr></table></figure><h2 id="çº§åˆ«è¿ç§»"><a href="#çº§åˆ«è¿ç§»" class="headerlink" title="çº§åˆ«è¿ç§»"></a>çº§åˆ«è¿ç§»</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œè½¬æ¢å‰çš„raidçš„ä¸€ä¸ªç›˜ä¸‹çº¿ï¼Œè½¬æ¢å‰raidçš„æ‰€æœ‰ç›˜éƒ½ä¸‹çº¿</span><br><span class="line">æ”¯æŒçš„ç±»å‹ RAID 0 to RAID 1ï¼ŒRAID 0 to RAID 5ï¼ŒRAID 0 to RAID 6ï¼ŒRAID 1 to RAID 0ï¼ŒRAID 1 to RAID 5ï¼ŒRAID 1 to RAID 6ï¼ŒRAID 5 to RAID 0ï¼ŒRAID 5 to RAID 6ï¼ŒRAID 6 to RAID 0ï¼ŒRAID 6 to RAID 5</span><br><span class="line"><span class="meta">#</span><span class="bash">å»ºç«‹äº†ä¸‰ä¸ªç›˜çš„raid 0</span></span><br><span class="line">MegaCli -cfgldadd -r0[117:1,117:3,117:11] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¢åŠ ä¸€ä¸ªç›˜[117:14],è½¬æ¢åˆ°raid5</span></span><br><span class="line">MegaCli -ldrecon -start -r5 -add -physdrv[117:14] -l0 -a0</span><br></pre></td></tr></table></figure><h2 id="å‡çº§-ROM"><a href="#å‡çº§-ROM" class="headerlink" title="å‡çº§ ROM"></a>å‡çº§ ROM</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ä»ä½ç‰ˆæœ¬åˆ°é«˜ç‰ˆæœ¬å‡çº§</span></span><br><span class="line">MegaCli -adpfwflash -f x.rom -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ä»é«˜ç‰ˆæœ¬åˆ°ä½ç‰ˆæœ¬é™çº§</span></span><br><span class="line"><span class="meta">#</span><span class="bash">åŠ ä¸Šnoverchkå¿½ç•¥ç‰ˆæœ¬çš„æ£€æŸ¥ï¼Œå‡çº§ä»¥åéœ€è¦é‡å¯æ‰ç”Ÿæ•ˆ</span></span><br><span class="line">MegaCli -adpfwflash -f x.rom -noverchk -a0</span><br></pre></td></tr></table></figure><h2 id="è¿æ¥æ–¹å¼"><a href="#è¿æ¥æ–¹å¼" class="headerlink" title="è¿æ¥æ–¹å¼"></a>è¿æ¥æ–¹å¼</h2><p>Raid å¯¹å†…æœ‰ä¸¤ä¸ªæ¥å£ï¼Œå³ connector0 å’Œ connector1ã€‚å¾—åˆ°è¿æ¥å™¨çš„çŠ¶æ€;<br> MegaCli -adpgetconnectormode -connector0 -a0<br>å¦‚æœè¿æ¥å™¨çš„æ¨¡å¼ä¸º internal æ—¶ï¼Œjbod çš„ç£ç›˜å…¨éƒ¨çœ‹ä¸åˆ°ï¼Œå¦‚æœè¿æ¥å™¨çš„æ¨¡å¼ä¸º external æ—¶ï¼Œä¸»æŸœä¸Šçš„ç£ç›˜å…¨éƒ¨çœ‹ä¸åˆ°;</p><h2 id="å¤–æ¥é…ç½®"><a href="#å¤–æ¥é…ç½®" class="headerlink" title="å¤–æ¥é…ç½®"></a>å¤–æ¥é…ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ‰«æå¤–æ¥é…ç½®çš„ä¸ªæ•°</span></span><br><span class="line">MegaCli -cfgforeign -scan -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹å½“å‰çš„ç£ç›˜åœ¨normalæ—¶çš„ä½ç½®</span></span><br><span class="line">MegaCli -cfgforeign -preview -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¥å¯¼å…¥é…ç½®ï¼Œæ¢å¤è™šæ‹Ÿç£ç›˜ç»„</span></span><br><span class="line">MegaCli -cfgforeign -import -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…é™¤å¤–æ¥é…ç½®</span></span><br><span class="line">MegaCli -cfgforeign -clear -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºå‡ºç°å¤–æ¥é…ç½®(ç£ç›˜æ’å…¥çš„é¡ºåº)çš„è¿‡ç¨‹</span></span><br><span class="line">MegaCli -cfgforeign -dsply -a0</span><br></pre></td></tr></table></figure><h2 id="ç‰©ç†ç£ç›˜çš„å¤„ç†"><a href="#ç‰©ç†ç£ç›˜çš„å¤„ç†" class="headerlink" title="ç‰©ç†ç£ç›˜çš„å¤„ç†"></a>ç‰©ç†ç£ç›˜çš„å¤„ç†</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç£ç›˜çš„çŠ¶æ€ç”±FAULTYå˜æˆCONF</span></span><br><span class="line">MegaCli -PDMakeGood -PhysDrv[E0:S0] â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç£ç›˜ä¸Šçº¿</span></span><br><span class="line">MegaCli -PDOnline -PhysDrv[E0:S0,E1:S1,...] â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç£ç›˜ä¸‹çº¿</span></span><br><span class="line"><span class="meta">#</span><span class="bash">failedçŠ¶æ€çš„ç›˜å¯ä»¥ä¸‹çº¿ï¼Œç„¶åç”¨MegaCli -pdmarkmissing -physdrv[E0:S0] -a0è®©ç£ç›˜è¸¢ç›˜ï¼Œè®©å…¶ä»–çš„UNCONFçŠ¶æ€çš„ç£ç›˜æ¥æ›¿ä»£è¿™ä¸ªç›˜MegaCli -PdReplaceMissing -physdrv[E0:S0] -arrayA, -rowB -a0</span></span><br><span class="line">MegaCli -PDOffline -PhysDrv[E0:S0,E1:S1,...] â€“a0 </span><br><span class="line"><span class="meta">#</span><span class="bash">æ­¤æ—¶ç£ç›˜å¤„äºSpun downçŠ¶æ€ï¼Œå¦‚æœç”¨æ­¤ç£ç›˜æ¥å»ºç«‹raidï¼Œåˆ™ç£ç›˜çš„çŠ¶æ€è‡ªåŠ¨å˜æˆSpun Up</span></span><br><span class="line">MegaCli -PdPrpRmv -physdrv[E0:S0] â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ¸…é™¤å•ä¸ªç£ç›˜</span></span><br><span class="line">MegaCli -pdclear -start -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®çƒ­å¤‡ç›˜çš„èŠ‚ç”µç­–ç•¥</span></span><br><span class="line">MegaCli -AdpSetProp â€“DsblSpinDownHSP -val â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®ç©ºé—²ç›˜çš„èŠ‚ç”µç­–ç•¥</span></span><br><span class="line">MegaCli -AdpSetProp â€“EnblSpinDownUnConfigDrvs -val â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–æ‰€æœ‰ç£ç›˜çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">MegaCli -PDList â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–å•ä¸ªç›˜çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">MegaCli -pdInfo -PhysDrv[E0:S0] â€“a0</span><br></pre></td></tr></table></figure><h2 id="Adpsetprop-è®¾ç½®å±æ€§"><a href="#Adpsetprop-è®¾ç½®å±æ€§" class="headerlink" title="Adpsetprop è®¾ç½®å±æ€§"></a>Adpsetprop è®¾ç½®å±æ€§</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RebuildRate ï¼ŒPatrolReadRateï¼ŒBgiRateï¼ŒCCRateï¼ŒReconRateï¼Œè¡¨ç¤ºè¿›è¡Œé‡å»ºï¼Œå·¡è¯»ï¼Œåå°åˆå§‹åŒ–ï¼Œccæ ¡éªŒï¼Œæ‰©å®¹ç­‰æ‰€å æœ‰çš„ç³»ç»Ÿèµ„æºç‡ï¼Œæé«˜é€Ÿåº¦</span><br><span class="line">CoercionMode(å¼ºåˆ¶æ¨¡å¼)ï¼Œåˆ†æˆä¸‰ç§å½¢å¼ï¼ŒNoneï¼Œ128Mï¼Œ1Gï¼Œå½“ä¸º1Gæ—¶ï¼Œæ¯ä¸ªç£ç›˜æ¯”æ²¡æœ‰è®¾ç½®çš„æ—¶å‡å°‘äº†1Gçš„ç©ºé—´;</span><br><span class="line">PredFailPollIntervalï¼Œè½®è¯¢é¢„æµ‹å¤±è´¥çš„æ—¶é—´é—´éš”ã€‚Predictive Failure Countå°±æ˜¯smarté”™è¯¯;</span><br><span class="line">MaintainPdFailHistoryEnbl ä¿å­˜åç›˜çš„å†å²è®°å½•ã€‚å½“ä¸ºenableæ—¶ï¼Œå½“ä¸€ä¸ªç›˜æ‰çº¿å¹¶é‡æ–°ä¸Šçº¿ã€‚éœ€è¦æ¸…é™¤é…ç½®ä¿¡æ¯ï¼Œæ·»åŠ ä¸ºçƒ­å¤‡ç›˜æ‰å¯ä»¥é‡å»ºå½“ä¸ºdisableæ—¶ã€‚å½“ä¸€ä¸ªç›˜æ‰çº¿å¹¶é‡æ–°ä¸Šçº¿ï¼Œè‡ªåŠ¨é‡å»º;</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®Clusteræ¨¡å¼ï¼Œç›®å‰ä¸æ”¯æŒï¼Œåªèƒ½è®¾ç½®ä¸ºdisbale</span></span><br><span class="line">MegaCli -AdpSetProp ClusterEnable -0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®jbodæ¨¡å¼ï¼Œé’ˆå¯¹raid0æœ‰æ•ˆï¼Œå¯¹å•ä¸ªç›˜è¯»å†™ï¼Œå³å…ˆå†™ç¬¬ä¸€ä¸ªç›˜ï¼Œå†™æ»¡äº†åœ¨å†™ç¬¬äºŒä¸ªç›˜ã€‚MegaCli -PDMakeJBOD -physdrv[E0:S0,E1:S1] -a0 å¯ä»¥è®¾ç½®jbodæ¨¡å¼(ç›®å‰ä¸æ”¯æŒ)</span></span><br><span class="line">MegaCli -AdpSetProp -EnableJBOD -1 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®©è®¾å¤‡é©±åŠ¨æš´éœ²enclosure devices</span></span><br><span class="line">MegaCli -AdpSetProp ExposeEnclDevicesEnbl -1 -a0</span><br></pre></td></tr></table></figure><h2 id="NCQ"><a href="#NCQ" class="headerlink" title="NCQ"></a>NCQ</h2><p>Native Command Queuing (NCQ)å¯¹ç¡¬ç›˜çš„è¯»å†™å‘½ä»¤çš„é¡ºåºè¿›è¡Œä¼˜åŒ–ã€‚å¸¦ NCQ æŠ€æœ¯çš„ç¡¬ç›˜åœ¨æ¥åˆ°è¯»å†™æŒ‡ä»¤åï¼Œä¼šæ ¹æ®æŒ‡ä»¤å¯¹è®¿é—®åœ°å€è¿›è¡Œé‡æ–°æ’åºã€‚æ¯”å¦‚æ ¹æ®æŒ‡ä»¤ï¼Œç¡¬ç›˜éœ€è¦è®¿é—® 330 æ‰‡åŒºã€980 æ‰‡åŒºã€340 æ‰‡åŒºï¼Œç”±äºæ•°æ®åœ¨ç£ç›˜ä¸Šåˆ†å¸ƒä½ç½®ä¸åŒï¼Œæ™®é€šç¡¬ç›˜åªä¼šæŒ‰éƒ¨å°±ç­åœ°ä¾æ¬¡è®¿é—®ã€‚è€Œ NCQ ç¡¬ç›˜å¯¹æŒ‡ä»¤è¿›è¡Œä¼˜åŒ–æ’åˆ—ä¹‹åï¼Œå°±å¯ä»¥å…ˆè¯»å– 330 æ‰‡åŒºï¼Œæ¥ç€è¯»å– 340 æ‰‡åŒºï¼Œç„¶åå†è¯»å– 980 æ‰‡åŒºã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å‡å°‘äº†ç£å¤´è‡‚æ¥å›ç§»åŠ¨çš„æ—¶é—´ï¼Œä½¿æ•°æ®è¯»å–æ›´æœ‰æ•ˆï¼ŒåŒæ—¶æœ‰æ•ˆåœ°å»¶é•¿äº†ç¡¬ç›˜çš„ä½¿ç”¨å¯¿å‘½ã€‚<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºNCQçš„è®¾ç½®æƒ…å†µ</span></span><br><span class="line">MegaCli -adpgetprop -NCQdsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®å¼€å¯NCQ</span></span><br><span class="line">MegaCli -adpsetprop -NCQenbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å…³é—­NCQ</span></span><br><span class="line">MegaCli -adpsetprop -NCQdsbl -a0</span><br></pre></td></tr></table></figure></p><h2 id="æ·»åŠ å’Œç§»é™¤çƒ­å¤‡ç›˜"><a href="#æ·»åŠ å’Œç§»é™¤çƒ­å¤‡ç›˜" class="headerlink" title="æ·»åŠ å’Œç§»é™¤çƒ­å¤‡ç›˜"></a>æ·»åŠ å’Œç§»é™¤çƒ­å¤‡ç›˜</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ·»åŠ å±€éƒ¨çƒ­å¤‡ç›˜ï¼Œå…¶ä¸­array0è¡¨ç¤ºç¬¬0ä¸ªraid</span></span><br><span class="line">MegaCli -PDHSP -Set -Dedicated -Array0 -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ·»åŠ å…¨å±€çƒ­å¤‡ç›˜</span></span><br><span class="line">MegaCli -pdhsp -set -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ç§»é™¤å…¨å±€å’Œçƒ­å¤‡å±€éƒ¨çƒ­å¤‡</span></span><br><span class="line">MegaCli -pdhsp -rmv -physdrv[E:S] -a0</span><br></pre></td></tr></table></figure><h2 id="é‡å»º"><a href="#é‡å»º" class="headerlink" title="é‡å»º"></a>é‡å»º</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹é‡å»ºçš„è¿›åº¦</span></span><br><span class="line">MegaCli -PDRbld -progdsply -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è°ƒå¿«é‡å»ºçš„é€Ÿåº¦</span></span><br><span class="line">MegaCli -AdpSetProp RebuildRate -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®è‡ªåŠ¨é‡å»ºï¼Œå½“ä¸€ä¸ªç›˜åæ‰æ—¶ï¼Œçƒ­å¤‡ç›˜å¯ä»¥è‡ªåŠ¨é‡å»ºï¼Œä»£æ›¿åçš„ç›˜</span></span><br><span class="line">MegaCli -AdpAutoRbld -Enbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ‰‹åŠ¨å¼€å§‹é‡å»ºï¼ŒE0:S0è¡¨ç¤ºåçš„ç›˜</span></span><br><span class="line">MegaCli -PDRbld -Start -PhysDrv [E0:S0] -a0</span><br></pre></td></tr></table></figure><h2 id="æ¢å¤å‡ºå‚è®¾ç½®"><a href="#æ¢å¤å‡ºå‚è®¾ç½®" class="headerlink" title="æ¢å¤å‡ºå‚è®¾ç½®"></a>æ¢å¤å‡ºå‚è®¾ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ¢å¤å‡ºå‚çš„é»˜è®¤é…ç½®</span></span><br><span class="line">MegaCli -AdpFacDefSet â€“a0</span><br></pre></td></tr></table></figure><h2 id="å‘Šè­¦"><a href="#å‘Šè­¦" class="headerlink" title="å‘Šè­¦"></a>å‘Šè­¦</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ä¸´æ—¶å…³é—­ï¼Œé‡å¯åˆå˜æˆå¼€å¯</span></span><br><span class="line">MegaCli -AdpSetProp -AlarmSilence â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ°¸ä¹…å…³é—­ï¼Œé‡å¯åè¿˜æ˜¯å…³é—­</span></span><br><span class="line">MegaCli -AdpSetProp -AlarmDsbl â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¼€å¯</span></span><br><span class="line">MegaCli -AdpSetProp -Alarmenbl â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹å‘Šè­¦çš„çŠ¶æ€</span></span><br><span class="line">MegaCli -AdpgetProp -Alarmdsply â€“a0</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç›¸å…³"><a href="#é…ç½®ç›¸å…³" class="headerlink" title="é…ç½®ç›¸å…³"></a>é…ç½®ç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¯ä»¥æŸ¥çœ‹ä¸€ç»„ç£ç›˜ä¸Šçš„å¤šä¸ªraidçš„é…ç½®</span></span><br><span class="line">MegaCli -CfgDsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿å­˜é…ç½®æ–‡ä»¶</span></span><br><span class="line">MegaCli -CfgSave -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯¼å…¥é…ç½®æ–‡ä»¶ï¼ŒRaidç»„çš„é…ç½®æ–‡ä»¶æ”¾åœ¨æœ€åï¼Œæ”¾åœ¨æ¯ä¸ªç£ç›˜çš„æœ€å512Mï¼Œä¸»è¦åŒ…å«æ•°æ®ä»å“ªé‡Œå¼€å§‹å†™çš„é…ç½®å’Œç”¨æ¥Migration çš„swapæ–‡ä»¶</span></span><br><span class="line">MegaCli -CfgRestore -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨æ—¶æ¢å¤å¤–æ¥é…ç½®</span></span><br><span class="line">MegaCli -AdpSetProp -AutoEnhancedImportEnbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">éªŒè¯é…ç½®æ–‡ä»¶å’Œæ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">MegaCli -AdpSetVerify -f fileName -a0</span><br></pre></td></tr></table></figure><h2 id="RAID-å¡ç›¸å…³"><a href="#RAID-å¡ç›¸å…³" class="headerlink" title="RAID å¡ç›¸å…³"></a>RAID å¡ç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹raidçš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">MegaCli -adpallinfo -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å…³é—­raidå¡</span></span><br><span class="line">MegaCli -adpShutDown -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–raidçš„æ—¶é—´</span></span><br><span class="line">MegaCli -adpGetTime -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯¹raidè¿›è¡Œè¯Šæ–­</span></span><br><span class="line">MegaCli -AdpDiag val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®è´Ÿè½½å‡è¡¡ï¼ŒRaidå¡å¯¹ç»ˆç«¯è®¾å¤‡é‡‡ç”¨å¤šè·¯å¾„è®¿é—®ï¼Œä¸€åŠçš„è®¾å¤‡é€šè¿‡ä¸€æ¡è·¯å¾„ï¼Œå¦ä¸€åŠçš„è®¾å¤‡é€šè¿‡å¦ä¸€æ¡è·¯å¾„ï¼Œä¸€æ¡é€”å¾„æœ‰ç›˜æ’å…¥å’Œç§»é™¤æ—¶ï¼Œå¯åŠ¨è´Ÿè½½å¹³è¡¡ï¼Œé¿å…è®¾å¤‡æœ‰é‡ç”¨</span></span><br><span class="line">MegaCli -AdpSetProp â€“LoadBalanceMode -val â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–raidå¡çš„ä¸ªæ•°</span></span><br><span class="line">MegaCli â€“adpCount</span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–pciä¿¡æ¯</span></span><br><span class="line">MegaCli -AdpGetPciInfo -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">Raidå¡çš„åœ¨çº¿é‡ç½®ï¼Œfwé‡ç½®raidå¡æ§åˆ¶å™¨èŠ¯ç‰‡</span></span><br><span class="line">MegaCli -AdpSetProp DisableOCR -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºraidå¡ï¼Œç³»ç»Ÿç­‰çš„ä¸€äº›ç®€å•ä¿¡æ¯</span></span><br><span class="line">MegaCli -ShowSummary -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æ˜¾ç¤ºæ¯ä¸ªphyçš„é”™è¯¯æ•°</span></span><br><span class="line">MegaCli -PhyErrorCounters -a0</span><br></pre></td></tr></table></figure><h2 id="Enclosure-çš„ä¿¡æ¯"><a href="#Enclosure-çš„ä¿¡æ¯" class="headerlink" title="Enclosure çš„ä¿¡æ¯"></a>Enclosure çš„ä¿¡æ¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æœºæŸœçš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">MegaCli -encinfo -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æœºæŸœçš„çŠ¶æ€</span></span><br><span class="line">MegaCli -encstatus -a0</span><br></pre></td></tr></table></figure><h2 id="BIOS-ç›¸å…³"><a href="#BIOS-ç›¸å…³" class="headerlink" title="BIOS ç›¸å…³"></a>BIOS ç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">åœ¨å¯åŠ¨æ—¶è¦æŒ‰ä»»æ„é”®æ‰å¯ä»¥å¯åŠ¨è¿™ç§æƒ…å†µè®¾ç½®è¿™ä¸ªå‚æ•°ã€‚ä½†æ˜¯é¦–å…ˆè¦ç¡®ä¿ bios å¤„äº <span class="built_in">enable</span> çŠ¶æ€ã€‚é€šè¿‡ MegaCli -AdpBIOS -dsply -a0å¯ä»¥æŸ¥çœ‹ã€‚å¦‚æœä¸æ˜¯ï¼Œå…ˆç”¨MegaCli -AdpBIOS -enbl -a0æ¥è®¾ç½®</span></span><br><span class="line">MegaCli â€“AdpBIOS â€“BE â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŠŠå½“å‰çš„Raidç»„ä½œä¸ºå¯åŠ¨</span></span><br><span class="line">MegaCli â€“AdpBootDrive -set -L0 -a0</span><br></pre></td></tr></table></figure><h2 id="èƒŒæ¿ç›¸å…³"><a href="#èƒŒæ¿ç›¸å…³" class="headerlink" title="èƒŒæ¿ç›¸å…³"></a>èƒŒæ¿ç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœèƒŒæ¿ <span class="built_in">disable</span> æ—¶ï¼Œä¼šè‡ªåŠ¨çš„å»æ£€æµ‹èƒŒæ¿</span></span><br><span class="line">MegaCli -AdpSetProp -AutoDetectBackPlaneDsbl -val â€“a0</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨æ—¶ä¸Šç”µ"><a href="#å¯åŠ¨æ—¶ä¸Šç”µ" class="headerlink" title="å¯åŠ¨æ—¶ä¸Šç”µ"></a>å¯åŠ¨æ—¶ä¸Šç”µ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®ä¸€æ¬¡ä¸Šç”µçš„ç£ç›˜çš„ä¸ªæ•°</span></span><br><span class="line">MegaCli -AdpSetProp SpinupDriveCount -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®ä¸Šç”µçš„å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line">MegaCli -AdpSetProp SpinupDelay -val -a0</span><br></pre></td></tr></table></figure><h2 id="åˆ·æ–°ç¼“å­˜"><a href="#åˆ·æ–°ç¼“å­˜" class="headerlink" title="åˆ·æ–°ç¼“å­˜"></a>åˆ·æ–°ç¼“å­˜</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">åˆ·æ–°raidå¡ç¼“å­˜</span></span><br><span class="line">MegaCli -AdpCacheFlush â€“a0</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ·ç¼“å­˜çš„æ—¶é—´é—´éš”</span></span><br><span class="line">MegaCli -AdpSetProp CacheFlushInterval â€“val â€“a0</span><br></pre></td></tr></table></figure><h2 id="è®©ç¡¬ç›˜-LED-ç¯é—ªçƒ"><a href="#è®©ç¡¬ç›˜-LED-ç¯é—ªçƒ" class="headerlink" title="è®©ç¡¬ç›˜ LED ç¯é—ªçƒ"></a>è®©ç¡¬ç›˜ LED ç¯é—ªçƒ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¼€å¯blink</span></span><br><span class="line">MegaCli -AdpSetProp UseDiskActivityforLocate -1 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®©ç¡¬ç›˜LEDç¯é—ªçƒ</span></span><br><span class="line">MegaCli -PdLocate -start â€“physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">åœæ‰ç¡¬ç›˜LEDç¯</span></span><br><span class="line">MegaCli -PdLocate -stopt â€“physdrv[E:S] -a0</span><br></pre></td></tr></table></figure><h2 id="ç”µæ± å‘Šè­¦"><a href="#ç”µæ± å‘Šè­¦" class="headerlink" title="ç”µæ± å‘Šè­¦"></a>ç”µæ± å‘Šè­¦</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpSetProp BatWarnDsbl -val -a0</span><br></pre></td></tr></table></figure><h2 id="çº é”™ç ç›¸å…³"><a href="#çº é”™ç ç›¸å…³" class="headerlink" title="çº é”™ç ç›¸å…³"></a>çº é”™ç ç›¸å…³</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®çº é”™ç æ¼æ¡¶çš„å­—èŠ‚æ•°</span></span><br><span class="line">MegaCli -AdpSetProp EccBucketSize -val -a0</span><br></pre></td></tr></table></figure><h2 id="åå°åˆå§‹åŒ–ï¼Œå®Œå…¨åˆå§‹åŒ–ï¼Œcc-æ ¡éªŒï¼Œå·¡è¯»ç­‰ä¹‹é—´çš„å…³ç³»"><a href="#åå°åˆå§‹åŒ–ï¼Œå®Œå…¨åˆå§‹åŒ–ï¼Œcc-æ ¡éªŒï¼Œå·¡è¯»ç­‰ä¹‹é—´çš„å…³ç³»" class="headerlink" title="åå°åˆå§‹åŒ–ï¼Œå®Œå…¨åˆå§‹åŒ–ï¼Œcc æ ¡éªŒï¼Œå·¡è¯»ç­‰ä¹‹é—´çš„å…³ç³»"></a>åå°åˆå§‹åŒ–ï¼Œå®Œå…¨åˆå§‹åŒ–ï¼Œcc æ ¡éªŒï¼Œå·¡è¯»ç­‰ä¹‹é—´çš„å…³ç³»</h2><p>åå°åˆå§‹åŒ–å’Œå®Œå…¨åˆå§‹åŒ–ï¼Œcc æ ¡éªŒæ—¶ä¸èƒ½è¿›è¡Œå·¡è¯»;<br>å·¡è¯»æ—¶å¯ä»¥åå°åˆå§‹åŒ–å’Œå®Œå…¨åˆå§‹åŒ–ï¼Œæ­¤æ—¶å·¡è¯»ç»“æŸ;;<br>åœ¨åå°åˆå§‹åŒ–å’Œ cc æ ¡éªŒæ—¶ï¼Œä¸èƒ½å¼€å§‹å®Œå…¨åˆå§‹åŒ–;<br>æ‰©å®¹æ—¶ä¸èƒ½å»º raidï¼Œä¸èƒ½æ·»åŠ çƒ­å¤‡ç›˜;<br>rebuild çš„ä¼˜å…ˆçº§é«˜äº copyback;</p><h2 id="RAID-çš„åˆ›å»ºä¸åˆ é™¤"><a href="#RAID-çš„åˆ›å»ºä¸åˆ é™¤" class="headerlink" title="RAID çš„åˆ›å»ºä¸åˆ é™¤"></a>RAID çš„åˆ›å»ºä¸åˆ é™¤</h2><ul><li>åˆ›å»º raid 0ï¼Œ1ï¼Œ5ï¼Œ6</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">MegaCli -CfgLdAdd -rX[E0:S0,E1:S1,...] [WT|WB] [NORA|RA|ADRA] [Direct|Cached] [CachedBadBBU|NoCachedBadBBU] [-szXXX [-szYYY ...]] [-strpszM] [-Hsp[E0:S0,...]] [-AfterLdX] [-Force]|[FDE|CtrlBased] -a0 å¯ä»¥è®¾ç½®å†™æ¨¡å¼(wtï¼Œwb)ï¼Œè¯»æ¨¡å¼(raï¼Œnoraï¼Œadra)ï¼Œç¼“å­˜æ¨¡å¼(directï¼Œcached)ï¼Œå¤§å°(sz)ï¼Œæ¡å—å¤§å°(strpszM)ç­‰ã€‚æ¯”å¦‚1000Gï¼Œåªç”¨æŒ‡å®šç›˜çš„ä¸€éƒ¨åˆ†(sz1000G)ï¼Œè®¾ç½®æ¡å—çš„å¤§å°strpsz(è®¾ç½®ä¸º16kï¼Œåˆ™ä¸ºstrpsz16)</span></span><br><span class="line">MegaCli -cfgldadd -r5[117:1,117:3,117:11] -wb -ra -cached -cachedbadbbu -force -a0</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º raid 10ï¼Œ50ï¼Œ60</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">MegaCli -CfgSpanAdd -rX-Array0[E0:S0,E1:S1] -Array1[E0:S0,E1:S1] [-ArrayX[E0:S0,E1:S1] ...] [WT|WB] [NORA|RA|ADRA] [Direct|Cached] [CachedBadBBU| NoCachedBadBBU] [-szXXX[-szYYY ...]][-strpszM][-AfterLdX][-Force] |[FDE|CtrlBased] -aN</span></span><br><span class="line">MegaCli -CfgSpanAdd -r10 -Array0[245:0,245:1] Array1[245:2,245:3] -WB -RA -Cached -Cachedbadbbu -a0</span><br></pre></td></tr></table></figure><ul><li>æ‰¹é‡åˆ›å»º raid0</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æŠŠæ¯ä¸ªæ§½ä½çš„ç£ç›˜éƒ½åˆ›å»ºä¸ºåªæœ‰ä¸€ä¸ªç›˜çš„raid0</span></span><br><span class="line">MegaCli -CfgEachDskRaid0 -wb -ra -cached -cachedbadbbu -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">æŠŠæ‰€æœ‰çš„ç©ºé—²ç›˜éƒ½åŠ å…¥åˆ°raidä¸­</span></span><br><span class="line">MegaCli -CfgAllFreeDrv -r5 -SATAOnly -wb -ra -cached -cachedbadbbu -a0</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤ raid ç»„</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æ¸…é™¤æ‰€æœ‰çš„raidç»„çš„é…ç½®</span></span><br><span class="line">MegaCli -cfgclr -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æŒ‡å®šçš„raidç»„(Target Id: 0)çš„raidç»„</span></span><br><span class="line">MegaCli -cfglddel -L0 -a0</span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®-RAID-ç»„çš„å±æ€§"><a href="#è®¾ç½®-RAID-ç»„çš„å±æ€§" class="headerlink" title="è®¾ç½® RAID ç»„çš„å±æ€§"></a>è®¾ç½® RAID ç»„çš„å±æ€§</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®raidç»„çš„åå­—</span></span><br><span class="line">MegaCli -ldsetprop -name dg -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®è®¿é—®ç­–ç•¥ä¸ºè¯»å†™ï¼ŒMegaCli -ldsetprop -blocked -L0 -a0è®¾ç½®è®¿é—®ç­–ç•¥ä¸ºé˜»å¡ï¼Œæ­¤æ—¶raidç»„çš„è®¾å¤‡ä¸å¯ä»¥è®¿é—®ï¼Œfdisk -lä¸èƒ½å‘ç°è®¾å¤‡</span></span><br><span class="line">MegaCli -ldsetprop -rw -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®å†™ç­–ç•¥ä¸ºwt(ç›´å†™)ï¼Œç›´æ¥å†™å…¥åˆ°ç¡¬ç›˜ä¸Šï¼Œç„¶åå†è¿”å›ã€‚wbæ¨¡å¼æ˜¯å†™å…¥åˆ°ç¼“å­˜ä¸­å°±è¿”å›ï¼Œè®¾ç½®wbæ¨¡å¼å†™é€Ÿåº¦æœ‰æ˜¾è‘—çš„æ”¹å–„ï¼Œæé«˜åˆ°12å€</span></span><br><span class="line">MegaCli -ldsetprop -wt -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®è¯»ç­–ç•¥ä¸ºra(é¢„å…ˆè¯»å‡ºä¸€å®šçš„æ•°æ®)ï¼Œè¿˜æœ‰noraæ¨¡å¼ï¼Œraæ¨¡å¼è¯»å¯ä»¥æé«˜åˆ°2å€å·¦å³</span></span><br><span class="line">MegaCli -ldsetprop -ra -L0 -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash">è®¾ç½®ç¼“å­˜ç­–ç•¥ä¸ºcached</span></span><br><span class="line">MegaCli -ldsetprop -cached -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">å¼€å¯ç£ç›˜çš„ç¼“å­˜ï¼Œå¯¹å†™é€Ÿåº¦æœ‰ä¸€å®šçš„æé«˜(1.4å€)</span></span><br><span class="line">MegaCli -ldsetprop -endskcache -L0 -a0</span><br></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢ç¯‡"><a href="#æŸ¥è¯¢ç¯‡" class="headerlink" title="æŸ¥è¯¢ç¯‡"></a>æŸ¥è¯¢ç¯‡</h2><ul><li><p>æ˜¾ç¤º BBU çŠ¶æ€ä¿¡æ¯    </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuStatus â€“aALL </span><br><span class="line">``` </span><br><span class="line">- æ˜¾ç¤º BBU å®¹é‡ä¿¡æ¯    </span><br><span class="line">```shell</span><br><span class="line">MegaCli -AdpBbuCmd -GetBbuCapacityInfo â€“aALL</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤º BBU è®¾è®¡å‚æ•°    </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuDesignInfo â€“aALL</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤ºå½“å‰ BBU å±æ€§   </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuProperties â€“aALL</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å……ç”µçŠ¶æ€    </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuStatus -aALL |grep "Charger Status"</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å……ç”µè¿›åº¦ç™¾åˆ†æ¯”     </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuStatus -aALL |grep "Relative State of Charge"</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ‰€æœ‰ç‰©ç†ç£ç›˜ä¿¡æ¯     </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDList -aALL</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤ºæ‰€æœ‰é€»è¾‘ç£ç›˜ç»„ä¿¡æ¯     </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDInfo -LALL â€“aAll</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç‰©ç†ç£ç›˜é‡å»ºè¿›åº¦(é‡è¦)</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDRbld -ShowProg -PhysDrv [1:5] -a0</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é€‚é…å™¨ä¸ªæ•°    </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli â€“adpCount</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é€‚é…å™¨æ—¶é—´     </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpGetTime â€“aALL</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤ºæ‰€æœ‰é€‚é…å™¨ä¿¡æ¯    </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpAllInfo â€“aAll</span><br></pre></td></tr></table></figure></li><li><p>æ˜¾ç¤º RAID å¡å‹å·ï¼ŒRAID è®¾ç½®ï¼ŒDisk ç›¸å…³ä¿¡æ¯      </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -cfgdsply â€“aALL</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢ RAID é˜µåˆ—ä¸ªæ•°    </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -cfgdsply -aALL |grep "Number of DISK GROUPS:"</span><br><span class="line">``` </span><br><span class="line">- æŸ¥çœ‹ Cache ç­–ç•¥è®¾ç½®    </span><br><span class="line">```shell</span><br><span class="line">MegaCli -cfgdsply -aALL |grep Polic</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç£ç›˜ç¼“å­˜ç­–ç•¥ </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> L----&gt;[VD num or ALL] a----&gt;[Adapter num or ALL]</span></span><br><span class="line">MegaCli -LDGetProp -Cache -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">MegaCli -LDGetProp -DskCache -LALL -aALL</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ç‰©ç†ç£ç›˜é‡å»ºè¿›åº¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDRbld -ShowProg -PhysDrv [1:5] -a0</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ Megacli çš„ log</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -FwTermLog dsply -a0 &gt; adp2.log</span><br></pre></td></tr></table></figure></li></ul><h2 id="è®¾ç½®ç¯‡"><a href="#è®¾ç½®ç¯‡" class="headerlink" title="è®¾ç½®ç¯‡"></a>è®¾ç½®ç¯‡</h2><h3 id="åˆ›å»º-åˆ é™¤é˜µåˆ—"><a href="#åˆ›å»º-åˆ é™¤é˜µåˆ—" class="headerlink" title="åˆ›å»º/åˆ é™¤é˜µåˆ—"></a>åˆ›å»º/åˆ é™¤é˜µåˆ—</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºä¸€ä¸ª RAID5 é˜µåˆ—ï¼Œç”±ç‰©ç†ç›˜ 2,3,4 æ„æˆï¼Œè¯¥é˜µåˆ—çš„çƒ­å¤‡ç›˜æ˜¯ç‰©ç†ç›˜ 5 </span></span><br><span class="line">MegaCli -CfgLdAdd -r5 [1:2,1:3,1:4] WB Direct -Hsp[1:5] â€“a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé˜µåˆ—ï¼Œä¸æŒ‡å®šçƒ­å¤‡ </span></span><br><span class="line">MegaCli -CfgLdAdd -r5 [1:2,1:3,1:4] WB Direct â€“a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤é˜µåˆ— </span></span><br><span class="line">MegaCli -CfgLdDel -L1 â€“a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨çº¿æ·»åŠ ç£ç›˜ </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å»ºé€»è¾‘ç£ç›˜ç»„ 1 , RAID çº§åˆ«æ˜¯5ï¼Œæ·»åŠ ç‰©ç†ç£ç›˜å· 1:4ã€‚</span></span><br><span class="line">MegaCli -LDRecon -Start -r5 -Add -PhysDrv[1:4] -L1 -a0</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼š</strong>é‡å»ºå®Œåï¼Œæ–°æ·»åŠ çš„ç‰©ç†ç£ç›˜ä¼šè‡ªåŠ¨å¤„äºé‡å»º(åŒæ­¥)çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™ <code>fdisk -l</code>æ˜¯çœ‹ä¸åˆ°é˜µåˆ—çš„ç©ºé—´å˜å¤§çš„ï¼Œåªæœ‰åœ¨ç³»ç»Ÿé‡å¯åæ‰èƒ½çœ‹è§ã€‚ </p><h3 id="æŸ¥çœ‹é˜µåˆ—åˆå§‹åŒ–ä¿¡æ¯"><a href="#æŸ¥çœ‹é˜µåˆ—åˆå§‹åŒ–ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹é˜µåˆ—åˆå§‹åŒ–ä¿¡æ¯"></a>æŸ¥çœ‹é˜µåˆ—åˆå§‹åŒ–ä¿¡æ¯</h3><ul><li><p>é˜µåˆ—åˆ›å»ºå®Œåï¼Œä¼šæœ‰ä¸€ä¸ªåˆå§‹åŒ–åŒæ­¥å—çš„è¿‡ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹å…¶è¿›åº¦ã€‚ </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDInit -ShowProg -LALL -aALL </span><br><span class="line"><span class="meta">#</span><span class="bash"> or ä»¥åŠ¨æ€å¯è§†åŒ–æ–‡å­—ç•Œé¢æ˜¾ç¤º </span></span><br><span class="line">MegaCli -LDInit -ProgDsply -LALL â€“aALL</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é˜µåˆ—åå°åˆå§‹åŒ–è¿›åº¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDBI -ShowProg -LALL -aALL </span><br><span class="line"><span class="meta">#</span><span class="bash"> or ä»¥åŠ¨æ€å¯è§†åŒ–æ–‡å­—ç•Œé¢æ˜¾ç¤º </span></span><br><span class="line">MegaCli -LDBI -ProgDsply -LALL -aALL</span><br></pre></td></tr></table></figure></li></ul><h3 id="è®¾ç½®ç£ç›˜ç¼“å­˜ç­–ç•¥"><a href="#è®¾ç½®ç£ç›˜ç¼“å­˜ç­–ç•¥" class="headerlink" title="è®¾ç½®ç£ç›˜ç¼“å­˜ç­–ç•¥"></a>è®¾ç½®ç£ç›˜ç¼“å­˜ç­–ç•¥</h3><p>ç¼“å­˜ç­–ç•¥è§£é‡Šï¼š</p><table><thead><tr><th style="text-align:left">ä»£ç </th><th style="text-align:left">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left">WT</td><td style="text-align:left">(Write through)</td></tr><tr><td style="text-align:left">WB</td><td style="text-align:left">(Write back)</td></tr><tr><td style="text-align:left">NORA</td><td style="text-align:left">(No read ahead)</td></tr><tr><td style="text-align:left">RA</td><td style="text-align:left">(Read ahead)</td></tr><tr><td style="text-align:left">ADRA</td><td style="text-align:left">(Adaptive read ahead)</td></tr><tr><td style="text-align:left">Cached</td><td style="text-align:left">-</td></tr><tr><td style="text-align:left">Direct</td><td style="text-align:left">-</td></tr></tbody></table><p>egï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDSetProp WT|WB|NORA|RA|ADRA -L0 -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">MegaCli -LDSetProp -Cached|-Direct -L0 -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">- enable / disable disk cache </span><br><span class="line">MegaCli -LDSetProp -EnDskCache|-DisDskCache -L0 -a0</span><br></pre></td></tr></table></figure><h3 id="çƒ­å¤‡ç®¡ç†"><a href="#çƒ­å¤‡ç®¡ç†" class="headerlink" title="çƒ­å¤‡ç®¡ç†"></a>çƒ­å¤‡ç®¡ç†</h3><ul><li>åˆ›å»ºçƒ­å¤‡</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> [1:5]----&gt;[E:S]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šç¬¬ 5 å—ç›˜ä½œä¸ºå…¨å±€çƒ­å¤‡</span></span><br><span class="line">MegaCli -PDHSP -Set [-EnclAffinity] [-nonRevertible] -PhysDrv[1:5] -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> egï¼š</span></span><br><span class="line">MegaCli -PDHSP   -Set   -Dedicated  -Array0  -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºæŸä¸ªé˜µåˆ—æŒ‡å®šä¸“ç”¨çƒ­å¤‡ </span></span><br><span class="line">MegaCli -PDHSP -Set [-Dedicated [-Array1]] [-EnclAffinity] [-nonRevertible] -PhysDrv[1:5] -a0</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤çƒ­å¤‡</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDHSP -rmv -PhysDrv[1:5] -a0</span><br></pre></td></tr></table></figure><ul><li>å°†æŸå—ç‰©ç†ç›˜ä¸‹çº¿/ä¸Šçº¿ <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹çº¿</span></span><br><span class="line">MegaCli -PDOffline -PhysDrv [1:4] -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸Šçº¿</span></span><br><span class="line">MegaCli -PDOnline -PhysDrv [1:4] -a0</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ³¨ï¼š</strong>å¦‚æœç›´æ¥åˆ é™¤ RAID è€Œä¸æ“ä½œçƒ­å¤‡ï¼Œå…¶å±€éƒ¨çƒ­å¤‡ä¼šå˜ä¸ºå…¨å±€çƒ­å¤‡ï¼Œè€Œä¸æ˜¯åˆ é™¤ã€‚</p><h2 id="ç®¡ç†ç¯‡"><a href="#ç®¡ç†ç¯‡" class="headerlink" title="ç®¡ç†ç¯‡"></a>ç®¡ç†ç¯‡</h2><ul><li><p>ç‚¹äº®æŒ‡å®šç¡¬ç›˜ï¼ˆå®šä½ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PdLocate -start -physdrv[252:2] -a0</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ RAID é˜µåˆ—ä¸­æ‰çº¿çš„ç›˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -pdgetmissing -a0</span><br></pre></td></tr></table></figure></li><li><p>æ›¿æ¢åæ‰çš„æ¨¡å—</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -pdreplacemissing -physdrv[12:10] -Array5 -row0 -a0</span><br></pre></td></tr></table></figure></li><li><p>æ‰‹åŠ¨å¼€å¯ rebuid</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -pdrbld -start -physdrv[12:10] -a0</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ Megacli çš„ log</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -FwTermLog dsply -a0 &gt; adp2.log</span><br></pre></td></tr></table></figure></li><li><p>å…³é—­ Rebuild</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpAutoRbld -Dsbl -a0</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½® rebuild çš„é€Ÿç‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpSetProp RebuildRate -30 -a0</span><br></pre></td></tr></table></figure></li></ul><h3 id="foreign-ç®¡ç†"><a href="#foreign-ç®¡ç†" class="headerlink" title="foreign ç®¡ç†"></a>foreign ç®¡ç†</h3><p>åˆ›å»º RAID å‰, éœ€è¦æ£€æµ‹æ˜¯å¦å…·æœ‰<code>foreign</code>é…ç½®, å¦‚æœæœ‰ä½†æ­¤æ—¶ä¸éœ€è¦ä¿ç•™ RAID æ—¶éœ€è¦æ¸…é™¤ RAID çš„ <code>foreign</code>çŠ¶æ€ã€‚</p><ul><li><p>æ£€æµ‹æ˜¯å¦å…·æœ‰ <code>foreign</code> é…ç½®</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDlist -aALL | grep "Foreign State"</span><br></pre></td></tr></table></figure></li><li><p>å°†æ ‡æ³¨ä¸º <code>Foreign</code> ç£ç›˜æ ‡æ³¨ä¸º<code>unconfigrue good</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDMakeGood -PhysDrv[32:5] -a0</span><br></pre></td></tr></table></figure></li><li><p>æ¸…é™¤ <code>foreign</code> é…ç½®</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -CfgForeign -Scan -a0</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ³¨</strong>ï¼šä¸€èˆ¬ä»¥ä¸Šä¸¤æ¡éƒ½è¦æ‰§è¡Œæ‰èƒ½æ¸…é™¤ <code>foreign</code> çŠ¶æ€</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>ç£ç›˜çŠ¶æ€ State<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">("Failed", "Online, Spun Up", "Online, Spun Down", "Unconfigured(bad)", "Unconfigured(good), Spun down", "Hotspare, Spun down", "Hotspare, Spun up" or "not Online")</span><br></pre></td></tr></table></figure></p><h2 id="Unsolved"><a href="#Unsolved" class="headerlink" title="Unsolved"></a>Unsolved</h2><ul><li>æ‰©å±• RAIDï¼ˆåŠ ç›˜ï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDRecon -Start -r1 -Add -PhysDrv[252:1] -L1 -a0                                     </span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠ¥é”™</span></span><br><span class="line">Failed to Start Reconstruction of Virtual Drive.</span><br><span class="line"></span><br><span class="line">FW error description: </span><br><span class="line"> The requested command has invalid arguments.  </span><br><span class="line"></span><br><span class="line">Exit Code: 0x03</span><br></pre></td></tr></table></figure><p><a href="http://en.community.dell.com/support-forums/servers/f/956/t/19531272" target="_blank" rel="noopener">å‚è§è¿™é‡Œ 1</a></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.broadcom.com/site-search?q=megacli" target="_blank" rel="noopener">å®˜æ–¹èµ„æºä¸‹è½½-broadcom</a></li><li><a href="https://techedemic.com/2014/08/07/dell-perclsi-megacli-how-to-install/" target="_blank" rel="noopener">Dell â€“ PERC/LSI MegaCLI â€“ How to install</a></li><li><a href="https://hwraid.le-vert.net/wiki/LSIMegaRAIDSAS#a3.1.megactl" target="_blank" rel="noopener">LSIMegaRAIDSAS</a></li><li><a href="http://zh.community.dell.com/techcenter/b/weblog/archive/2013/03/07/megacli-command-share" target="_blank" rel="noopener">DELL ç£ç›˜é˜µåˆ—æ§åˆ¶å¡ï¼ˆRAID å¡ï¼‰MegaCli å¸¸ç”¨ç®¡ç†å‘½ä»¤æ±‡æ€»</a></li><li><a href="http://blog.csdn.net/heart_2011/article/details/7254404" target="_blank" rel="noopener">MegaCli å‘½ä»¤æ€»ç»“ - CSDN åšå®¢</a></li><li><a href="http://www.ha97.com/4073.html" target="_blank" rel="noopener">Linux ä¸‹æŸ¥çœ‹ Raid ç£ç›˜é˜µåˆ—ä¿¡æ¯çš„æ–¹æ³•</a></li><li><a href="http://www.mamicode.com/info-detail-860128.html" target="_blank" rel="noopener">Megacli å¸¸ç”¨å‘½ä»¤</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­˜å‚¨ </tag>
            
            <tag> Linux </tag>
            
            <tag> RAID </tag>
            
            <tag> MegaCli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨æ­å»º Hexo ä¸­é‡åˆ°çš„é—®é¢˜è®°å½•</title>
      <link href="/blog/2017-11-18/how-to-build-hexo-blog/"/>
      <url>/blog/2017-11-18/how-to-build-hexo-blog/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p><img src="/images/v2-4b229aa661f0d337bd16390761963842.jpg" alt="Github loves Hexo"></p><p><br></p><p>åœ¨ç½‘ç»œä¸Šæœç´¢ä¸€å¤©å¤šæ‰ç£•ç£•ç»Šç»Šæ­å»ºå¥½è¿™ä¸ªåšå®¢ï¼Œâ„(â„ â„â€¢â„Ï‰â„â€¢â„ â„)â„ ç°åœ¨æŠŠè¿‡ç¨‹ä¸­é‡åˆ°çš„å‘è®°å½•ä¸€ä¸‹ï¼Œå¸Œæœ›å¯ä»¥ç»™ä¹‹åçš„åŒå­¦ä»¬å¸¦æ¥å¸®åŠ©ã€‚<br><a id="more"></a></p><h2 id="npm-åŒ…ç®¡ç†å®‰è£…å¤ªæ…¢æ€ä¹ˆåŠ"><a href="#npm-åŒ…ç®¡ç†å®‰è£…å¤ªæ…¢æ€ä¹ˆåŠ" class="headerlink" title="npm åŒ…ç®¡ç†å®‰è£…å¤ªæ…¢æ€ä¹ˆåŠ"></a>npm åŒ…ç®¡ç†å®‰è£…å¤ªæ…¢æ€ä¹ˆåŠ</h2><ul><li><p>ä¸´æ—¶ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm --registry https://registry.npm.taobao.org install express</span><br></pre></td></tr></table></figure></li><li><p>æŒä¹…ä½¿ç”¨(æ›´æ¢æºé“¾æ¥ä¸ºæ·˜å®æº)</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org</span><br><span class="line"><span class="meta">#</span><span class="bash"> é…ç½®åå¯é€šè¿‡ä¸‹é¢æ–¹å¼æ¥éªŒè¯æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">npm config get registry</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line">npm info express</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ cnpm ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"># ä½¿ç”¨</span><br><span class="line">cnpm install expresstall express</span><br></pre></td></tr></table></figure></li></ul><p>è¿˜å¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªå·¥å…·:</p><p><a href="https://segmentfault.com/a/1190000000473869" target="_blank" rel="noopener">nrm â€”â€” å¿«é€Ÿåˆ‡æ¢ NPM æº ï¼ˆé™„å¸¦æµ‹é€ŸåŠŸèƒ½ï¼‰</a></p><h2 id="æˆ‘æœ‰ä¸¤å°ç”µè„‘-æ¢ç”µè„‘åå¦‚ä½•é‡æ–°å‘å¸ƒåšå®¢"><a href="#æˆ‘æœ‰ä¸¤å°ç”µè„‘-æ¢ç”µè„‘åå¦‚ä½•é‡æ–°å‘å¸ƒåšå®¢" class="headerlink" title="æˆ‘æœ‰ä¸¤å°ç”µè„‘/æ¢ç”µè„‘åå¦‚ä½•é‡æ–°å‘å¸ƒåšå®¢"></a>æˆ‘æœ‰ä¸¤å°ç”µè„‘/æ¢ç”µè„‘åå¦‚ä½•é‡æ–°å‘å¸ƒåšå®¢</h2><p>ä½¿ç”¨ Github çš„ branch åŠŸèƒ½å»ºç«‹ä¸¤ä¸ªåˆ†æ”¯ï¼Œï¼ˆå¦‚ï¼šmaster å’Œ hexoï¼‰è®¾ç½® hexo åˆ†æ”¯ä¸ºé»˜è®¤åˆ†æ”¯ï¼Œç„¶åå°†åšå®¢åå°é…ç½®æ–‡ä»¶å…¨éƒ¨<code>push</code>åˆ°è¯¥åˆ†æ”¯ã€‚master ç«¯ä¸ºä½¿ç”¨<code>hexo d</code>å‘½ä»¤å‘å¸ƒåˆ†æ”¯ã€‚</p><p><strong>æ³¨ï¼š</strong>master åˆ†æ”¯ä¸èƒ½å½“ä½œä»–ç”¨ï¼Œåªèƒ½ä½œä¸º hexo å‘å¸ƒä¹‹åä½¿ç”¨ã€‚</p><p>å¯ä»¥å‚è€ƒä¸‹é¢é“¾æ¥é…ç½®<br><a href="http://www.jianshu.com/p/beb8d611340a" target="_blank" rel="noopener">Hexo åšå®¢ä»ä¸€å°ç”µè„‘è¿ç§»åˆ°å…¶ä»–ç”µè„‘ - ç®€ä¹¦</a></p><h2 id="å¦‚ä½•è®¾ç½®è…¾è®¯å…¬ç›Šä¸º-404-é¡µé¢"><a href="#å¦‚ä½•è®¾ç½®è…¾è®¯å…¬ç›Šä¸º-404-é¡µé¢" class="headerlink" title="å¦‚ä½•è®¾ç½®è…¾è®¯å…¬ç›Šä¸º 404 é¡µé¢"></a>å¦‚ä½•è®¾ç½®è…¾è®¯å…¬ç›Šä¸º 404 é¡µé¢</h2><p>ä»¥ä¸‹æ˜¯çŸ¥ä¹ç½‘å‹ç»™å‡ºçš„å›ç­”ï¼š</p><blockquote><p>ç›´æ¥åœ¨ source æ ¹ç›®å½•ä¸‹åˆ›å»ºè‡ªå·±çš„<code>404.html</code>å³å¯ã€‚<del>ä½†æ˜¯è‡ªå®šä¹‰ 404 é¡µé¢ä»…å¯¹ç»‘å®šé¡¶çº§åŸŸåçš„é¡¹ç›®æ‰èµ·ä½œç”¨ã€‚</del></p></blockquote><p>ç»æˆ‘è¯•éªŒå¹¶ä¸ä¸€å®šè¦ç»‘å®šé¡¶çº§åŸŸåæ‰å¯ä»¥ï¼Œä½¿ç”¨å®˜æ–¹ç»™å‡ºçš„æ–¹æ¡ˆè®¾ç½®åå¹¶ä¸èƒ½å®ç°é”™è¯¯é¡µ é¡µé¢è·³è½¬åˆ°æˆ‘ä»¬è®¾ç½®çš„ 404 é¡µé¢ã€‚<br>ä»¥ä¸‹æ¥è‡ª github ç½‘å‹åœ¨ issues ä¸­çš„è§£é‡Šï¼š</p><blockquote><p>ä½ çš„ç«™ç‚¹(ç¼–æ³¨ï¼šäºŒçº§åŸŸåå³ Github)å¯ç”¨äº† httpsï¼Œè…¾è®¯å…¬ç›Š 404 çš„è„šæœ¬æ˜¯ http åè®®ï¼Œå› æ­¤è¿™æ®µè„šæœ¬è¢«é˜»æ­¢äº†ã€‚</p></blockquote><p>è§£å†³çš„æ–¹æ³•æ˜¯å°†é¡µé¢é‡Œçš„ script æ¢æˆå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/plain"</span> src=<span class="string">"http://www.qq.com/404/search_children.js"</span> charset=<span class="string">"utf-8"</span> homePageUrl=<span class="string">"/"</span> homePageName=<span class="string">"å›åˆ°æˆ‘çš„ä¸»é¡µ"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"https://qzone.qq.com/gy/404/data.js"</span> charset=<span class="string">"utf-8"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">"https://qzone.qq.com/gy/404/page.js"</span> charset=<span class="string">"utf-8"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ç»è¯•éªŒè¯¥æ–¹æ³•è¿˜æ˜¯ä¼šå‡ºç°é—®é¢˜ï¼Œä½¿ç”¨ F12 å®¡æŸ¥å…ƒç´ å‡ºç°æŠ¥é”™ä¿¡æ¯ã€‚æœ€åä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆè§£å†³è¯¥é—®é¢˜:</p><p><a href="https://eason-yang.com/2016/08/06/set-tencent-lostchild-404-page-for-ssl/" target="_blank" rel="noopener">ä½¿è…¾è®¯ 404 å…¬ç›Šé¡µé¢æ”¯æŒ HTTPS</a></p><p>ç›®å‰å­˜åœ¨é—®é¢˜ï¼šé¡µé¢ä¼šæœ‰ä¸€ä¸ªå¡é¡¿åŠ è½½çš„è¿‡ç¨‹ï¼Œè¯¥é¡µé¢æ²¡æœ‰é€‚é…ç§»åŠ¨ç«¯ã€‚</p><h2 id="Next-ä¸»é¢˜æ–‡ç« é¡µå¦‚ä½•è®¾ç½®å¤šæ ‡ç­¾"><a href="#Next-ä¸»é¢˜æ–‡ç« é¡µå¦‚ä½•è®¾ç½®å¤šæ ‡ç­¾" class="headerlink" title="Next ä¸»é¢˜æ–‡ç« é¡µå¦‚ä½•è®¾ç½®å¤šæ ‡ç­¾"></a>Next ä¸»é¢˜æ–‡ç« é¡µå¦‚ä½•è®¾ç½®å¤šæ ‡ç­¾</h2><p>åœ¨æ–‡ç« å‘å¸ƒé¡µï¼ˆMARKDOWN æ–‡ä»¶é¡¶éƒ¨ï¼‰æ·»åŠ å¦‚ä¸‹å­—æ®µ:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">title: åœ¨æ­å»ºHexoä¸­é‡åˆ°çš„é—®é¢˜è®°å½•</span><br><span class="line"># æ ‡ç­¾ï¼ˆæ³¨æ„çŸ­æ¨ªæ åçš„ç©ºæ ¼ï¼‰</span><br><span class="line">tags:</span><br><span class="line">- HOWTO</span><br><span class="line">- Hexo</span><br><span class="line">- Hexo-Next</span><br><span class="line">- etc.</span><br><span class="line">author: imoyao</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ç»™åšå®¢æ–‡ç« é¡µæ·»åŠ éŸ³ä¹"><a href="#å¦‚ä½•ç»™åšå®¢æ–‡ç« é¡µæ·»åŠ éŸ³ä¹" class="headerlink" title="å¦‚ä½•ç»™åšå®¢æ–‡ç« é¡µæ·»åŠ éŸ³ä¹"></a>å¦‚ä½•ç»™åšå®¢æ–‡ç« é¡µæ·»åŠ éŸ³ä¹</h2><p>å¯ä»¥ç”¨éŸ³ä¹ç½‘ç«™çš„å¤–é“¾ï¼Œä½†æ˜¯ä¸€èˆ¬å¤–é“¾æ˜¯<code>&lt;iframe&gt;</code>ï¼Œæ®è¯´è¿™ä¸ªæ–¹æ³•å½±å“ç½‘ç«™çš„ SEOã€‚</p><p>ä¸‹é¢æˆ‘å°±éš†é‡ä»‹ç»ä¸€æ¬¾ HTML5 éŸ³ä¹æ’­æ”¾å™¨ï¼šAplayerã€‚éœ€è¦ç”¨åˆ°<code>hexo-tag-aplayer</code>æ’ä»¶ã€‚</p><p>åˆ‡æ¢åˆ°æœ¬åœ° Hexo ç›®å½•ï¼Œè¿è¡Œï¼š</p><p><code>npm install hexo-tag-aplayer@2.0.1</code></p><p>è¿™é‡Œç›´æ¥è¿è¡Œ<code>npm install hexo-tag-aplayer</code>åªä¼šå®‰è£… 2.0.0ï¼Œè¯¥ç‰ˆæœ¬ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FATAL Cannot find module &apos;/Users/hechao/Documents/TechBlog/CniceToUpp/node_modules/hexo-tag-aplayer&apos;</span><br><span class="line">Error: Cannot find module &apos;/Users/hechao/Documents/TechBlog/CniceToUpp/node_modules/hexo-tag-aplayer&apos;</span><br></pre></td></tr></table></figure><p>ä½œè€…ç»™å‡ºæ¥è§£å†³æ–¹æ¡ˆæ˜¯ç”¨ 2.0.1 ç‰ˆæœ¬ã€‚å®‰è£…å®Œæˆåï¼Œåœ¨éœ€è¦æ·»åŠ éŸ³ä¹çš„åœ°æ–¹åŠ ä¸Šï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#This is a example.</span><br><span class="line">&#123;% aplayer &quot;å¹³å‡¡ä¹‹è·¯&quot; &quot;æœ´æ ‘&quot; &quot;https://xxx.com/%E5%B9%B3%E5%87%A1%E4%B9%8B%E8%B7%AF.mp3&quot; &quot;https://xxx.com/1.jpg&quot; &quot;autoplay&quot; %&#125;</span><br></pre></td></tr></table></figure><p>å°±ä¼šå‡ºç°ä½ æƒ³è¦çš„éŸ³ä¹å•¦ã€‚</p><p><div id="aplayer0" class="aplayer" style="margin-bottom: 20px;"></div><script>new APlayer({element: document.getElementById("aplayer0"),narrow: false,autoplay: true,showlrc: 0,music: {title: "è“è²èŠ±",author: "è®¸å·",url: "http://oh6j8wijn.bkt.clouddn.com/%E8%93%9D%E8%8E%B2%E8%8A%B1.mp3",pic: "http://oh6j8wijn.bkt.clouddn.com/133107859321201106e3c3ede9a13305.jpeg",}});</script>`</p><p>å¦‚æœä½ æƒ³åŠ å…¥æ­Œå•ï¼ŒæŠŠä¸Šé¢çš„ä»£ç æ¢æˆä¸‹é¢ä»£ç å°±è¡Œï¼Œå‚æ•°çš„ç”¨æ³•å¯ä»¥å‚ç…§æ’ä»¶çš„ä½¿ç”¨è¯´æ˜ã€‚</p><p>```</p><h1 id="aplayer-åˆ é™¤ï¼ˆ-ï¼‰"><a href="#aplayer-åˆ é™¤ï¼ˆ-ï¼‰" class="headerlink" title="aplayer:åˆ é™¤ï¼ˆ`ï¼‰"></a>aplayer:åˆ é™¤ï¼ˆ`ï¼‰</h1><p>`<div id="aplayer1" class="aplayer" style="margin-bottom: 20px;"></div><script>var options = {"narrow":false,"autoplay":true,"showlrc":3,"mode":"random","music":[{"title":"å¹³å‡¡ä¹‹è·¯","author":"æœ´æ ‘","url":"http://xxx.com/%E5%B9%B3%E5%87%A1%E4%B9%8B%E8%B7%AF.mp3","pic":"https://xxx.com/1.jpg","lrc":"http://og9ocpmwk.bkt.clouddn.com/%E5%B9%B3%E5%87%A1%E4%B9%8B%E8%B7%AF.txt"},{"title":"é‡å­","author":"è‹è¿è¹","url":"http://xxx.com/01%20%E9%87%8E%E5%AD%90.m4a","pic":"http://xxxx.com/%E9%87%8E%E5%AD%90.jpg","lrc":"https://xxx.com/%E9%87%8E%E5%AD%90.txt"}]};options.element = document.getElementById("aplayer1");new APlayer(options);</script>`<br>```plain</p><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><p><code>material</code> ä¸»é¢˜å¡«å‘</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol><li><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">å¼€å§‹ä½¿ç”¨ - NexT ä½¿ç”¨æ–‡æ¡£ </a></li><li><a href="https://zhuanlan.zhihu.com/p/26625249" target="_blank" rel="noopener">GitHub+Hexo æ­å»ºä¸ªäººç½‘ç«™è¯¦ç»†æ•™ç¨‹</a></li><li><a href="http://tc9011.com/2016/12/24/hexo%E6%B7%BB%E5%8A%A0%E9%9F%B3%E4%B9%90%E3%80%81high%E4%B8%80%E4%B8%8B%E5%8F%8A%E4%B8%80%E4%BA%9B%E5%9D%91/" target="_blank" rel="noopener">hexoæ·»åŠ éŸ³ä¹ã€highä¸€ä¸‹åŠä¸€äº›å‘ | tc9011â€™s</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•™ç¨‹è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HOWTO </tag>
            
            <tag> Hexo </tag>
            
            <tag> Hexo-Next </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python ä¸­ exec()å’Œ eval()çš„åŒºåˆ«</title>
      <link href="/blog/2017-11-17/exec-vs-eval-in-Python/"/>
      <url>/blog/2017-11-17/exec-vs-eval-in-Python/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>Python åŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç ç‰‡æ®µï¼ˆä¹Ÿå¯ä»¥æ˜¯æ–‡ä»¶ï¼‰ï¼Œ ä¸€èˆ¬ä¼šç”¨åˆ° exec,evalã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><a id="more"></a><h2 id="exec-æ–¹æ³•"><a href="#exec-æ–¹æ³•" class="headerlink" title="exec æ–¹æ³•"></a>exec æ–¹æ³•</h2><p>æ³¨æ„ï¼š<code>exec</code> æ˜¯ä¸€ä¸ªè¯­æ³•å£°æ˜ï¼Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´å’Œ<code>if</code>ã€<code>for</code>ä¸€æ ·ã€‚</p><p>å®˜æ–¹æ–‡æ¡£å¯¹äº exec çš„è§£é‡Š</p><blockquote><p>This statement supports dynamic execution of Python code.</p></blockquote><p>exec çš„ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥æ˜¯ï¼š</p><ol><li>ä»£ç å­—ç¬¦ä¸²</li><li>æ–‡ä»¶å¯¹è±¡</li><li>ä»£ç å¯¹è±¡</li><li>tuple</li></ol><p>å‰é¢ä¸‰ç§æƒ…å†µå·®ä¸å¤šï¼Œç¬¬å››ç§æ¯”è¾ƒç‰¹æ®Šæœ€åè®²</p><p>å¦‚æœå¿½ç•¥åé¢çš„å¯é€‰è¡¨è¾¾å¼,exec åé¢ä»£ç å°†åœ¨å½“å‰åŸŸæ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a=2</span><br><span class="line">&gt;&gt;&gt; exec &quot;a=1&quot;</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">1</span><br></pre></td></tr></table></figure></p><p>å¦‚æœåœ¨è¡¨è¾¾å¼ä¹‹åä½¿ç”¨ in é€‰é¡¹æŒ‡å®šä¸€ä¸ª<code>dict</code>ï¼Œå®ƒå°†ä½œä¸º<code>global</code>å’Œ<code>local</code>å˜é‡ä½œç”¨åŸŸ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a=10 </span><br><span class="line">&gt;&gt;&gt; b=20 </span><br><span class="line">&gt;&gt;&gt; g=&#123;&apos;a&apos;:6,&apos;b&apos;:8&#125; </span><br><span class="line">&gt;&gt;&gt; exec &quot;global a;print a,b&quot; in g </span><br><span class="line">6 8</span><br></pre></td></tr></table></figure></p><p>å¦‚æœ<code>in</code>åè¯¦æŒ‡å®šä¸¤ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒä»¬å°†åˆ†åˆ«ç”¨ä½œ<code>global</code>å’Œ<code>local</code>å˜é‡ä½œç”¨åŸŸ<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a=10 </span><br><span class="line">&gt;&gt;&gt; b=20 </span><br><span class="line">&gt;&gt;&gt; c=20 </span><br><span class="line">&gt;&gt;&gt; g=&#123;&apos;a&apos;:6,&apos;b&apos;:8&#125; </span><br><span class="line">&gt;&gt;&gt; l=&#123;&apos;b&apos;:9,&apos;c&apos;:10&#125; </span><br><span class="line">&gt;&gt;&gt; exec &quot;global a;print a,b,c&quot; in g,l </span><br><span class="line">6 9 10</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨è¯´ä¸‹<code>tuple</code>çš„æƒ…å†µï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´å¾ˆå¤šäººè¯¯ä»¥ä¸º<code>exec</code>æ˜¯ä¸€ä¸ªå‡½æ•°çš„åŸå› ã€‚</p><p>å¦‚æœç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯<code>tuple</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exec(expr, globals) #å®ƒç­‰æ•ˆäº `exec expr in globals`</span><br><span class="line"></span><br><span class="line">exec(expr, globals, locals) #å®ƒç­‰æ•ˆäº  `exec expr in globals,locals`</span><br></pre></td></tr></table></figure><h2 id="eval-æ–¹æ³•"><a href="#eval-æ–¹æ³•" class="headerlink" title="eval()æ–¹æ³•"></a>eval()æ–¹æ³•</h2><p><code>eval</code>é€šå¸¸ç”¨æ¥æ‰§è¡Œä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œå¹¶è¿”å›è¡¨è¾¾å¼çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval(expression[, globals[, locals]])</span><br></pre></td></tr></table></figure><p>æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œè¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œglobals å˜é‡ä½œç”¨åŸŸï¼Œlocals å˜é‡ä½œç”¨åŸŸã€‚ å…¶ä¸­ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ã€‚</p><p>å¦‚æœå¿½ç•¥åé¢ä¸¤ä¸ªå‚æ•°ï¼Œåˆ™<code>eval</code>åœ¨å½“å‰ä½œç”¨åŸŸæ‰§è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a=1 </span><br><span class="line">&gt;&gt;&gt; eval(&quot;a+1&quot;) </span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‡å®š globals å‚æ•°<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a=1 </span><br><span class="line">&gt;&gt;&gt; g=&#123;&apos;a&apos;:10&#125; </span><br><span class="line">&gt;&gt;&gt; eval(&quot;a+1&quot;,g) </span><br><span class="line">11</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæŒ‡å®š<code>locals</code>å‚æ•°<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a=10 </span><br><span class="line">&gt;&gt;&gt; b=20 </span><br><span class="line">&gt;&gt;&gt; c=20 </span><br><span class="line">&gt;&gt;&gt; g=&#123;&apos;a&apos;:6,&apos;b&apos;:8&#125; </span><br><span class="line">&gt;&gt;&gt; l=&#123;&apos;b&apos;:9,&apos;c&apos;:10&#125; </span><br><span class="line">&gt;&gt;&gt; eval(&quot;a+b+c&quot;,g,l) </span><br><span class="line">25</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¦ä¸¥æ ¼é™åˆ¶<code>eval</code>æ‰§è¡Œï¼Œå¯ä»¥è®¾ç½®<code>globals</code>ä¸º<code>__builtins__</code>,è¿™æ · è¿™ä¸ªè¡¨è¾¾å¼åªå¯ä»¥è®¿é—®<code>__builtin__</code> moduleã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># coding=utf-8</span><br><span class="line">exec &apos;print(&quot;hello&quot;)&apos;   #æ”¯æŒstrçš„è¡¨è¾¾å¼åŠ¨æ€ä»£ç æ‰§è¡Œ    &gt;&gt;hello</span><br><span class="line">exec (&apos;a = 3*4&apos;)</span><br><span class="line">print a     # &gt;&gt;12</span><br><span class="line">b = eval(&apos;3*4&apos;)     #ä¸æ”¯æŒè¡¨è¾¾å¼ æœ‰è¿”å›å€¼</span><br><span class="line">print b     # &gt;&gt;12</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ¥æºï¼š</p><p><a href="http://www.coolpython.com/index.php?aid=12" target="_blank" rel="noopener">python çš„ execã€eval è¯¦è§£ - ç–¯ç‹‚å¥”è·‘çš„çŒª</a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½›ä¸å§‘å¨˜</title>
      <link href="/blog/2017-11-11/choose-Buddha-or-gril/"/>
      <url>/blog/2017-11-11/choose-Buddha-or-gril/</url>
      
        <content type="html"><![CDATA[<script src="/assets/js/APlayer.min.js"> </script><p>é’ç¯ï¼Œå¤ä½›ã€‚å–é…’ã€åƒè‚‰ã€æ³¡å§‘å¨˜ã€‚</p><p>æˆ‘ç›˜åå‚äº†ä½ è¿™ä¹ˆé•¿çš„æ—¶é—´ï¼Œå´æ€»ä¸è§ä½ å‘è¨€ã€‚</p><p>ä½ è¯´äº”è•´çš†ç©ºã€‚å¯è°çš„å¿ƒé‡Œè¿˜ä¸è—ç€ä¸€ä¸ªä¸ç©¿è¡£æœçš„å§‘å¨˜ï¼›ä½ è¯´è§‚æ³•è‡ªåœ¨ï¼Œå¯é‚£å§‘å¨˜å¤œå¤œé’»æˆ‘çš„è¢«çªï¼Œåˆè®©æˆ‘å¦‚ä½•æ˜¯å¥½ï¼Ÿ<br><a id="more"></a></p><p><br></p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="52" src="//music.163.com/outchain/player?type=2&id=28308561&auto=1&height=32"></iframe><p><br></p><p>æˆ‘æƒ³äº†åˆæƒ³ï¼Œè¿˜æ˜¯æŠŠå¥¹åŠäº†å§ã€‚</p><p><br></p><p>ä½ çœ‹è¿™è‹ç”Ÿä¸‡ç‰©ï¼Œå¿™ç¢Œåœ°ç”Ÿï¼Œå¿™ç¢Œåœ°æ­»ã€‚ä½ ç¬‘ä»–ä»¬æ— çŸ¥æ— åŠ›ï¼Œæˆ‘ä»°ä½ ä¼Ÿå¤§æ…ˆæ‚²ã€‚ä½ å…³ç…§é‚£ä¹ˆå¤šçš„ç”Ÿæ­»ï¼Œæˆ‘å´åªå…³å¿ƒè‡ªå·±çš„çç¢ã€‚</p><p>ç´¢æ€§æˆ‘ä¹Ÿå¦èƒ¸éœ²ä¹³ï¼Œæˆ‘ä¹Ÿè£…å®ƒä¸ªå››å¤§çš†ç©ºã€‚</p><p><br></p><p>äºæ˜¯ï¼Œä½ æ˜¯ä¸æ˜¯ä¹Ÿè¯¥æ•™æˆ‘ä¸ªè’™äº‹çš„æ³•é—¨ï¼Ÿä¸€å¿µä¸€æ‰§ï¼Œå¿µå¥¹ä¸ªæ­»å¿ƒå¡Œåœ°ï¼Œæ‰§å¥¹ä¸ªæ‰§è¿·ä¸æ‚Ÿã€‚</p><p>ç®¡ä»–æ¬¢ä¹è¿˜æ˜¯ç—›è‹¦ï¼Œç®¡ä»–å–œæ‚¦è¿˜æ˜¯æ‚²ä¼¤ã€‚</p><p>èŠ±é—´ä¸€å£¶é…’ï¼Œå¯¹ç€æœˆäº®å–ä¸ªæ­»å»æ´»æ¥ï¼Œæ‘¸ç€å§‘å¨˜çš„å¤§è…¿å–ƒå–ƒé“ï¼šå§æ§½ï¼ŒçœŸæ˜¯éš¾å¾—ç³Šæ¶‚ã€‚</p><p><br></p><p>ç³Šæ¶‚ç€ï¼Œæˆ‘æŠ±ç€é‚£å§‘å¨˜åœ¨åºŠå•ä¸Šæ»šæ¥åˆæ»šå»ã€‚</p><p>ä½ æç€æ‰‹å°ç¬‘è€Œä¸è¯­åœ°çœ‹ç€æˆ‘ä»¬æ‰‹æ·«ã€‚</p><p>æˆ‘æƒ³ç€ç­‰å¤´å‘é•¿é•¿äº†ä¹Ÿå»çƒ«ä¸€å¤´å¦‚ä½ ä¸€æ ·äº”è•´çš†ç©ºçš„å¤´å‘ï¼ŒæŠ«ä¸Šä¸€èº«è¢ˆè£Ÿå’Œå§‘å¨˜æ‹‰ç€æ‰‹ç§å¥”â€”â€”ä¹Ÿè¿˜æ˜¯åœ¨ä½ çš„æ‰‹æŒå¿ƒé‡Œæ¸¸è¡ã€‚</p><p><br></p><p>è¯´çœŸçš„ï¼Œå¦‚æœä½ çˆ±æˆ‘å°±èµ¶å¿«å¸¦æˆ‘ç¦»å¼€ã€‚</p><p>å…¶å®ƒçš„ä¸œè¥¿éƒ½æ˜¯æ‰¯æ·¡ï¼Œæ‰¯å¤šäº†ä½ å°±æ˜¯è€æµæ°“ã€‚</p><p><br></p><p>è°è¯´é‡Šè¿¦è€çˆ·å­ä¸è€æµæ°“ï¼Ÿé‚£æ˜¯ä»–è‡ªå·±è¯´çš„ã€‚</p><p><br></p><p>æˆ‘æŠŠæœ¨é±¼æ•²ç¢ï¼ŒæŠŠè’²å›¢åç©¿ï¼Œåœ¨æ¢¦é‡ŒæŠŠä½ æ‘¸äº†ä¸€éåˆä¸€éã€‚</p><p>æˆ‘è„±äº†è¿™èº«è¡£æœå°±å·²ä¸å†æ˜¯æˆ‘ï¼Œæˆ‘ç©¿ä¸Šäº†è¡£æœè‡ªå·±å´æ€ä¹ˆä¹Ÿæ‰¾ä¸åˆ°äº†ã€‚</p><p><br></p><p>ä¸€æ—¶ï¼Œä½›åœ¨èˆå«å›½ï¼Œç ´è¡£çƒ‚é’µï¼šâ€œå¯æœ‰æ®‹ç¾¹æ–½èˆï¼Ÿâ€</p><p>ä¸€ä¸ªè¯´ï¼šâ€œå»å»å»ï¼Œå“ªé‡Œæ¥çš„å«èŠ±ï¼Œè¿™é‡Œäººäººéƒ½å¿™ç€å¯‚å¯ï¼Œå“ªæœ‰é—²å·¥å¤«ç†ä½ ã€‚â€</p><p>ä½›è¯´ï¼šâ€œå¯‚å¯è¿™ä¸ªä¸œè¥¿ï¼Œå¤šåŠæ˜¯å§‘å¨˜é—¹çš„ã€‚å¯åˆ°å“ªå»æ‰¾ä¸ªå§‘å¨˜ï¼Œä¸å¯è¯´ï¼Œä¸å¯è¯´ã€‚â€</p><p><br></p><p>è¯´åˆ°å¤´æ¥è¿˜æ˜¯è¯´åˆ°å§‘å¨˜ã€‚</p><p>æˆ‘å°±è¯´å¯‚å¯å°±ä»–å¦ˆæ˜¯ä¸ªå…‰ç€å¤§è…¿çš„å§‘å¨˜ï¼Œè®©ä½ çœ‹ç€åˆååä¸è®©ä½ æ‘¸ã€‚</p><p>çœ‹å¾—ä½ å¿ƒä¹Ÿç—’ç—’å˜´ä¹Ÿç—’ç—’ï¼Œæ€»æ†‹ç€æ³•åœ°æƒ³ä¸€äº›æ±¡è¨€ç§½è¯­æ¥æŒ‘é€—å¥¹ã€‚</p><p>å¯è¶Šæ˜¯æŒ‘é€—å¥¹å°±ç¦»ä½ è¶Šè¿‘ï¼Œç¦»ä½ è¶Šè¿‘å°±è¶Šä¸è®©ä½ æ‘¸ã€‚</p><p><br></p><p>æˆ‘è§‰å¾—ï¼Œè¿™å¾ˆæ“è›‹ã€‚</p><p><br></p><p>ä½›è¯´ï¼Œè¿™å°±æ˜¯æ³•å•Šï¼Œä½ æ˜çŸ¥å®ƒæ˜¯çœŸçš„å´æ€»ä¹ŸæŠ“ä¸ä½ï¼Œä½ åˆ†æ˜çœ‹ä¸åˆ°å´æ€»åœ¨ä½ èº«è¾¹è½¬ã€‚é€—ç€ä½ ï¼Œé¦‹ç€ä½ ï¼Œè¯´ä¸€äº›æ¼äººçš„è¯æ¥å‹¾å¼•ä½ ï¼Œæƒ¹ä½ ç”Ÿæ°”ï¼Œæƒ¹ä½ æ¬¢å–œã€‚</p><p><br></p><p>æˆ‘è¯´ï¼Œè¿™åˆ†æ˜æ˜¯è€æµæ°“ã€‚</p><p>ä½›è¯´ï¼Œå¯¹å‘€ï¼Œå°±æ˜¯è€æµæ°“ï¼Œä½ æŠŠæ¶æ ¹ä¸¢äº†ï¼ŒæŠŠæ‰§å¿µä¸¢äº†ï¼ŒæŠŠå¦„æƒ³ä¸¢äº†ï¼ŒæŠŠå§‘å¨˜ä¸¢äº†ï¼Œè„±å…‰äº†è¡£æœç«™è¡—ä¸Šï¼Œå°±ç«‹åœ°æˆä½›äº†ã€‚</p><p><br></p><p>æˆ‘è„±å…‰äº†è¡£æœç«™åœ¨è¡—ä¸Šï¼Œæ¥äº†ä¸¤ä¸ªæ¼‚äº®çš„å¥³è­¦å¯Ÿé—®æˆ‘åœ¨åšä»€ä¹ˆã€‚</p><p>æˆ‘è¯´ï¼Œæˆ‘ç«‹åœ°æˆä½›ï¼Œç„¶ååº¦ä½ ä»¬å‡ºè‹¦å„ã€‚</p><p>å¥¹ä»¬éè¦æŠŠæˆ‘æŠ“èµ°ï¼Œæˆ‘è¯´æˆ‘<strong>æ—¥</strong>ä½ ä»¬è€æ¯ï¼ï¼ï¼</p><p><br></p><p>ä½›ç¬‘äº†ï¼Œååœ¨è¿œè¿œçš„äº‘ç«¯ï¼Œè²èŠ±å°ä¸Šã€‚</p><p>æˆ‘è¯´è¿™ä¸ç§‘å­¦ï¼Œä¼—ç”Ÿå¤ªæ‰§ï¼Œå§‘å¨˜åˆå¤ªç¾ï¼Œæ•™äººæ€ä¹ˆåº¦ï¼Œæ€ä¹ˆä¸ªæ— æ¬²æ— æ±‚ã€‚</p><p>ä½›æ‰“äº†ä¸ªå“ˆæ¬ ï¼Œå°±æ²¡å†è¯´ä»€ä¹ˆã€‚</p><p><br></p><p>æˆ‘è§‰å¾—è¿™æœ‰äº›æ‰¯ï¼Œä½†è¿˜æ˜¯è€ç€æ€§å­æ€ç´¢ä¸€äº›äº‹æƒ…ã€‚</p><p>æœ€åæˆ‘å†³å®šï¼Œè¿˜æ˜¯æŠŠé‚£ä¸ªå‹¾å¼•æˆ‘çš„å°å¨˜ä»¬ç»™åŠäº†ã€‚</p><p><br></p><p>åŠå¥¹ä¸ªäº”è•´çš†ç©ºï¼Œåº¦å¥¹å‡ºå¯‚å¯çš„è‹¦å„ã€‚</p><p><br></p>]]></content>
      
      
      <categories>
          
          <category> æ‚¦è¯» </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¾æ–‡ </tag>
            
            <tag> é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
