<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="进行存储开发时需要创建磁盘阵列，本文主要记录 RAID 卡管理工具MegaCli的使用。需要注意的是，目前该管理工具因为商业收购已经被官方“弃坑”，StorCLI作为后继者整合了LSI和原来3ware的产品支持，兼容MegaCLI命令的同时更加简洁，参阅此篇。">
<meta name="keywords" content="存储,Linux,RAID,MegaCli">
<meta property="og:type" content="article">
<meta property="og:title" content="磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总">
<meta property="og:url" content="https://imoyao.github.io/blog/2017-11-20/megacli-command-share/index.html">
<meta property="og:site_name" content="别院牧志">
<meta property="og:description" content="进行存储开发时需要创建磁盘阵列，本文主要记录 RAID 卡管理工具MegaCli的使用。需要注意的是，目前该管理工具因为商业收购已经被官方“弃坑”，StorCLI作为后继者整合了LSI和原来3ware的产品支持，兼容MegaCLI命令的同时更加简洁，参阅此篇。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-02T09:54:39.788Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总">
<meta name="twitter:description" content="进行存储开发时需要创建磁盘阵列，本文主要记录 RAID 卡管理工具MegaCli的使用。需要注意的是，目前该管理工具因为商业收购已经被官方“弃坑”，StorCLI作为后继者整合了LSI和原来3ware的产品支持，兼容MegaCLI命令的同时更加简洁，参阅此篇。">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="https://blog.masantu.com">博客</a></li>
         
          <li><a href="https://resume.masantu.com">简历</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/blog/2017-11-21/how-to-count-sequense-with-python/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/blog/2017-11-18/how-to-build-hexo-blog/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&text=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&is_video=false&description=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总&body=Check out this article: https://imoyao.github.io/blog/2017-11-20/megacli-command-share/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&name=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总&description=&lt;p&gt;进行存储开发时需要创建磁盘阵列，本文主要记录 RAID 卡管理工具&lt;code&gt;MegaCli&lt;/code&gt;的使用。需要注意的是，目前该管理工具因为商业收购已经被官方“弃坑”，&lt;code&gt;StorCLI&lt;/code&gt;作为后继者整合了&lt;code&gt;LSI&lt;/code&gt;和原来&lt;code&gt;3ware&lt;/code&gt;的产品支持，兼容&lt;code&gt;MegaCLI&lt;/code&gt;命令的同时更加简洁，参阅&lt;a href=&#34;https://imoyao.github.io/blog/2017-12-27/storcli_command_share/&#34;&gt;此篇&lt;/a&gt;。&lt;br&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#巡读"><span class="toc-number">1.</span> <span class="toc-text">巡读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cc-校验"><span class="toc-number">2.</span> <span class="toc-text">cc 校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快速初始化和完全初始化"><span class="toc-number">3.</span> <span class="toc-text">快速初始化和完全初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后台初始化"><span class="toc-number">4.</span> <span class="toc-text">后台初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#copyback"><span class="toc-number">5.</span> <span class="toc-text">copyback</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志"><span class="toc-number">6.</span> <span class="toc-text">日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#raid5-扩容"><span class="toc-number">7.</span> <span class="toc-text">raid5 扩容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#级别迁移"><span class="toc-number">8.</span> <span class="toc-text">级别迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#升级-ROM"><span class="toc-number">9.</span> <span class="toc-text">升级 ROM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接方式"><span class="toc-number">10.</span> <span class="toc-text">连接方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#外来配置"><span class="toc-number">11.</span> <span class="toc-text">外来配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#物理磁盘的处理"><span class="toc-number">12.</span> <span class="toc-text">物理磁盘的处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adpsetprop-设置属性"><span class="toc-number">13.</span> <span class="toc-text">Adpsetprop 设置属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCQ"><span class="toc-number">14.</span> <span class="toc-text">NCQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加和移除热备盘"><span class="toc-number">15.</span> <span class="toc-text">添加和移除热备盘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#重建"><span class="toc-number">16.</span> <span class="toc-text">重建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#恢复出厂设置"><span class="toc-number">17.</span> <span class="toc-text">恢复出厂设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#告警"><span class="toc-number">18.</span> <span class="toc-text">告警</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置相关"><span class="toc-number">19.</span> <span class="toc-text">配置相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAID-卡相关"><span class="toc-number">20.</span> <span class="toc-text">RAID 卡相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enclosure-的信息"><span class="toc-number">21.</span> <span class="toc-text">Enclosure 的信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BIOS-相关"><span class="toc-number">22.</span> <span class="toc-text">BIOS 相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#背板相关"><span class="toc-number">23.</span> <span class="toc-text">背板相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动时上电"><span class="toc-number">24.</span> <span class="toc-text">启动时上电</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#刷新缓存"><span class="toc-number">25.</span> <span class="toc-text">刷新缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#让硬盘-LED-灯闪烁"><span class="toc-number">26.</span> <span class="toc-text">让硬盘 LED 灯闪烁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#电池告警"><span class="toc-number">27.</span> <span class="toc-text">电池告警</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#纠错码相关"><span class="toc-number">28.</span> <span class="toc-text">纠错码相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后台初始化，完全初始化，cc-校验，巡读等之间的关系"><span class="toc-number">29.</span> <span class="toc-text">后台初始化，完全初始化，cc 校验，巡读等之间的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAID-的创建与删除"><span class="toc-number">30.</span> <span class="toc-text">RAID 的创建与删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置-RAID-组的属性"><span class="toc-number">31.</span> <span class="toc-text">设置 RAID 组的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询篇"><span class="toc-number">32.</span> <span class="toc-text">查询篇</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置篇"><span class="toc-number">33.</span> <span class="toc-text">设置篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建-删除阵列"><span class="toc-number">33.1.</span> <span class="toc-text">创建/删除阵列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看阵列初始化信息"><span class="toc-number">33.2.</span> <span class="toc-text">查看阵列初始化信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置磁盘缓存策略"><span class="toc-number">33.3.</span> <span class="toc-text">设置磁盘缓存策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#热备管理"><span class="toc-number">33.4.</span> <span class="toc-text">热备管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#管理篇"><span class="toc-number">34.</span> <span class="toc-text">管理篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#foreign-管理"><span class="toc-number">34.1.</span> <span class="toc-text">foreign 管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他"><span class="toc-number">35.</span> <span class="toc-text">其他</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsolved"><span class="toc-number">36.</span> <span class="toc-text">Unsolved</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">37.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">imoyao</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2017-11-20T07:02:45.000Z" itemprop="datePublished">2017-11-20</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/教程记录/">教程记录</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Linux/">Linux</a>, <a class="tag-link" href="/tags/MegaCli/">MegaCli</a>, <a class="tag-link" href="/tags/RAID/">RAID</a>, <a class="tag-link" href="/tags/存储/">存储</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <script src="/assets/js/APlayer.min.js"> </script><p>进行存储开发时需要创建磁盘阵列，本文主要记录 RAID 卡管理工具<code>MegaCli</code>的使用。需要注意的是，目前该管理工具因为商业收购已经被官方“弃坑”，<code>StorCLI</code>作为后继者整合了<code>LSI</code>和原来<code>3ware</code>的产品支持，兼容<code>MegaCLI</code>命令的同时更加简洁，参阅<a href="https://imoyao.github.io/blog/2017-12-27/storcli_command_share/">此篇</a>。<br><a id="more"></a></p>
<h2 id="巡读"><a href="#巡读" class="headerlink" title="巡读"></a>巡读</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">立即激活</span></span><br><span class="line">MegaCli -adppr -enblauto -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置成手动模式，需要用MegaCli -adppr -start –a0 来激活</span></span><br><span class="line">MegaCli -adppr -enblman -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看巡读的模式，本次巡读结束与下一次开始巡读的间隔，当前状态等信息</span></span><br><span class="line">MegaCli -adppr -info -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看巡读的进度</span></span><br><span class="line">MegaCli -fwtermlog -dsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">结束巡读，在巡读过程中，多次运用MegaCli -adppr -stop -a0或MegaCli -adppr -start -a0会使叠代数增加，此时可能不能开始或结束巡读，用MegaCli -adppr -dsbl -a0来禁止巡读，重新开始。</span></span><br><span class="line">MegaCli -adppr -stop -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置本次巡读结束与下一次巡读开始的时间间隔，默认是168小时，当val=0时, 本次巡读结束后，立即开始下一次巡读</span></span><br><span class="line">MegaCli -adppr -setdelay val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">巡读时是否纠正媒介错误</span></span><br><span class="line">MegaCli -AdpSetProp -PrCorrectUncfgdAreas -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置定时巡读 yyyymmdd hh，具体含义如下：20120108 16表示2012年01月08日16点</span></span><br><span class="line">MegaCli -AdpPR -SetStartTime yyyymmdd hh -a0</span><br></pre></td></tr></table></figure>
<h2 id="cc-校验"><a href="#cc-校验" class="headerlink" title="cc 校验"></a>cc 校验</h2><ul>
<li>立即开始 cc 校验</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">L0表示Target ID 为0的raid组</span></span><br><span class="line">MegaCli -ldcc -start -L0 –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">如果没有完全初始化或后台初始化</span></span><br><span class="line"><span class="meta">#</span><span class="bash">The virtual disk has not been initialized、 Running a consistency check may result <span class="keyword">in</span> inconsistent messages <span class="keyword">in</span> the <span class="built_in">log</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">可以强行cc校验</span></span><br><span class="line">MegaCli -ldcc -start -force –L0 –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">显示当前cc校验的进度</span></span><br><span class="line">MegaCli -ldcc -progdsply -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">关掉当前的cc校验</span></span><br><span class="line">MegaCli -ldcc -abort -L0 -a0</span><br></pre></td></tr></table></figure>
<ul>
<li>计划 cc 校验<br>如果模式为 disable(MegaCli -adpccsched -info -a0 来查看)，则下一次开始时间为 07/28/2135, 02:00:00，状态为 Stopped，延期为 168 个小时;<br>只有模式为 Sequential 和 Concurrent 模式时，才可以设定定期时间，所以要首先设定模式;<br>如果模式为 Sequential 时，所有虚拟磁盘组顺序进行 cc 校验;<br>如果模式为 Concurrent 时，所有虚拟磁盘组同时进行 cc 校验;<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设定CC模式</span></span><br><span class="line">MegaCli -adpccsched -modeconc -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">或者</span></span><br><span class="line">MegaCli -adpccsched -modeseq -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">然后设定开始时间</span></span><br><span class="line">MegaCli -adpccsched setstarttime 20101122 18 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置本次cc校验结束和下次cc校验开始的时间间隔</span></span><br><span class="line">MegaCli -adpccsched -setdelay 2 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">禁止计划cc校验</span></span><br><span class="line">MegaCli -AdpCcSched -dsbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置错误发生时放弃cc校验</span></span><br><span class="line">MegaCli -adpsetprop -AbortCC -1 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看cc校验的事件日志</span></span><br><span class="line">MegaCli -AdpEventLog -GetCCIncon –f filename –L0 –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">如果设置延期时间为0，本次cc校验结束后，下一次cc校验会立即开始</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="快速初始化和完全初始化"><a href="#快速初始化和完全初始化" class="headerlink" title="快速初始化和完全初始化"></a>快速初始化和完全初始化</h2><p>快速初始化值是往 raid 组的前 8M 和后 8M 写 0<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">快速初始化</span></span><br><span class="line">MegaCli -LDInit -start –L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">完全初始化</span></span><br><span class="line">MegaCli -LDInit -start -full –L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">显示初始化的进度</span></span><br><span class="line">MegaCli -LDInit -progdsply -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">结束完全初始化</span></span><br><span class="line">MegaCli -LDInit -abort -L0 -a0</span><br></pre></td></tr></table></figure></p>
<h2 id="后台初始化"><a href="#后台初始化" class="headerlink" title="后台初始化"></a>后台初始化</h2><p>Raid5 需要 5 个数据盘才可以后台初始化(5 个盘中不包含热备盘)<br>后台初始化是创建 raid 后 5 分钟开始的(好像有时不是这样的)<br>后台初始化和 cc 校验不同的地方是，后台初始化可以自动开始<br>改变后台初始化率时，需要停止后台初始化，否则没有效果<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">禁止后台初始化</span></span><br><span class="line">MegaCli -LDBI -dsbl -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">结束正在进行的后台初始化</span></span><br><span class="line">MegaCli -LDBI -abort -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看后台初始化的设置</span></span><br><span class="line">MegaCli -LDBI -getsetting -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">显示后台初始化进度</span></span><br><span class="line">MegaCli -LDBI -progdsply -L0 -a0</span><br></pre></td></tr></table></figure></p>
<h2 id="copyback"><a href="#copyback" class="headerlink" title="copyback"></a>copyback</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">开启或禁用copyback</span></span><br><span class="line">MegaCli -AdpSetProp –CopyBackDsbl -0 -a0 (开启)</span><br><span class="line"><span class="meta">#</span><span class="bash">显示copyback设置情况</span></span><br><span class="line">MegaCli –AdpGetProp -CopyBackDsbl –a0</span><br></pre></td></tr></table></figure>
<p>当设置 copyback 为 enable 时，拔出坏盘，换上一个 UNCONF 的新盘，先用热备盘进行重建，然后进行 copyback 操作，如果 copyback 为 disable 时，不进行 copyback 操作，可以设定 copyback 为 enable，然后用 MegaCli -PDCpyBk -Start -PhysDrv[E0:S0,E1:S1] –a0 开始 copyback 操作，其中[E0：S0]是 raid 组中的磁盘(源盘)，而[E1：S1]不是 raid 组中的磁盘(目的盘)</p>
<p>当某个盘出现第一个 smart 错误时，可以在这个盘和热备盘之间进行 copyback 操作，热备盘作为目的盘，完成了 copyback 操作时，smart 错误盘才标记为 failed 状态。<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">如果在copyback时，raid组删除，目的盘回到热备盘状态或Unconfigured Good</span></span><br><span class="line">MegaCli -AdpGetProp SMARTCpyBkEnbl -a0</span><br></pre></td></tr></table></figure></p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看所有的information日志</span></span><br><span class="line">MegaCli -adpalilog -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看固件调试日志(固件终端日志)</span></span><br><span class="line">MegaCli -fwtermlog -dsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看raid卡日志</span></span><br><span class="line">MegaCli -adpeventlog -getevents -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">清除日志</span></span><br><span class="line">MegaCli -AdpEventLog -Clear –a0</span><br></pre></td></tr></table></figure>
<h2 id="raid5-扩容"><a href="#raid5-扩容" class="headerlink" title="raid5 扩容"></a>raid5 扩容</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">raid5的扩容</span></span><br><span class="line">MegaCli -LDRecon -Start -r5 -Add -Physdrv[E0:S0] -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看扩容的进度</span></span><br><span class="line">MegaCli -LDRecon -progdsply -L0 –a0</span><br></pre></td></tr></table></figure>
<h2 id="级别迁移"><a href="#级别迁移" class="headerlink" title="级别迁移"></a>级别迁移</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">在迁移过程中，转换前的raid的一个盘下线，转换前raid的所有盘都下线</span><br><span class="line">支持的类型 RAID 0 to RAID 1，RAID 0 to RAID 5，RAID 0 to RAID 6，RAID 1 to RAID 0，RAID 1 to RAID 5，RAID 1 to RAID 6，RAID 5 to RAID 0，RAID 5 to RAID 6，RAID 6 to RAID 0，RAID 6 to RAID 5</span><br><span class="line"><span class="meta">#</span><span class="bash">建立了三个盘的raid 0</span></span><br><span class="line">MegaCli -cfgldadd -r0[117:1,117:3,117:11] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">增加一个盘[117:14],转换到raid5</span></span><br><span class="line">MegaCli -ldrecon -start -r5 -add -physdrv[117:14] -l0 -a0</span><br></pre></td></tr></table></figure>
<h2 id="升级-ROM"><a href="#升级-ROM" class="headerlink" title="升级 ROM"></a>升级 ROM</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">从低版本到高版本升级</span></span><br><span class="line">MegaCli -adpfwflash -f x.rom -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">从高版本到低版本降级</span></span><br><span class="line"><span class="meta">#</span><span class="bash">加上noverchk忽略版本的检查，升级以后需要重启才生效</span></span><br><span class="line">MegaCli -adpfwflash -f x.rom -noverchk -a0</span><br></pre></td></tr></table></figure>
<h2 id="连接方式"><a href="#连接方式" class="headerlink" title="连接方式"></a>连接方式</h2><p>Raid 对内有两个接口，即 connector0 和 connector1。得到连接器的状态;<br> MegaCli -adpgetconnectormode -connector0 -a0<br>如果连接器的模式为 internal 时，jbod 的磁盘全部看不到，如果连接器的模式为 external 时，主柜上的磁盘全部看不到;</p>
<h2 id="外来配置"><a href="#外来配置" class="headerlink" title="外来配置"></a>外来配置</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">扫描外来配置的个数</span></span><br><span class="line">MegaCli -cfgforeign -scan -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看当前的磁盘在normal时的位置</span></span><br><span class="line">MegaCli -cfgforeign -preview -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">来导入配置，恢复虚拟磁盘组</span></span><br><span class="line">MegaCli -cfgforeign -import -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">清除外来配置</span></span><br><span class="line">MegaCli -cfgforeign -clear -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">显示出现外来配置(磁盘插入的顺序)的过程</span></span><br><span class="line">MegaCli -cfgforeign -dsply -a0</span><br></pre></td></tr></table></figure>
<h2 id="物理磁盘的处理"><a href="#物理磁盘的处理" class="headerlink" title="物理磁盘的处理"></a>物理磁盘的处理</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">磁盘的状态由FAULTY变成CONF</span></span><br><span class="line">MegaCli -PDMakeGood -PhysDrv[E0:S0] –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">磁盘上线</span></span><br><span class="line">MegaCli -PDOnline -PhysDrv[E0:S0,E1:S1,...] –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">磁盘下线</span></span><br><span class="line"><span class="meta">#</span><span class="bash">failed状态的盘可以下线，然后用MegaCli -pdmarkmissing -physdrv[E0:S0] -a0让磁盘踢盘，让其他的UNCONF状态的磁盘来替代这个盘MegaCli -PdReplaceMissing -physdrv[E0:S0] -arrayA, -rowB -a0</span></span><br><span class="line">MegaCli -PDOffline -PhysDrv[E0:S0,E1:S1,...] –a0 </span><br><span class="line"><span class="meta">#</span><span class="bash">此时磁盘处于Spun down状态，如果用此磁盘来建立raid，则磁盘的状态自动变成Spun Up</span></span><br><span class="line">MegaCli -PdPrpRmv -physdrv[E0:S0] –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">清除单个磁盘</span></span><br><span class="line">MegaCli -pdclear -start -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置热备盘的节电策略</span></span><br><span class="line">MegaCli -AdpSetProp –DsblSpinDownHSP -val –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置空闲盘的节电策略</span></span><br><span class="line">MegaCli -AdpSetProp –EnblSpinDownUnConfigDrvs -val –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">获取所有磁盘的详细信息</span></span><br><span class="line">MegaCli -PDList –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">获取单个盘的详细信息</span></span><br><span class="line">MegaCli -pdInfo -PhysDrv[E0:S0] –a0</span><br></pre></td></tr></table></figure>
<h2 id="Adpsetprop-设置属性"><a href="#Adpsetprop-设置属性" class="headerlink" title="Adpsetprop 设置属性"></a>Adpsetprop 设置属性</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RebuildRate ，PatrolReadRate，BgiRate，CCRate，ReconRate，表示进行重建，巡读，后台初始化，cc校验，扩容等所占有的系统资源率，提高速度</span><br><span class="line">CoercionMode(强制模式)，分成三种形式，None，128M，1G，当为1G时，每个磁盘比没有设置的时减少了1G的空间;</span><br><span class="line">PredFailPollInterval，轮询预测失败的时间间隔。Predictive Failure Count就是smart错误;</span><br><span class="line">MaintainPdFailHistoryEnbl 保存坏盘的历史记录。当为enable时，当一个盘掉线并重新上线。需要清除配置信息，添加为热备盘才可以重建当为disable时。当一个盘掉线并重新上线，自动重建;</span><br><span class="line"><span class="meta">#</span><span class="bash">设置Cluster模式，目前不支持，只能设置为disbale</span></span><br><span class="line">MegaCli -AdpSetProp ClusterEnable -0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置jbod模式，针对raid0有效，对单个盘读写，即先写第一个盘，写满了在写第二个盘。MegaCli -PDMakeJBOD -physdrv[E0:S0,E1:S1] -a0 可以设置jbod模式(目前不支持)</span></span><br><span class="line">MegaCli -AdpSetProp -EnableJBOD -1 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">让设备驱动暴露enclosure devices</span></span><br><span class="line">MegaCli -AdpSetProp ExposeEnclDevicesEnbl -1 -a0</span><br></pre></td></tr></table></figure>
<h2 id="NCQ"><a href="#NCQ" class="headerlink" title="NCQ"></a>NCQ</h2><p>Native Command Queuing (NCQ)对硬盘的读写命令的顺序进行优化。带 NCQ 技术的硬盘在接到读写指令后，会根据指令对访问地址进行重新排序。比如根据指令，硬盘需要访问 330 扇区、980 扇区、340 扇区，由于数据在磁盘上分布位置不同，普通硬盘只会按部就班地依次访问。而 NCQ 硬盘对指令进行优化排列之后，就可以先读取 330 扇区，接着读取 340 扇区，然后再读取 980 扇区。这样做的好处就是减少了磁头臂来回移动的时间，使数据读取更有效，同时有效地延长了硬盘的使用寿命。<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">显示NCQ的设置情况</span></span><br><span class="line">MegaCli -adpgetprop -NCQdsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置开启NCQ</span></span><br><span class="line">MegaCli -adpsetprop -NCQenbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">关闭NCQ</span></span><br><span class="line">MegaCli -adpsetprop -NCQdsbl -a0</span><br></pre></td></tr></table></figure></p>
<h2 id="添加和移除热备盘"><a href="#添加和移除热备盘" class="headerlink" title="添加和移除热备盘"></a>添加和移除热备盘</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">添加局部热备盘，其中array0表示第0个raid</span></span><br><span class="line">MegaCli -PDHSP -Set -Dedicated -Array0 -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">添加全局热备盘</span></span><br><span class="line">MegaCli -pdhsp -set -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">移除全局和热备局部热备</span></span><br><span class="line">MegaCli -pdhsp -rmv -physdrv[E:S] -a0</span><br></pre></td></tr></table></figure>
<h2 id="重建"><a href="#重建" class="headerlink" title="重建"></a>重建</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看重建的进度</span></span><br><span class="line">MegaCli -PDRbld -progdsply -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">调快重建的速度</span></span><br><span class="line">MegaCli -AdpSetProp RebuildRate -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置自动重建，当一个盘坏掉时，热备盘可以自动重建，代替坏的盘</span></span><br><span class="line">MegaCli -AdpAutoRbld -Enbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">手动开始重建，E0:S0表示坏的盘</span></span><br><span class="line">MegaCli -PDRbld -Start -PhysDrv [E0:S0] -a0</span><br></pre></td></tr></table></figure>
<h2 id="恢复出厂设置"><a href="#恢复出厂设置" class="headerlink" title="恢复出厂设置"></a>恢复出厂设置</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">恢复出厂的默认配置</span></span><br><span class="line">MegaCli -AdpFacDefSet –a0</span><br></pre></td></tr></table></figure>
<h2 id="告警"><a href="#告警" class="headerlink" title="告警"></a>告警</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">临时关闭，重启又变成开启</span></span><br><span class="line">MegaCli -AdpSetProp -AlarmSilence –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">永久关闭，重启后还是关闭</span></span><br><span class="line">MegaCli -AdpSetProp -AlarmDsbl –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">开启</span></span><br><span class="line">MegaCli -AdpSetProp -Alarmenbl –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看告警的状态</span></span><br><span class="line">MegaCli -AdpgetProp -Alarmdsply –a0</span><br></pre></td></tr></table></figure>
<h2 id="配置相关"><a href="#配置相关" class="headerlink" title="配置相关"></a>配置相关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">可以查看一组磁盘上的多个raid的配置</span></span><br><span class="line">MegaCli -CfgDsply -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">保存配置文件</span></span><br><span class="line">MegaCli -CfgSave -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">导入配置文件，Raid组的配置文件放在最后，放在每个磁盘的最后512M，主要包含数据从哪里开始写的配置和用来Migration 的swap文件</span></span><br><span class="line">MegaCli -CfgRestore -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">启动时恢复外来配置</span></span><br><span class="line">MegaCli -AdpSetProp -AutoEnhancedImportEnbl -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">验证配置文件和文件的内容</span></span><br><span class="line">MegaCli -AdpSetVerify -f fileName -a0</span><br></pre></td></tr></table></figure>
<h2 id="RAID-卡相关"><a href="#RAID-卡相关" class="headerlink" title="RAID 卡相关"></a>RAID 卡相关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看raid的配置信息</span></span><br><span class="line">MegaCli -adpallinfo -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">关闭raid卡</span></span><br><span class="line">MegaCli -adpShutDown -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">获取raid的时间</span></span><br><span class="line">MegaCli -adpGetTime -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">对raid进行诊断</span></span><br><span class="line">MegaCli -AdpDiag val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置负载均衡，Raid卡对终端设备采用多路径访问，一半的设备通过一条路径，另一半的设备通过另一条路径，一条途径有盘插入和移除时，启动负载平衡，避免设备有重用</span></span><br><span class="line">MegaCli -AdpSetProp –LoadBalanceMode -val –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">获取raid卡的个数</span></span><br><span class="line">MegaCli –adpCount</span><br><span class="line"><span class="meta">#</span><span class="bash">获取pci信息</span></span><br><span class="line">MegaCli -AdpGetPciInfo -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">Raid卡的在线重置，fw重置raid卡控制器芯片</span></span><br><span class="line">MegaCli -AdpSetProp DisableOCR -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">显示raid卡，系统等的一些简单信息</span></span><br><span class="line">MegaCli -ShowSummary -f filename -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">显示每个phy的错误数</span></span><br><span class="line">MegaCli -PhyErrorCounters -a0</span><br></pre></td></tr></table></figure>
<h2 id="Enclosure-的信息"><a href="#Enclosure-的信息" class="headerlink" title="Enclosure 的信息"></a>Enclosure 的信息</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看机柜的相关信息</span></span><br><span class="line">MegaCli -encinfo -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">查看机柜的状态</span></span><br><span class="line">MegaCli -encstatus -a0</span><br></pre></td></tr></table></figure>
<h2 id="BIOS-相关"><a href="#BIOS-相关" class="headerlink" title="BIOS 相关"></a>BIOS 相关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在启动时要按任意键才可以启动这种情况设置这个参数。但是首先要确保 bios 处于 <span class="built_in">enable</span> 状态。通过 MegaCli -AdpBIOS -dsply -a0可以查看。如果不是，先用MegaCli -AdpBIOS -enbl -a0来设置</span></span><br><span class="line">MegaCli –AdpBIOS –BE –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">把当前的Raid组作为启动</span></span><br><span class="line">MegaCli –AdpBootDrive -set -L0 -a0</span><br></pre></td></tr></table></figure>
<h2 id="背板相关"><a href="#背板相关" class="headerlink" title="背板相关"></a>背板相关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">如果背板 <span class="built_in">disable</span> 时，会自动的去检测背板</span></span><br><span class="line">MegaCli -AdpSetProp -AutoDetectBackPlaneDsbl -val –a0</span><br></pre></td></tr></table></figure>
<h2 id="启动时上电"><a href="#启动时上电" class="headerlink" title="启动时上电"></a>启动时上电</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设置一次上电的磁盘的个数</span></span><br><span class="line">MegaCli -AdpSetProp SpinupDriveCount -val -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置上电的延迟时间</span></span><br><span class="line">MegaCli -AdpSetProp SpinupDelay -val -a0</span><br></pre></td></tr></table></figure>
<h2 id="刷新缓存"><a href="#刷新缓存" class="headerlink" title="刷新缓存"></a>刷新缓存</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">刷新raid卡缓存</span></span><br><span class="line">MegaCli -AdpCacheFlush –a0</span><br><span class="line"><span class="meta">#</span><span class="bash">刷缓存的时间间隔</span></span><br><span class="line">MegaCli -AdpSetProp CacheFlushInterval –val –a0</span><br></pre></td></tr></table></figure>
<h2 id="让硬盘-LED-灯闪烁"><a href="#让硬盘-LED-灯闪烁" class="headerlink" title="让硬盘 LED 灯闪烁"></a>让硬盘 LED 灯闪烁</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">开启blink</span></span><br><span class="line">MegaCli -AdpSetProp UseDiskActivityforLocate -1 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">让硬盘LED灯闪烁</span></span><br><span class="line">MegaCli -PdLocate -start –physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">停掉硬盘LED灯</span></span><br><span class="line">MegaCli -PdLocate -stopt –physdrv[E:S] -a0</span><br></pre></td></tr></table></figure>
<h2 id="电池告警"><a href="#电池告警" class="headerlink" title="电池告警"></a>电池告警</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpSetProp BatWarnDsbl -val -a0</span><br></pre></td></tr></table></figure>
<h2 id="纠错码相关"><a href="#纠错码相关" class="headerlink" title="纠错码相关"></a>纠错码相关</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设置纠错码漏桶的字节数</span></span><br><span class="line">MegaCli -AdpSetProp EccBucketSize -val -a0</span><br></pre></td></tr></table></figure>
<h2 id="后台初始化，完全初始化，cc-校验，巡读等之间的关系"><a href="#后台初始化，完全初始化，cc-校验，巡读等之间的关系" class="headerlink" title="后台初始化，完全初始化，cc 校验，巡读等之间的关系"></a>后台初始化，完全初始化，cc 校验，巡读等之间的关系</h2><p>后台初始化和完全初始化，cc 校验时不能进行巡读;<br>巡读时可以后台初始化和完全初始化，此时巡读结束;;<br>在后台初始化和 cc 校验时，不能开始完全初始化;<br>扩容时不能建 raid，不能添加热备盘;<br>rebuild 的优先级高于 copyback;</p>
<h2 id="RAID-的创建与删除"><a href="#RAID-的创建与删除" class="headerlink" title="RAID 的创建与删除"></a>RAID 的创建与删除</h2><ul>
<li>创建 raid 0，1，5，6</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">MegaCli -CfgLdAdd -rX[E0:S0,E1:S1,...] [WT|WB] [NORA|RA|ADRA] [Direct|Cached] [CachedBadBBU|NoCachedBadBBU] [-szXXX [-szYYY ...]] [-strpszM] [-Hsp[E0:S0,...]] [-AfterLdX] [-Force]|[FDE|CtrlBased] -a0 可以设置写模式(wt，wb)，读模式(ra，nora，adra)，缓存模式(direct，cached)，大小(sz)，条块大小(strpszM)等。比如1000G，只用指定盘的一部分(sz1000G)，设置条块的大小strpsz(设置为16k，则为strpsz16)</span></span><br><span class="line">MegaCli -cfgldadd -r5[117:1,117:3,117:11] -wb -ra -cached -cachedbadbbu -force -a0</span><br></pre></td></tr></table></figure>
<ul>
<li>创建 raid 10，50，60</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">MegaCli -CfgSpanAdd -rX-Array0[E0:S0,E1:S1] -Array1[E0:S0,E1:S1] [-ArrayX[E0:S0,E1:S1] ...] [WT|WB] [NORA|RA|ADRA] [Direct|Cached] [CachedBadBBU| NoCachedBadBBU] [-szXXX[-szYYY ...]][-strpszM][-AfterLdX][-Force] |[FDE|CtrlBased] -aN</span></span><br><span class="line">MegaCli -CfgSpanAdd -r10 -Array0[245:0,245:1] Array1[245:2,245:3] -WB -RA -Cached -Cachedbadbbu -a0</span><br></pre></td></tr></table></figure>
<ul>
<li>批量创建 raid0</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">把每个槽位的磁盘都创建为只有一个盘的raid0</span></span><br><span class="line">MegaCli -CfgEachDskRaid0 -wb -ra -cached -cachedbadbbu -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">把所有的空闲盘都加入到raid中</span></span><br><span class="line">MegaCli -CfgAllFreeDrv -r5 -SATAOnly -wb -ra -cached -cachedbadbbu -a0</span><br></pre></td></tr></table></figure>
<ul>
<li>删除 raid 组</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">清除所有的raid组的配置</span></span><br><span class="line">MegaCli -cfgclr -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">删除指定的raid组(Target Id: 0)的raid组</span></span><br><span class="line">MegaCli -cfglddel -L0 -a0</span><br></pre></td></tr></table></figure>
<h2 id="设置-RAID-组的属性"><a href="#设置-RAID-组的属性" class="headerlink" title="设置 RAID 组的属性"></a>设置 RAID 组的属性</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">设置raid组的名字</span></span><br><span class="line">MegaCli -ldsetprop -name dg -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置访问策略为读写，MegaCli -ldsetprop -blocked -L0 -a0设置访问策略为阻塞，此时raid组的设备不可以访问，fdisk -l不能发现设备</span></span><br><span class="line">MegaCli -ldsetprop -rw -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置写策略为wt(直写)，直接写入到硬盘上，然后再返回。wb模式是写入到缓存中就返回，设置wb模式写速度有显著的改善，提高到12倍</span></span><br><span class="line">MegaCli -ldsetprop -wt -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">设置读策略为ra(预先读出一定的数据)，还有nora模式，ra模式读可以提高到2倍左右</span></span><br><span class="line">MegaCli -ldsetprop -ra -L0 -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash">设置缓存策略为cached</span></span><br><span class="line">MegaCli -ldsetprop -cached -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash">开启磁盘的缓存，对写速度有一定的提高(1.4倍)</span></span><br><span class="line">MegaCli -ldsetprop -endskcache -L0 -a0</span><br></pre></td></tr></table></figure>
<h2 id="查询篇"><a href="#查询篇" class="headerlink" title="查询篇"></a>查询篇</h2><ul>
<li><p>显示 BBU 状态信息    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuStatus –aALL </span><br><span class="line">``` </span><br><span class="line">- 显示 BBU 容量信息    </span><br><span class="line">```shell</span><br><span class="line">MegaCli -AdpBbuCmd -GetBbuCapacityInfo –aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示 BBU 设计参数    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuDesignInfo –aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示当前 BBU 属性   </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuProperties –aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看充电状态    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuStatus -aALL |grep "Charger Status"</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看充电进度百分比     </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpBbuCmd -GetBbuStatus -aALL |grep "Relative State of Charge"</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看所有物理磁盘信息     </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDList -aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示所有逻辑磁盘组信息     </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDInfo -LALL –aAll</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看物理磁盘重建进度(重要)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDRbld -ShowProg -PhysDrv [1:5] -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看适配器个数    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli –adpCount</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看适配器时间     </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpGetTime –aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示所有适配器信息    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpAllInfo –aAll</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示 RAID 卡型号，RAID 设置，Disk 相关信息      </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -cfgdsply –aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询 RAID 阵列个数    </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -cfgdsply -aALL |grep "Number of DISK GROUPS:"</span><br><span class="line">``` </span><br><span class="line">- 查看 Cache 策略设置    </span><br><span class="line">```shell</span><br><span class="line">MegaCli -cfgdsply -aALL |grep Polic</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看磁盘缓存策略 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> L----&gt;[VD num or ALL] a----&gt;[Adapter num or ALL]</span></span><br><span class="line">MegaCli -LDGetProp -Cache -L0 -a0</span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">MegaCli -LDGetProp -DskCache -LALL -aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看物理磁盘重建进度</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDRbld -ShowProg -PhysDrv [1:5] -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看 Megacli 的 log</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -FwTermLog dsply -a0 &gt; adp2.log</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="设置篇"><a href="#设置篇" class="headerlink" title="设置篇"></a>设置篇</h2><h3 id="创建-删除阵列"><a href="#创建-删除阵列" class="headerlink" title="创建/删除阵列"></a>创建/删除阵列</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个 RAID5 阵列，由物理盘 2,3,4 构成，该阵列的热备盘是物理盘 5 </span></span><br><span class="line">MegaCli -CfgLdAdd -r5 [1:2,1:3,1:4] WB Direct -Hsp[1:5] –a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建阵列，不指定热备 </span></span><br><span class="line">MegaCli -CfgLdAdd -r5 [1:2,1:3,1:4] WB Direct –a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除阵列 </span></span><br><span class="line">MegaCli -CfgLdDel -L1 –a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 在线添加磁盘 </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重建逻辑磁盘组 1 , RAID 级别是5，添加物理磁盘号 1:4。</span></span><br><span class="line">MegaCli -LDRecon -Start -r5 -Add -PhysDrv[1:4] -L1 -a0</span><br></pre></td></tr></table></figure>
<p><strong>注：</strong>重建完后，新添加的物理磁盘会自动处于重建(同步)状态，这个时候 <code>fdisk -l</code>是看不到阵列的空间变大的，只有在系统重启后才能看见。 </p>
<h3 id="查看阵列初始化信息"><a href="#查看阵列初始化信息" class="headerlink" title="查看阵列初始化信息"></a>查看阵列初始化信息</h3><ul>
<li><p>阵列创建完后，会有一个初始化同步块的过程，可以查看其进度。 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDInit -ShowProg -LALL -aALL </span><br><span class="line"><span class="meta">#</span><span class="bash"> or 以动态可视化文字界面显示 </span></span><br><span class="line">MegaCli -LDInit -ProgDsply -LALL –aALL</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看阵列后台初始化进度</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDBI -ShowProg -LALL -aALL </span><br><span class="line"><span class="meta">#</span><span class="bash"> or 以动态可视化文字界面显示 </span></span><br><span class="line">MegaCli -LDBI -ProgDsply -LALL -aALL</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="设置磁盘缓存策略"><a href="#设置磁盘缓存策略" class="headerlink" title="设置磁盘缓存策略"></a>设置磁盘缓存策略</h3><p>缓存策略解释：</p>
<table>
<thead>
<tr>
<th style="text-align:left">代码</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">WT</td>
<td style="text-align:left">(Write through)</td>
</tr>
<tr>
<td style="text-align:left">WB</td>
<td style="text-align:left">(Write back)</td>
</tr>
<tr>
<td style="text-align:left">NORA</td>
<td style="text-align:left">(No read ahead)</td>
</tr>
<tr>
<td style="text-align:left">RA</td>
<td style="text-align:left">(Read ahead)</td>
</tr>
<tr>
<td style="text-align:left">ADRA</td>
<td style="text-align:left">(Adaptive read ahead)</td>
</tr>
<tr>
<td style="text-align:left">Cached</td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left">Direct</td>
<td style="text-align:left">-</td>
</tr>
</tbody>
</table>
<p>eg：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDSetProp WT|WB|NORA|RA|ADRA -L0 -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">MegaCli -LDSetProp -Cached|-Direct -L0 -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> or </span></span><br><span class="line">- enable / disable disk cache </span><br><span class="line">MegaCli -LDSetProp -EnDskCache|-DisDskCache -L0 -a0</span><br></pre></td></tr></table></figure>
<h3 id="热备管理"><a href="#热备管理" class="headerlink" title="热备管理"></a>热备管理</h3><ul>
<li>创建热备</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> [1:5]----&gt;[E:S]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定第 5 块盘作为全局热备</span></span><br><span class="line">MegaCli -PDHSP -Set [-EnclAffinity] [-nonRevertible] -PhysDrv[1:5] -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> eg：</span></span><br><span class="line">MegaCli -PDHSP   -Set   -Dedicated  -Array0  -physdrv[E:S] -a0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 为某个阵列指定专用热备 </span></span><br><span class="line">MegaCli -PDHSP -Set [-Dedicated [-Array1]] [-EnclAffinity] [-nonRevertible] -PhysDrv[1:5] -a0</span><br></pre></td></tr></table></figure>
<ul>
<li>删除热备</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDHSP -rmv -PhysDrv[1:5] -a0</span><br></pre></td></tr></table></figure>
<ul>
<li>将某块物理盘下线/上线 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下线</span></span><br><span class="line">MegaCli -PDOffline -PhysDrv [1:4] -a0 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 上线</span></span><br><span class="line">MegaCli -PDOnline -PhysDrv [1:4] -a0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注：</strong>如果直接删除 RAID 而不操作热备，其局部热备会变为全局热备，而不是删除。</p>
<h2 id="管理篇"><a href="#管理篇" class="headerlink" title="管理篇"></a>管理篇</h2><ul>
<li><p>点亮指定硬盘（定位）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PdLocate -start -physdrv[252:2] -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看 RAID 阵列中掉线的盘</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -pdgetmissing -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>替换坏掉的模块</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -pdreplacemissing -physdrv[12:10] -Array5 -row0 -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>手动开启 rebuid</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -pdrbld -start -physdrv[12:10] -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看 Megacli 的 log</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -FwTermLog dsply -a0 &gt; adp2.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭 Rebuild</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpAutoRbld -Dsbl -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置 rebuild 的速率</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -AdpSetProp RebuildRate -30 -a0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="foreign-管理"><a href="#foreign-管理" class="headerlink" title="foreign 管理"></a>foreign 管理</h3><p>创建 RAID 前, 需要检测是否具有<code>foreign</code>配置, 如果有但此时不需要保留 RAID 时需要清除 RAID 的 <code>foreign</code>状态。</p>
<ul>
<li><p>检测是否具有 <code>foreign</code> 配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDlist -aALL | grep "Foreign State"</span><br></pre></td></tr></table></figure>
</li>
<li><p>将标注为 <code>Foreign</code> 磁盘标注为<code>unconfigrue good</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -PDMakeGood -PhysDrv[32:5] -a0</span><br></pre></td></tr></table></figure>
</li>
<li><p>清除 <code>foreign</code> 配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -CfgForeign -Scan -a0</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>注</strong>：一般以上两条都要执行才能清除 <code>foreign</code> 状态</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>磁盘状态 State<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">("Failed", "Online, Spun Up", "Online, Spun Down", "Unconfigured(bad)", "Unconfigured(good), Spun down", "Hotspare, Spun down", "Hotspare, Spun up" or "not Online")</span><br></pre></td></tr></table></figure></p>
<h2 id="Unsolved"><a href="#Unsolved" class="headerlink" title="Unsolved"></a>Unsolved</h2><ul>
<li>扩展 RAID（加盘）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">MegaCli -LDRecon -Start -r1 -Add -PhysDrv[252:1] -L1 -a0                                     </span><br><span class="line"><span class="meta">#</span><span class="bash"> 报错</span></span><br><span class="line">Failed to Start Reconstruction of Virtual Drive.</span><br><span class="line"></span><br><span class="line">FW error description: </span><br><span class="line"> The requested command has invalid arguments.  </span><br><span class="line"></span><br><span class="line">Exit Code: 0x03</span><br></pre></td></tr></table></figure>
<p><a href="http://en.community.dell.com/support-forums/servers/f/956/t/19531272" target="_blank" rel="noopener">参见这里 1</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://www.broadcom.com/site-search?q=megacli" target="_blank" rel="noopener">官方资源下载-broadcom</a></li>
<li><a href="https://techedemic.com/2014/08/07/dell-perclsi-megacli-how-to-install/" target="_blank" rel="noopener">Dell – PERC/LSI MegaCLI – How to install</a></li>
<li><a href="https://hwraid.le-vert.net/wiki/LSIMegaRAIDSAS#a3.1.megactl" target="_blank" rel="noopener">LSIMegaRAIDSAS</a></li>
<li><a href="http://zh.community.dell.com/techcenter/b/weblog/archive/2013/03/07/megacli-command-share" target="_blank" rel="noopener">DELL 磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总</a></li>
<li><a href="http://blog.csdn.net/heart_2011/article/details/7254404" target="_blank" rel="noopener">MegaCli 命令总结 - CSDN 博客</a></li>
<li><a href="http://www.ha97.com/4073.html" target="_blank" rel="noopener">Linux 下查看 Raid 磁盘阵列信息的方法</a></li>
<li><a href="http://www.mamicode.com/info-detail-860128.html" target="_blank" rel="noopener">Megacli 常用命令</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        
        
        <div class="vcomment"></div>
        
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="https://blog.masantu.com">博客</a></li>
         
          <li><a href="https://resume.masantu.com">简历</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#巡读"><span class="toc-number">1.</span> <span class="toc-text">巡读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cc-校验"><span class="toc-number">2.</span> <span class="toc-text">cc 校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快速初始化和完全初始化"><span class="toc-number">3.</span> <span class="toc-text">快速初始化和完全初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后台初始化"><span class="toc-number">4.</span> <span class="toc-text">后台初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#copyback"><span class="toc-number">5.</span> <span class="toc-text">copyback</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志"><span class="toc-number">6.</span> <span class="toc-text">日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#raid5-扩容"><span class="toc-number">7.</span> <span class="toc-text">raid5 扩容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#级别迁移"><span class="toc-number">8.</span> <span class="toc-text">级别迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#升级-ROM"><span class="toc-number">9.</span> <span class="toc-text">升级 ROM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接方式"><span class="toc-number">10.</span> <span class="toc-text">连接方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#外来配置"><span class="toc-number">11.</span> <span class="toc-text">外来配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#物理磁盘的处理"><span class="toc-number">12.</span> <span class="toc-text">物理磁盘的处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Adpsetprop-设置属性"><span class="toc-number">13.</span> <span class="toc-text">Adpsetprop 设置属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCQ"><span class="toc-number">14.</span> <span class="toc-text">NCQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加和移除热备盘"><span class="toc-number">15.</span> <span class="toc-text">添加和移除热备盘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#重建"><span class="toc-number">16.</span> <span class="toc-text">重建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#恢复出厂设置"><span class="toc-number">17.</span> <span class="toc-text">恢复出厂设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#告警"><span class="toc-number">18.</span> <span class="toc-text">告警</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置相关"><span class="toc-number">19.</span> <span class="toc-text">配置相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAID-卡相关"><span class="toc-number">20.</span> <span class="toc-text">RAID 卡相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enclosure-的信息"><span class="toc-number">21.</span> <span class="toc-text">Enclosure 的信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BIOS-相关"><span class="toc-number">22.</span> <span class="toc-text">BIOS 相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#背板相关"><span class="toc-number">23.</span> <span class="toc-text">背板相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动时上电"><span class="toc-number">24.</span> <span class="toc-text">启动时上电</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#刷新缓存"><span class="toc-number">25.</span> <span class="toc-text">刷新缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#让硬盘-LED-灯闪烁"><span class="toc-number">26.</span> <span class="toc-text">让硬盘 LED 灯闪烁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#电池告警"><span class="toc-number">27.</span> <span class="toc-text">电池告警</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#纠错码相关"><span class="toc-number">28.</span> <span class="toc-text">纠错码相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后台初始化，完全初始化，cc-校验，巡读等之间的关系"><span class="toc-number">29.</span> <span class="toc-text">后台初始化，完全初始化，cc 校验，巡读等之间的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAID-的创建与删除"><span class="toc-number">30.</span> <span class="toc-text">RAID 的创建与删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置-RAID-组的属性"><span class="toc-number">31.</span> <span class="toc-text">设置 RAID 组的属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询篇"><span class="toc-number">32.</span> <span class="toc-text">查询篇</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#设置篇"><span class="toc-number">33.</span> <span class="toc-text">设置篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建-删除阵列"><span class="toc-number">33.1.</span> <span class="toc-text">创建/删除阵列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看阵列初始化信息"><span class="toc-number">33.2.</span> <span class="toc-text">查看阵列初始化信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置磁盘缓存策略"><span class="toc-number">33.3.</span> <span class="toc-text">设置磁盘缓存策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#热备管理"><span class="toc-number">33.4.</span> <span class="toc-text">热备管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#管理篇"><span class="toc-number">34.</span> <span class="toc-text">管理篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#foreign-管理"><span class="toc-number">34.1.</span> <span class="toc-text">foreign 管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他"><span class="toc-number">35.</span> <span class="toc-text">其他</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsolved"><span class="toc-number">36.</span> <span class="toc-text">Unsolved</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">37.</span> <span class="toc-text">参考资料</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&text=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&is_video=false&description=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总&body=Check out this article: https://imoyao.github.io/blog/2017-11-20/megacli-command-share/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&title=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://imoyao.github.io/blog/2017-11-20/megacli-command-share/&name=磁盘阵列控制卡（RAID 卡）MegaCli 常用管理命令汇总&description=&lt;p&gt;进行存储开发时需要创建磁盘阵列，本文主要记录 RAID 卡管理工具&lt;code&gt;MegaCli&lt;/code&gt;的使用。需要注意的是，目前该管理工具因为商业收购已经被官方“弃坑”，&lt;code&gt;StorCLI&lt;/code&gt;作为后继者整合了&lt;code&gt;LSI&lt;/code&gt;和原来&lt;code&gt;3ware&lt;/code&gt;的产品支持，兼容&lt;code&gt;MegaCLI&lt;/code&gt;命令的同时更加简洁，参阅&lt;a href=&#34;https://imoyao.github.io/blog/2017-12-27/storcli_command_share/&#34;&gt;此篇&lt;/a&gt;。&lt;br&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 - 2019 IMOYAO
    Theme by <a href="https://github.com/probberechts/hexo-theme-cactus">Cactus</a>.
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="https://blog.masantu.com">博客</a></li>
         
          <li><a href="https://resume.masantu.com">简历</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

        <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

  <script src="/lib/clipboard/clipboard.min.js"></script>
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?231bfe4abce99ac3586b516eef2ea05e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


<!-- Valine Comments -->

<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<script type="text/javascript">
    var notify = 'false' == true ? true : false;
    var verify = 'false' == true ? true : false;
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
      return GUEST_INFO.indexOf(item) > -1
    });
    guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "tVPRVDtsAXHH6pVaD2ymi5CY-MdYXbMMI",
        appKey: "CARePe7R247vdXACFg1fhk4E",
        avatar:"monsterid",
        placeholder: "我们期待理性、友好而和谐的声音……",
        guest_info:guest_info,
        pageSize:"10"
    })
</script>

    </div>
</body>
</html>
