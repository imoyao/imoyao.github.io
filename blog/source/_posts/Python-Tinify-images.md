---
title: ä½¿ç”¨ Python å‹ç¼©å›¾ç‰‡(å€ŸåŠ© TinyPng çš„æ¥å£)
date: 2020-01-12 11:03:14
tags:
- Python
- å‹ç¼©å›¾ç‰‡
- TODO
---
## ç¼˜èµ·
    pass

## ä½¿ç”¨è¯´æ˜
é¦–å…ˆå»å®˜ç½‘ç”³è¯·åˆ° key ğŸ‘‰[tinypng](https://tinypng.com/developers)ã€‚ç„¶åè¿è¡Œè„šæœ¬ã€‚â€¦â€¦
TODO
### ä¾èµ–
pass

## æ€è·¯

### key
åœ¨æ‰§è¡Œå‰ç›´æ¥é…ç½®ï¼šç¨‹åºè‡ªåŠ¨è·å–ï¼ˆç¯å¢ƒå˜é‡ã€æ–‡ä»¶ã€ä»£ç ä¸­ï¼‰ï¼›å¦‚æœè·å–å¤±è´¥åˆ™æç¤ºé…ç½®ï¼Œè®¾ç½® key æˆåŠŸï¼Œä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œä¸‹ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œç›´æ¥åœ¨æ–‡ä»¶ä¸­ç›´æ¥è¯»å–ï¼›

### å‹ç¼©å¤„ç†

1. å¦‚æœæ²¡æœ‰ç»™å‡ºå‚æ•°ï¼Œåˆ™é€’å½’å‹ç¼©å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åˆ°`tiny`ç›®å½•ï¼›
2. å¦‚æœç»™å‡ºå‚æ•°å¹¶ä¸”æ˜¯æ–‡ä»¶ï¼Œåˆ™å‹ç¼©å•ä¸ªæ–‡ä»¶
    1. å¦‚æœæ²¡æœ‰é¢å¤–å‚æ•°ï¼Œåˆ™å‹ç¼©è¯¥æ–‡ä»¶å¹¶ä¿å­˜åˆ° tiny ç›®å½•ï¼›
    2. å¦‚æœç»™å‡ºçš„é¢å¤–å‚æ•°æ˜¯ -d xxxï¼Œåˆ™ä¿å­˜åˆ°ç”¨æˆ·æŒ‡å®šçš„ç›®å½•ï¼ˆç›®å½•å¯ä»¥æ˜¯ç›¸å¯¹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼‰ï¼›
    3. å¦‚æœç»™å‡ºçš„å‚æ•°æ˜¯ -f  xxxï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™å‹ç¼©æˆåŒå+'_tinified'ï¼›å¦‚æœä¸ä¸ºç©ºä¸”æœ‰åç¼€ï¼Œåˆ™éªŒè¯åç¼€ç›¸åŒå†å‹ç¼©ï¼Œå¦åˆ™ raiseï¼›å¦‚æœæ²¡æœ‰åç¼€ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦åŒåï¼Œä¸åŒååˆ™å‹ç¼©ä¹‹åå‘½åæ–°åç§°æ–‡ä»¶ï¼Œå¦åˆ™è¦†ç›–æç¤ºï¼›
3. å¦‚æœç»™å‡ºå‚æ•°[æºç›®å½• ç›®çš„ç›®å½•]ï¼Œåˆ™å°†æ–‡ä»¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•ï¼›

## å‚æ•°
- ä¸å¸¦å‚æ•°
    é€’å½’å‹ç¼©å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å›¾ç‰‡ï¼Œå¹¶ä¿å­˜åˆ° tiny ç›®å½•
    ```bash
    python shrink_img.py
    ```
- `--key/-k`
 ä»å®˜ç½‘ç”³è¯·çš„ `key`ï¼Œæä¾›ä¸‰ç§æ–¹å¼å¯¼å…¥ä½¿ç”¨ï¼š
     1. ä»£ç ä¸­ç›´æ¥å¡«å……ï¼›
     2. æ‰§è¡Œå‰ï¼Œå‘½ä»¤è¡Œå¯¼å…¥ç¯å¢ƒå˜é‡ï¼›
         ```bash
         export TINY_KEY='{{YOU GET FROM tinypng.com }}'
         ```
     3. å†™è¿›é…ç½®æ–‡ä»¶`tiny.key`ï¼›
         ```bash
         echo '{{YOU GET FROM tinypng.com }}' > tiny.key
         ```
     4. æ‰§è¡Œæ—¶ï¼Œæ­é…`--key`æŒ‡å®šï¼›å¦‚æœæ²¡æœ‰ç»™å‡ºï¼Œåˆ™è¦æ±‚ç”¨æˆ·è¾“å…¥ï¼›
     
- `--file/-f`
    æŒ‡å®šå›¾ç‰‡åç§°ï¼Œå¿…é¡»åŒ…å«æ–‡ä»¶å…¨åï¼ˆå³åŒ…å«åç¼€åï¼‰ã€‚å¦‚æœä¸å¸¦é¢å¤–å‚æ•°ï¼Œåˆ™è¡¨ç¤ºä¿å­˜åˆ°å½“å‰ç›®å½•ä¸‹ï¼›å¦åˆ™ï¼Œä¸ºç”¨æˆ·æŒ‡å®šç›®å½•ä¸‹æ–‡ä»¶ã€‚
    æ­é…ä»¥ä¸‹æŒ‡ä»¤ä½¿ç”¨ã€‚
    - `--fcover/-c`
        ä»¥è¦†ç›–å½¢å¼å‹ç¼©ï¼Œå³ç›´æ¥å°†å‹ç¼©åæ–‡ä»¶ä¿å­˜ä¸ºè¢«å‹ç¼©æ–‡ä»¶çš„ä½ç½®ï¼ˆä¸”åŒåï¼‰ï¼›
        
    - `--save/-s`
        å¯é€‰å‚æ•°ï¼Œç¼ºçœæ—¶ä¸º**å½“å‰æ‰§è¡Œç›®å½•**ä¸‹çš„`tiny`ç›®å½•ï¼›ç»™å®šå‚æ•°æ—¶ï¼Œä¸ºæŒ‡å®šä¿å­˜çš„ç›®å½•ï¼›
- `--dir/-d`  
    æŒ‡å®šå‹ç¼©çš„ç›®å½•ã€‚ç¼ºçœæ—¶ä¸º**å½“å‰æ‰§è¡Œç›®å½•**ä¸‹çš„`tiny`ç›®å½•ï¼Œå¯é€‰æŒ‡å®šç›®å½•åç§°ï¼›
    
    å¯é€‰æ­é…ä»¥ä¸‹å‚æ•°ä½¿ç”¨:
    - `--recurse|--not-recurse/-r|-nr`
        é€’å½’å¼å‹ç¼©æŒ‡å®šç›®å½•ã€‚å¦‚æœä½¿ç”¨`--recurse/-r`åˆ™é€’å½’å‹ç¼©æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰å±‚çº§ä¸‹çš„å›¾ç‰‡æ–‡ä»¶ï¼›å¦‚æœä½¿ç”¨`--not-recurse/-nr`è¡¨ç¤ºåªå‹ç¼©è¯¥å±‚çº§ç›®å½•ï¼›
    - `--save/-s`
        å¯é€‰å‚æ•°ï¼Œå¯ä»¥é€‰æ‹©æ­é…`--recurse`ä½¿ç”¨ã€‚ç¼ºçœæ—¶ä¸º**å½“å‰æ‰§è¡Œç›®å½•**ä¸‹çš„`tiny`ç›®å½•ï¼ˆå³å’Œé»˜è®¤ä¸æŒ‡å®šç›®å½•åç§°æ•ˆæœç›¸åŒï¼‰ï¼›ç»™å®šå‚æ•°æ—¶ï¼Œä¸ºæŒ‡å®šä¿å­˜çš„ç›®å½•ï¼›
         
- resize
    åªæ”¯æŒå•æ–‡ä»¶ resize,æ ¹æ®å®˜ç½‘ APIï¼Œç›®å‰æ”¯æŒ`--scale/--fit/--cover/--thumb`å‚æ•°ï¼ŒæŒ‡å®šè¯¥å‚æ•°ä¸­çš„å…¶ä¸€æ—¶ï¼Œè¡¨ç¤º resize çš„æ–‡ä»¶åç§°ï¼Œåé¢è·Ÿ*file name å’Œ width å’Œ/æˆ– height*ï¼›
    1. å…¶ä¸­æŒ‡å®šä¸º`--scale`æ—¶ï¼Œ**å¿…é¡»**--width æˆ–è€…--heightï¼›
        ```bash
        --scale FILENAME --width INT
        --scale FILENAME --height INT
        ```
    2. å…¶ä½™å‚æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–‡ä»¶åï¼Œå‰©ä½™ä¸¤ä¸ªå‚æ•°**ä¾æ¬¡**ä¸º*width å’Œ height*ï¼Œä¸éœ€è¦æ˜¾å¼æŒ‡å®š`--width`å’Œ`--height`ï¼›
        ```bash
        --[fit,cover,thumb] FILENAME INT INT
        ```  
 
## æŠ¥é”™è®°å½•
- TypeError: It would appear that nargs is set to conflict with the composite type arity.

å‚è€ƒ [here](https://stackoverflow.com/questions/40794429/typeerror-it-would-appear-that-nargs-is-set-to-conflict-with-the-composite-type)å’Œ [github issue](https://github.com/pallets/click/issues/472)  
> Click does not have a way currently to define default values for nargs > 1 when different types are used. A workaround is to set default=(None, None) for instance.
ä¹Ÿå°±æ˜¯è¯´ä½ å¿…é¡»ç»™ tuple ä¸€ä¸ªé»˜è®¤å€¼ä¸º None çš„ç­‰é•¿å…ƒç¥–ï¼›
```python
import click
@click.option('--baz', '-b',
              default=[None] * 6,
              type=click.Tuple([str, str, str, str, str, str]),help='bar')
def foo(baz):
    pass
```

## TODO
- [ ] ç»„è£…ä¿¡æ¯å¹¶è¿”å›ç»™ç”¨æˆ·å±•ç¤ºå‡ºæ¥ï¼›
- [ ] é€’å½’å‹ç¼©ç›®å½•ä¸‹æ–‡ä»¶å¥½åƒæœ‰é—®é¢˜ï¼›
- [ ] ä¸è¦å†™æ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ ini/conf é…ç½®ï¼›
- [ ] resize æ²¡æœ‰æµ‹è¯•ï¼›

æºç ä¸­çš„ click ä½¿ç”¨ Google å¼€æºåº“ [Python Fire](https://github.com/google/python-fire)

## å‚è€ƒæ–‡æ¡£
- [æ¬¢è¿æŸ¥é˜… Click ä¸­æ–‡æ–‡æ¡£ â€” click](https://click-docs-zh-cn.readthedocs.io/zh/latest/)

## æ›´å¤š

- [å›¾ç‰‡æ— æŸå‹ç¼©å·¥å…·éƒ½æœ‰å“ªäº›ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/19779256)
---
{% blockquote è§ä¼¯çº³ %}
æ˜ç™½äº‹ç†çš„äººä½¿è‡ªå·±é€‚åº”ä¸–ç•Œï¼›ä¸æ˜äº‹ç†çš„äººæƒ³ä½¿ä¸–ç•Œé€‚åº”è‡ªå·±ã€‚æ‰€ä»¥ï¼Œæ‰€æœ‰è¿›æ­¥éƒ½è¦é ä¸æ˜äº‹ç†çš„äººã€‚
{% endblockquote %}